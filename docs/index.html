<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<meta name="author" content="本資料は、(株)日本取引所グループがデータサイエンスに興味のある個人向けに提供する、ITやデータ分析を活用した取引の学習を目的とした、ハンズオン形式のチュートリアルです。">
<title>株式分析チュートリアル | 日本取引所グループ</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:'Hiragino Sans',sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-weight:bold}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:"Courier New",monospace;}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
/* fix serif; body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased} */
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:'Hiragino Sans',"Noto Serif","DejaVu Serif";font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.7;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-weight:bold}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:'Hiragino Sans',"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#2d466b;text-rendering:optimizeLegibility;margin-top:1.5em;margin-bottom:1.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-weight:bold;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Courier New",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Courier New",monospace;font-size:16px;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Courier New",monospace;display:inline-block;color:rgba(0,0,0,.8);line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-weight:bold}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#2d466b;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#2d466b;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:2em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:'Hiragino Sans',"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-weight:normal}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-top:3em;margin-bottom:3em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#2d466b;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.listingblock{margin: 2em 0}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:2.25em 1em 2.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
/* fix font style; .quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-weight:bold;text-align:justify} */
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1em;line-height:1.75;word-spacing:.1em;letter-spacing:0;}
.quoteblock blockquote{margin:0;padding:0;border:0;background-color:#fff;}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#2d466b;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-weight:normal}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate;margin: 2em 0;}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock{margin: 2em 0}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock{margin: 2em 0}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>株式分析チュートリアル | 日本取引所グループ</h1>
<div class="details">
<span id="author" class="author">本資料は、(株)日本取引所グループがデータサイエンスに興味のある個人向けに提供する、ITやデータ分析を活用した取引の学習を目的とした、ハンズオン形式のチュートリアルです。</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">目次</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. はじめに</a></li>
<li><a href="#_財務諸表で株価の先行きを予測しよう">2. 財務諸表で株価の先行きを予測しよう</a>
<ul class="sectlevel2">
<li><a href="#_予測対象">2.1. 予測対象</a></li>
<li><a href="#_データセットの説明">2.2. データセットの説明</a></li>
<li><a href="#_実行環境及び必要なライブラリ">2.3. 実行環境及び必要なライブラリ</a></li>
<li><a href="#_データセットの読み込み">2.4. データセットの読み込み</a></li>
<li><a href="#_データセットの可視化">2.5. データセットの可視化</a></li>
<li><a href="#_データセットの前処理">2.6. データセットの前処理</a></li>
<li><a href="#anchor-2.7">2.7. 特徴量の生成</a></li>
<li><a href="#_バックテスト用のテストデータ作成">2.8. バックテスト用のテストデータ作成</a></li>
<li><a href="#_モデルの構築">2.9. モデルの構築</a></li>
<li><a href="#_モデルの推論">2.10. モデルの推論</a></li>
<li><a href="#_予測結果に対する分析の道筋">2.11. 予測結果に対する分析の道筋</a></li>
<li><a href="#_モデルの評価">2.12. モデルの評価</a></li>
<li><a href="#_モデルの提出">2.13. モデルの提出</a></li>
</ul>
</li>
<li><a href="#_ポートフォリオを構築しよう">3. ポートフォリオを構築しよう</a>
<ul class="sectlevel2">
<li><a href="#_ニュース分析チャレンジのチュートリアルの構成">3.1. 「ニュース分析チャレンジ」のチュートリアルの構成</a></li>
<li><a href="#_ニュース分析チャレンジについて">3.2. 「ニュース分析チャレンジ」について</a></li>
<li><a href="#_予測対象_2">3.3. 予測対象</a></li>
<li><a href="#anchor-3.4">3.4. データセットの説明</a></li>
<li><a href="#_環境構築">3.5. 環境構築</a></li>
<li><a href="#anchor-3.6">3.6. バックテスト環境の構築</a></li>
<li><a href="#_シンプルなポートフォリオ組成モデルの作成">3.7. シンプルなポートフォリオ組成モデルの作成</a></li>
<li><a href="#_投稿用パッケージの作成">3.8. 投稿用パッケージの作成</a></li>
</ul>
</li>
<li><a href="#_ファンダメンタルズ分析チャレンジで作成したモデルを使用してポートフォリオを構築しよう">4. 「ファンダメンタルズ分析チャレンジ」で作成したモデルを使用してポートフォリオを構築しよう</a>
<ul class="sectlevel2">
<li><a href="#_環境設定">4.1. 環境設定</a></li>
<li><a href="#_必要なライブラリの読み込み_2">4.2. 必要なライブラリの読み込み</a></li>
<li><a href="#_データセット及び2章のモデル準備">4.3. データセット及び2章のモデル準備</a></li>
<li><a href="#_2章で作成した_predictor_py_の変更">4.4. 2章で作成した <code>predictor.py</code> の変更</a></li>
<li><a href="#_バックテスト">4.5. バックテスト</a></li>
<li><a href="#_適時開示情報を使用して特別損失銘柄を除外">4.6. 適時開示情報を使用して特別損失銘柄を除外</a></li>
<li><a href="#_投稿用パッケージの作成_2">4.7. 投稿用パッケージの作成</a></li>
</ul>
</li>
<li><a href="#_ニュースデータから特徴量を抽出しよう">5. ニュースデータから特徴量を抽出しよう</a>
<ul class="sectlevel2">
<li><a href="#_テキストからの特徴量抽出方法の紹介">5.1. テキストからの特徴量抽出方法の紹介</a></li>
<li><a href="#anchor-5.2">5.2. 実行環境</a></li>
<li><a href="#anchor-5.2.6">5.3. テキスト解析について</a></li>
<li><a href="#_ニュースデータ処理の流れ">5.4. ニュースデータ処理の流れ</a></li>
<li><a href="#_利用するテキストデータについて">5.5. 利用するテキストデータについて</a></li>
<li><a href="#_データセットの前処理_2">5.6. データセットの前処理</a></li>
<li><a href="#_テキストデータの可視化">5.7. テキストデータの可視化</a></li>
<li><a href="#_特徴量抽出機前処理機の定義">5.8. 特徴量抽出機、前処理機の定義</a></li>
</ul>
</li>
<li><a href="#_bert特徴量を用いてポートフォリオを構築しよう">6. BERT特徴量を用いてポートフォリオを構築しよう</a>
<ul class="sectlevel2">
<li><a href="#_予測対象の検討">6.1. 予測対象の検討</a></li>
<li><a href="#_lstmによる可変特徴量の統合処理">6.2. LSTMによる可変特徴量の統合処理</a></li>
<li><a href="#_合成特徴量の解析">6.3. 合成特徴量の解析</a></li>
<li><a href="#_結果の可視化">6.4. 結果の可視化</a></li>
<li><a href="#_ストラテジーへの適用の実装例">6.5. ストラテジーへの適用の実装例</a></li>
<li><a href="#_投稿用コードの実装例">6.6. 投稿用コードの実装例</a></li>
</ul>
</li>
<li><a href="#_tips集">7. tips集</a>
<ul class="sectlevel2">
<li><a href="#_コンペティションフォーラムの紹介">7.1. コンペティションフォーラムの紹介</a></li>
<li><a href="#_金融用語集">7.2. 金融用語集</a></li>
<li><a href="#_東証マネ部">7.3. 東証マネ部</a></li>
<li><a href="#_参考になる書籍">7.4. 参考になる書籍</a></li>
<li><a href="#_参考になるコンペティション">7.5. 参考になるコンペティション</a></li>
<li><a href="#_ファンダメンタルズ分析の活用方法">7.6. ファンダメンタルズ分析の活用方法</a></li>
<li><a href="#_テクニカル分析の活用方法">7.7. テクニカル分析の活用方法</a></li>
<li><a href="#_ファクター分析の活用方法">7.8. ファクター分析の活用方法</a></li>
<li><a href="#_複数個のモデルの出力をアンサンブルするアプローチ">7.9. 複数個のモデルの出力をアンサンブルするアプローチ</a></li>
<li><a href="#_プライベート期間の性能の向上のために考慮すべきこと">7.10. プライベート期間の性能の向上のために考慮すべきこと</a></li>
<li><a href="#_本コンペでは利用できないがモデルを将来的に発展させるために検討する価値のある外部データ">7.11. 本コンペでは利用できないが、モデルを将来的に発展させるために検討する価値のある外部データ</a></li>
<li><a href="#_モデルの再学習の運用について">7.12. モデルの再学習の運用について</a></li>
<li><a href="#_google_colaboratoryの使用法">7.13. Google Colaboratoryの使用法</a></li>
<li><a href="#_内国株の売買制度">7.14. 内国株の売買制度</a></li>
<li><a href="#_バックテスト用ライブラリ">7.15. バックテスト用ライブラリ</a></li>
</ul>
</li>
<li><a href="#_j_quantsapi">8. J-QuantsAPI</a>
<ul class="sectlevel2">
<li><a href="#_概要">8.1. 概要</a></li>
<li><a href="#_apiの利用">8.2. APIの利用</a></li>
<li><a href="#_必要なパッケージのインポート">8.3. 必要なパッケージのインポート</a></li>
<li><a href="#_refresh_api">8.4. Refresh API</a></li>
<li><a href="#_共通で使用するメソッド">8.5. 共通で使用するメソッド</a></li>
<li><a href="#_stock_lists_api">8.6. Stock Lists API</a></li>
<li><a href="#_prices_api">8.7. Prices API</a></li>
<li><a href="#_stock_fins_api">8.8. Stock Fins API</a></li>
<li><a href="#_stock_labels_api">8.9. Stock Labels API</a></li>
<li><a href="#_news_api">8.10. News API</a></li>
<li><a href="#_tdnet_api">8.11. TDnet API</a></li>
</ul>
</li>
<li><a href="#_チュートリアル作成環境の参考文献">9. チュートリアル作成環境の参考文献</a>
<ul class="sectlevel2">
<li><a href="#_商標">9.1. 商標</a></li>
</ul>
</li>
<li><a href="#_ライセンス">10. ライセンス</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>本&#8203;​&#8203;チュー&#8203;​&#8203;ト&#8203;​&#8203;リ&#8203;​&#8203;ア&#8203;​&#8203;ル&#8203;​&#8203;に&#8203;​&#8203;関&#8203;​&#8203;し&#8203;​&#8203;て&#8203;​&#8203;の&#8203;​&#8203;ご&#8203;​&#8203;質&#8203;​&#8203;問&#8203;​&#8203;は、&#8203;​SIGNATE​&#8203;に&#8203;​&#8203;て&#8203;​&#8203;開&#8203;​&#8203;催&#8203;​&#8203;中&#8203;​&#8203;の&#8203;​&#8203;コ&#8203;​&#8203;ン&#8203;​&#8203;ペ&#8203;​&#8203;ティ&#8203;​&#8203;ショ&#8203;​&#8203;ン&#8203;​&#8203;サ&#8203;​&#8203;イ&#8203;​&#8203;ト&#8203;​( <a href="https://signate.jp/competitions/443" class="bare">https://signate.jp/competitions/443</a> )​&#8203;の&#8203;​&#8203;フォー&#8203;​&#8203;ラ&#8203;​&#8203;ム&#8203;​&#8203;に&#8203;​&#8203;お&#8203;​&#8203;き&#8203;​&#8203;ま&#8203;​&#8203;し&#8203;​&#8203;て、&#8203;新&#8203;規&#8203;の&#8203;ス&#8203;レッ&#8203;ド&#8203;（ディ&#8203;ス&#8203;カッ&#8203;ショ&#8203;ン）&#8203;に&#8203;て&#8203;​&#8203;ご&#8203;​&#8203;質&#8203;​&#8203;問&#8203;​&#8203;し&#8203;​&#8203;て&#8203;​&#8203;い&#8203;​&#8203;た&#8203;​&#8203;だ&#8203;​&#8203;け&#8203;​&#8203;ま&#8203;​&#8203;す&#8203;​&#8203;と&#8203;​&#8203;幸&#8203;​&#8203;い&#8203;​&#8203;で&#8203;​&#8203;す。</p>
</div>
<div class="paragraph">
<p>ま&#8203;た、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;に&#8203;関&#8203;し&#8203;て&#8203;の&#8203;ご&#8203;要&#8203;望&#8203;が&#8203;あ&#8203;れ&#8203;ば、&#8203;Github&#8203;リ&#8203;ポ&#8203;ジ&#8203;ト&#8203;リ&#8203;( <a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial" class="bare">https://github.com/JapanExchangeGroup/J-Quants-Tutorial</a> )&#8203;の&#8203; <code>Issues</code> &#8203;か&#8203;ら&#8203;ご&#8203;意&#8203;見&#8203;を&#8203;い&#8203;た&#8203;だ&#8203;け&#8203;ま&#8203;す&#8203;と&#8203;幸&#8203;い&#8203;で&#8203;す。&#8203; (&#8203;な&#8203;お、&#8203;投&#8203;稿&#8203;の&#8203;際&#8203;に&#8203;は、&#8203;過&#8203;去&#8203;に&#8203;同&#8203;じ&#8203;ご&#8203;要&#8203;望&#8203;が&#8203;な&#8203;い&#8203;か&#8203;ご&#8203;確&#8203;認&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;)</p>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>更&#8203;新&#8203;履&#8203;歴</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>2021-01-29: 初版リリース
2021-02-05: 誤字や表記の修正を中心に改良
2021-02-12: ランタイム環境のデータの扱い、GoogleColaboratoryについて追記
2021-02-19: predictor.pyの修正、stocklabelsAPIの修正
2021-02-26: 予測対象のエッジケースにおいて追記
2021-03-19: 問題２のチュートリアルを追加
2021-03-29: 問題２のチュートリアルを一部修正
2021-04-09: backtest.pyの修正（株式分割の対応）
2021-04-16: ３章の加筆</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">1. はじめに</h2>
<div class="sectionbody">
<div class="paragraph">
<p>証&#8203;券&#8203;市&#8203;場&#8203;で&#8203;は、&#8203;長&#8203;年、&#8203;様々&#8203;な&#8203;デー&#8203;タ&#8203;や&#8203;数&#8203;学&#8203;的&#8203;手&#8203;法&#8203;を&#8203;用&#8203;い&#8203;て&#8203;市&#8203;場&#8203;を&#8203;分&#8203;析&#8203;し&#8203;た&#8203;り、&#8203;金&#8203;融&#8203;商&#8203;品&#8203;の&#8203;組&#8203;成&#8203;や&#8203;投&#8203;資&#8203;戦&#8203;略&#8203;の&#8203;立&#8203;案&#8203;が&#8203;行&#8203;わ&#8203;れ&#8203;た&#8203;り&#8203;し&#8203;て&#8203;き&#8203;ま&#8203;し&#8203;た。&#8203;以&#8203;前&#8203;は&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;分&#8203;析&#8203;を&#8203;行&#8203;う&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る&#8203;の&#8203;は、&#8203;金&#8203;融&#8203;機&#8203;関&#8203;や&#8203;機&#8203;関&#8203;投&#8203;資&#8203;家&#8203;と&#8203;呼&#8203;ば&#8203;れ&#8203;る&#8203;大&#8203;手&#8203;の&#8203;投&#8203;資&#8203;家&#8203;に&#8203;限&#8203;ら&#8203;れ&#8203;て&#8203;き&#8203;ま&#8203;し&#8203;た。&#8203;し&#8203;か&#8203;し&#8203;近&#8203;年&#8203;で&#8203;は、&#8203;個&#8203;人&#8203;の&#8203;方&#8203;に&#8203;も、&#8203;IT&#8203;や&#8203;デー&#8203;タ&#8203;を&#8203;活&#8203;用&#8203;し&#8203;た&#8203;金&#8203;融&#8203;市&#8203;場&#8203;の&#8203;分&#8203;析&#8203;や&#8203;取&#8203;引&#8203;が&#8203;拡&#8203;大&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>日&#8203;本&#8203;取&#8203;引&#8203;所&#8203;グ&#8203;ルー&#8203;プ&#8203;は、&#8203;証&#8203;券&#8203;分&#8203;野&#8203;に&#8203;お&#8203;け&#8203;る&#8203;デー&#8203;タ&#8203;活&#8203;用&#8203;や&#8203;人&#8203;工&#8203;知&#8203;能&#8203;の&#8203;活&#8203;用&#8203;を&#8203;発&#8203;展&#8203;さ&#8203;せ&#8203;た&#8203;い&#8203;と&#8203;考&#8203;え&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;日&#8203;本&#8203;に&#8203;お&#8203;い&#8203;て&#8203;も&#8203;さ&#8203;ま&#8203;ざ&#8203;ま&#8203;な&#8203;デー&#8203;タ&#8203;の&#8203;活&#8203;用&#8203;や&#8203;デー&#8203;タ&#8203;サ&#8203;イ&#8203;エ&#8203;ン&#8203;ティ&#8203;ス&#8203;ト&#8203;の&#8203;育&#8203;成&#8203;が&#8203;推&#8203;進&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;金&#8203;融&#8203;分&#8203;野&#8203;に&#8203;特&#8203;化&#8203;し&#8203;た&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;作&#8203;成&#8203;や&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;は&#8203;あ&#8203;ま&#8203;り&#8203;行&#8203;わ&#8203;れ&#8203;て&#8203;き&#8203;て&#8203;い&#8203;ま&#8203;せ&#8203;ん&#8203;で&#8203;し&#8203;た。</p>
</div>
<div class="paragraph">
<p>そ&#8203;こ&#8203;で、&#8203;日&#8203;本&#8203;取&#8203;引&#8203;所&#8203;グ&#8203;ルー&#8203;プ&#8203;は、&#8203;投&#8203;資&#8203;に&#8203;ま&#8203;つ&#8203;わ&#8203;る&#8203;デー&#8203;タ・&#8203;環&#8203;境&#8203;を&#8203;提&#8203;供&#8203;し、&#8203;個&#8203;人&#8203;投&#8203;資&#8203;家&#8203;の&#8203;皆&#8203;様&#8203;に&#8203;よ&#8203;る&#8203;デー&#8203;タ&#8203;利&#8203;活&#8203;用&#8203;の&#8203;可&#8203;能&#8203;性&#8203;を&#8203;検&#8203;証&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;実&#8203;証&#8203;実&#8203;験&#8203;プ&#8203;ロ&#8203;ジェ&#8203;ク&#8203;ト&#8203;と&#8203;し&#8203;て、&#8203;J-Quants&#8203;を&#8203;立&#8203;ち&#8203;上&#8203;げ&#8203;ま&#8203;し&#8203;た。&#8203;本&#8203;プ&#8203;ロ&#8203;ジェ&#8203;ク&#8203;ト&#8203;で&#8203;は、&#8203;「ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;ズ&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ」&#8203;と&#8203;「ニュー&#8203;ス&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ」&#8203;の&#8203;2&#8203;本&#8203;の&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;開&#8203;催&#8203;を&#8203;予&#8203;定&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;本&#8203;ペー&#8203;ジ&#8203;で&#8203;は、&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;係&#8203;る&#8203;学&#8203;習&#8203;環&#8203;境&#8203;と&#8203;い&#8203;う&#8203;位&#8203;置&#8203;付&#8203;け&#8203;で、&#8203;ハ&#8203;ン&#8203;ズ&#8203;オ&#8203;ン&#8203;形&#8203;式&#8203;の&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;を&#8203;提&#8203;供&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;を&#8203;学&#8203;ぶ&#8203;こ&#8203;と&#8203;で、&#8203;デー&#8203;タ&#8203;サ&#8203;イ&#8203;エ&#8203;ン&#8203;ス&#8203;を&#8203;活&#8203;用&#8203;し&#8203;た&#8203;株&#8203;価&#8203;予&#8203;測&#8203;を&#8203;行&#8203;う&#8203;際&#8203;に、&#8203;最&#8203;低&#8203;限&#8203;必&#8203;要&#8203;な&#8203;知&#8203;識&#8203;や&#8203;実&#8203;践&#8203;方&#8203;法&#8203;を&#8203;学&#8203;ぶ&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;は&#8203;幅&#8203;広&#8203;い&#8203;方&#8203;に&#8203;ご&#8203;参&#8203;加&#8203;い&#8203;た&#8203;だ&#8203;け&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;期&#8203;待&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;プ&#8203;ロ&#8203;グ&#8203;ラ&#8203;ミ&#8203;ン&#8203;グ&#8203;の&#8203;経&#8203;験&#8203;が&#8203;あ&#8203;り&#8203;確&#8203;率・&#8203;統&#8203;計&#8203;の&#8203;基&#8203;礎&#8203;な&#8203;ど&#8203;を&#8203;勉&#8203;強&#8203;さ&#8203;れ&#8203;た&#8203;学&#8203;生&#8203;の&#8203;方&#8203;や、&#8203;他&#8203;分&#8203;野&#8203;で&#8203;の&#8203;デー&#8203;タ&#8203;分&#8203;析&#8203;経&#8203;験&#8203;を&#8203;お&#8203;持&#8203;ち&#8203;の&#8203;社&#8203;会&#8203;人&#8203;の&#8203;方、&#8203;金&#8203;融&#8203;分&#8203;野&#8203;で&#8203;の&#8203;知&#8203;見&#8203;は&#8203;あ&#8203;る&#8203;が&#8203;デー&#8203;タ&#8203;サ&#8203;イ&#8203;エ&#8203;ン&#8203;ス&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;こ&#8203;れ&#8203;か&#8203;ら&#8203;勉&#8203;強&#8203;を&#8203;さ&#8203;れ&#8203;た&#8203;い&#8203;と&#8203;考&#8203;え&#8203;て&#8203;い&#8203;る&#8203;社&#8203;会&#8203;人&#8203;の&#8203;方&#8203;に&#8203;は&#8203;特&#8203;に&#8203;楽&#8203;し&#8203;ん&#8203;で&#8203;い&#8203;た&#8203;だ&#8203;け&#8203;る&#8203;内&#8203;容&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;及&#8203;び&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;を&#8203;通&#8203;じ&#8203;て&#8203;金&#8203;融&#8203;デー&#8203;タ&#8203;や&#8203;デー&#8203;タ&#8203;分&#8203;析&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;理&#8203;解&#8203;を&#8203;深&#8203;め&#8203;て&#8203;い&#8203;た&#8203;だ&#8203;き、&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;分&#8203;析&#8203;や&#8203;資&#8203;産&#8203;運&#8203;用&#8203;に&#8203;活&#8203;用&#8203;い&#8203;た&#8203;だ&#8203;き&#8203;た&#8203;い&#8203;と&#8203;考&#8203;え&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;デー&#8203;タ&#8203;サ&#8203;イ&#8203;エ&#8203;ン&#8203;ス&#8203;を&#8203;学&#8203;ぶ&#8203;学&#8203;生&#8203;の&#8203;方々&#8203;に&#8203;とっ&#8203;て&#8203;は、&#8203;金&#8203;融&#8203;デー&#8203;タ&#8203;を&#8203;用&#8203;い&#8203;た&#8203;デー&#8203;タ&#8203;活&#8203;用&#8203;や&#8203;人&#8203;工&#8203;知&#8203;能&#8203;の&#8203;活&#8203;用&#8203;に&#8203;関&#8203;す&#8203;る&#8203;研&#8203;究&#8203;に&#8203;も&#8203;興&#8203;味&#8203;を&#8203;持っ&#8203;て&#8203;い&#8203;た&#8203;だ&#8203;き&#8203;た&#8203;い&#8203;と&#8203;考&#8203;え&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="注記"></i>
</td>
<td class="content">
本&#8203;プ&#8203;ロ&#8203;ジェ&#8203;ク&#8203;ト&#8203;の&#8203;概&#8203;要&#8203;や&#8203;ハ&#8203;ン&#8203;ズ&#8203;オ&#8203;ン&#8203;で&#8203;使&#8203;う&#8203;ソー&#8203;ス&#8203;コー&#8203;ド&#8203;類&#8203;は&#8203;以&#8203;下&#8203;の&#8203;ペー&#8203;ジ&#8203;で&#8203;公&#8203;開&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。
</td>
</tr>
</table>
</div>
<table class="tableblock frame-ends grid-none stripes-even stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">プ&#8203;ロ&#8203;ジェ&#8203;ク&#8203;ト&#8203;概&#8203;要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.jpx-jquants-info.com/" class="bare">https://www.jpx-jquants-info.com/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial" class="bare">https://github.com/JapanExchangeGroup/J-Quants-Tutorial</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jupyter&#8203;ノー&#8203;ト&#8203;ブッ&#8203;ク</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial/tree/main/handson/" class="bare">https://github.com/JapanExchangeGroup/J-Quants-Tutorial/tree/main/handson/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">J-QuantsAPI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://jpx-jquants.com/" class="bare">https://jpx-jquants.com/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;ズ&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://signate.jp/competitions/423" class="bare">https://signate.jp/competitions/423</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ニュー&#8203;ス&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://signate.jp/competitions/443" class="bare">https://signate.jp/competitions/443</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_財務諸表で株価の先行きを予測しよう">2. 財務諸表で株価の先行きを予測しよう</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本&#8203;章&#8203;で&#8203;は、&#8203;J-Quants&#8203;で&#8203;開&#8203;催&#8203;す&#8203;る&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;う&#8203;ち、&#8203;「ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;ズ&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ」&#8203;（https://signate.jp/competitions/423）&#8203;に&#8203;係&#8203;る&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;を&#8203;提&#8203;供&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;デー&#8203;タ&#8203;分&#8203;析&#8203;や&#8203;株&#8203;式&#8203;取&#8203;引&#8203;に&#8203;は&#8203;興&#8203;味&#8203;は&#8203;あ&#8203;る&#8203;が、&#8203;きっ&#8203;か&#8203;け&#8203;が&#8203;な&#8203;い&#8203;と&#8203;い&#8203;う&#8203;方&#8203;を&#8203;主&#8203;な&#8203;対&#8203;象&#8203;と&#8203;し&#8203;て、&#8203;投&#8203;資&#8203;に&#8203;ま&#8203;つ&#8203;わ&#8203;る&#8203;デー&#8203;タ・&#8203;環&#8203;境&#8203;を&#8203;提&#8203;供&#8203;し、&#8203;株&#8203;式&#8203;市&#8203;場&#8203;に&#8203;お&#8203;け&#8203;る&#8203;デー&#8203;タ&#8203;利&#8203;活&#8203;用&#8203;の&#8203;可&#8203;能&#8203;性&#8203;を&#8203;試&#8203;し&#8203;て&#8203;い&#8203;た&#8203;だ&#8203;く&#8203;こ&#8203;と&#8203;を&#8203;期&#8203;待&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;ス&#8203;ケ&#8203;ジュー&#8203;ル&#8203;</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;日&#8203;時&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;内&#8203;容&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021&#8203;年&#8203;1&#8203;月&#8203;29&#8203;日&#8203;（金）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;開&#8203;始</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021&#8203;年&#8203;3&#8203;月&#8203;28&#8203;日&#8203;（日）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モ&#8203;デ&#8203;ル&#8203;提&#8203;出&#8203;締&#8203;切</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021&#8203;年&#8203;3&#8203;月&#8203;29&#8203;日&#8203;（月）&#8203; 〜&#8203; 6&#8203;月&#8203;14&#8203;日&#8203;（月）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モ&#8203;デ&#8203;ル&#8203;評&#8203;価&#8203;期&#8203;間</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021&#8203;年&#8203;7&#8203;月&#8203;頃</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">入&#8203;賞&#8203;者&#8203;の&#8203;決&#8203;定</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;東&#8203;証&#8203;上&#8203;場&#8203;企&#8203;業&#8203;（普&#8203;通&#8203;株&#8203;式&#8203;の&#8203;み。&#8203;ETF&#8203;及&#8203;び&#8203;REIT&#8203;は&#8203;除&#8203;き&#8203;ま&#8203;す。）&#8203;が、&#8203;決&#8203;算&#8203;短&#8203;信&#8203;（本&#8203;資&#8203;料&#8203;で&#8203;は、&#8203;四&#8203;半&#8203;期&#8203;決&#8203;算&#8203;短&#8203;信&#8203;や&#8203;訂&#8203;正&#8203;開&#8203;示&#8203;等&#8203;を&#8203;総&#8203;称&#8203;し、&#8203;決&#8203;算&#8203;短&#8203;信&#8203;と&#8203;表&#8203;記&#8203;し&#8203;ま&#8203;す。）&#8203;を&#8203;発&#8203;表&#8203;し&#8203;た&#8203;後&#8203;の&#8203;20&#8203;営&#8203;業&#8203;日&#8203;の&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る、&#8203;当&#8203;該&#8203;企&#8203;業&#8203;の&#8203;株&#8203;価&#8203;の&#8203;最&#8203;高&#8203;値&#8203;及&#8203;び&#8203;最&#8203;安&#8203;値&#8203;を、&#8203;銘&#8203;柄&#8203;情&#8203;報・&#8203;株&#8203;価&#8203;情&#8203;報・&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;等&#8203;を&#8203;用&#8203;い&#8203;て&#8203;予&#8203;測&#8203;い&#8203;た&#8203;だ&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;概&#8203;要&#8203;</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;項&#8203;目&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;内&#8203;容&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;ズ&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">主&#8203;な&#8203;対&#8203;象&#8203;者</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">株&#8203;式&#8203;市&#8203;場&#8203;を&#8203;対&#8203;象&#8203;と&#8203;し&#8203;た&#8203;デー&#8203;タ&#8203;分&#8203;析&#8203;の&#8203;初&#8203;学&#8203;者</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">入&#8203;力&#8203;内&#8203;容&#8203;（利&#8203;用&#8203;デー&#8203;タ）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;情&#8203;報・&#8203;株&#8203;価&#8203;情&#8203;報・&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;等</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">出&#8203;力&#8203;内&#8203;容&#8203;（予&#8203;測&#8203;対&#8203;象）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各&#8203;東&#8203;証&#8203;上&#8203;場&#8203;企&#8203;業&#8203;が、&#8203;決&#8203;算&#8203;短&#8203;信&#8203;を&#8203;発&#8203;表&#8203;し&#8203;た&#8203;後&#8203;の&#8203;20&#8203;営&#8203;業&#8203;日&#8203;の&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る、&#8203;当&#8203;該&#8203;企&#8203;業&#8203;の&#8203;株&#8203;価&#8203;の&#8203;最&#8203;高&#8203;値&#8203;及&#8203;び&#8203;最&#8203;安&#8203;値</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">参&#8203;加&#8203;を&#8203;通&#8203;じ&#8203;て&#8203;得&#8203;ら&#8203;れ&#8203;る&#8203;知&#8203;見</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">- &#8203;株&#8203;価&#8203;や&#8203;企&#8203;業&#8203;業&#8203;績&#8203;の&#8203;推&#8203;移&#8203;な&#8203;ど&#8203;の&#8203;時&#8203;系&#8203;列&#8203;デー&#8203;タ&#8203;の&#8203;解&#8203;析&#8203;手&#8203;法&#8203;<br>
- &#8203;市&#8203;場&#8203;動&#8203;向&#8203;の&#8203;把&#8203;握&#8203;手&#8203;法&#8203;<br>
- &#8203;リ&#8203;ス&#8203;ク&#8203;分&#8203;析</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>本&#8203;章&#8203;の&#8203;構&#8203;成&#8203;は、&#8203;ま&#8203;ず、&#8203;2.1&#8203;節&#8203;に&#8203;て、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;お&#8203;け&#8203;る&#8203;予&#8203;測&#8203;対&#8203;象&#8203;等&#8203;の&#8203;詳&#8203;細&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し、&#8203;2.2&#8203;節&#8203;に&#8203;て、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;提&#8203;供&#8203;す&#8203;る&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;仕&#8203;様&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。&#8203;そ&#8203;し&#8203;て、&#8203;2.3&#8203;節&#8203;以&#8203;降&#8203;で、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;ベー&#8203;ス&#8203;ラ&#8203;イ&#8203;ン&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;開&#8203;発&#8203;か&#8203;ら&#8203;モ&#8203;デ&#8203;ル&#8203;提&#8203;出&#8203;ま&#8203;で&#8203;の&#8203;一&#8203;連&#8203;の&#8203;フ&#8203;ロー&#8203;を&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect2">
<h3 id="_予測対象">2.1. 予測対象</h3>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;予&#8203;測&#8203;対&#8203;象&#8203;は、&#8203;東&#8203;証&#8203;上&#8203;場&#8203;企&#8203;業&#8203;が、&#8203;決&#8203;算&#8203;短&#8203;信&#8203;を&#8203;発&#8203;表&#8203;し&#8203;た&#8203;後&#8203;の&#8203;20&#8203;営&#8203;業&#8203;日&#8203;の&#8203;期&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る、&#8203;当&#8203;該&#8203;企&#8203;業&#8203;の&#8203;株&#8203;価&#8203;の&#8203;最&#8203;高&#8203;値&#8203;及&#8203;び&#8203;最&#8203;安&#8203;値&#8203;で&#8203;す。&#8203; &#8203;上&#8203;場&#8203;企&#8203;業&#8203;は&#8203;決&#8203;算&#8203;期&#8203;末&#8203;を&#8203;含&#8203;め&#8203;四&#8203;半&#8203;期&#8203;毎&#8203;に&#8203;決&#8203;算&#8203;内&#8203;容&#8203;が&#8203;定&#8203;まっ&#8203;た&#8203;際、&#8203;決&#8203;算&#8203;内&#8203;容&#8203;の&#8203;開&#8203;示&#8203;が&#8203;義&#8203;務&#8203;付&#8203;け&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;決&#8203;算&#8203;の&#8203;内&#8203;容&#8203;と&#8203;し&#8203;て&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;る&#8203;決&#8203;算&#8203;短&#8203;信&#8203;に&#8203;は&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;が&#8203;添&#8203;付&#8203;さ&#8203;れ&#8203;て&#8203;お&#8203;り、&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;は&#8203;企&#8203;業&#8203;の&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;を&#8203;含&#8203;む&#8203;複&#8203;数&#8203;の&#8203;表&#8203;で&#8203;構&#8203;成&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>2.1.1&#8203;項&#8203;で&#8203;は&#8203;予&#8203;測&#8203;対&#8203;象&#8203;の&#8203;銘&#8203;柄&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;2.1.2&#8203;項&#8203;で&#8203;は&#8203;予&#8203;測&#8203;対&#8203;象&#8203;の&#8203;決&#8203;算&#8203;短&#8203;信&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;2.1.3&#8203;項&#8203;で&#8203;は&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;評&#8203;価&#8203;方&#8203;法&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;2.1.4&#8203;項&#8203;で&#8203;は&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;の&#8203;仕&#8203;様&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;2.1.5&#8203;項&#8203;で&#8203;は&#8203;決&#8203;算&#8203;短&#8203;信&#8203;と&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;の&#8203;概&#8203;要&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_予測対象の銘柄">2.1.1. 予測対象の銘柄</h4>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;予&#8203;測&#8203;対&#8203;象&#8203;と&#8203;な&#8203;る&#8203;銘&#8203;柄&#8203;は、&#8203;次&#8203;に&#8203;挙&#8203;げ&#8203;る&#8203;条&#8203;件&#8203;を&#8203;全&#8203;て&#8203;満&#8203;た&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>A)	2020&#8203;年&#8203;12&#8203;月&#8203;末&#8203;日&#8203;時&#8203;点&#8203;で、&#8203;東&#8203;京&#8203;証&#8203;券&#8203;取&#8203;引&#8203;所&#8203;に&#8203;上&#8203;場&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と</p>
</div>
<div class="paragraph">
<p>B)	&#8203;普&#8203;通&#8203;株&#8203;式&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;（種&#8203;類&#8203;株&#8203;で&#8203;は&#8203;な&#8203;い&#8203;こ&#8203;と）</p>
</div>
<div class="paragraph">
<p>C)	ETF、&#8203;ETN、&#8203;REIT、&#8203;優&#8203;先&#8203;出&#8203;資&#8203;証&#8203;券、&#8203;イ&#8203;ン&#8203;フ&#8203;ラ&#8203;ファ&#8203;ン&#8203;ド、&#8203;外&#8203;国&#8203;株&#8203;の&#8203;い&#8203;ず&#8203;れ&#8203;に&#8203;も&#8203;該&#8203;当&#8203;し&#8203;な&#8203;い&#8203;こ&#8203;と</p>
</div>
<div class="paragraph">
<p>D)	2020&#8203;年&#8203;12&#8203;月&#8203;末&#8203;日&#8203;時&#8203;点&#8203;で、&#8203;上&#8203;場&#8203;後&#8203;2&#8203;年&#8203;を&#8203;経&#8203;過&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と</p>
</div>
</div>
<div class="sect3">
<h4 id="_予測対象の決算短信">2.1.2. 予測対象の決算短信</h4>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;2021&#8203;年&#8203;3&#8203;月&#8203;27&#8203;日&#8203;か&#8203;ら&#8203;同&#8203;年&#8203;5&#8203;月&#8203;15&#8203;日&#8203;の&#8203;期&#8203;間&#8203;中&#8203;に&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;た&#8203;決&#8203;算&#8203;短&#8203;信&#8203;を&#8203;対&#8203;象&#8203;に、&#8203;そ&#8203;の&#8203;開&#8203;示&#8203;日&#8203;か&#8203;ら&#8203;起&#8203;算&#8203;し&#8203;て&#8203;20&#8203;営&#8203;業&#8203;日&#8203;を&#8203;経&#8203;過&#8203;し&#8203;た&#8203;期&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る、&#8203;各&#8203;銘&#8203;柄&#8203;の&#8203;最&#8203;高&#8203;値&#8203;及&#8203;び&#8203;最&#8203;安&#8203;値&#8203;を&#8203;予&#8203;測&#8203;し&#8203;ま&#8203;す。&#8203;厳&#8203;密&#8203;に&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;予&#8203;測&#8203;対&#8203;象&#8203;と&#8203;な&#8203;る&#8203;決&#8203;算&#8203;短&#8203;信&#8203;は、&#8203;次&#8203;に&#8203;挙&#8203;げ&#8203;る&#8203;条&#8203;件&#8203;を&#8203;全&#8203;て&#8203;満&#8203;た&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>A)	&#8203;直&#8203;近&#8203;の&#8203;決&#8203;算&#8203;期&#8203;末&#8203;ま&#8203;た&#8203;は&#8203;四&#8203;半&#8203;期&#8203;期&#8203;末&#8203;に&#8203;係&#8203;る&#8203;決&#8203;算&#8203;短&#8203;信&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と</p>
</div>
<div class="paragraph">
<p>B)	2021&#8203;年&#8203;3&#8203;月&#8203;27&#8203;日&#8203;か&#8203;ら&#8203;同&#8203;年&#8203;5&#8203;月&#8203;15&#8203;日&#8203;ま&#8203;で&#8203;の&#8203;期&#8203;間&#8203;に&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と</p>
</div>
<div class="paragraph">
<p>C)	&#8203;開&#8203;示&#8203;日&#8203;及&#8203;び&#8203;同&#8203;日&#8203;か&#8203;ら&#8203;起&#8203;算&#8203;し&#8203;て&#8203;20&#8203;営&#8203;業&#8203;日&#8203;を&#8203;経&#8203;過&#8203;し&#8203;た&#8203;日&#8203;ま&#8203;で&#8203;の&#8203;期&#8203;間、&#8203;訂&#8203;正&#8203;開&#8203;示&#8203;等&#8203;が&#8203;行&#8203;わ&#8203;れ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;こ&#8203;と</p>
</div>
<div class="paragraph">
<p>D)	&#8203;開&#8203;示&#8203;日&#8203;及&#8203;び&#8203;同&#8203;日&#8203;か&#8203;ら&#8203;起&#8203;算&#8203;し&#8203;て&#8203;20&#8203;営&#8203;業&#8203;日&#8203;を&#8203;経&#8203;過&#8203;し&#8203;た&#8203;日&#8203;ま&#8203;で&#8203;の&#8203;期&#8203;間、&#8203;上&#8203;場&#8203;廃&#8203;止&#8203;に&#8203;なっ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;こ&#8203;と</p>
</div>
<div class="paragraph">
<p>条&#8203;件&#8203;C&#8203;に&#8203;示&#8203;す&#8203;「訂&#8203;正&#8203;開&#8203;示&#8203;等」&#8203;と&#8203;は、&#8203;決&#8203;算&#8203;発&#8203;表&#8203;資&#8203;料&#8203;の&#8203;訂&#8203;正、&#8203;業&#8203;績&#8203;予&#8203;想&#8203;の&#8203;修&#8203;正・&#8203;予&#8203;想&#8203;値&#8203;と&#8203;決&#8203;算&#8203;値&#8203;と&#8203;の&#8203;差&#8203;異&#8203;等、&#8203;配&#8203;当&#8203;予&#8203;想・&#8203;配&#8203;当&#8203;予&#8203;想&#8203;の&#8203;修&#8203;正&#8203;に&#8203;か&#8203;か&#8203;る&#8203;開&#8203;示&#8203;を&#8203;指&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;詳&#8203;細&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;以&#8203;下&#8203;の&#8203;と&#8203;お&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>決&#8203;算&#8203;発&#8203;表&#8203;資&#8203;料&#8203;の&#8203;訂&#8203;正&#8203;<br>
&#8203;決&#8203;算&#8203;短&#8203;信&#8203;等&#8203;を&#8203;開&#8203;示&#8203;し&#8203;た&#8203;後&#8203;に、&#8203;開&#8203;示&#8203;し&#8203;た&#8203;内&#8203;容&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;変&#8203;更&#8203;又&#8203;は&#8203;訂&#8203;正&#8203;す&#8203;べ&#8203;き&#8203;事&#8203;情&#8203;が&#8203;生&#8203;じ&#8203;た&#8203;場&#8203;合&#8203;に&#8203;義&#8203;務&#8203;付&#8203;け&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;訂&#8203;正&#8203;開&#8203;示&#8203;を&#8203;い&#8203;い&#8203;ま&#8203;す。</p>
</li>
<li>
<p>業&#8203;績&#8203;予&#8203;想&#8203;の&#8203;修&#8203;正・&#8203;予&#8203;想&#8203;値&#8203;と&#8203;決&#8203;算&#8203;値&#8203;と&#8203;の&#8203;差&#8203;異&#8203;等&#8203;<br>
&#8203;売&#8203;上&#8203;高&#8203;や&#8203;営&#8203;業&#8203;利&#8203;益、&#8203;経&#8203;常&#8203;利&#8203;益、&#8203;当&#8203;期&#8203;純&#8203;利&#8203;益&#8203;等&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;公&#8203;表&#8203;が&#8203;さ&#8203;れ&#8203;た&#8203;直&#8203;近&#8203;の&#8203;予&#8203;想&#8203;値&#8203;等&#8203;と&#8203;比&#8203;較&#8203;し&#8203;て、&#8203;新&#8203;た&#8203;に&#8203;算&#8203;出&#8203;し&#8203;た&#8203;予&#8203;想&#8203;値&#8203;ま&#8203;た&#8203;は&#8203;決&#8203;算&#8203;に&#8203;お&#8203;け&#8203;る&#8203;数&#8203;値&#8203;に&#8203;一&#8203;定&#8203;以&#8203;上&#8203;の&#8203;差&#8203;異&#8203;が&#8203;生&#8203;じ&#8203;た&#8203;場&#8203;合&#8203;に&#8203;義&#8203;務&#8203;付&#8203;け&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;開&#8203;示&#8203;を&#8203;い&#8203;い&#8203;ま&#8203;す。</p>
</li>
<li>
<p>配&#8203;当&#8203;予&#8203;想・&#8203;配&#8203;当&#8203;予&#8203;想&#8203;の&#8203;修&#8203;正&#8203;<br>
&#8203;公&#8203;表&#8203;が&#8203;さ&#8203;れ&#8203;た&#8203;直&#8203;近&#8203;の&#8203;配&#8203;当&#8203;の&#8203;予&#8203;想&#8203;値&#8203;と&#8203;比&#8203;較&#8203;し&#8203;て、&#8203;新&#8203;た&#8203;に&#8203;算&#8203;出&#8203;し&#8203;た&#8203;予&#8203;想&#8203;値&#8203;に&#8203;差&#8203;異&#8203;が&#8203;生&#8203;じ&#8203;た&#8203;場&#8203;合&#8203;を&#8203;含&#8203;め、&#8203;剰&#8203;余&#8203;金&#8203;の&#8203;配&#8203;当&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;予&#8203;想&#8203;値&#8203;を&#8203;算&#8203;出&#8203;し&#8203;た&#8203;場&#8203;合&#8203;に&#8203;義&#8203;務&#8203;付&#8203;け&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;開&#8203;示&#8203;を&#8203;い&#8203;い&#8203;ま&#8203;す。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ま&#8203;た、&#8203;上&#8203;記&#8203;の&#8203;決&#8203;算&#8203;短&#8203;信&#8203;の&#8203;訂&#8203;正&#8203;開&#8203;示&#8203;等&#8203;が、&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;（stock_fin）&#8203;の&#8203;変&#8203;更&#8203;を&#8203;伴&#8203;い、&#8203;か&#8203;つ、&#8203;次&#8203;に&#8203;挙&#8203;げ&#8203;る&#8203;条&#8203;件&#8203;を&#8203;全&#8203;て&#8203;満&#8203;た&#8203;す&#8203;場&#8203;合、&#8203;こ&#8203;れ&#8203;も&#8203;予&#8203;測&#8203;対&#8203;象&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><span class="line-through">E)&#8203;直&#8203;近&#8203;の&#8203;決&#8203;算&#8203;期&#8203;末&#8203;ま&#8203;た&#8203;は&#8203;四&#8203;半&#8203;期&#8203;期&#8203;末&#8203;に&#8203;係&#8203;る&#8203;決&#8203;算&#8203;短&#8203;信&#8203;に&#8203;対&#8203;す&#8203;る&#8203;訂&#8203;正&#8203;開&#8203;示&#8203;等&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;</span></p>
</div>
<div class="paragraph">
<p>F)	2021&#8203;年&#8203;3&#8203;月&#8203;27&#8203;日&#8203;か&#8203;ら&#8203;同&#8203;年&#8203;5&#8203;月&#8203;15&#8203;日&#8203;ま&#8203;で&#8203;の&#8203;期&#8203;間&#8203;に&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と</p>
</div>
<div class="paragraph">
<p>G)	&#8203;訂&#8203;正&#8203;開&#8203;示&#8203;等&#8203;の&#8203;開&#8203;示&#8203;日&#8203;及&#8203;び&#8203;同&#8203;日&#8203;か&#8203;ら&#8203;起&#8203;算&#8203;し&#8203;て&#8203;20&#8203;営&#8203;業&#8203;日&#8203;を&#8203;経&#8203;過&#8203;し&#8203;た&#8203;日&#8203;ま&#8203;で&#8203;の&#8203;期&#8203;間、&#8203;当&#8203;該&#8203;開&#8203;示&#8203;に&#8203;対&#8203;す&#8203;る&#8203;訂&#8203;正&#8203;開&#8203;示&#8203;等&#8203;が&#8203;行&#8203;わ&#8203;れ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;こ&#8203;と</p>
</div>
<div class="paragraph">
<p>H)	&#8203;訂&#8203;正&#8203;開&#8203;示&#8203;等&#8203;の&#8203;開&#8203;示&#8203;日&#8203;及&#8203;び&#8203;同&#8203;日&#8203;か&#8203;ら&#8203;起&#8203;算&#8203;し&#8203;て&#8203;20&#8203;営&#8203;業&#8203;日&#8203;を&#8203;経&#8203;過&#8203;し&#8203;た&#8203;日&#8203;ま&#8203;で&#8203;の&#8203;期&#8203;間、&#8203;上&#8203;場&#8203;廃&#8203;止&#8203;に&#8203;なっ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;こ&#8203;と</p>
</div>
<div class="paragraph">
<p>な&#8203;お、&#8203;あ&#8203;る&#8203;同&#8203;一&#8203;銘&#8203;柄&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;条&#8203;件&#8203;を&#8203;満&#8203;た&#8203;す&#8203;決&#8203;算&#8203;短&#8203;信&#8203;が&#8203;複&#8203;数&#8203;存&#8203;在&#8203;す&#8203;る&#8203;場&#8203;合&#8203;は、&#8203;最&#8203;も&#8203;新&#8203;し&#8203;く&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;た&#8203;も&#8203;の&#8203;の&#8203;み&#8203;を&#8203;予&#8203;測&#8203;の&#8203;対&#8203;象&#8203;と&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>（追&#8203;記：&#8203;予&#8203;測&#8203;対&#8203;象&#8203;期&#8203;間&#8203;の&#8203;20&#8203;営&#8203;業&#8203;日&#8203;の&#8203;全&#8203;て&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;株&#8203;価&#8203;が&#8203;存&#8203;在&#8203;し&#8203;な&#8203;い&#8203;銘&#8203;柄&#8203;は、&#8203;評&#8203;価&#8203;の&#8203;対&#8203;象&#8203;外&#8203;と&#8203;し&#8203;ま&#8203;す。）</p>
</div>
<div class="paragraph">
<p>以&#8203;上&#8203;を&#8203;踏&#8203;ま&#8203;え、&#8203;各&#8203;決&#8203;算&#8203;短&#8203;信&#8203;等&#8203;（訂&#8203;正&#8203;開&#8203;示&#8203;等&#8203;を&#8203;含&#8203;み&#8203;ま&#8203;す。）&#8203;が&#8203;予&#8203;測&#8203;対&#8203;象&#8203;に&#8203;該&#8203;当&#8203;す&#8203;る&#8203;か&#8203;ど&#8203;う&#8203;か&#8203;の&#8203;事&#8203;例&#8203;を、&#8203;図&#8203;に&#8203;示&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/predict_target.png" alt="predict_target">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_評価方法">2.1.3. 評価方法</h4>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;予&#8203;測&#8203;と&#8203;真&#8203;の&#8203;値&#8203;（決&#8203;算&#8203;短&#8203;信&#8203;の&#8203;開&#8203;示&#8203;後&#8203;か&#8203;ら&#8203;起&#8203;算&#8203;し&#8203;て&#8203;20&#8203;営&#8203;業&#8203;日&#8203;以&#8203;内&#8203;に&#8203;発&#8203;生&#8203;す&#8203;る&#8203;最&#8203;高&#8203;値&#8203;及&#8203;び&#8203;最&#8203;安&#8203;値）&#8203;と&#8203;の&#8203;順&#8203;位&#8203;相&#8203;関&#8203;係&#8203;数&#8203;（算&#8203;出&#8203;式&#8203;１）&#8203;に&#8203;よ&#8203;る&#8203;定&#8203;量&#8203;評&#8203;価&#8203;方&#8203;法&#8203;を&#8203;採&#8203;用&#8203;し&#8203;ま&#8203;す。&#8203;<br></p>
</div>
<div class="paragraph">
<p>先&#8203;ず、&#8203;最&#8203;高&#8203;値&#8203;も&#8203;し&#8203;く&#8203;は&#8203;最&#8203;安&#8203;値&#8203;へ&#8203;の&#8203;変&#8203;化&#8203;率&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;（算&#8203;出&#8203;式&#8203;１）&#8203;を&#8203;用&#8203;い&#8203;て&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;ス&#8203;ピ&#8203;ア&#8203;マ&#8203;ン&#8203;の&#8203;順&#8203;位&#8203;相&#8203;関&#8203;係&#8203;数&#8203;を&#8203;計&#8203;算&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>（算&#8203;出&#8203;式&#8203;１）&#8203;順&#8203;位&#8203;相&#8203;関&#8203;係&#8203;数&#8203;の&#8203;計&#8203;算</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/math-sample1.svg" alt="math sample1" width="170" height="57">
</div>
</div>
<div class="paragraph">
<p>d = &#8203;対&#8203;応&#8203;す&#8203;る&#8203;X&#8203;と&#8203;Y&#8203;の&#8203;値&#8203;の&#8203;順&#8203;位&#8203;の&#8203;差</p>
</div>
<div class="paragraph">
<p>n = &#8203;値&#8203;の&#8203;ペ&#8203;ア&#8203;の&#8203;数</p>
</div>
<div class="paragraph">
<p>d&#8203;の&#8203;X&#8203;と&#8203;Y&#8203;は、</p>
</div>
<div class="paragraph">
<p>X = &#8203;該&#8203;当&#8203;期&#8203;間&#8203;の&#8203;決&#8203;算&#8203;日&#8203;に&#8203;対&#8203;し&#8203;て&#8203;出&#8203;力&#8203;さ&#8203;れ&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;（予&#8203;測&#8203;値）</p>
</div>
<div class="paragraph">
<p>Y = &#8203;決&#8203;算&#8203;短&#8203;信&#8203;の&#8203;開&#8203;示&#8203;後&#8203;か&#8203;ら&#8203;起&#8203;算&#8203;し&#8203;て&#8203;20&#8203;営&#8203;業&#8203;日&#8203;以&#8203;内&#8203;に&#8203;発&#8203;生&#8203;し&#8203;た&#8203;最&#8203;高&#8203;値&#8203;も&#8203;し&#8203;く&#8203;は&#8203;最&#8203;安&#8203;値&#8203;へ&#8203;の&#8203;変&#8203;化&#8203;率</p>
</div>
</div>
</div>
<div class="paragraph">
<p>(&#8203;式&#8203;は&#8203;一&#8203;部&#8203;英&#8203;語&#8203;Wikipedia&#8203;ス&#8203;ピ&#8203;ア&#8203;マ&#8203;ン&#8203;の&#8203;順&#8203;位&#8203;相&#8203;関&#8203;係&#8203;数&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://ja.wikipedia.org/wiki/%E3%82%B9%E3%83%94%E3%82%A2%E3%83%9E%E3%83%B3%E3%81%AE%E9%A0%86%E4%BD%8D%E7%9B%B8%E9%96%A2%E4%BF%82%E6%95%B0">https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient</a>)</p>
</div>
<div class="paragraph">
<p>そ&#8203;の&#8203;上&#8203;で、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;順&#8203;位&#8203;相&#8203;関&#8203;係&#8203;数&#8203;を&#8203;以&#8203;下&#8203;の&#8203;（算&#8203;出&#8203;式&#8203;２）&#8203;を&#8203;用&#8203;い&#8203;て&#8203;算&#8203;出&#8203;し&#8203;た&#8203;統&#8203;合&#8203;ス&#8203;コ&#8203;ア&#8203;を&#8203;最&#8203;終&#8203;ス&#8203;コ&#8203;ア&#8203;と&#8203;し&#8203;て&#8203;評&#8203;価&#8203;し&#8203;ま&#8203;す。&#8203;<br>
な&#8203;お、&#8203;最&#8203;終&#8203;ス&#8203;コ&#8203;ア&#8203;は&#8203;0～8&#8203;の&#8203;値&#8203;を&#8203;と&#8203;り、&#8203;精&#8203;度&#8203;が&#8203;高&#8203;い&#8203;ほ&#8203;ど&#8203; <strong>&#8203;小&#8203;さ&#8203;な&#8203;値&#8203;</strong> &#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。
（た&#8203;だ&#8203;し、&#8203;予&#8203;測&#8203;対&#8203;象&#8203;期&#8203;間&#8203;の&#8203;20&#8203;営&#8203;業&#8203;日&#8203;の&#8203;全&#8203;て&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;株&#8203;価&#8203;が&#8203;存&#8203;在&#8203;し&#8203;な&#8203;い&#8203;銘&#8203;柄&#8203;は、&#8203;評&#8203;価&#8203;の&#8203;対&#8203;象&#8203;外&#8203;と&#8203;し&#8203;ま&#8203;す。）</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>（算&#8203;出&#8203;式&#8203;２）&#8203;最&#8203;終&#8203;ス&#8203;コ&#8203;ア&#8203;の&#8203;計&#8203;算</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/math-sample2.svg" alt="math sample2" width="291" height="33">
</div>
</div>
<div class="paragraph">
<p>P_high : &#8203;最&#8203;高&#8203;値&#8203;の&#8203;順&#8203;位&#8203;相&#8203;関&#8203;係&#8203;数</p>
</div>
<div class="paragraph">
<p>P_low : &#8203;最&#8203;安&#8203;値&#8203;の&#8203;順&#8203;位&#8203;相&#8203;関&#8203;係&#8203;数</p>
</div>
</div>
</div>
<div class="paragraph">
<p>今&#8203;回、&#8203;順&#8203;位&#8203;相&#8203;関&#8203;係&#8203;数&#8203;を&#8203;採&#8203;用&#8203;す&#8203;る&#8203;理&#8203;由&#8203;と&#8203;し&#8203;て&#8203;は、&#8203;以&#8203;下&#8203;の&#8203;説&#8203;明&#8203;に&#8203;も&#8203;あ&#8203;る&#8203;と&#8203;お&#8203;り、&#8203;金&#8203;融&#8203;商&#8203;品&#8203;の&#8203;価&#8203;格&#8203;変&#8203;動&#8203;の&#8203;変&#8203;化&#8203;率&#8203;の&#8203;分&#8203;布&#8203;は&#8203;必&#8203;ず&#8203;し&#8203;も&#8203;正&#8203;規&#8203;分&#8203;布&#8203;に&#8203;な&#8203;る&#8203;と&#8203;は&#8203;限&#8203;り&#8203;ま&#8203;せ&#8203;ん。
そ&#8203;の&#8203;た&#8203;め、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;特&#8203;定&#8203;の&#8203;分&#8203;布&#8203;を&#8203;仮&#8203;定&#8203;し&#8203;な&#8203;い&#8203;順&#8203;位&#8203;相&#8203;関&#8203;係&#8203;数&#8203;を&#8203;採&#8203;用&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>一&#8203;定&#8203;間&#8203;隔&#8203;刻&#8203;み&#8203;で&#8203;集&#8203;計&#8203;し&#8203;た&#8203;騰&#8203;落&#8203;率&#8203;の&#8203;度&#8203;数&#8203;（頻&#8203;度）&#8203;分&#8203;布&#8203;が、&#8203;騰&#8203;落&#8203;率&#8203;の&#8203;平&#8203;均&#8203;値&#8203;を&#8203;中&#8203;心&#8203;軸&#8203;と&#8203;し&#8203;て&#8203;左&#8203;右&#8203;対&#8203;称&#8203;の&#8203;釣&#8203;り&#8203;鐘&#8203;型&#8203;の&#8203;形&#8203;状&#8203;に&#8203;な&#8203;る&#8203;分&#8203;布&#8203; (&#8203;正&#8203;規&#8203;分&#8203;布&#8203;＝Normal Distribution) &#8203;で&#8203;は、&#8203;「平&#8203;均&#8203;値&#8203;±&#8203;標&#8203;準&#8203;偏&#8203;差」&#8203;の&#8203;範&#8203;囲&#8203;に&#8203;全&#8203;デー&#8203;タ&#8203;の&#8203;約&#8203;7&#8203;割&#8203;が&#8203;収&#8203;ま&#8203;る&#8203;と&#8203;い&#8203;う&#8203;確&#8203;率&#8203;的&#8203;な&#8203;特&#8203;性&#8203;を&#8203;持&#8203;ち&#8203;ま&#8203;す。&#8203;た&#8203;だ&#8203;し、&#8203;金&#8203;融&#8203;商&#8203;品&#8203;の&#8203;価&#8203;格&#8203;変&#8203;動&#8203;が&#8203;厳&#8203;密&#8203;な&#8203;意&#8203;味&#8203;で&#8203;の&#8203;正&#8203;規&#8203;分&#8203;布&#8203;に&#8203;従&#8203;う&#8203;こ&#8203;と&#8203;は&#8203;実&#8203;際&#8203;上&#8203;ほ&#8203;と&#8203;ん&#8203;ど&#8203;あ&#8203;り&#8203;ま&#8203;せ&#8203;ん。&#8203;こ&#8203;の&#8203;た&#8203;め、&#8203;「平&#8203;均&#8203;±&#8203;標&#8203;準&#8203;偏&#8203;差&#8203;の&#8203;範&#8203;囲&#8203;に&#8203;騰&#8203;落&#8203;率&#8203;の&#8203;約&#8203;7&#8203;割&#8203;が&#8203;収&#8203;ま&#8203;る」&#8203;と&#8203;い&#8203;う&#8203;考&#8203;え&#8203;方&#8203;は&#8203;理&#8203;論&#8203;的&#8203;な&#8203;目&#8203;安&#8203;に&#8203;過&#8203;ぎ&#8203;な&#8203;く、&#8203;発&#8203;生&#8203;確&#8203;率&#8203;は&#8203;低&#8203;い&#8203;も&#8203;の&#8203;の&#8203;標&#8203;準&#8203;偏&#8203;差&#8203;を&#8203;大&#8203;幅&#8203;に&#8203;超&#8203;す&#8203;価&#8203;格&#8203;変&#8203;動&#8203;も&#8203;起&#8203;こ&#8203;り&#8203;え&#8203;ま&#8203;す。&#8203;こ&#8203;う&#8203;し&#8203;た&#8203;価&#8203;格&#8203;変&#8203;動&#8203;の&#8203;リ&#8203;ス&#8203;ク&#8203;を&#8203;テー&#8203;ル&#8203;リ&#8203;ス&#8203;ク&#8203;と&#8203;呼&#8203;び、&#8203;と&#8203;く&#8203;に、&#8203;金&#8203;融&#8203;市&#8203;場&#8203;の&#8203;混&#8203;乱&#8203;期&#8203;に&#8203;は&#8203;分&#8203;布&#8203;が&#8203;マ&#8203;イ&#8203;ナ&#8203;ス&#8203;方&#8203;向&#8203;に&#8203;偏&#8203;る&#8203;ケー&#8203;ス&#8203;や、&#8203;裾&#8203;が&#8203;極&#8203;端&#8203;に&#8203;広&#8203;く&#8203;厚&#8203;い&#8203;"&#8203;ファッ&#8203;ト・&#8203;テー&#8203;ル&#8203;"&#8203;と&#8203;い&#8203;う&#8203;現&#8203;象&#8203;が&#8203;確&#8203;認&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>(&#8203;野&#8203;村&#8203;証&#8203;券&#8203;証&#8203;券&#8203;用&#8203;語&#8203;解&#8203;説&#8203;集&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.nomura.co.jp/terms/japan/hi/A02397.html" class="bare">https://www.nomura.co.jp/terms/japan/hi/A02397.html</a>)</p>
</div>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;に&#8203;お&#8203;い&#8203;て&#8203;も、&#8203;例&#8203;え&#8203;ば&#8203;新&#8203;型&#8203;コ&#8203;ロ&#8203;ナ&#8203;ウ&#8203;イ&#8203;ル&#8203;ス&#8203;感&#8203;染&#8203;症&#8203; (COVID-19)&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;外&#8203;部&#8203;影&#8203;響&#8203;を&#8203;受&#8203;け、&#8203;マー&#8203;ケッ&#8203;ト&#8203;の&#8203;変&#8203;化&#8203;率&#8203;の&#8203;分&#8203;布&#8203;が&#8203;歪&#8203;む&#8203;期&#8203;間&#8203;が&#8203;存&#8203;在&#8203;す&#8203;る&#8203;と&#8203;想&#8203;定&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;し&#8203;た&#8203;がっ&#8203;て、&#8203;順&#8203;位&#8203;相&#8203;関&#8203;係&#8203;数&#8203;は&#8203;相&#8203;関&#8203;係&#8203;数&#8203;と&#8203;比&#8203;較&#8203;し&#8203;て&#8203;特&#8203;定&#8203;の&#8203;分&#8203;布&#8203;を&#8203;仮&#8203;定&#8203;し&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;お&#8203;い&#8203;て&#8203;は、&#8203;よ&#8203;り&#8203;適&#8203;し&#8203;た&#8203;評&#8203;価&#8203;方&#8203;法&#8203;で&#8203;あ&#8203;る&#8203;と&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_リーダーボード">2.1.4. リーダーボード</h4>
<div class="paragraph">
<p>一&#8203;般&#8203;的&#8203;に、&#8203;デー&#8203;タ&#8203;分&#8203;析&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;お&#8203;け&#8203;る&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;（Leaderboard）&#8203;と&#8203;は、&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;参&#8203;加&#8203;者&#8203;の&#8203;投&#8203;稿&#8203;内&#8203;容&#8203;に&#8203;対&#8203;す&#8203;る&#8203;評&#8203;価&#8203;（ス&#8203;コ&#8203;ア、&#8203;実&#8203;行&#8203;時&#8203;間&#8203;等）&#8203;を&#8203;ラ&#8203;ン&#8203;キ&#8203;ン&#8203;グ&#8203;形&#8203;式&#8203;で&#8203;並&#8203;べ&#8203;る&#8203;表&#8203;を&#8203;意&#8203;味&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;提&#8203;供&#8203;す&#8203;る&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;は、&#8203;パ&#8203;ブ&#8203;リッ&#8203;ク&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;（以&#8203;下、&#8203;Public LB）&#8203;と&#8203;プ&#8203;ラ&#8203;イ&#8203;ベー&#8203;ト&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;（以&#8203;下、&#8203;Private LB）&#8203;の&#8203;2&#8203;つ&#8203;で&#8203;構&#8203;成&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;以&#8203;下&#8203;で&#8203;は、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;の&#8203;仕&#8203;様&#8203;等&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>ま&#8203;ず、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Public LB&#8203;は、&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;開&#8203;催&#8203;日&#8203;よ&#8203;り&#8203;過&#8203;去&#8203;の&#8203;期&#8203;間&#8203;を&#8203;対&#8203;象&#8203;と&#8203;し&#8203;て&#8203;評&#8203;価&#8203;を&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。&#8203;具&#8203;体&#8203;的&#8203;に&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Public LB&#8203;で&#8203;は、&#8203;2020&#8203;年&#8203;1&#8203;月&#8203;1&#8203;日&#8203;（水）〜&#8203;2020&#8203;年&#8203;11&#8203;月&#8203;30&#8203;日&#8203;（月）&#8203;の&#8203;期&#8203;間&#8203;中&#8203;に&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;た&#8203;決&#8203;算&#8203;短&#8203;信&#8203;等&#8203;を&#8203;対&#8203;象&#8203;に、&#8203;開&#8203;示&#8203;日&#8203;よ&#8203;り&#8203;起&#8203;算&#8203;し&#8203;て&#8203;20&#8203;営&#8203;業&#8203;日&#8203;を&#8203;経&#8203;過&#8203;し&#8203;た&#8203;期&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る&#8203;最&#8203;高&#8203;値&#8203;及&#8203;び&#8203;最&#8203;安&#8203;値&#8203;を&#8203;予&#8203;測&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>過&#8203;去&#8203;の&#8203;各&#8203;銘&#8203;柄&#8203;の&#8203;株&#8203;価&#8203;は、&#8203;各&#8203;Web&#8203;サ&#8203;イ&#8203;ト&#8203;等&#8203;で&#8203;取&#8203;得&#8203;可&#8203;能&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Public LB&#8203;で&#8203;は&#8203;チー&#8203;ティ&#8203;ン&#8203;グ&#8203;が&#8203;容&#8203;易&#8203;と&#8203;い&#8203;う&#8203;特&#8203;徴&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Public LB&#8203;は、&#8203;他&#8203;の&#8203;一&#8203;般&#8203;的&#8203;な&#8203;Public LB&#8203;と&#8203;は&#8203;異&#8203;な&#8203;り、&#8203;ス&#8203;コ&#8203;ア&#8203;や&#8203;実&#8203;行&#8203;時&#8203;間&#8203;を&#8203;競&#8203;う&#8203;と&#8203;い&#8203;う&#8203;よ&#8203;り&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;正&#8203;常&#8203;に&#8203;投&#8203;稿&#8203;で&#8203;き&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;環&#8203;境&#8203;と&#8203;し&#8203;て&#8203;位&#8203;置&#8203;付&#8203;け&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>次&#8203;に、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Private LB&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;提&#8203;出&#8203;締&#8203;切&#8203;日&#8203;よ&#8203;り&#8203;も&#8203;将&#8203;来&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;Private LB&#8203;を&#8203;出&#8203;力&#8203;し&#8203;ま&#8203;す。&#8203;具&#8203;体&#8203;的&#8203;に&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Private LB&#8203;で&#8203;は、&#8203;2021&#8203;年&#8203;3&#8203;月&#8203;27&#8203;日&#8203;（土）〜&#8203;2021&#8203;年&#8203;5&#8203;月&#8203;15&#8203;日&#8203;（土）&#8203;に&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;た&#8203;決&#8203;算&#8203;短&#8203;信&#8203;を&#8203;対&#8203;象&#8203;に、&#8203;そ&#8203;の&#8203;開&#8203;示&#8203;日&#8203;か&#8203;ら&#8203;起&#8203;算&#8203;し&#8203;て&#8203;20&#8203;営&#8203;業&#8203;日&#8203;を&#8203;経&#8203;過&#8203;し&#8203;た&#8203;期&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る&#8203;最&#8203;高&#8203;値&#8203;及&#8203;び&#8203;最&#8203;安&#8203;値&#8203;を&#8203;予&#8203;測&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>ま&#8203;た、&#8203;こ&#8203;の&#8203;予&#8203;測&#8203;に&#8203;当&#8203;たっ&#8203;て&#8203;は、&#8203;決&#8203;算&#8203;短&#8203;信&#8203;の&#8203;開&#8203;示&#8203;日&#8203;の&#8203;期&#8203;間&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;5&#8203;回&#8203;に&#8203;分&#8203;け&#8203;て&#8203;実&#8203;施&#8203;し、&#8203;最&#8203;終&#8203;的&#8203;な&#8203;順&#8203;位&#8203;は&#8203;5&#8203;回&#8203;目&#8203;の&#8203;評&#8203;価&#8203;で&#8203;決&#8203;定&#8203;し&#8203;ま&#8203;す。&#8203;(&#8203;評&#8203;価&#8203;の&#8203;計&#8203;算&#8203;は&#8203;5&#8203;回&#8203;行&#8203;わ&#8203;れ&#8203;ま&#8203;す&#8203;が、&#8203;最&#8203;後&#8203;の&#8203;1&#8203;回&#8203;を&#8203;除&#8203;く&#8203;4&#8203;回&#8203;は&#8203;途&#8203;中&#8203;経&#8203;過&#8203;を&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;で&#8203;ご&#8203;確&#8203;認&#8203;い&#8203;た&#8203;だ&#8203;け&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;計&#8203;算&#8203;し&#8203;て&#8203;い&#8203;る&#8203;も&#8203;の&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;)</p>
</div>
<div class="paragraph">
<p>こ&#8203;の&#8203;5&#8203;回&#8203;の&#8203;評&#8203;価&#8203;の&#8203;ス&#8203;ケ&#8203;ジュー&#8203;ル&#8203;は&#8203;次&#8203;を&#8203;予&#8203;定&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>5&#8203;月&#8203;10&#8203;日&#8203;（月）&#8203;に&#8203;3&#8203;月&#8203;27&#8203;日&#8203;（土）〜&#8203;4&#8203;月&#8203;5&#8203;日&#8203;（月）&#8203;分&#8203;の&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;の&#8203;評&#8203;価</p>
</li>
<li>
<p>5&#8203;月&#8203;17&#8203;日&#8203;（月）&#8203;に&#8203;3&#8203;月&#8203;27&#8203;日&#8203;（土）〜&#8203;4&#8203;月&#8203;12&#8203;日&#8203;（月）&#8203;分&#8203;の&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;の&#8203;評&#8203;価</p>
</li>
<li>
<p>5&#8203;月&#8203;24&#8203;日&#8203;（月）&#8203;に&#8203;3&#8203;月&#8203;27&#8203;日&#8203;（土）〜&#8203;4&#8203;月&#8203;19&#8203;日&#8203;（月）&#8203;分&#8203;の&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;の&#8203;評&#8203;価</p>
</li>
<li>
<p>5&#8203;月&#8203;31&#8203;日&#8203;（月）&#8203;に&#8203;3&#8203;月&#8203;27&#8203;日&#8203;（土）〜&#8203;4&#8203;月&#8203;26&#8203;日&#8203;（月）&#8203;分&#8203;の&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;の&#8203;評&#8203;価</p>
</li>
<li>
<p>6&#8203;月&#8203;14&#8203;日&#8203;（月）&#8203;に&#8203;3&#8203;月&#8203;27&#8203;日&#8203;（土）〜&#8203;5&#8203;月&#8203;15&#8203;日&#8203;（土）&#8203;分&#8203;の&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;の&#8203;評&#8203;価</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以&#8203;上&#8203;を&#8203;踏&#8203;ま&#8203;え、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;お&#8203;け&#8203;る&#8203;Public LB&#8203;と&#8203;Private LB&#8203;の&#8203;概&#8203;要&#8203;を、&#8203;表&#8203;に&#8203;示&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;お&#8203;け&#8203;る&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;の&#8203;仕&#8203;様&#8203;</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;項&#8203;目&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>Public LB</strong></th>
<th class="tableblock halign-left valign-top"><strong>Private LB</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用&#8203;途</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モ&#8203;デ&#8203;ル&#8203;が&#8203;正&#8203;常&#8203;に&#8203;投&#8203;稿&#8203;で&#8203;き&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;環&#8203;境</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;最&#8203;終&#8203;的&#8203;な&#8203;ラ&#8203;ン&#8203;キ&#8203;ン&#8203;グ&#8203;を&#8203;表&#8203;示</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;測&#8203;対&#8203;象&#8203;と&#8203;な&#8203;る&#8203;決&#8203;算&#8203;短&#8203;信&#8203;の&#8203;開&#8203;示&#8203;日&#8203;の&#8203;期&#8203;間</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020&#8203;年&#8203;1&#8203;月&#8203;1&#8203;日&#8203;（水）〜&#8203;2020&#8203;年&#8203;11&#8203;月&#8203;30&#8203;日&#8203;（月）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021&#8203;年&#8203;3&#8203;月&#8203;27&#8203;日&#8203;（土）〜&#8203;2021&#8203;年&#8203;5&#8203;月&#8203;15&#8203;日&#8203;（土）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;測&#8203;対&#8203;象&#8203;と&#8203;な&#8203;る&#8203;決&#8203;算&#8203;短&#8203;信&#8203;の&#8203;開&#8203;示&#8203;日&#8203;の&#8203;条&#8203;件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各&#8203;銘&#8203;柄&#8203;の&#8203;各&#8203;四&#8203;半&#8203;期&#8203;ご&#8203;と&#8203;に&#8203;一&#8203;番&#8203;開&#8203;示&#8203;日&#8203;が&#8203;新&#8203;し&#8203;い&#8203;開&#8203;示&#8203;　</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.1.2&#8203;項&#8203;に&#8203;示&#8203;す&#8203;と&#8203;お&#8203;り</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;測&#8203;内&#8203;容</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">決&#8203;算&#8203;短&#8203;信&#8203;の&#8203;開&#8203;示&#8203;日&#8203;か&#8203;ら&#8203;起&#8203;算&#8203;し&#8203;て&#8203;20&#8203;営&#8203;業&#8203;日&#8203;を&#8203;経&#8203;過&#8203;し&#8203;た&#8203;期&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る、&#8203;各&#8203;銘&#8203;柄&#8203;の&#8203;最&#8203;高&#8203;値&#8203;及&#8203;び&#8203;最&#8203;安&#8203;値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">同&#8203;左</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">評&#8203;価&#8203;方&#8203;法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.1.3&#8203;項&#8203;に&#8203;示&#8203;す&#8203;評&#8203;価&#8203;方&#8203;法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.1.3&#8203;項&#8203;に&#8203;示&#8203;す&#8203;評&#8203;価&#8203;方&#8203;法&#8203;を、&#8203;5&#8203;回&#8203;の&#8203;決&#8203;算&#8203;短&#8203;信&#8203;開&#8203;示&#8203;期&#8203;間&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;実&#8203;施</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_決算短信財務諸表">2.1.5. 決算短信・財務諸表</h4>
<div class="paragraph">
<p>上&#8203;場&#8203;企&#8203;業&#8203;の&#8203;株&#8203;価&#8203;は、&#8203;各&#8203;社&#8203;の&#8203;経&#8203;営&#8203;状&#8203;態&#8203;等&#8203;を&#8203;反&#8203;映&#8203;し&#8203;て&#8203;日々&#8203;刻々&#8203;と&#8203;変&#8203;化&#8203;し&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;金&#8203;融&#8203;商&#8203;品&#8203;市&#8203;場&#8203;に&#8203;お&#8203;い&#8203;て&#8203;公&#8203;正&#8203;な&#8203;価&#8203;格&#8203;形&#8203;成&#8203;と&#8203;円&#8203;滑&#8203;な&#8203;流&#8203;通&#8203;を&#8203;確&#8203;保&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;は&#8203;公&#8203;平&#8203;で&#8203;適&#8203;時、&#8203;適&#8203;切&#8203;な&#8203;情&#8203;報&#8203;開&#8203;示&#8203;が&#8203;必&#8203;要&#8203;不&#8203;可&#8203;欠&#8203;な&#8203;も&#8203;の&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>東&#8203;京&#8203;証&#8203;券&#8203;取&#8203;引&#8203;所&#8203;で&#8203;は、&#8203;投&#8203;資&#8203;者&#8203;が&#8203;投&#8203;資&#8203;判&#8203;断&#8203;を&#8203;行&#8203;う&#8203;う&#8203;え&#8203;で&#8203;必&#8203;要&#8203;な&#8203;会&#8203;社&#8203;情&#8203;報&#8203;を、&#8203;迅&#8203;速、&#8203;正&#8203;確&#8203;か&#8203;つ&#8203;公&#8203;平&#8203;に&#8203;提&#8203;供&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;制&#8203;度&#8203;と&#8203;し&#8203;て、&#8203;適&#8203;時&#8203;開&#8203;示&#8203;制&#8203;度&#8203;を&#8203;設&#8203;け&#8203;て&#8203;お&#8203;り、&#8203;上&#8203;場&#8203;企&#8203;業&#8203;は、&#8203;報&#8203;道&#8203;機&#8203;関&#8203;等&#8203;を&#8203;通&#8203;じ&#8203;て&#8203;あ&#8203;る&#8203;い&#8203;は&#8203;TDnet&#8203;（適&#8203;時&#8203;開&#8203;示&#8203;情&#8203;報&#8203;伝&#8203;達&#8203;シ&#8203;ス&#8203;テ&#8203;ム）&#8203;に&#8203;よ&#8203;り&#8203;直&#8203;接&#8203;に、&#8203;広&#8203;く、&#8203;か&#8203;つ&#8203;タ&#8203;イ&#8203;ム&#8203;リー&#8203;に&#8203;伝&#8203;達&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;と&#8203;い&#8203;う&#8203;特&#8203;徴&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;適&#8203;時&#8203;開&#8203;示&#8203;制&#8203;度&#8203;の&#8203;下&#8203;で&#8203;上&#8203;場&#8203;企&#8203;業&#8203;が&#8203;開&#8203;示&#8203;す&#8203;る&#8203;資&#8203;料&#8203;の&#8203;こ&#8203;と&#8203;を、&#8203;適&#8203;時&#8203;開&#8203;示&#8203;資&#8203;料&#8203;と&#8203;呼&#8203;び&#8203;ま&#8203;す。&#8203;適&#8203;時&#8203;開&#8203;示&#8203;資&#8203;料&#8203;と&#8203;そ&#8203;の&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203;（タ&#8203;イ&#8203;ト&#8203;ル、&#8203;開&#8203;示&#8203;日&#8203;時&#8203;等）&#8203;を&#8203;総&#8203;称&#8203;し&#8203;て&#8203;適&#8203;時&#8203;開&#8203;示&#8203;情&#8203;報&#8203;と&#8203;呼&#8203;び、&#8203;適&#8203;時&#8203;開&#8203;示&#8203;情&#8203;報&#8203;は&#8203;「<a href="https://www.release.tdnet.info/inbs/I_main_00.html">適時開示情報閲覧サービス</a>」&#8203;で&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;下&#8203;図&#8203;に&#8203;投&#8203;資&#8203;家&#8203;に&#8203;お&#8203;け&#8203;る&#8203;適&#8203;時&#8203;開&#8203;示&#8203;資&#8203;料&#8203;の&#8203;代&#8203;表&#8203;的&#8203;な&#8203;用&#8203;途&#8203;を&#8203;示&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;投&#8203;資&#8203;家&#8203;に&#8203;お&#8203;け&#8203;る&#8203;適&#8203;時&#8203;開&#8203;示&#8203;資&#8203;料&#8203;の&#8203;代&#8203;表&#8203;的&#8203;な&#8203;用&#8203;途&#8203;</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/structure.png" alt="structure">
</div>
</div>
<div class="paragraph">
<p>(&#8203;開&#8203;示&#8203;資&#8203;料&#8203;と&#8203;翻&#8203;訳&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://aamt.info/wp-content/uploads/2019/11/%E3%83%91%E3%83%8D%E3%83%AB%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3_%E5%B1%B1%E8%97%A4%E6%95%A6%E5%8F%B2%E6%B0%8F_AAMT2019Tokyo-1.pdf" class="bare">https://aamt.info/wp-content/uploads/2019/11/%E3%83%91%E3%83%8D%E3%83%AB%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3_%E5%B1%B1%E8%97%A4%E6%95%A6%E5%8F%B2%E6%B0%8F_AAMT2019Tokyo-1.pdf</a>)</p>
</div>
<div class="paragraph">
<p>上&#8203;場&#8203;企&#8203;業&#8203;が&#8203;開&#8203;示&#8203;を&#8203;義&#8203;務&#8203;付&#8203;け&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;適&#8203;時&#8203;開&#8203;示&#8203;資&#8203;料&#8203;の&#8203;一&#8203;つ&#8203;に、&#8203;決&#8203;算&#8203;短&#8203;信&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;決&#8203;算&#8203;短&#8203;信&#8203;と&#8203;は、&#8203;決&#8203;算&#8203;発&#8203;表&#8203;及&#8203;び&#8203;四&#8203;半&#8203;期&#8203;決&#8203;算&#8203;発&#8203;表&#8203;を&#8203;行&#8203;う&#8203;際&#8203;に、&#8203;決&#8203;算&#8203;内&#8203;容&#8203;の&#8203;要&#8203;点&#8203;を&#8203;ま&#8203;と&#8203;め&#8203;た&#8203;書&#8203;類&#8203;の&#8203;こ&#8203;と&#8203;で&#8203;す。&#8203;本&#8203;資&#8203;料&#8203;で&#8203;は、&#8203;決&#8203;算&#8203;発&#8203;表&#8203;時&#8203;に&#8203;開&#8203;示&#8203;す&#8203;る&#8203;決&#8203;算&#8203;短&#8203;信&#8203;と、&#8203;四&#8203;半&#8203;期&#8203;決&#8203;算&#8203;発&#8203;表&#8203;時&#8203;に&#8203;開&#8203;示&#8203;す&#8203;る&#8203;四&#8203;半&#8203;期&#8203;決&#8203;算&#8203;短&#8203;信&#8203;を&#8203;総&#8203;称&#8203;し&#8203;て、&#8203;決&#8203;算&#8203;短&#8203;信&#8203;と&#8203;呼&#8203;び&#8203;ま&#8203;す。&#8203;上&#8203;場&#8203;企&#8203;業&#8203;は、&#8203;決&#8203;算&#8203;期&#8203;末&#8203;を&#8203;含&#8203;め&#8203;四&#8203;半&#8203;期&#8203;毎&#8203;に&#8203;決&#8203;算&#8203;内&#8203;容&#8203;が&#8203;定&#8203;まっ&#8203;た&#8203;際、&#8203;決&#8203;算&#8203;内&#8203;容&#8203;の&#8203;開&#8203;示&#8203;が&#8203;義&#8203;務&#8203;付&#8203;け&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;四&#8203;半&#8203;期&#8203;決&#8203;算&#8203;短&#8203;信&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;金&#8203;商&#8203;法&#8203;に&#8203;基&#8203;づ&#8203;く&#8203;四&#8203;半&#8203;期&#8203;報&#8203;告&#8203;書&#8203;の&#8203;法&#8203;定&#8203;提&#8203;出&#8203;期&#8203;限&#8203;が&#8203;45&#8203;日&#8203;と&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;ま&#8203;た、&#8203;決&#8203;算&#8203;短&#8203;信&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;決&#8203;算&#8203;期&#8203;末&#8203;後&#8203;45&#8203;日&#8203;以&#8203;内&#8203;に&#8203;決&#8203;算&#8203;の&#8203;内&#8203;容&#8203;を&#8203;開&#8203;示&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;東&#8203;証&#8203;が&#8203;要&#8203;請&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;決&#8203;算&#8203;短&#8203;信&#8203;等&#8203;の&#8203;多&#8203;く&#8203;は&#8203;期&#8203;末&#8203;後&#8203;45&#8203;日&#8203;以&#8203;内&#8203;に&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;決&#8203;算&#8203;短&#8203;信&#8203;の&#8203;作&#8203;成&#8203;要&#8203;領&#8203;等&#8203;は、&#8203;下&#8203;記&#8203;Web&#8203;サ&#8203;イ&#8203;ト&#8203;で&#8203;公&#8203;開&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>決&#8203;算&#8203;短&#8203;信&#8203;作&#8203;成&#8203;要&#8203;領・&#8203;四&#8203;半&#8203;期&#8203;決&#8203;算&#8203;短&#8203;信&#8203;作&#8203;成&#8203;要&#8203;領&#8203; | &#8203;日&#8203;本&#8203;取&#8203;引&#8203;所&#8203;グ&#8203;ルー&#8203;プ&#8203;<br>
<a href="https://www.jpx.co.jp/equities/listed-co/format/summary/index.html" class="bare">https://www.jpx.co.jp/equities/listed-co/format/summary/index.html</a></p>
</div>
<div class="paragraph">
<p>決&#8203;算&#8203;の&#8203;内&#8203;容&#8203;と&#8203;し&#8203;て&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;る&#8203;決&#8203;算&#8203;短&#8203;信&#8203;は、&#8203;大&#8203;き&#8203;く、&#8203;サ&#8203;マ&#8203;リー&#8203;情&#8203;報&#8203;と&#8203;添&#8203;付&#8203;資&#8203;料&#8203;で&#8203;構&#8203;成&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;<br></p>
</div>
<div class="paragraph">
<p>サ&#8203;マ&#8203;リー&#8203;情&#8203;報&#8203;は、&#8203;投&#8203;資&#8203;者&#8203;の&#8203;投&#8203;資&#8203;判&#8203;断&#8203;に&#8203;重&#8203;要&#8203;な&#8203;影&#8203;響&#8203;を&#8203;与&#8203;え&#8203;る&#8203;上&#8203;場&#8203;会&#8203;社&#8203;の&#8203;決&#8203;算&#8203;の&#8203;内&#8203;容&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;そ&#8203;の&#8203;要&#8203;点&#8203;の&#8203;一&#8203;覧&#8203;性&#8203;及&#8203;び&#8203;比&#8203;較&#8203;可&#8203;能&#8203;性&#8203;を&#8203;確&#8203;保&#8203;す&#8203;る&#8203;観&#8203;点&#8203;か&#8203;ら、&#8203;簡&#8203;潔&#8203;に&#8203;取&#8203;り&#8203;ま&#8203;と&#8203;め&#8203;た&#8203;も&#8203;の&#8203;と&#8203;し&#8203;て、&#8203;参&#8203;考&#8203;様&#8203;式&#8203;に&#8203;基&#8203;づ&#8203;い&#8203;て&#8203;東&#8203;証&#8203;が&#8203;作&#8203;成&#8203;を&#8203;要&#8203;請&#8203;し&#8203;て&#8203;い&#8203;る&#8203;資&#8203;料&#8203;で&#8203;す。&#8203;<br></p>
</div>
<div class="paragraph">
<p>添&#8203;付&#8203;資&#8203;料&#8203;と&#8203;は、&#8203;サ&#8203;マ&#8203;リー&#8203;情&#8203;報&#8203;に&#8203;記&#8203;載&#8203;さ&#8203;れ&#8203;る&#8203;主&#8203;要&#8203;な&#8203;決&#8203;算&#8203;数&#8203;値&#8203;を&#8203;投&#8203;資&#8203;者&#8203;が&#8203;適&#8203;切&#8203;に&#8203;理&#8203;解&#8203;で&#8203;き&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;す&#8203;る&#8203;目&#8203;的&#8203;で&#8203;作&#8203;成&#8203;さ&#8203;れ&#8203;る、&#8203;経&#8203;営&#8203;成&#8203;績・&#8203;財&#8203;政&#8203;状&#8203;態&#8203;の&#8203;概&#8203;況、&#8203;今&#8203;後&#8203;の&#8203;見&#8203;通&#8203;し、&#8203;財&#8203;務&#8203;諸&#8203;表、&#8203;主&#8203;な&#8203;注&#8203;記&#8203;等&#8203;を&#8203;記&#8203;載&#8203;し&#8203;た&#8203;資&#8203;料&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>前&#8203;述&#8203;の&#8203;と&#8203;お&#8203;り、&#8203;決&#8203;算&#8203;短&#8203;信&#8203;に&#8203;は、&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;が&#8203;添&#8203;付&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;と&#8203;は、&#8203;財&#8203;政&#8203;状&#8203;態、&#8203;経&#8203;営&#8203;成&#8203;績&#8203;及&#8203;び&#8203;キャッ&#8203;シュ・&#8203;フ&#8203;ロー&#8203;の&#8203;状&#8203;況&#8203;を&#8203;外&#8203;部&#8203;の&#8203;情&#8203;報&#8203;利&#8203;用&#8203;者&#8203;に&#8203;明&#8203;ら&#8203;か&#8203;に&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;も&#8203;の&#8203;で、&#8203;有&#8203;価&#8203;証&#8203;券&#8203;届&#8203;出&#8203;書&#8203;や&#8203;有&#8203;価&#8203;証&#8203;券&#8203;報&#8203;告&#8203;書&#8203;等&#8203;に&#8203;記&#8203;載&#8203;さ&#8203;れ&#8203;る&#8203;財&#8203;務&#8203;計&#8203;算&#8203;に&#8203;関&#8203;す&#8203;る&#8203;書&#8203;類&#8203;の&#8203;う&#8203;ち、&#8203;貸&#8203;借&#8203;対&#8203;照&#8203;表、&#8203;損&#8203;益&#8203;計&#8203;算&#8203;書、&#8203;株&#8203;主&#8203;資&#8203;本&#8203;等&#8203;変&#8203;動&#8203;計&#8203;算&#8203;書、&#8203;キャッ&#8203;シュ・&#8203;フ&#8203;ロー&#8203;計&#8203;算&#8203;書&#8203;の&#8203;総&#8203;称&#8203;を&#8203;指&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;内、&#8203;貸&#8203;借&#8203;対&#8203;照&#8203;表、&#8203;損&#8203;益&#8203;計&#8203;算&#8203;書、&#8203;キャッ&#8203;シュ・&#8203;フ&#8203;ロー&#8203;計&#8203;算&#8203;書&#8203;の&#8203;3&#8203;つ&#8203;は、&#8203;総&#8203;称&#8203;し&#8203;て&#8203;「財&#8203;務&#8203;三&#8203;表」&#8203;と&#8203;呼&#8203;ば&#8203;れ&#8203;て&#8203;お&#8203;り、&#8203;上&#8203;場&#8203;企&#8203;業&#8203;に&#8203;対&#8203;す&#8203;る&#8203;投&#8203;資&#8203;判&#8203;断&#8203;に&#8203;お&#8203;い&#8203;て&#8203;特&#8203;に&#8203;重&#8203;要&#8203;視&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;財&#8203;務&#8203;三&#8203;表&#8203;の&#8203;読&#8203;み&#8203;方&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;下&#8203;記&#8203;Web&#8203;サ&#8203;イ&#8203;ト&#8203;が&#8203;参&#8203;考&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>投&#8203;資&#8203;に&#8203;不&#8203;可&#8203;欠&#8203;な&#8203;財&#8203;務&#8203;三&#8203;表&#8203;の&#8203;見&#8203;方&#8203; | &#8203;東&#8203;証&#8203;マ&#8203;ネ&#8203;部！&#8203;
<a href="https://money-bu-jpx.com/news/article022723/" class="bare">https://money-bu-jpx.com/news/article022723/</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ま&#8203;た、&#8203;各&#8203;上&#8203;場&#8203;企&#8203;業&#8203;の&#8203;決&#8203;算&#8203;発&#8203;表&#8203;予&#8203;定&#8203;日&#8203;（決&#8203;算&#8203;短&#8203;信&#8203;の&#8203;開&#8203;示&#8203;予&#8203;定&#8203;日）&#8203;は、&#8203;下&#8203;記&#8203;JPX&#8203;の&#8203;Web&#8203;サ&#8203;イ&#8203;ト&#8203;に&#8203;て&#8203;随&#8203;時&#8203;公&#8203;開&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;投&#8203;資&#8203;家&#8203;の&#8203;投&#8203;資&#8203;判&#8203;断&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;各&#8203;上&#8203;場&#8203;企&#8203;業&#8203;の&#8203;決&#8203;算&#8203;発&#8203;表&#8203;は&#8203;特&#8203;に&#8203;重&#8203;要&#8203;視&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;当&#8203;該&#8203;Web&#8203;サ&#8203;イ&#8203;ト&#8203;は&#8203;多&#8203;く&#8203;の&#8203;投&#8203;資&#8203;家&#8203;よ&#8203;り&#8203;注&#8203;目&#8203;を&#8203;集&#8203;め&#8203;て&#8203;い&#8203;る&#8203;と&#8203;推&#8203;察&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>決&#8203;算&#8203;発&#8203;表&#8203;予&#8203;定&#8203;日&#8203; | &#8203;日&#8203;本&#8203;取&#8203;引&#8203;所&#8203;グ&#8203;ルー&#8203;プ&#8203;
　
<a href="https://www.jpx.co.jp/listing/event-schedules/financial-announcement/index.html" class="bare">https://www.jpx.co.jp/listing/event-schedules/financial-announcement/index.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以&#8203;上&#8203;の&#8203;と&#8203;お&#8203;り、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;予&#8203;測&#8203;対&#8203;象&#8203;の&#8203;起&#8203;点&#8203;と&#8203;な&#8203;る&#8203;決&#8203;算&#8203;短&#8203;信&#8203;に&#8203;は、&#8203;各&#8203;上&#8203;場&#8203;企&#8203;業&#8203;の&#8203;重&#8203;要&#8203;な&#8203;決&#8203;算&#8203;内&#8203;容&#8203;が&#8203;記&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;決&#8203;算&#8203;短&#8203;信&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;る&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;か&#8203;ら&#8203;抽&#8203;出&#8203;し&#8203;た&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;を&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;ペー&#8203;ジ&#8203;若&#8203;し&#8203;く&#8203;は&#8203;専&#8203;用&#8203;の&#8203;API&#8203;に&#8203;お&#8203;い&#8203;て&#8203;配&#8203;信&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;こ&#8203;れ&#8203;を&#8203;用&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;株&#8203;価&#8203;の&#8203;先&#8203;行&#8203;き&#8203;を&#8203;予&#8203;測&#8203;し&#8203;て&#8203;い&#8203;た&#8203;だ&#8203;き&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_データセットの説明">2.2. データセットの説明</h3>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は、&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;る&#8203;各&#8203;デー&#8203;タ&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。&#8203;提&#8203;供&#8203;さ&#8203;れ&#8203;る&#8203;デー&#8203;タ&#8203;は&#8203;以&#8203;下&#8203;の&#8203;5&#8203;種&#8203;類&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;デー&#8203;タ&#8203;概&#8203;要&#8203;</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;ファ&#8203;イ&#8203;ル&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各&#8203;銘&#8203;柄&#8203;の&#8203;情&#8203;報&#8203;が&#8203;記&#8203;録&#8203;さ&#8203;れ&#8203;た&#8203;デー&#8203;タ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_price</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各&#8203;銘&#8203;柄&#8203;の&#8203;株&#8203;価&#8203;情&#8203;報&#8203;（始&#8203;値・&#8203;高&#8203;値・&#8203;安&#8203;値・&#8203;終&#8203;値&#8203;等）&#8203;が&#8203;記&#8203;録&#8203;さ&#8203;れ&#8203;た&#8203;デー&#8203;タ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_fin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各&#8203;銘&#8203;柄&#8203;の&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;（決&#8203;算&#8203;数&#8203;値&#8203;デー&#8203;タ&#8203;や&#8203;配&#8203;当&#8203;デー&#8203;タ&#8203;等）&#8203;が&#8203;記&#8203;録&#8203;さ&#8203;れ&#8203;た&#8203;デー&#8203;タ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_fin_price</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デー&#8203;タ&#8203;が&#8203;扱&#8203;い&#8203;や&#8203;す&#8203;い&#8203;よ&#8203;う&#8203;に&#8203;stock_price&#8203;及&#8203;び&#8203;stock_fin&#8203;を&#8203;マー&#8203;ジ&#8203;し&#8203;た&#8203;デー&#8203;タ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_labels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;学&#8203;習&#8203;に&#8203;用&#8203;い&#8203;る&#8203;ラ&#8203;ベ&#8203;ル&#8203;（目&#8203;的&#8203;変&#8203;数）&#8203;が&#8203;記&#8203;録&#8203;さ&#8203;れ&#8203;た&#8203;デー&#8203;タ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>提&#8203;供&#8203;デー&#8203;タ&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;2016&#8203;年&#8203;1&#8203;月&#8203;初&#8203;か&#8203;ら&#8203;2020&#8203;年&#8203;12&#8203;月&#8203;末&#8203;を&#8203;csv&#8203;ファ&#8203;イ&#8203;ル&#8203;形&#8203;式、&#8203;2021&#8203;年&#8203;１&#8203;月&#8203;初&#8203;か&#8203;ら&#8203;の&#8203;デー&#8203;タ&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;専&#8203;用&#8203;の&#8203;API&#8203;に&#8203;て&#8203;提&#8203;供&#8203;い&#8203;た&#8203;し&#8203;ま&#8203;す。&#8203;API&#8203;に&#8203;よ&#8203;る&#8203;デー&#8203;タ&#8203;取&#8203;得&#8203;に&#8203;つ&#8203;き&#8203;ま&#8203;し&#8203;て&#8203;は、&#8203;8&#8203;章&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="sect3">
<h4 id="_銘柄情報_stock_list">2.2.1. 銘柄情報: stock_list</h4>
<div class="paragraph">
<p>stock_list&#8203;は、&#8203;銘&#8203;柄&#8203;の&#8203;名&#8203;前&#8203;や&#8203;業&#8203;種&#8203;区&#8203;分&#8203;な&#8203;ど&#8203;の&#8203;基&#8203;本&#8203;情&#8203;報&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;発&#8203;行&#8203;済&#8203;株&#8203;式&#8203;数&#8203;は、&#8203;会&#8203;社&#8203;が&#8203;発&#8203;行&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;あ&#8203;ら&#8203;か&#8203;じ&#8203;め&#8203;定&#8203;款&#8203;に&#8203;定&#8203;め&#8203;て&#8203;い&#8203;る&#8203;株&#8203;式&#8203;数&#8203;（授&#8203;権&#8203;株&#8203;式&#8203;数）&#8203;の&#8203;う&#8203;ち、&#8203;会&#8203;社&#8203;が&#8203;既&#8203;に&#8203;発&#8203;行&#8203;し&#8203;た&#8203;株&#8203;式&#8203;数&#8203;の&#8203;こ&#8203;と&#8203;で&#8203;す。&#8203;発&#8203;行&#8203;済&#8203;株&#8203;式&#8203;数&#8203;と&#8203;株&#8203;価&#8203;と&#8203;か&#8203;け&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;時&#8203;価&#8203;総&#8203;額&#8203;を&#8203;計&#8203;算&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;時&#8203;価&#8203;総&#8203;額&#8203;は&#8203;企&#8203;業&#8203;価&#8203;値&#8203;を&#8203;評&#8203;価&#8203;す&#8203;る&#8203;際&#8203;に&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;る&#8203;重&#8203;要&#8203;な&#8203;指&#8203;標&#8203;で&#8203;す。&#8203;業&#8203;種&#8203;区&#8203;分&#8203;情&#8203;報&#8203;は、&#8203;マー&#8203;ケッ&#8203;ト&#8203;に&#8203;お&#8203;け&#8203;る&#8203;業&#8203;種&#8203;別&#8203;の&#8203;平&#8203;均&#8203;な&#8203;ど&#8203;を&#8203;計&#8203;算&#8203;す&#8203;る&#8203;時&#8203;に&#8203;役&#8203;立&#8203;つ&#8203;情&#8203;報&#8203;で&#8203;す。&#8203;33&#8203;業&#8203;種&#8203;は&#8203;証&#8203;券&#8203;コー&#8203;ド&#8203;協&#8203;議&#8203;会&#8203;が&#8203;定&#8203;め&#8203;て&#8203;お&#8203;り、&#8203;17&#8203;業&#8203;種&#8203;は&#8203;TOPIX-17&#8203;シ&#8203;リー&#8203;ズ&#8203;と&#8203;し&#8203;て&#8203;「投&#8203;資&#8203;利&#8203;便&#8203;性&#8203;を&#8203;考&#8203;慮&#8203;し&#8203;て&#8203;17&#8203;業&#8203;種&#8203;に&#8203;再&#8203;編&#8203;し&#8203;た&#8203;も&#8203;の」&#8203;(JPX&#8203;東&#8203;証&#8203;33&#8203;業&#8203;種&#8203;別&#8203;株&#8203;価&#8203;指&#8203;数・&#8203;TOPIX-17&#8203;シ&#8203;リー&#8203;ズ&#8203;ファ&#8203;ク&#8203;ト&#8203;シー&#8203;ト&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.jpx.co.jp/markets/indices/line-up/index.html" class="bare">https://www.jpx.co.jp/markets/indices/line-up/index.html</a>) &#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>「業&#8203;種」&#8203;(JPX&#8203;用&#8203;語&#8203;集&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.jpx.co.jp/glossary/ka/112.html" class="bare">https://www.jpx.co.jp/glossary/ka/112.html</a>)</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">prediction_target</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;測&#8203;対&#8203;象&#8203;銘&#8203;柄</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Effective Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;情&#8203;報&#8203;の&#8203;基&#8203;準&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20201030</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">株&#8203;式&#8203;銘&#8203;柄&#8203;コー&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1301</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name (English)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KYOKUYO CO.,LTD.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Section/Products</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">市&#8203;場・&#8203;商&#8203;品&#8203;区&#8203;分</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First Section (Domestic)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">33 Sector(Code)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;の&#8203;33&#8203;業&#8203;種&#8203;区&#8203;分&#8203;(&#8203;コー&#8203;ド&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">33 Sector(name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;の&#8203;33&#8203;業&#8203;種&#8203;区&#8203;分&#8203;(&#8203;名&#8203;前&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fishery, Agriculture and Forestry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">17 Sector(Code)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;の&#8203;17&#8203;業&#8203;種&#8203;区&#8203;分&#8203;(&#8203;コー&#8203;ド&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">17 Sector(name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;の&#8203;17&#8203;業&#8203;種&#8203;区&#8203;分&#8203;(&#8203;名&#8203;前&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FOODS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size Code (New Index Series)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPIX&#8203;ニュー&#8203;イ&#8203;ン&#8203;デッ&#8203;ク&#8203;ス&#8203;シ&#8203;リー&#8203;ズ&#8203;規&#8203;模&#8203;区&#8203;分&#8203;(&#8203;コー&#8203;ド&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size (New Index Series)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPIX&#8203;ニュー&#8203;イ&#8203;ン&#8203;デッ&#8203;ク&#8203;ス&#8203;シ&#8203;リー&#8203;ズ&#8203;規&#8203;模&#8203;区&#8203;分</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPIX Small 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IssuedShareEquityQuote AccountingStandard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会&#8203;計&#8203;基&#8203;準&#8203; &#8203;単&#8203;独&#8203;:NonConsolidated、&#8203;連&#8203;結&#8203;国&#8203;内&#8203;:ConsolidatedJP、&#8203;連&#8203;結&#8203;SEC:ConsolidatedUS、&#8203;連&#8203;結&#8203;IFRS:ConsolidatedIFRS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConsolidatedJP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IssuedShareEquityQuote ModifyDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">更&#8203;新&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020/11/06</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IssuedShareEquityQuote IssuedShare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">発&#8203;行&#8203;済&#8203;株&#8203;式&#8203;数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10928283.0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(JPX&#8203;東&#8203;証&#8203;上&#8203;場&#8203;銘&#8203;柄&#8203;一&#8203;覧&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.jpx.co.jp/markets/statistics-equities/misc/01.html" class="bare">https://www.jpx.co.jp/markets/statistics-equities/misc/01.html</a>)<br>
(Quick xignite API Market Data API Catalog&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.marketdata-cloud.quick-co.jp/Products/" class="bare">https://www.marketdata-cloud.quick-co.jp/Products/</a>)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_stock_list.png" alt="sample_stock_list">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_株価情報_stock_price">2.2.2. 株価情報 : stock_price</h4>
<div class="paragraph">
<p>stock_price&#8203;に&#8203;は&#8203;各&#8203;銘&#8203;柄&#8203;の&#8203;各&#8203;日&#8203;付&#8203;の&#8203;始&#8203;値&#8203;や&#8203;終&#8203;値&#8203;な&#8203;ど&#8203;の&#8203;株&#8203;価&#8203;情&#8203;報&#8203;が&#8203;記&#8203;録&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;な&#8203;ど&#8203;で&#8203;終&#8203;値&#8203;ベー&#8203;ス&#8203;の&#8203;分&#8203;析&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;場&#8203;合&#8203;は、&#8203;ExchangeOfficialClose&#8203;を&#8203;利&#8203;用&#8203;し&#8203;ま&#8203;す。&#8203;<br>
こ&#8203;こ&#8203;で&#8203;い&#8203;う&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;と&#8203;い&#8203;う&#8203;の&#8203;は、&#8203;マー&#8203;ケッ&#8203;ト&#8203;デー&#8203;タ&#8203;か&#8203;ら&#8203;計&#8203;算&#8203;さ&#8203;れ&#8203;る&#8203;指&#8203;標&#8203;に&#8203;基&#8203;づ&#8203;い&#8203;た&#8203;分&#8203;析&#8203;の&#8203;こ&#8203;と&#8203;で&#8203;す。&#8203;ま&#8203;た、&#8203;終&#8203;値&#8203;ベー&#8203;ス&#8203;の&#8203;分&#8203;析&#8203;と&#8203;は、&#8203;マー&#8203;ケッ&#8203;ト&#8203;デー&#8203;タ&#8203;の&#8203;中&#8203;で&#8203;も、&#8203;終&#8203;値&#8203;の&#8203;み&#8203;を&#8203;用&#8203;い&#8203;た&#8203;分&#8203;析&#8203;を&#8203;表&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>株&#8203;価&#8203;情&#8203;報&#8203;は、&#8203;「株&#8203;式&#8203;分&#8203;割」&#8203;や&#8203;「株&#8203;式&#8203;併&#8203;合」&#8203;が&#8203;発&#8203;生&#8203;し&#8203;た&#8203;際&#8203;に&#8203;生&#8203;じ&#8203;る&#8203;株&#8203;価&#8203;の&#8203;変&#8203;動&#8203;を、&#8203;株&#8203;式&#8203;数&#8203;の&#8203;変&#8203;化&#8203;率&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;調&#8203;整&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;定&#8203;義&#8203;に&#8203;よっ&#8203;て&#8203;は、&#8203;そ&#8203;の&#8203;日&#8203;付&#8203;時&#8203;点&#8203;で&#8203;実&#8203;際&#8203;に&#8203;取&#8203;引&#8203;さ&#8203;れ&#8203;た&#8203;株&#8203;価&#8203;や&#8203;出&#8203;来&#8203;高&#8203;を&#8203;取&#8203;得&#8203;し&#8203;た&#8203;い&#8203;場&#8203;合&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;そ&#8203;の&#8203;場&#8203;合&#8203;は&#8203;累&#8203;積&#8203;調&#8203;整&#8203;係&#8203;数&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;<br>
 <code>[&#8203;調&#8203;整&#8203;前&#8203;株&#8203;価&#8203;] = [&#8203;調&#8203;整&#8203;済&#8203;株&#8203;価&#8203;] * [&#8203;累&#8203;積&#8203;調&#8203;整&#8203;係&#8203;数&#8203;]</code> &#8203;及&#8203;び&#8203; <code>[&#8203;調&#8203;整&#8203;前&#8203;出&#8203;来&#8203;高&#8203;] = [&#8203;調&#8203;整&#8203;済&#8203;出&#8203;来&#8203;高&#8203;] / [&#8203;累&#8203;積&#8203;調&#8203;整&#8203;係&#8203;数&#8203;]</code> <br>
 &#8203;と&#8203;い&#8203;う&#8203;計&#8203;算&#8203;で&#8203;算&#8203;出&#8203;可&#8203;能&#8203;で&#8203;す。&#8203;<br>
「株&#8203;式&#8203;分&#8203;割」&#8203;(JPX&#8203;用&#8203;語&#8203;集&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.jpx.co.jp/glossary/ka/81.html" class="bare">https://www.jpx.co.jp/glossary/ka/81.html</a>)<br>
「株&#8203;式&#8203;併&#8203;合」&#8203;(JPX&#8203;用&#8203;語&#8203;集&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.jpx.co.jp/glossary/ka/83.html" class="bare">https://www.jpx.co.jp/glossary/ka/83.html</a>)</p>
</div>
<div class="paragraph">
<p><strong>&#8203;た&#8203;だ&#8203;し、&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;使&#8203;用&#8203;す&#8203;る&#8203;場&#8203;合&#8203;に&#8203;は&#8203;注&#8203;意&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。&#8203;</strong></p>
</div>
<div class="paragraph">
<p>履&#8203;歴&#8203;デー&#8203;タ&#8203;の&#8203;累&#8203;積&#8203;調&#8203;整&#8203;係&#8203;数&#8203;は&#8203;過&#8203;去&#8203;の&#8203;あ&#8203;る&#8203;日&#8203;時&#8203;点&#8203;で&#8203;は&#8203;知&#8203;り&#8203;得&#8203;な&#8203;い&#8203;未&#8203;来&#8203;の&#8203;情&#8203;報&#8203;を&#8203;含&#8203;ん&#8203;で&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;注&#8203;意&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;具&#8203;体&#8203;的&#8203;に&#8203;は、&#8203;過&#8203;去&#8203;の&#8203;あ&#8203;る&#8203;日&#8203;時&#8203;点&#8203;の&#8203;累&#8203;積&#8203;調&#8203;整&#8203;係&#8203;数&#8203;が&#8203;2&#8203;で&#8203;あ&#8203;る&#8203;場&#8203;合、&#8203;そ&#8203;の&#8203;日&#8203;以&#8203;降&#8203;に&#8203;1:2&#8203;の&#8203;株&#8203;式&#8203;分&#8203;割&#8203;が&#8203;発&#8203;生&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>一&#8203;般&#8203;に&#8203;株&#8203;式&#8203;分&#8203;割&#8203;は&#8203;流&#8203;動&#8203;性&#8203;向&#8203;上&#8203;を&#8203;期&#8203;待&#8203;で&#8203;き&#8203;る&#8203;ポ&#8203;ジ&#8203;ティ&#8203;ブ&#8203;な&#8203;イ&#8203;ベ&#8203;ン&#8203;ト&#8203;と&#8203;み&#8203;な&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;仮&#8203;に、&#8203;モ&#8203;デ&#8203;ル&#8203;学&#8203;習&#8203;時&#8203;に&#8203;累&#8203;積&#8203;調&#8203;整&#8203;係&#8203;数&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;へ&#8203;入&#8203;力&#8203;し、&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;累&#8203;積&#8203;調&#8203;整&#8203;係&#8203;数&#8203;が&#8203;大&#8203;き&#8203;い&#8203;銘&#8203;柄&#8203;は&#8203;未&#8203;来&#8203;の&#8203;株&#8203;価&#8203;が&#8203;上&#8203;が&#8203;る&#8203;傾&#8203;向&#8203;が&#8203;あ&#8203;る&#8203;と&#8203;い&#8203;う&#8203;こ&#8203;と&#8203;を&#8203;学&#8203;習&#8203;し、&#8203;履&#8203;歴&#8203;デー&#8203;タ&#8203;を&#8203;使&#8203;用&#8203;し&#8203;た&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;で&#8203;は&#8203;良&#8203;い&#8203;結&#8203;果&#8203;が&#8203;で&#8203;た&#8203;と&#8203;し&#8203;ま&#8203;す。&#8203;し&#8203;か&#8203;し、&#8203;こ&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;最&#8203;新&#8203;デー&#8203;タ&#8203;を&#8203;入&#8203;力&#8203;し&#8203;て&#8203;予&#8203;測&#8203;を&#8203;出&#8203;力&#8203;し&#8203;た&#8203;場&#8203;合、&#8203;そ&#8203;の&#8203;予&#8203;測&#8203;は&#8203;期&#8203;待&#8203;す&#8203;る&#8203;結&#8203;果&#8203;を&#8203;得&#8203;ら&#8203;れ&#8203;な&#8203;い&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;な&#8203;ぜ&#8203;な&#8203;ら、&#8203;最&#8203;新&#8203;デー&#8203;タ&#8203;の&#8203;累&#8203;積&#8203;調&#8203;整&#8203;係&#8203;数&#8203;に&#8203;は&#8203;ま&#8203;だ&#8203;発&#8203;生&#8203;し&#8203;て&#8203;い&#8203;な&#8203;い&#8203;未&#8203;来&#8203;の&#8203;情&#8203;報&#8203;は&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;た&#8203;め&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>こ&#8203;の&#8203;よ&#8203;う&#8203;に、&#8203;そ&#8203;の&#8203;日&#8203;付&#8203;時&#8203;点&#8203;で&#8203;は&#8203;取&#8203;得&#8203;で&#8203;き&#8203;な&#8203;い&#8203;未&#8203;来&#8203;の&#8203;情&#8203;報&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;入&#8203;力&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;リー&#8203;ク&#8203;と&#8203;い&#8203;い、&#8203;時&#8203;系&#8203;列&#8203;デー&#8203;タ&#8203;に&#8203;は&#8203;累&#8203;積&#8203;調&#8203;整&#8203;係&#8203;数&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;そ&#8203;の&#8203;日&#8203;付&#8203;時&#8203;点&#8203;で&#8203;は&#8203;取&#8203;得&#8203;で&#8203;き&#8203;な&#8203;い&#8203;情&#8203;報&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;リー&#8203;ク&#8203;に&#8203;は&#8203;と&#8203;く&#8203;に&#8203;注&#8203;意&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;デー&#8203;タ&#8203;の&#8203;特&#8203;性&#8203;</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>マー&#8203;ケッ&#8203;ト&#8203;が&#8203;開&#8203;い&#8203;て&#8203;い&#8203;る&#8203;日&#8203;に&#8203;取&#8203;引&#8203;が&#8203;成&#8203;立&#8203;し&#8203;な&#8203;かっ&#8203;た&#8203;銘&#8203;柄&#8203;は、&#8203;売&#8203;買&#8203;高&#8203;が&#8203;0&#8203;と&#8203;な&#8203;り、&#8203;四&#8203;本&#8203;値&#8203; (&#8203;始&#8203;値、&#8203;高&#8203;値、&#8203;安&#8203;値、&#8203;終&#8203;値&#8203;) &#8203;全&#8203;て&#8203;が&#8203;0&#8203;と&#8203;表&#8203;示&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</li>
<li>
<p>stock_price&#8203;の&#8203;デー&#8203;タ&#8203;は、&#8203;そ&#8203;の&#8203;デー&#8203;タ&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;最&#8203;新&#8203;日&#8203;付&#8203;時&#8203;点&#8203;で&#8203;累&#8203;積&#8203;調&#8203;整&#8203;係&#8203;数&#8203;1&#8203;と&#8203;な&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;調&#8203;整&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;調&#8203;整&#8203;済&#8203;み&#8203;株&#8203;価&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;も&#8203;同&#8203;様&#8203;に&#8203;過&#8203;去&#8203;に&#8203;遡っ&#8203;て&#8203;更&#8203;新&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;コー&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1301</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日&#8203;付</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/01/04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote Open</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">始&#8203;値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2800</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote High</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">高&#8203;値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2820</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote Low</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">安&#8203;値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2740</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote Close</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">終&#8203;値。&#8203;大&#8203;引&#8203;け&#8203;後&#8203;に&#8203;セッ&#8203;ト&#8203;さ&#8203;れ&#8203;る</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2750</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote ExchangeOfficialClose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">取&#8203;引&#8203;所&#8203;公&#8203;式&#8203;終&#8203;値。&#8203;最&#8203;終&#8203;の&#8203;特&#8203;別&#8203;気&#8203;配&#8203;ま&#8203;た&#8203;は&#8203;最&#8203;終&#8203;気&#8203;配&#8203;を&#8203;含&#8203;む&#8203;終&#8203;値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2750</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote Volume</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">売&#8203;買&#8203;高</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote CumulativeAdjustmentFactor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">累&#8203;積&#8203;調&#8203;整&#8203;係&#8203;数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote PreviousClose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">前&#8203;回&#8203;の&#8203;終&#8203;値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2770</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote PreviousCloseDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">前&#8203;回&#8203;の&#8203;終&#8203;値&#8203;が&#8203;発&#8203;生&#8203;し&#8203;た&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015/12/30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote PreviousExchangeOfficialClose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">前&#8203;回&#8203;の&#8203;取&#8203;引&#8203;所&#8203;公&#8203;式&#8203;終&#8203;値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2770</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote PreviousExchangeOfficialCloseDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">前&#8203;回&#8203;の&#8203;取&#8203;引&#8203;所&#8203;公&#8203;式&#8203;終&#8203;値&#8203;が&#8203;発&#8203;生&#8203;し&#8203;た&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015/12/30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote ChangeFromPreviousClose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">騰&#8203;落&#8203;幅。&#8203;前&#8203;回&#8203;終&#8203;値&#8203;と&#8203;直&#8203;近&#8203;約&#8203;定&#8203;値&#8203;の&#8203;価&#8203;格&#8203;差</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote PercentChangeFromPreviousClose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">騰&#8203;落&#8203;率。&#8203;前&#8203;回&#8203;終&#8203;値&#8203;か&#8203;ら&#8203;の&#8203;直&#8203;近&#8203;約&#8203;定&#8203;値&#8203;の&#8203;上&#8203;昇&#8203;率&#8203;ま&#8203;た&#8203;は&#8203;下&#8203;落&#8203;率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0.722</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote VWAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">売&#8203;買&#8203;高&#8203;加&#8203;重&#8203;平&#8203;均&#8203;価&#8203;格&#8203;(VWAP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2778.25</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(Quick xignite API Market Data API Catalog&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.marketdata-cloud.quick-co.jp/Products/" class="bare">https://www.marketdata-cloud.quick-co.jp/Products/</a>)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_stock_price.png" alt="sample_stock_price">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ファンダメンタル情報_stock_fin">2.2.3. ファンダメンタル情報: stock_fin</h4>
<div class="paragraph">
<p>株&#8203;式&#8203;投&#8203;資&#8203;に&#8203;お&#8203;け&#8203;る&#8203; <code>&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;</code> &#8203;と&#8203;は、&#8203;対&#8203;象&#8203;銘&#8203;柄&#8203;の&#8203;純&#8203;資&#8203;産&#8203;と&#8203;いっ&#8203;た&#8203;財&#8203;務&#8203;状&#8203;況&#8203;や&#8203;当&#8203;期&#8203;純&#8203;利&#8203;益&#8203;と&#8203;いっ&#8203;た&#8203;業&#8203;績&#8203;状&#8203;況&#8203;を&#8203;表&#8203;す&#8203;情&#8203;報&#8203;の&#8203;こ&#8203;と&#8203;で&#8203;す。&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;各&#8203;銘&#8203;柄&#8203;の&#8203;成&#8203;長&#8203;性、&#8203;収&#8203;益&#8203;性、&#8203;安&#8203;全&#8203;性、&#8203;割&#8203;安&#8203;度&#8203;な&#8203;ど&#8203;の&#8203;投&#8203;資&#8203;判&#8203;断&#8203;に&#8203;活&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;を&#8203;利&#8203;用&#8203;し&#8203;た&#8203;解&#8203;析&#8203;は、&#8203;さ&#8203;ま&#8203;ざ&#8203;ま&#8203;な&#8203;手&#8203;法&#8203;が&#8203;考&#8203;案&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;の&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;で&#8203;あ&#8203;る&#8203;stock_fin&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;い&#8203;く&#8203;つ&#8203;か&#8203;の&#8203;変&#8203;数&#8203;名&#8203;は&#8203; <code>Forecast</code> &#8203;か&#8203;ら&#8203;始&#8203;まっ&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;こ&#8203;れ&#8203;ら&#8203;は&#8203;各&#8203;企&#8203;業&#8203;が&#8203;来&#8203;期&#8203;の&#8203;自&#8203;社&#8203;の&#8203;業&#8203;績・&#8203;財&#8203;務&#8203;状&#8203;況&#8203;を&#8203;予&#8203;想&#8203;し&#8203;た&#8203;デー&#8203;タ&#8203;で&#8203;す。&#8203;例&#8203;え&#8203;ば、&#8203;企&#8203;業&#8203;が&#8203;来&#8203;期&#8203;の&#8203;業&#8203;績&#8203;が&#8203;厳&#8203;し&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;予&#8203;め&#8203;分&#8203;かっ&#8203;て&#8203;い&#8203;る&#8203;場&#8203;合&#8203;に&#8203;は、&#8203;予&#8203;想&#8203;と&#8203;し&#8203;て&#8203;早&#8203;め&#8203;に&#8203;開&#8203;示&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;予&#8203;想&#8203;の&#8203;デー&#8203;タ&#8203;も&#8203;重&#8203;要&#8203;な&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">base_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日&#8203;付</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/01/04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;コー&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2753</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement AccountingStandard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会&#8203;計&#8203;基&#8203;準&#8203;　&#8203;単&#8203;独&#8203;:NonConsolidated、&#8203;連&#8203;結&#8203;国&#8203;内&#8203;:ConsolidatedJP、&#8203;連&#8203;結&#8203;SEC:ConsolidatedUS、&#8203;連&#8203;結&#8203;IFRS:ConsolidatedIFRS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConsolidatedJP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement FiscalPeriodEnd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">決&#8203;算&#8203;期</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015/12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement ReportType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">決&#8203;算&#8203;種&#8203;別&#8203;　&#8203;第&#8203;1&#8203;四&#8203;半&#8203;期&#8203;:Q1、&#8203;中&#8203;間&#8203;決&#8203;算&#8203;:Q2、&#8203;第&#8203;3&#8203;四&#8203;半&#8203;期&#8203;:Q3、&#8203;本&#8203;決&#8203;算&#8203;:Annual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Q3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement FiscalYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">決&#8203;算&#8203;年&#8203;度。&#8203;本&#8203;決&#8203;算&#8203;の&#8203;決&#8203;算&#8203;期&#8203;末&#8203;が&#8203;属&#8203;す&#8203;る&#8203;年。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement ModifyDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">更&#8203;新&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/01/04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement CompanyType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会&#8203;社&#8203;区&#8203;分&#8203; &#8203;一&#8203;般&#8203;事&#8203;業&#8203;会&#8203;社&#8203;:GB、&#8203;銀&#8203;行&#8203;:BK、&#8203;証&#8203;券&#8203;会&#8203;社&#8203;:SE、&#8203;損&#8203;保&#8203;会&#8203;社&#8203;:IN ※&#8203;上&#8203;記&#8203;に&#8203;該&#8203;当&#8203;し&#8203;な&#8203;い&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement ChangeOfFiscalYearEnd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">決&#8203;算&#8203;期&#8203;変&#8203;更&#8203;フ&#8203;ラ&#8203;グ&#8203; &#8203;決&#8203;算&#8203;期&#8203;変&#8203;更&#8203;あ&#8203;り&#8203;:true、&#8203;決&#8203;算&#8203;期&#8203;変&#8203;更&#8203;な&#8203;し&#8203;:false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement NetSales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">売&#8203;上&#8203;高&#8203;（単&#8203;位：&#8203;百&#8203;万&#8203;円）&#8203; &#8203;会&#8203;社&#8203;区&#8203;分&#8203;に&#8203;よっ&#8203;て&#8203;項&#8203;目&#8203;名&#8203;の&#8203;読&#8203;替&#8203;え&#8203;を&#8203;行&#8203;う&#8203;い&#8203;ま&#8203;す。&#8203; &#8203;銀&#8203;行：&#8203;経&#8203;常&#8203;収&#8203;益、&#8203;証&#8203;券：&#8203;営&#8203;業&#8203;収&#8203;益、&#8203;損&#8203;保：&#8203;経&#8203;常&#8203;収&#8203;益&#8203; ※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22354</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement OperatingIncome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">営&#8203;業&#8203;利&#8203;益&#8203;（単&#8203;位：&#8203;百&#8203;万&#8203;円）&#8203; ※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2391</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement OrdinaryIncome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">経&#8203;常&#8203;利&#8203;益&#8203;（単&#8203;位：&#8203;百&#8203;万&#8203;円）&#8203; &#8203;会&#8203;計&#8203;基&#8203;準&#8203;が&#8203;連&#8203;結&#8203;SEC&#8203;の&#8203;場&#8203;合&#8203;は、&#8203;項&#8203;目&#8203;名&#8203;を&#8203;「税&#8203;引&#8203;前&#8203;利&#8203;益」&#8203;に&#8203;読&#8203;み&#8203;替&#8203;え&#8203;ま&#8203;す。&#8203; ※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2466</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement NetIncome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当&#8203;期&#8203;純&#8203;利&#8203;益&#8203;（単&#8203;位：&#8203;百&#8203;万&#8203;円）&#8203; ※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1645</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement TotalAssets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">総&#8203;資&#8203;産&#8203;（単&#8203;位：&#8203;百&#8203;万&#8203;円）&#8203; ※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21251</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement NetAssets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">純&#8203;資&#8203;産&#8203;（単&#8203;位：&#8203;百&#8203;万&#8203;円）&#8203; ※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16962</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement CashFlowsFromOperatingActivities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">営&#8203;業&#8203;キャッ&#8203;シュ&#8203;フ&#8203;ロー&#8203;（単&#8203;位：&#8203;百&#8203;万&#8203;円）&#8203; ※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12404</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement CashFlowsFromFinancingActivities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">財&#8203;務&#8203;キャッ&#8203;シュ&#8203;フ&#8203;ロー&#8203;（単&#8203;位：&#8203;百&#8203;万&#8203;円）&#8203; ※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-98</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement CashFlowsFromInvestingActivities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">投&#8203;資&#8203;キャッ&#8203;シュ&#8203;フ&#8203;ロー&#8203;（単&#8203;位：&#8203;百&#8203;万&#8203;円）&#8203; ※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1307</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement AccountingStandard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;想&#8203;: &#8203;会&#8203;計&#8203;基&#8203;準&#8203;　&#8203;単&#8203;独&#8203;:NonConsolidated、&#8203;連&#8203;結&#8203;国&#8203;内&#8203;:ConsolidatedJP、&#8203;連&#8203;結&#8203;SEC:ConsolidatedUS、&#8203;連&#8203;結&#8203;IFRS:ConsolidatedIFRS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConsolidatedJP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement FiscalPeriodEnd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来&#8203;期&#8203;予&#8203;想&#8203;情&#8203;報&#8203;:　&#8203;決&#8203;算&#8203;期</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/03</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement ReportType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来&#8203;期&#8203;予&#8203;想&#8203;情&#8203;報&#8203;:　&#8203;決&#8203;算&#8203;種&#8203;別&#8203;　&#8203;第&#8203;1&#8203;四&#8203;半&#8203;期&#8203;:Q1、&#8203;中&#8203;間&#8203;決&#8203;算&#8203;:Q2、&#8203;第&#8203;3&#8203;四&#8203;半&#8203;期&#8203;:Q3、&#8203;本&#8203;決&#8203;算&#8203;:Annual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annual</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement FiscalYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来&#8203;期&#8203;予&#8203;想&#8203;情&#8203;報&#8203;:　&#8203;決&#8203;算&#8203;年&#8203;度。&#8203;本&#8203;決&#8203;算&#8203;の&#8203;決&#8203;算&#8203;期&#8203;末&#8203;が&#8203;属&#8203;す&#8203;る&#8203;年。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement ModifyDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来&#8203;期&#8203;予&#8203;想&#8203;情&#8203;報&#8203;:　&#8203;更&#8203;新&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/01/04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement CompanyType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来&#8203;期&#8203;予&#8203;想&#8203;情&#8203;報&#8203;:　&#8203;会&#8203;社&#8203;区&#8203;分&#8203; &#8203;一&#8203;般&#8203;事&#8203;業&#8203;会&#8203;社&#8203;:GB、&#8203;銀&#8203;行&#8203;:BK、&#8203;証&#8203;券&#8203;会&#8203;社&#8203;:SE、&#8203;損&#8203;保&#8203;会&#8203;社&#8203;:IN ※&#8203;上&#8203;記&#8203;に&#8203;該&#8203;当&#8203;し&#8203;な&#8203;い&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement ChangeOfFiscalYearEnd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来&#8203;期&#8203;予&#8203;想&#8203;情&#8203;報&#8203;:　&#8203;決&#8203;算&#8203;期&#8203;変&#8203;更&#8203;フ&#8203;ラ&#8203;グ&#8203; &#8203;決&#8203;算&#8203;期&#8203;変&#8203;更&#8203;あ&#8203;り&#8203;:true、&#8203;決&#8203;算&#8203;期&#8203;変&#8203;更&#8203;な&#8203;し&#8203;:false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement NetSales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来&#8203;期&#8203;予&#8203;想&#8203;情&#8203;報&#8203;:　&#8203;売&#8203;上&#8203;高&#8203;（単&#8203;位：&#8203;百&#8203;万&#8203;円）&#8203; &#8203;会&#8203;社&#8203;区&#8203;分&#8203;に&#8203;よっ&#8203;て&#8203;項&#8203;目&#8203;名&#8203;の&#8203;読&#8203;替&#8203;え&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。&#8203; &#8203;銀&#8203;行：&#8203;経&#8203;常&#8203;収&#8203;益、&#8203;証&#8203;券：&#8203;営&#8203;業&#8203;収&#8203;益、&#8203;損&#8203;保：&#8203;経&#8203;常&#8203;収&#8203;益&#8203; ※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement OperatingIncome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来&#8203;期&#8203;予&#8203;想&#8203;情&#8203;報&#8203;:　&#8203;営&#8203;業&#8203;利&#8203;益&#8203;（単&#8203;位：&#8203;百&#8203;万&#8203;円）&#8203; ※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement OrdinaryIncome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来&#8203;期&#8203;予&#8203;想&#8203;情&#8203;報&#8203;:　&#8203;経&#8203;常&#8203;利&#8203;益&#8203;（単&#8203;位：&#8203;百&#8203;万&#8203;円）&#8203; &#8203;会&#8203;計&#8203;基&#8203;準&#8203;が&#8203;連&#8203;結&#8203;SEC&#8203;の&#8203;場&#8203;合&#8203;は、&#8203;項&#8203;目&#8203;名&#8203;を&#8203;「税&#8203;引&#8203;前&#8203;利&#8203;益」&#8203;に&#8203;読&#8203;み&#8203;替&#8203;え&#8203;ま&#8203;す。&#8203; ※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement NetIncome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来&#8203;期&#8203;予&#8203;想&#8203;情&#8203;報&#8203;:　&#8203;当&#8203;期&#8203;純&#8203;利&#8203;益&#8203;（単&#8203;位：&#8203;百&#8203;万&#8203;円）&#8203; ※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2130</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend FiscalPeriodEnd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;決&#8203;算&#8203;期</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015/11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend ReportType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;決&#8203;算&#8203;種&#8203;別&#8203;　&#8203;第&#8203;1&#8203;四&#8203;半&#8203;期&#8203;:Q1、&#8203;中&#8203;間&#8203;決&#8203;算&#8203;:Q2、&#8203;第&#8203;3&#8203;四&#8203;半&#8203;期&#8203;:Q3、&#8203;本&#8203;決&#8203;算&#8203;:Annual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annual</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend FiscalYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;決&#8203;算&#8203;年&#8203;度。&#8203;本&#8203;決&#8203;算&#8203;の&#8203;決&#8203;算&#8203;期&#8203;末&#8203;が&#8203;属&#8203;す&#8203;る&#8203;年。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend ModifyDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;更&#8203;新&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/01/07</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend RecordDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;配&#8203;当&#8203;基&#8203;準&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015/11/30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend DividendPayableDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;配&#8203;当&#8203;支&#8203;払&#8203;開&#8203;始&#8203;日&#8203;　※&#8203;予&#8203;想&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/02/29</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend QuarterlyDividendPerShare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;一&#8203;株&#8203;当&#8203;た&#8203;り&#8203;四&#8203;半&#8203;期&#8203;配&#8203;当&#8203;金&#8203;（単&#8203;位：&#8203;円）&#8203;　※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend AnnualDividendPerShare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;一&#8203;株&#8203;当&#8203;た&#8203;り&#8203;年&#8203;間&#8203;配&#8203;当&#8203;金&#8203;累&#8203;計&#8203;（単&#8203;位：&#8203;円）&#8203;※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend FiscalPeriodEnd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;想&#8203;配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;決&#8203;算&#8203;期</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/03</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend ReportType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;想&#8203;配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;決&#8203;算&#8203;種&#8203;別&#8203;　&#8203;第&#8203;1&#8203;四&#8203;半&#8203;期&#8203;:Q1、&#8203;中&#8203;間&#8203;決&#8203;算&#8203;:Q2、&#8203;第&#8203;3&#8203;四&#8203;半&#8203;期&#8203;:Q3、&#8203;本&#8203;決&#8203;算&#8203;:Annual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annual</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend FiscalYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;想&#8203;配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;決&#8203;算&#8203;年&#8203;度。&#8203;本&#8203;決&#8203;算&#8203;の&#8203;決&#8203;算&#8203;期&#8203;末&#8203;が&#8203;属&#8203;す&#8203;る&#8203;年。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend ModifyDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;想&#8203;配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;更&#8203;新&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/01/04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend RecordDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;想&#8203;配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;配&#8203;当&#8203;基&#8203;準&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/03/31</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend QuarterlyDividendPerShare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;想&#8203;配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;一&#8203;株&#8203;当&#8203;た&#8203;り&#8203;四&#8203;半&#8203;期&#8203;配&#8203;当&#8203;金&#8203;（単&#8203;位：&#8203;円）&#8203;　※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">45</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend AnnualDividendPerShare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;想&#8203;配&#8203;当&#8203;情&#8203;報&#8203;:　&#8203;一&#8203;株&#8203;当&#8203;た&#8203;り&#8203;年&#8203;間&#8203;配&#8203;当&#8203;金&#8203;累&#8203;計&#8203;（単&#8203;位：&#8203;円）&#8203;※&#8203;未&#8203;開&#8203;示&#8203;の&#8203;場&#8203;合&#8203;は&#8203;空&#8203;文&#8203;字&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;ま&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">90</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(Quick xignite API Market Data API Catalog&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.marketdata-cloud.quick-co.jp/Products/" class="bare">https://www.marketdata-cloud.quick-co.jp/Products/</a>)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_stock_fin.png" alt="sample_stock_fin">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_財務諸表株価情報_stock_fin_price">2.2.4. 財務諸表+株価情報: stock_fin_price</h4>
<div class="paragraph">
<p>stock_fin_price&#8203;は、&#8203;株&#8203;価&#8203;情&#8203;報&#8203;で&#8203;あ&#8203;る&#8203;&lt;&lt;&#8203;株&#8203;価&#8203;情&#8203;報&#8203; : stock_price, stock_price&gt;&gt;&#8203;と&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;で&#8203;あ&#8203;る&#8203;&lt;&lt;&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;: stock_fin, stock_fin&gt;&gt;&#8203;を&#8203;デー&#8203;タ&#8203;と&#8203;し&#8203;て&#8203;扱&#8203;い&#8203;や&#8203;す&#8203;い&#8203;よ&#8203;う&#8203;に&#8203;結&#8203;合&#8203;し&#8203;た&#8203;デー&#8203;タ&#8203;で&#8203;す。&#8203;変&#8203;数&#8203;名&#8203;や&#8203;型&#8203;な&#8203;ど&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;同&#8203;じ&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め&#8203;記&#8203;載&#8203;を&#8203;省&#8203;略&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>ま&#8203;た、&#8203;デー&#8203;タ&#8203;の&#8203;サ&#8203;イ&#8203;ズ&#8203;が&#8203;非&#8203;常&#8203;に&#8203;大&#8203;き&#8203;い&#8203;た&#8203;め、&#8203;必&#8203;要&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;活&#8203;用&#8203;し&#8203;て&#8203;い&#8203;た&#8203;だ&#8203;き&#8203;た&#8203;い&#8203;と&#8203;思&#8203;い&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_目的変数_stock_labels">2.2.5. 目的変数: stock_labels</h4>
<div class="paragraph">
<p>stock_labels&#8203;は&#8203;予&#8203;測&#8203;の&#8203;目&#8203;的&#8203;変&#8203;数&#8203;の&#8203;デー&#8203;タ&#8203;で&#8203;あ&#8203;り、&#8203;各&#8203;銘&#8203;柄&#8203;で&#8203;決&#8203;算&#8203;発&#8203;表&#8203;が&#8203;行&#8203;わ&#8203;れ&#8203;た&#8203;日&#8203;の&#8203;取&#8203;引&#8203;所&#8203;公&#8203;式&#8203;終&#8203;値&#8203;か&#8203;ら、&#8203;そ&#8203;の&#8203;日&#8203;の&#8203;翌&#8203;営&#8203;業&#8203;日&#8203;以&#8203;降&#8203;N&#8203;（5，&#8203;10，&#8203;20）&#8203;営&#8203;業&#8203;日&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る&#8203;最&#8203;高&#8203;値&#8203;及&#8203;び&#8203;最&#8203;安&#8203;値&#8203;へ&#8203;の&#8203;変&#8203;化&#8203;率&#8203;を&#8203;記&#8203;録&#8203;し&#8203;た&#8203;デー&#8203;タ&#8203;で&#8203;す。&#8203;<br>
各&#8203;値&#8203;の&#8203;計&#8203;算&#8203;式&#8203;は、&#8203; <code>([&#8203;基&#8203;準&#8203;日&#8203;付&#8203;の&#8203;翌&#8203;日&#8203;以&#8203;降&#8203;N&#8203;営&#8203;業&#8203;日&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る&#8203;高&#8203;値&#8203;/&#8203;安&#8203;値&#8203;] / [&#8203;基&#8203;準&#8203;日&#8203;付&#8203;の&#8203;終&#8203;値&#8203;]) - 1</code> &#8203;で&#8203;す。&#8203;<br>
な&#8203;お、&#8203;ラ&#8203;ベ&#8203;ル&#8203;の&#8203;対&#8203;象&#8203;期&#8203;間&#8203; (5、&#8203;10、&#8203;20&#8203;営&#8203;業&#8203;日&#8203;の&#8203;間&#8203;) &#8203;に&#8203;値&#8203;が&#8203;付&#8203;か&#8203;な&#8203;かっ&#8203;た&#8203;場&#8203;合&#8203;は、&#8203;ラ&#8203;ベ&#8203;ル&#8203;を&#8203; <code>NaN</code> &#8203;と&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">base_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基&#8203;準&#8203;日&#8203;付&#8203;（各&#8203;銘&#8203;柄&#8203;で&#8203;決&#8203;算&#8203;短&#8203;信&#8203;等&#8203;の&#8203;開&#8203;示&#8203;が&#8203;さ&#8203;れ&#8203;た&#8203;日）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016-01-04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;コー&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1301</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_date_5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基&#8203;準&#8203;日&#8203;付&#8203;か&#8203;ら&#8203;5&#8203;営&#8203;業&#8203;日&#8203;後&#8203;の&#8203;日&#8203;付。&#8203;label_high_5&#8203;算&#8203;出&#8203;に&#8203;使&#8203;用&#8203;さ&#8203;れ&#8203;る&#8203;終&#8203;値&#8203;範&#8203;囲&#8203;の&#8203;基&#8203;準&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016-01-12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_high_5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基&#8203;準&#8203;日&#8203;付&#8203;の&#8203;終&#8203;値&#8203;か&#8203;ら&#8203;5&#8203;営&#8203;業&#8203;日&#8203;の&#8203;間&#8203;の&#8203;最&#8203;高&#8203;値&#8203;へ&#8203;の&#8203;変&#8203;化&#8203;率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00364</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_low_5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基&#8203;準&#8203;日&#8203;付&#8203;の&#8203;終&#8203;値&#8203;か&#8203;ら&#8203;5&#8203;営&#8203;業&#8203;日&#8203;の&#8203;間&#8203;の&#8203;最&#8203;安&#8203;値&#8203;へ&#8203;の&#8203;変&#8203;化&#8203;率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0.04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_date_10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基&#8203;準&#8203;日&#8203;付&#8203;か&#8203;ら&#8203;10&#8203;営&#8203;業&#8203;日&#8203;後&#8203;の&#8203;日&#8203;付。&#8203;label_high_10&#8203;算&#8203;出&#8203;に&#8203;使&#8203;用&#8203;さ&#8203;れ&#8203;る&#8203;終&#8203;値&#8203;範&#8203;囲&#8203;の&#8203;基&#8203;準&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016-01-19</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_high_10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基&#8203;準&#8203;日&#8203;付&#8203;の&#8203;終&#8203;値&#8203;か&#8203;ら&#8203;10&#8203;営&#8203;業&#8203;日&#8203;の&#8203;間&#8203;の&#8203;最&#8203;高&#8203;値&#8203;へ&#8203;の&#8203;変&#8203;化&#8203;率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00364</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_low_10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基&#8203;準&#8203;日&#8203;付&#8203;の&#8203;終&#8203;値&#8203;か&#8203;ら&#8203;10&#8203;営&#8203;業&#8203;日&#8203;の&#8203;間&#8203;の&#8203;最&#8203;安&#8203;値&#8203;へ&#8203;の&#8203;変&#8203;化&#8203;率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0.05455</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_date_20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基&#8203;準&#8203;日&#8203;付&#8203;か&#8203;ら&#8203;20&#8203;営&#8203;業&#8203;日&#8203;後&#8203;の&#8203;日&#8203;付。&#8203;label_high_20&#8203;算&#8203;出&#8203;に&#8203;使&#8203;用&#8203;さ&#8203;れ&#8203;る&#8203;終&#8203;値&#8203;範&#8203;囲&#8203;の&#8203;基&#8203;準&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016-02-02</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_high_20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基&#8203;準&#8203;日&#8203;付&#8203;の&#8203;終&#8203;値&#8203;か&#8203;ら&#8203;20&#8203;営&#8203;業&#8203;日&#8203;の&#8203;間&#8203;の&#8203;最&#8203;高&#8203;値&#8203;へ&#8203;の&#8203;変&#8203;化&#8203;率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00364</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_low_20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基&#8203;準&#8203;日&#8203;付&#8203;の&#8203;終&#8203;値&#8203;か&#8203;ら&#8203;20&#8203;営&#8203;業&#8203;日&#8203;の&#8203;間&#8203;の&#8203;最&#8203;安&#8203;値&#8203;へ&#8203;の&#8203;変&#8203;化&#8203;率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0.08364</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_stock_labels.png" alt="sample_stock_label">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_実行環境及び必要なライブラリ">2.3. 実行環境及び必要なライブラリ</h3>
<div class="sect3">
<h4 id="_実行環境">2.3.1. 実行環境</h4>
<div class="paragraph">
<p>本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;実&#8203;行&#8203;環&#8203;境&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;提&#8203;出&#8203;す&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;実&#8203;行&#8203;環&#8203;境&#8203;と&#8203;同&#8203;一&#8203;環&#8203;境&#8203;と&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;以&#8203;下&#8203;の&#8203;python&#8203;環&#8203;境&#8203;を&#8203;用&#8203;い&#8203;ま&#8203;す。&#8203;環&#8203;境&#8203;構&#8203;築&#8203;方&#8203;法&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;詳&#8203;し&#8203;く&#8203;は&#8203; <a href="https://signate.jp/features/runtime/detail">SIGNATE: Runtime &#8203;投&#8203;稿&#8203;方&#8203;法&#8203;: &#8203;ロー&#8203;カ&#8203;ル&#8203;開&#8203;発&#8203;環&#8203;境&#8203;の&#8203;構&#8203;築&#8203;方&#8203;法&#8203;は？&#8203;</a> &#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>anaconda3-2019.03</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_google_colaboratoryの利用">2.3.2. Google Colaboratoryの利用</h4>
<div class="paragraph">
<p>本&#8203;章&#8203;は&#8203;Docker&#8203;を&#8203;用&#8203;い&#8203;た&#8203;実&#8203;行&#8203;環&#8203;境&#8203;の&#8203;利&#8203;用&#8203;を&#8203;想&#8203;定&#8203;し&#8203;て&#8203;記&#8203;述&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;Docker&#8203;の&#8203;実&#8203;行&#8203;環&#8203;境&#8203;構&#8203;築&#8203;が&#8203;ご&#8203;利&#8203;用&#8203;の&#8203;OS&#8203;な&#8203;ど&#8203;何&#8203;ら&#8203;か&#8203;の&#8203;理&#8203;由&#8203;に&#8203;よ&#8203;り&#8203;困&#8203;難&#8203;な&#8203;方、&#8203;よ&#8203;り&#8203;簡&#8203;便&#8203;に&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;を&#8203;実&#8203;行&#8203;し&#8203;た&#8203;い&#8203;方&#8203;は&#8203;Google Colaboratory&#8203;の&#8203;利&#8203;用&#8203;を&#8203;ご&#8203;検&#8203;討&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;提&#8203;供&#8203;さ&#8203;れ&#8203;る&#8203;Notebook&#8203;は&#8203;Google Colaboratory&#8203;で&#8203;も&#8203;実&#8203;行&#8203;可&#8203;能&#8203;で&#8203;す。&#8203;詳&#8203;細&#8203;は&#8203;第&#8203;7&#8203;章&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
</div>
<div class="sect3">
<h4 id="_dockerを用いた実行環境構築方法">2.3.3. Dockerを用いた実行環境構築方法</h4>
<div class="paragraph">
<p>本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;リ&#8203;ポ&#8203;ジ&#8203;ト&#8203;リ&#8203;を&#8203; <code>git clone</code> &#8203;し&#8203;て&#8203;い&#8203;た&#8203;だ&#8203;き、&#8203;以&#8203;下&#8203;の&#8203;手&#8203;順&#8203;を&#8203;実&#8203;行&#8203;し&#8203;て&#8203;い&#8203;た&#8203;だ&#8203;く&#8203;こ&#8203;と&#8203;で&#8203;実&#8203;行&#8203;環&#8203;境&#8203;の&#8203;docker&#8203;コ&#8203;ン&#8203;テ&#8203;ナ&#8203;内&#8203;で&#8203;jupyter notebook&#8203;を&#8203;起&#8203;動&#8203;可&#8203;能&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203; <code>Chapter02</code> &#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;内&#8203;に&#8203;は、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;記&#8203;載&#8203;し&#8203;た&#8203; ipynb &#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;配&#8203;置&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で&#8203;必&#8203;要&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;ご&#8203;活&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>Windows&#8203;環&#8203;境&#8203;の&#8203;場&#8203;合、&#8203;コ&#8203;マ&#8203;ン&#8203;ド&#8203;実&#8203;行&#8203;に&#8203;は&#8203;「PowerShell」&#8203;な&#8203;ど&#8203;を&#8203;ご&#8203;使&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;な&#8203;お、&#8203;PowerShell&#8203;の&#8203;利&#8203;用&#8203;に&#8203;当&#8203;たっ&#8203;て&#8203;は、&#8203;最&#8203;新&#8203;の&#8203;セ&#8203;キュ&#8203;リ&#8203;ティ&#8203;事&#8203;情&#8203;を&#8203;踏&#8203;ま&#8203;え&#8203;ご&#8203;自&#8203;身&#8203;で&#8203;ご&#8203;判&#8203;断&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>docker &#8203;の&#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203; <a href="http://docs.docker.jp/get-docker.html" class="bare">http://docs.docker.jp/get-docker.html</a> &#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;docker &#8203;の&#8203;制&#8203;約&#8203;と&#8203;し&#8203;て&#8203;マ&#8203;ウ&#8203;ン&#8203;ト&#8203;す&#8203;る&#8203;パ&#8203;ス&#8203;に&#8203;は&#8203;ア&#8203;ル&#8203;ファ&#8203;ベッ&#8203;ト、&#8203;数&#8203;字、&#8203;「_」、&#8203;「.」、&#8203;「-」&#8203;以&#8203;外&#8203;の&#8203;文&#8203;字&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;と&#8203;エ&#8203;ラー&#8203;と&#8203;な&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;あ&#8203;る&#8203;よ&#8203;う&#8203;で&#8203;す。&#8203;そ&#8203;の&#8203;場&#8203;合&#8203;は、&#8203;パ&#8203;ス&#8203;が&#8203;前&#8203;述&#8203;の&#8203;文&#8203;字&#8203;の&#8203;み&#8203;で&#8203;構&#8203;成&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;ご&#8203;使&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd handson/

# データ配置先のディレクトリを作成
mkdir data_dir
# その後作成したhandson/data_dirに、コンペティションサイトよりデータをダウンロードし配置します。

# dockerでjupyter notebookを起動します。(初回実行時は約2GB程度コンテナイメージをダウンロードします。)
# データ配置先のディレクトリを /path/to としてマウントしています。
# 学習済みモデル提出用のディレクトリ (handson/Chapter02/archive) を /opt/ml としてマウントしています。
# jupyter notebook作業用に handson ディレクトリを /notebook としてマウントしています。
# jupyter notebook は port 8888でtokenとpasswordを空にして、vscode のjupyter pluginからアクセスできるように xsrf 対策を無効化しています。
docker run --name tutorial -v ${PWD}/data_dir:/path/to -v ${PWD}/Chapter02/archive:/opt/ml -v ${PWD}:/notebook -e PYTHONPATH=/opt/ml/src -p8888:8888 --rm -it continuumio/anaconda3:2019.03 jupyter notebook --ip 0.0.0.0 --allow-root --no-browser --no-mathjax --NotebookApp.disable_check_xsrf=True  --NotebookApp.token='' --NotebookApp.password='' /notebook

# ブラウザで以下のURLにアクセスしてjupyter notebookの画面が表示されていて、本チュートリアル用のnotebookが表示されていることを確認します。
http://localhost:8888/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_必要なライブラリのインストール">2.3.4. 必要なライブラリのインストール</h4>
<div class="paragraph">
<p>本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;内&#8203;で&#8203;は、&#8203;上&#8203;記&#8203;の&#8203;実&#8203;行&#8203;環&#8203;境&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;以&#8203;下&#8203;の&#8203;コ&#8203;マ&#8203;ン&#8203;ド&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;個&#8203;別&#8203;に&#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># shap用にg++とgccをインストールします
apt-get update
apt-get install -y --no-install-recommends g++ gcc

# 必要なライブラリをインストールします
pip install shap==0.37.0 slicer==0.0.3 xgboost==1.3.0.post0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ライブラリの読み込み">2.3.5. ライブラリの読み込み</h4>
<div class="paragraph">
<p>本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は、&#8203;下&#8203;記&#8203;の&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;の&#8203;イ&#8203;ン&#8203;ポー&#8203;ト&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">import</span> <span class="include">os</span>
<span class="keyword">import</span> <span class="include">pickle</span>
<span class="keyword">import</span> <span class="include">sys</span>
<span class="keyword">import</span> <span class="include">warnings</span>
<span class="keyword">from</span> <span class="include">glob</span> <span class="keyword">import</span> <span class="include">glob</span>

<span class="keyword">import</span> <span class="include">matplotlib</span>
<span class="keyword">import</span> <span class="include">matplotlib.pyplot</span> <span class="keyword">as</span> plt
<span class="keyword">import</span> <span class="include">numpy</span> <span class="keyword">as</span> np
<span class="keyword">import</span> <span class="include">pandas</span> <span class="keyword">as</span> pd
<span class="keyword">import</span> <span class="include">seaborn</span> <span class="keyword">as</span> sns
<span class="keyword">import</span> <span class="include">shap</span>
<span class="keyword">import</span> <span class="include">xgboost</span>
<span class="keyword">from</span> <span class="include">scipy.stats</span> <span class="keyword">import</span> <span class="include">spearmanr</span>
<span class="keyword">from</span> <span class="include">sklearn.ensemble</span> <span class="keyword">import</span> (
    ExtraTreesRegressor,
    GradientBoostingRegressor,
    RandomForestRegressor,
)
<span class="keyword">from</span> <span class="include">sklearn.metrics</span> <span class="keyword">import</span> <span class="include">accuracy_score</span>, <span class="include">mean_squared_error</span>
<span class="keyword">from</span> <span class="include">tqdm.auto</span> <span class="keyword">import</span> <span class="include">tqdm</span>


<span class="comment"># 表示用の設定を変更します</span>
%matplotlib inline
pd.options.display.max_rows = <span class="integer">100</span>
pd.options.display.max_columns = <span class="integer">100</span>
pd.options.display.width = <span class="integer">120</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ライブラリ解説">2.3.6. ライブラリ解説</h4>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;目&#8203;的&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;公&#8203;式&#8203;ド&#8203;キュ&#8203;メ&#8203;ン&#8203;ト&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;入&#8203;門&#8203;解&#8203;説&#8203;</strong> ｑ</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pandas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デー&#8203;タ&#8203;の&#8203;処&#8203;理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://pandas.pydata.org/docs/">pandas documentation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/ysdyt/items/9ccca82fc5b504e7913a">Qiita:データ分析で頻出のPandas基本操作</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">numpy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デー&#8203;タ&#8203;の&#8203;処&#8203;理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://numpy.org/doc/stable/user/tutorials_index.html">NumPy Tutorials</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/jyori112/items/a15658d1dd17c421e1e2">Qiita:numpyの使い方</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">glob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファ&#8203;イ&#8203;ル&#8203;の&#8203;検&#8203;知</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.python.org/3/library/glob.html">glob &#8203;—&#8203; Unix style pathname pattern expansion</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/HirosuguTakeshita/items/0e0850362c7eb3b10ea1">Qiita:【備忘録】globの使い方</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tqdm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">計&#8203;算&#8203;の&#8203;進&#8203;捗&#8203;確&#8203;認</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://tqdm.github.io/">tqdm</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/pontyo4/items/76145cb10e030ad8186a">Qiita:tqdmでプログレスバーを表示させる</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sklearn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">機&#8203;械&#8203;学&#8203;習&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;成</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://scikit-learn.org/stable/tutorial/index.html">https://scikit-learn.org/stable/tutorial/index.html</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/ynakayama/items/9c5867b6947aa41e9229">Qiita:scikit-learn &#8203;か&#8203;ら&#8203;学&#8203;ぶ&#8203;機&#8203;械&#8203;学&#8203;習&#8203;の&#8203;手&#8203;法&#8203;の&#8203;概&#8203;要&#8203;</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matplotlib</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デー&#8203;タ&#8203;の&#8203;可&#8203;視&#8203;化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://matplotlib.org/tutorials/index.html">matplotlib tutorials</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/skotaro/items/08dc0b8c5704c94eafb9">Qiita:早く知っておきたかったmatplotlibの基礎知識、あるいは見た目の調整が捗るArtistの話</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scipy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">統&#8203;計&#8203;用&#8203;の&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.scipy.org/doc/scipy/reference/tutorial/index.html">SciPy Tutorial</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://amorphous.tf.chiba-u.jp/lecture.files/chem_computer/11_scipy%E3%81%AE%E5%9F%BA%E6%9C%AC%E3%81%A8%E5%BF%9C%E7%94%A8/11.html">千葉大: &#8203;コ&#8203;ン&#8203;ピュー&#8203;タ&#8203;処&#8203;理&#8203; &#8203;ド&#8203;キュ&#8203;メ&#8203;ン&#8203;ト&#8203; 11. scipy&#8203;の&#8203;基&#8203;本&#8203;と&#8203;応&#8203;用&#8203;</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">seaborn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デー&#8203;タ&#8203;の&#8203;可&#8203;視&#8203;化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://seaborn.pydata.org/tutorial.html">User guide and tutorial</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/hik0107/items/3dc541158fceb3156ee0">Qiita:pythonで美しいグラフ描画 -seaborn&#8203;を&#8203;使&#8203;え&#8203;ば&#8203;デー&#8203;タ&#8203;分&#8203;析&#8203;と&#8203;可&#8203;視&#8203;化&#8203;が&#8203;捗&#8203;る&#8203; &#8203;そ&#8203;の&#8203;1</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">shap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHAP&#8203;分&#8203;析</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://shap.readthedocs.io/en/latest/">Welcome to the SHAP Documentation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/shin_mura/items/cde01198552eda9146b7">Shapを用いた機械学習モデルの解釈説明</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xgboost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">機&#8203;械&#8203;学&#8203;習&#8203;モ&#8203;デ&#8203;ル</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://xgboost.readthedocs.io/en/latest/">XGBoost Documentation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/triwave33/items/aad60f25485a4595b5c8">XGBoost論文を丁寧に解説する(1)</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_実行環境の確認">2.3.7. 実行環境の確認</h4>
<div class="paragraph">
<p>python&#8203;の&#8203;バー&#8203;ジョ&#8203;ン&#8203;が&#8203;3.7.3&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">print(sys.version)</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">3.7.3 (default, Mar 27 2019, 22:11:17)
[GCC 7.3.0]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_データセットの読み込み">2.4. データセットの読み込み</h3>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;用&#8203;に&#8203;提&#8203;供&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;て、&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;解&#8203;凍&#8203;し&#8203;た&#8203;場&#8203;所&#8203;を&#8203;定&#8203;義&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># データセット保存先ディレクトリ（&quot;&quot;の中身はご自身の環境に合わせて定義してください。）</span>
dataset_dir=<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>デー&#8203;タ&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。&#8203;な&#8203;お、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は&#8203; <code>stock_fin</code> &#8203;及&#8203;び&#8203; <code>stock_price</code> &#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;た&#8203;め、&#8203; <code>stock_fin_price</code> &#8203;は&#8203;読&#8203;み&#8203;込&#8203;ま&#8203;ず&#8203;に&#8203;進&#8203;め&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 読み込むファイルを定義します。</span>
inputs = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_list.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_price.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_fin.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="comment"># 本チュートリアルでは使用しないため、コメントアウトしています。</span>
    <span class="comment"># &quot;stock_fin_price&quot;: f&quot;{dataset_dir}/stock_fin_price.csv.gz&quot;,</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_labels.csv.gz</span><span class="delimiter">&quot;</span></span>,
}

<span class="comment"># ファイルを読み込みます</span>
dfs = {}
<span class="keyword">for</span> k, v <span class="keyword">in</span> inputs.items():
    print(k)
    dfs[k] = pd.read_csv(v)
    <span class="comment"># DataFrameのindexを設定します。</span>
    <span class="keyword">if</span> k == <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>:
        dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = pd.to_datetime(
            dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>]
        )
        dfs[k].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
    <span class="keyword">elif</span> k <span class="keyword">in</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin_price</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>]:
        dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = pd.to_datetime(
            dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">base_date</span><span class="delimiter">&quot;</span></span>]
        )
        dfs[k].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>読&#8203;み&#8203;込&#8203;ん&#8203;だ&#8203;デー&#8203;タ&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">for</span> k <span class="keyword">in</span> inputs.keys():
    print(k)
    print(dfs[k].info())
    print(dfs[k].head(<span class="integer">1</span>).T)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_データセットの可視化">2.5. データセットの可視化</h3>
<div class="paragraph">
<p>デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;各&#8203;項&#8203;目&#8203;の&#8203;特&#8203;徴&#8203;を&#8203;把&#8203;握&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;上&#8203;で&#8203;重&#8203;要&#8203;な&#8203;要&#8203;素&#8203;の&#8203;1&#8203;つ&#8203;で&#8203;す。&#8203;一&#8203;般&#8203;に&#8203;デー&#8203;タ&#8203;の&#8203;特&#8203;徴&#8203;を&#8203;把&#8203;握&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;は、&#8203;各&#8203;項&#8203;目&#8203;の&#8203;意&#8203;味&#8203;を&#8203;把&#8203;握&#8203;し、&#8203;値&#8203;の&#8203;平&#8203;均&#8203;や&#8203;標&#8203;準&#8203;偏&#8203;差&#8203;な&#8203;ど&#8203;の&#8203;基&#8203;本&#8203;統&#8203;計&#8203;量&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203;可&#8203;視&#8203;化&#8203;も&#8203;そ&#8203;う&#8203;いっ&#8203;た&#8203;特&#8203;徴&#8203;把&#8203;握&#8203;の&#8203;手&#8203;法&#8203;の&#8203;1&#8203;つ&#8203;で、&#8203;デー&#8203;タ&#8203;を&#8203;グ&#8203;ラ&#8203;フ&#8203;な&#8203;ど&#8203;で&#8203;表&#8203;現&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;特&#8203;性&#8203;を&#8203;直&#8203;感&#8203;的&#8203;に&#8203;理&#8203;解&#8203;で&#8203;き&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>Chapter 2.2 &#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;説&#8203;明&#8203;で&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;で&#8203;用&#8203;い&#8203;る&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;し&#8203;た。&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;そ&#8203;れ&#8203;ら&#8203;の&#8203;デー&#8203;タ&#8203;を、&#8203; <code>matplotlib</code> &#8203;と&#8203; <code>seaborn</code> &#8203;を&#8203;用&#8203;い&#8203;て&#8203;可&#8203;視&#8203;化&#8203;し&#8203;ま&#8203;す。&#8203;財&#8203;務&#8203;諸&#8203;表、&#8203;株&#8203;価、&#8203;移&#8203;動&#8203;平&#8203;均、&#8203;価&#8203;格&#8203;変&#8203;化&#8203;率、&#8203;ヒ&#8203;ス&#8203;ト&#8203;リ&#8203;カ&#8203;ル・&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;を&#8203;個&#8203;別&#8203;で&#8203;見&#8203;て、&#8203;最&#8203;後&#8203;に&#8203;1&#8203;つ&#8203;の&#8203;グ&#8203;ラ&#8203;フ&#8203;と&#8203;し&#8203;て&#8203;ま&#8203;と&#8203;め&#8203;て&#8203;可&#8203;視&#8203;化&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_財務諸表">2.5.1. 財務諸表</h4>
<div class="paragraph">
<p>ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;は&#8203;項&#8203;目&#8203;が&#8203;多&#8203;い&#8203;た&#8203;め、&#8203;今&#8203;回&#8203;は、&#8203;売&#8203;上&#8203;高、&#8203;営&#8203;業&#8203;利&#8203;益、&#8203;純&#8203;利&#8203;益、&#8203;純&#8203;資&#8203;産&#8203;及&#8203;び&#8203;そ&#8203;の&#8203;決&#8203;算&#8203;期&#8203;の&#8203;間&#8203;の&#8203;関&#8203;係&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;可&#8203;視&#8203;化&#8203;し&#8203;ま&#8203;す。&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;と&#8203;し&#8203;て、&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;9984&#8203;の&#8203;「ソ&#8203;フ&#8203;ト&#8203;バ&#8203;ン&#8203;ク&#8203;グ&#8203;ルー&#8203;プ」&#8203;を&#8203;可&#8203;視&#8203;化&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_finの読み込み</span>
fin = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 銘柄コード9984にデータを絞る</span>
code = <span class="integer">9984</span>
fin_data = fin[fin[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]

<span class="comment"># 2019年までの値を表示</span>
fin_data = fin_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># プロット対象を定義</span>
columns = [
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetSales</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 売上高</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OperatingIncome</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 営業利益</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetIncome</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 純利益</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetAssets</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 純資産</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>  <span class="comment"># 決算期</span>
]

<span class="comment"># プロット</span>
sns.pairplot(fin_data[columns], hue=<span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>, height=<span class="integer">5</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_fin_stock.png" alt="sample fin plot">
</div>
</div>
<div class="paragraph">
<p>上&#8203;記&#8203;の&#8203;プ&#8203;ロッ&#8203;ト&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す&#8203;と、&#8203;各&#8203;色&#8203;（緑、&#8203;赤、&#8203;青、&#8203;オ&#8203;レ&#8203;ン&#8203;ジ）&#8203;は&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;Q1,Q2,Q3,Annual&#8203;に&#8203;お&#8203;け&#8203;る&#8203;決&#8203;算&#8203;の&#8203;値&#8203;に&#8203;対&#8203;応&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;対&#8203;角&#8203;に&#8203;並&#8203;ん&#8203;で&#8203;い&#8203;る&#8203;プ&#8203;ロッ&#8203;ト&#8203;は&#8203;各&#8203;軸&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;分&#8203;布&#8203;を&#8203;表&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;そ&#8203;の&#8203;他&#8203;の&#8203;プ&#8203;ロッ&#8203;ト&#8203;は、&#8203;各&#8203;軸&#8203;2&#8203;つ&#8203;の&#8203;変&#8203;数&#8203;の&#8203;散&#8203;布&#8203;図&#8203;を&#8203;表&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;<br>
例&#8203;え&#8203;ば、&#8203;2&#8203;行&#8203;1&#8203;列&#8203;目&#8203;の&#8203;グ&#8203;ラ&#8203;フ&#8203;を&#8203;見&#8203;る&#8203;と、&#8203;横&#8203;軸&#8203;が&#8203;売&#8203;上&#8203;高、&#8203;縦&#8203;軸&#8203;が&#8203;営&#8203;業&#8203;利&#8203;益&#8203;に&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;高&#8203;い&#8203;売&#8203;上&#8203;高&#8203;は&#8203;高&#8203;い&#8203;営&#8203;業&#8203;利&#8203;益&#8203;に&#8203;繋&#8203;がっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;決&#8203;算&#8203;期&#8203;が&#8203;Q1&#8203;か&#8203;ら&#8203;Q3,&#8203;本&#8203;決&#8203;算&#8203;に&#8203;至&#8203;る&#8203;ま&#8203;で&#8203;に&#8203;基&#8203;本&#8203;的&#8203;に&#8203;右&#8203;肩&#8203;上&#8203;が&#8203;り&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;分&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;こ&#8203;と&#8203;か&#8203;ら&#8203;財&#8203;務&#8203;デー&#8203;タ&#8203;の&#8203;純&#8203;売&#8203;上&#8203;高&#8203;や&#8203;営&#8203;業&#8203;利&#8203;益&#8203;な&#8203;ど&#8203;の&#8203;変&#8203;数&#8203;は、&#8203;各&#8203;決&#8203;算&#8203;期&#8203;ご&#8203;と&#8203;の&#8203;値&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;各&#8203;決&#8203;算&#8203;期&#8203;を&#8203;積&#8203;み&#8203;上&#8203;げ&#8203;式&#8203;で&#8203;記&#8203;録&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;と&#8203;推&#8203;測&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="sect4">
<h5 id="_複数銘柄のファンダメンタル情報の比較">複数銘柄のファンダメンタル情報の比較</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_finの読み込み</span>
fin = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 銘柄コード9984と9983を比較する</span>
codes = [<span class="integer">9984</span>, <span class="integer">9983</span>]

multi_df = <span class="predefined">dict</span>()

<span class="comment"># プロット対象を定義</span>
columns = [
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetSales</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 売上高</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OperatingIncome</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 営業利益</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetIncome</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 純利益</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetAssets</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 純資産</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>  <span class="comment"># 決算期</span>
]

<span class="comment"># 比較対象の銘柄コード毎に処理</span>
<span class="keyword">for</span> code <span class="keyword">in</span> codes:
    <span class="comment"># 特定の銘柄コードに絞り込み</span>
    fin_data = fin[fin[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
    <span class="comment"># 2019年までの値を表示</span>
    fin_data = fin_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>].copy()
    <span class="comment"># 重複を排除</span>
    fin_data.drop_duplicates(
        subset=[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement FiscalYear</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>
        ],
        keep=<span class="string"><span class="delimiter">&quot;</span><span class="content">last</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
    <span class="comment"># プロット対象のカラムを取得</span>
    _fin_data = fin_data[columns]
    <span class="comment"># 決算期毎の平均を取得</span>
    multi_df[code] = _fin_data[columns].groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>).mean()

<span class="comment"># 銘柄毎に処理していたものを結合</span>
multi_df = pd.concat(multi_df)
<span class="comment"># 凡例を調整</span>
multi_df.set_index(multi_df.index.map(<span class="keyword">lambda</span> t: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{t[0]}/{t[1]}</span><span class="delimiter">&quot;</span></span>), inplace=<span class="predefined-constant">True</span>)
<span class="comment"># プロット</span>
ax = multi_df.T.plot(kind=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, figsize=(<span class="integer">12</span>, <span class="integer">6</span>), grid=<span class="predefined-constant">True</span>)
<span class="comment"># Y軸のラベルを調整</span>
ax.get_yaxis().set_major_formatter(matplotlib.ticker.FuncFormatter(<span class="keyword">lambda</span> x, p: <span class="string"><span class="delimiter">&quot;</span><span class="content">{} bYen</span><span class="delimiter">&quot;</span></span>.format(<span class="predefined">int</span>(x / <span class="integer">1</span>_000))))</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_comparison.png" alt="sample_comparison">
</div>
</div>
<div class="paragraph">
<p>画&#8203;像&#8203;の&#8203;中&#8203;に&#8203;コ&#8203;メ&#8203;ン&#8203;ト&#8203;を&#8203;記&#8203;載&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;NetSales&#8203;（売&#8203;上&#8203;高）&#8203;と&#8203;NetAssets&#8203;（純&#8203;資&#8203;産）&#8203;の&#8203;特&#8203;性&#8203;の&#8203;違&#8203;い&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;NetAssets&#8203;は&#8203;一&#8203;定&#8203;の&#8203;数&#8203;値&#8203;に&#8203;なっ&#8203;て&#8203;お&#8203;り、&#8203;決&#8203;算&#8203;期&#8203;の&#8203;影&#8203;響&#8203;を&#8203;あ&#8203;ま&#8203;り&#8203;受&#8203;け&#8203;て&#8203;い&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;一&#8203;方、&#8203;NetSales&#8203;は&#8203;Q1&#8203;か&#8203;ら&#8203;Annual&#8203;に&#8203;か&#8203;け&#8203;て&#8203;数&#8203;値&#8203;が&#8203;積&#8203;み&#8203;上&#8203;がっ&#8203;て&#8203;お&#8203;り、&#8203;Q1&#8203;か&#8203;ら&#8203;決&#8203;算&#8203;期&#8203;が&#8203;進&#8203;む&#8203;ご&#8203;と&#8203;に&#8203;大&#8203;き&#8203;く&#8203;な&#8203;る&#8203;特&#8203;性&#8203;を&#8203;持&#8203;つ&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_株価">2.5.2. 株価</h4>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は、&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;と&#8203;し&#8203;て&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;9984&#8203;の&#8203;「ソ&#8203;フ&#8203;ト&#8203;バ&#8203;ン&#8203;ク&#8203;グ&#8203;ルー&#8203;プ」&#8203;の&#8203;終&#8203;値&#8203;の&#8203;動&#8203;き&#8203;を&#8203;可&#8203;視&#8203;化&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_priceの読み込み</span>
price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 特定の銘柄コードに絞り込み</span>
code = <span class="integer">9984</span>
price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
<span class="comment"># 2019年までの値を表示</span>
price_data = price_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># プロット</span>
fig, ax = plt.subplots(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))

ax.plot(price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>], label=f<span class="string"><span class="delimiter">&quot;</span><span class="content">securities code : {code}.T</span><span class="delimiter">&quot;</span></span>)
ax.set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>)
ax.set_xlabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>)
ax.grid(<span class="predefined-constant">True</span>)
ax.legend()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_stock_price_close.png" alt="sample_close_price">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_移動平均">2.5.3. 移動平均</h4>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は&#8203;移&#8203;動&#8203;平&#8203;均&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。&#8203;移&#8203;動&#8203;平&#8203;均&#8203;に&#8203;も&#8203;さ&#8203;ま&#8203;ざ&#8203;ま&#8203;な&#8203;種&#8203;類&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;単&#8203;純&#8203;移&#8203;動&#8203;平&#8203;均&#8203;線&#8203;を&#8203;用&#8203;い&#8203;ま&#8203;す。&#8203;単&#8203;純&#8203;移&#8203;動&#8203;平&#8203;均&#8203;線&#8203;と&#8203;い&#8203;う&#8203;の&#8203;は、&#8203;例&#8203;え&#8203;ば、&#8203;5&#8203;日&#8203;線&#8203;で&#8203;あ&#8203;れ&#8203;ば、&#8203;直&#8203;近&#8203;5&#8203;営&#8203;業&#8203;日&#8203;の&#8203;価&#8203;格&#8203;の&#8203;平&#8203;均&#8203;値&#8203;で&#8203;す。&#8203;こ&#8203;れ&#8203;を&#8203;1&#8203;つ&#8203;ず&#8203;つ&#8203;期&#8203;間&#8203;を&#8203;ス&#8203;ラ&#8203;イ&#8203;ド&#8203;し&#8203;な&#8203;が&#8203;ら&#8203;計&#8203;算&#8203;し&#8203;た&#8203;も&#8203;の&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_priceの読み込み</span>
price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 特定の銘柄コードに絞り込み</span>
code = <span class="integer">9984</span>
price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
<span class="comment"># 2019年までの値を表示</span>
price_data = price_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>].copy()

<span class="comment"># 5日、25日、75日の移動平均を算出</span>
periods = [<span class="integer">5</span>, <span class="integer">25</span>, <span class="integer">75</span>]
cols = []
<span class="keyword">for</span> period <span class="keyword">in</span> periods:
    col = <span class="string"><span class="delimiter">&quot;</span><span class="content">{} windows simple moving average</span><span class="delimiter">&quot;</span></span>.format(period)
    price_data[col] = price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(period, min_periods=<span class="integer">1</span>).mean()
    cols.append(col)

<span class="comment"># プロット</span>
fig, ax = plt.subplots(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))

<span class="keyword">for</span> col <span class="keyword">in</span> cols:
    ax.plot(price_data[col], label=col)
ax.set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>)
ax.set_xlabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>)
ax.grid(<span class="predefined-constant">True</span>)
ax.legend()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_moving_average.png" alt="sample_SMA">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_価格変化率">2.5.4. 価格変化率</h4>
<div class="paragraph">
<p>価&#8203;格&#8203;変&#8203;化&#8203;率&#8203;は、&#8203;価&#8203;格&#8203;が&#8203;そ&#8203;の&#8203;期&#8203;間&#8203;で&#8203;ど&#8203;れ&#8203;く&#8203;ら&#8203;い&#8203;変&#8203;化&#8203;し&#8203;た&#8203;か&#8203;を&#8203;(%)&#8203;で&#8203;表&#8203;現&#8203;し&#8203;た&#8203;も&#8203;の&#8203;で&#8203;す。&#8203;相&#8203;場&#8203;の&#8203;勢&#8203;い&#8203;や&#8203;方&#8203;向&#8203;性&#8203;等&#8203;を&#8203;判&#8203;断&#8203;す&#8203;る&#8203;際&#8203;に&#8203;よ&#8203;く&#8203;使&#8203;わ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_priceの読み込み</span>
price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 特定の銘柄コードに絞り込み</span>
code = <span class="integer">9984</span>
price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
<span class="comment"># 2019年までの値を表示</span>
price_data = price_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>].copy()

<span class="comment"># 5日、25日、75日の価格変化率を算出</span>
periods = [<span class="integer">5</span>, <span class="integer">25</span>, <span class="integer">75</span>]
cols = []
<span class="keyword">for</span> period <span class="keyword">in</span> periods:
    col = <span class="string"><span class="delimiter">&quot;</span><span class="content">{} windows rate of return</span><span class="delimiter">&quot;</span></span>.format(period)
    price_data[col] = price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(period) * <span class="integer">100</span>
    cols.append(col)

<span class="comment"># プロット</span>
fig, ax = plt.subplots(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))

<span class="keyword">for</span> col <span class="keyword">in</span> cols:
    ax.plot(price_data[col], label=col)
ax.set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">rate of return (%)</span><span class="delimiter">&quot;</span></span>)
ax.set_xlabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>)
ax.grid(<span class="predefined-constant">True</span>)
ax.legend()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_rate_of_return.png" alt="sample_rr">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ヒストリカルボラティリティ">2.5.5. ヒストリカル・ボラティリティ</h4>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は&#8203;ヒ&#8203;ス&#8203;ト&#8203;リ&#8203;カ&#8203;ル・&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;を&#8203;計&#8203;算&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;計&#8203;算&#8203;す&#8203;る&#8203;ヒ&#8203;ス&#8203;ト&#8203;リ&#8203;カ&#8203;ル・&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;は、&#8203;5&#8203;日、&#8203;25&#8203;日、&#8203;75&#8203;日&#8203;の&#8203;対&#8203;数&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;標&#8203;準&#8203;偏&#8203;差&#8203;で&#8203;す。&#8203;ヒ&#8203;ス&#8203;ト&#8203;リ&#8203;カ&#8203;ル・&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;は&#8203;リ&#8203;ス&#8203;ク&#8203;指&#8203;標&#8203;の&#8203;一&#8203;つ&#8203;で、&#8203;価&#8203;格&#8203;が&#8203;ど&#8203;の&#8203;程&#8203;度&#8203;激&#8203;し&#8203;く&#8203;変&#8203;動&#8203;し&#8203;た&#8203;か&#8203;を&#8203;把&#8203;握&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;利&#8203;用&#8203;し&#8203;ま&#8203;す。&#8203;一&#8203;般&#8203;的&#8203;に&#8203;ヒ&#8203;ス&#8203;ト&#8203;リ&#8203;カ&#8203;ル・&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;が&#8203;大&#8203;き&#8203;い&#8203;銘&#8203;柄&#8203;は、&#8203;小&#8203;さ&#8203;い&#8203;銘&#8203;柄&#8203;よ&#8203;り&#8203;も&#8203;資&#8203;産&#8203;と&#8203;し&#8203;て&#8203;保&#8203;持&#8203;す&#8203;る&#8203;リ&#8203;ス&#8203;ク&#8203;が&#8203;相&#8203;対&#8203;的&#8203;に&#8203;高&#8203;い&#8203;と&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_priceの読み込み</span>
price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 特定の銘柄コードに絞り込み</span>
code = <span class="integer">9984</span>
price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
<span class="comment"># 2019年までの値を表示</span>
price_data = price_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>].copy()

<span class="comment"># 5日、25日、75日のヒストリカル・ボラティリティを算出</span>
periods = [<span class="integer">5</span>, <span class="integer">25</span>, <span class="integer">75</span>]
cols = []
<span class="keyword">for</span> period <span class="keyword">in</span> periods:
    col = <span class="string"><span class="delimiter">&quot;</span><span class="content">{} windows volatility</span><span class="delimiter">&quot;</span></span>.format(period)
    price_data[col] = np.log(price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(period).std()
    cols.append(col)

<span class="comment"># プロット</span>
fig, ax = plt.subplots(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))

<span class="keyword">for</span> col <span class="keyword">in</span> cols:
    ax.plot(price_data[col], label=col)
ax.set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility</span><span class="delimiter">&quot;</span></span>)
ax.set_xlabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>)
ax.grid(<span class="predefined-constant">True</span>)
ax.legend()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_volatility.png" alt="sample_volatility">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_複数の株価データを同時にプロット">2.5.6. 複数の株価データを同時にプロット</h4>
<div class="paragraph">
<p>こ&#8203;れ&#8203;ま&#8203;で&#8203;可&#8203;視&#8203;化&#8203;し&#8203;て&#8203;き&#8203;た&#8203;株&#8203;価&#8203;に&#8203;関&#8203;す&#8203;る&#8203;デー&#8203;タ&#8203;を&#8203;同&#8203;時&#8203;に&#8203;プ&#8203;ロッ&#8203;ト&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;値&#8203;の&#8203;関&#8203;連&#8203;性&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;考&#8203;察&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_priceの読み込み</span>
price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 特定の銘柄コードに絞り込み</span>
code = <span class="integer">9984</span>
price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
<span class="comment"># 2019年までの値を表示</span>
price_data = price_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>].copy()

<span class="comment"># 5日、25日、75日を対象に値を算出</span>
periods = [<span class="integer">5</span>, <span class="integer">25</span>, <span class="integer">75</span>]
ma_cols = []
<span class="comment"># 移動平均線</span>
<span class="keyword">for</span> period <span class="keyword">in</span> periods:
    col = <span class="string"><span class="delimiter">&quot;</span><span class="content">{} windows simple moving average</span><span class="delimiter">&quot;</span></span>.format(period)
    price_data[col] = price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(period, min_periods=<span class="integer">1</span>).mean()
    ma_cols.append(col)

return_cols = []
<span class="comment"># 価格変化率</span>
<span class="keyword">for</span> period <span class="keyword">in</span> periods:
    col = <span class="string"><span class="delimiter">&quot;</span><span class="content">{} windows rate of return</span><span class="delimiter">&quot;</span></span>.format(period)
    price_data[col] = price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(period) * <span class="integer">100</span>
    return_cols.append(col)

vol_cols = []
<span class="comment"># ヒストリカル・ボラティリティ</span>
<span class="keyword">for</span> period <span class="keyword">in</span> periods:
    col = <span class="string"><span class="delimiter">&quot;</span><span class="content">{} windows volatility</span><span class="delimiter">&quot;</span></span>.format(period)
    price_data[col] = np.log(price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(period).std()
    vol_cols.append(col)

<span class="comment"># プロット</span>
fig, ax = plt.subplots(nrows=<span class="integer">3</span> ,figsize=(<span class="integer">20</span>, <span class="integer">8</span>))

ax[<span class="integer">0</span>].plot(price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>], label=<span class="string"><span class="delimiter">&quot;</span><span class="content">Close Price</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">for</span> col <span class="keyword">in</span> ma_cols:
    ax[<span class="integer">0</span>].plot(price_data[col], label=col)

<span class="keyword">for</span> col <span class="keyword">in</span> return_cols:
    ax[<span class="integer">1</span>].plot(price_data[col], label=col)

<span class="keyword">for</span> col <span class="keyword">in</span> vol_cols:
    ax[<span class="integer">2</span>].plot(price_data[col], label=col)

ax[<span class="integer">0</span>].set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>)
ax[<span class="integer">1</span>].set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">rate of return (%)</span><span class="delimiter">&quot;</span></span>)
ax[<span class="integer">2</span>].set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility (log return)</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">for</span> _ax <span class="keyword">in</span> ax:
    _ax.set_xlabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>)
    _ax.grid(<span class="predefined-constant">True</span>)
    _ax.legend()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_plot_all_features.png" alt="plot_all_features">
</div>
</div>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は&#8203;2018&#8203;年&#8203;末&#8203;に&#8203;起&#8203;き&#8203;た&#8203;株&#8203;価&#8203;の&#8203;下&#8203;落&#8203;に&#8203;着&#8203;目&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;す。&#8203;複&#8203;数&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;並&#8203;べ&#8203;て&#8203;プ&#8203;ロッ&#8203;ト&#8203;す&#8203;る&#8203;と、&#8203;株&#8203;価&#8203;に&#8203;大&#8203;き&#8203;な&#8203;変&#8203;動&#8203;が&#8203;あっ&#8203;た&#8203;時&#8203;に&#8203;他&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;に&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;影&#8203;響&#8203;を&#8203;与&#8203;え&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;観&#8203;測&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>移&#8203;動&#8203;平&#8203;均&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;は、&#8203;期&#8203;間&#8203;が&#8203;短&#8203;い&#8203;ほ&#8203;ど&#8203;敏&#8203;感&#8203;に&#8203;株&#8203;価&#8203;の&#8203;下&#8203;落&#8203;に&#8203;反&#8203;応&#8203;し、&#8203;期&#8203;間&#8203;が&#8203;長&#8203;い&#8203;特&#8203;徴&#8203;量&#8203;ほ&#8203;ど&#8203;反&#8203;応&#8203;が&#8203;遅&#8203;れ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;も&#8203;下&#8203;落&#8203;時&#8203;に&#8203;は&#8203;同&#8203;一&#8203;の&#8203;傾&#8203;向&#8203;が&#8203;見&#8203;て&#8203;取&#8203;れ&#8203;ま&#8203;す&#8203;が、&#8203;そ&#8203;の&#8203;後&#8203;高&#8203;い&#8203;リ&#8203;ター&#8203;ン&#8203;が&#8203;観&#8203;測&#8203;さ&#8203;れ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;一&#8203;方、&#8203;ヒ&#8203;ス&#8203;ト&#8203;リ&#8203;カ&#8203;ル・&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;の&#8203;挙&#8203;動&#8203;を&#8203;み&#8203;る&#8203;と、&#8203;下&#8203;落&#8203;の&#8203;前&#8203;に&#8203;じ&#8203;わ&#8203;じ&#8203;わ&#8203;と&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;が&#8203;上&#8203;昇&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;一&#8203;つ&#8203;の&#8203;株&#8203;価&#8203;の&#8203;下&#8203;落&#8203;を&#8203;見&#8203;て&#8203;も、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;挙&#8203;動&#8203;が&#8203;微&#8203;妙&#8203;に&#8203;異&#8203;なっ&#8203;て&#8203;お&#8203;り、&#8203;複&#8203;数&#8203;個&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;投&#8203;入&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;挙&#8203;動&#8203;の&#8203;パ&#8203;ター&#8203;ン&#8203;を&#8203;学&#8203;習&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;想&#8203;像&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_データセットの前処理">2.6. データセットの前処理</h3>
<div class="paragraph">
<p>こ&#8203;こ&#8203;ま&#8203;で&#8203;デー&#8203;タ&#8203;の&#8203;読&#8203;み&#8203;込&#8203;み&#8203;及&#8203;び&#8203;可&#8203;視&#8203;化&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;て&#8203;き&#8203;ま&#8203;し&#8203;た&#8203;が、&#8203;こ&#8203;こ&#8203;か&#8203;ら&#8203;は&#8203;デー&#8203;タ&#8203;の&#8203;前&#8203;処&#8203;理&#8203;や&#8203;モ&#8203;デ&#8203;ル&#8203;構&#8203;築&#8203;に&#8203;関&#8203;し&#8203;て&#8203;説&#8203;明&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。
大&#8203;ま&#8203;か&#8203;な&#8203;流&#8203;れ&#8203;は、&#8203;次&#8203;の&#8203;図&#8203;の&#8203;と&#8203;お&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/flow_chart.png" alt="pipeline">
</div>
</div>
<div class="paragraph">
<p>上&#8203;図&#8203;の&#8203;と&#8203;お&#8203;り、&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;構&#8203;築&#8203;す&#8203;る&#8203;際&#8203;に&#8203;は、&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;そ&#8203;の&#8203;ま&#8203;ま&#8203;入&#8203;力&#8203;す&#8203;る&#8203;の&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;欠&#8203;損&#8203;値&#8203;処&#8203;理&#8203;や&#8203;正&#8203;規&#8203;化&#8203;処&#8203;理&#8203;な&#8203;ど&#8203;の&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;前&#8203;処&#8203;理&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;か&#8203;ら&#8203;入&#8203;力&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;一&#8203;般&#8203;的&#8203;で&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;前&#8203;処&#8203;理&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;解&#8203;説&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_欠損値処理">2.6.1. 欠損値処理</h4>
<div class="paragraph">
<p>機&#8203;械&#8203;学&#8203;習&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;多&#8203;く&#8203;は&#8203;欠&#8203;損&#8203;値&#8203;を&#8203;そ&#8203;の&#8203;ま&#8203;ま&#8203;扱&#8203;う&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;な&#8203;い&#8203;た&#8203;め、&#8203;補&#8203;完&#8203;す&#8203;る&#8203;な&#8203;ど&#8203;し&#8203;て&#8203;対&#8203;処&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;欠&#8203;損&#8203;値&#8203;補&#8203;完&#8203;の&#8203;方&#8203;法&#8203;と&#8203;し&#8203;て&#8203;は、&#8203;平&#8203;均&#8203;値&#8203;埋&#8203;め&#8203;や&#8203;リ&#8203;ス&#8203;ト&#8203;ワ&#8203;イ&#8203;ズ&#8203;法、&#8203;多&#8203;重&#8203;代&#8203;入&#8203;法&#8203;な&#8203;ど&#8203;が&#8203;存&#8203;在&#8203;し&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;変&#8203;数&#8203;に&#8203;欠&#8203;損&#8203;が&#8203;存&#8203;在&#8203;す&#8203;る&#8203;レ&#8203;コー&#8203;ド&#8203;を&#8203;単&#8203;に&#8203;除&#8203;外&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;や、&#8203;欠&#8203;損&#8203;を&#8203;多&#8203;く&#8203;含&#8203;む&#8203;変&#8203;数&#8203;自&#8203;体&#8203;を&#8203;除&#8203;外&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_欠損値の処理方法">2.6.2. 欠損値の処理方法</h4>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;デー&#8203;タ&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;ま&#8203;ず&#8203;は&#8203;実&#8203;際&#8203;に&#8203;欠&#8203;損&#8203;が&#8203;発&#8203;生&#8203;し&#8203;て&#8203;い&#8203;る&#8203;箇&#8203;所&#8203;や&#8203;パ&#8203;ター&#8203;ン&#8203;を&#8203;特&#8203;定&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に、&#8203;欠&#8203;損&#8203;の&#8203;発&#8203;生&#8203;状&#8203;況&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;て&#8203;確&#8203;認&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_finデータを読み込む</span>
stock_fin = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 2019年までの値を表示</span>
stock_fin = stock_fin[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># データ数の確認</span>
print(stock_fin.shape)

<span class="comment"># データの欠損値数を確認</span>
print(stock_fin.isna().sum())

<span class="comment"># 欠損値の数を年別に集計</span>
stock_fin = stock_fin.isna()
stock_fin[<span class="string"><span class="delimiter">&quot;</span><span class="content">year</span><span class="delimiter">&quot;</span></span>] = stock_fin.index.year

<span class="comment"># データの欠損値をプロット</span>
fig, ax = plt.subplots(figsize=(<span class="integer">20</span>, <span class="integer">5</span>))
sns.heatmap(stock_fin.groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">year</span><span class="delimiter">&quot;</span></span>).agg(<span class="string"><span class="delimiter">&quot;</span><span class="content">sum</span><span class="delimiter">&quot;</span></span>), ax=ax)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/missing_values.png" alt="欠損値">
</div>
</div>
<div class="paragraph">
<p>明&#8203;る&#8203;い&#8203;色&#8203;で&#8203;示&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;箇&#8203;所&#8203;は、&#8203;欠&#8203;損&#8203;値&#8203;が&#8203;多&#8203;く&#8203;発&#8203;生&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;表&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は&#8203;欠&#8203;損&#8203;値&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;対&#8203;応&#8203;し&#8203;ま&#8203;す。&#8203;<br>
・&#8203;`Result_FinancialStatement` &#8203;の&#8203; <code>CashFlowsFromOperatingActivities</code> 、&#8203; <code>CashFlowsFromFinancingActivities</code> 、&#8203; <code>CashFlowsFromInvestingActivities</code> &#8203;に&#8203;多&#8203;く&#8203;の&#8203;欠&#8203;損&#8203;値&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;（上&#8203;図&#8203;中&#8203;央&#8203;左）。&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;カ&#8203;ラ&#8203;ム&#8203;の&#8203;値&#8203;は&#8203; <code>Result_FinancialStatement ReportType</code> &#8203;が&#8203; <code>Annual</code> &#8203;の&#8203;場&#8203;合&#8203;に&#8203;の&#8203;み&#8203;値&#8203;が&#8203;入っ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;欠&#8203;損&#8203;値&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203; <code>0</code> &#8203;を&#8203;代&#8203;入&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;対&#8203;処&#8203;し&#8203;ま&#8203;す。&#8203;<br>
・&#8203;配&#8203;当&#8203;支&#8203;払&#8203;開&#8203;始&#8203;日&#8203;を&#8203;表&#8203;す&#8203; <code>Result_Dividend DividendPayableDate</code> &#8203;や&#8203;予&#8203;想&#8203;配&#8203;当&#8203;基&#8203;準&#8203;日&#8203;を&#8203;表&#8203;す&#8203; <code>Forecast_Dividend RecordDate</code> &#8203;と&#8203;い&#8203;う&#8203;デー&#8203;タ&#8203;列&#8203;等&#8203;の&#8203;float64&#8203;型&#8203;以&#8203;外&#8203;の&#8203;デー&#8203;タ&#8203;列&#8203;に&#8203;数&#8203;多&#8203;く&#8203;欠&#8203;損&#8203;が&#8203;発&#8203;生&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;分&#8203;か&#8203;り&#8203;ま&#8203;す&#8203;（上&#8203;図&#8203;右&#8203;側）。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は&#8203;float64&#8203;型&#8203;と&#8203;し&#8203;て&#8203;読&#8203;み&#8203;込&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;カ&#8203;ラ&#8203;ム&#8203;の&#8203;み&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;と&#8203;し&#8203;ま&#8203;す。&#8203;<br>
・&#8203;上&#8203;記&#8203;に&#8203;記&#8203;載&#8203;し&#8203;た&#8203;キャッ&#8203;シュ&#8203;フ&#8203;ロー&#8203;に&#8203;関&#8203;す&#8203;る&#8203;カ&#8203;ラ&#8203;ム&#8203;以&#8203;外&#8203;の&#8203;float64&#8203;型&#8203;と&#8203;し&#8203;て&#8203;読&#8203;み&#8203;込&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;カ&#8203;ラ&#8203;ム&#8203;の&#8203;欠&#8203;損&#8203;値&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;も、&#8203; <code>0</code> &#8203;を&#8203;代&#8203;入&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;対&#8203;処&#8203;し&#8203;ま&#8203;す。&#8203;た&#8203;だ&#8203;し、&#8203;変&#8203;数&#8203;に&#8203;よっ&#8203;て&#8203;は、&#8203;0&#8203;と&#8203;い&#8203;う&#8203;数&#8203;字&#8203;自&#8203;体&#8203;に&#8203;意&#8203;味&#8203;が&#8203;あ&#8203;る&#8203;ケー&#8203;ス&#8203;が&#8203;有&#8203;る&#8203;た&#8203;め、&#8203;気&#8203;を&#8203;つ&#8203;け&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>実&#8203;際&#8203;の&#8203;欠&#8203;損&#8203;値&#8203;処&#8203;理&#8203;は、&#8203;次&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;変&#8203;数&#8203;の&#8203;型&#8203; (&#8203;今&#8203;回&#8203;は&#8203; <code>np.float64</code> &#8203;と&#8203;い&#8203;う&#8203;型&#8203;を&#8203;選&#8203;択&#8203;) &#8203;別&#8203;に&#8203;後&#8203;段&#8203;処&#8203;理&#8203;で&#8203;き&#8203;る&#8203;値&#8203; (&#8203;今&#8203;回&#8203;は&#8203; <code>0</code>) &#8203;で&#8203;欠&#8203;損&#8203;値&#8203;を&#8203;埋&#8203;め&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_finデータを読み込む</span>
stock_fin = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 銘柄コード9984にデータを絞る</span>
code = <span class="integer">9984</span>
stock_fin = stock_fin[stock_fin[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]

<span class="comment"># float64型の列に絞り込み</span>
fin_data = stock_fin.select_dtypes(include=[<span class="string"><span class="delimiter">&quot;</span><span class="content">float64</span><span class="delimiter">&quot;</span></span>])

<span class="comment"># 欠損値を0でフィル</span>
fin_data = fin_data.fillna(<span class="integer">0</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="anchor-2.7">2.7. 特徴量の生成</h3>
<div class="sect3">
<h4 id="_なぜ特徴量の設計が重要なのか">2.7.1. なぜ特徴量の設計が重要なのか</h4>
<div class="paragraph">
<p>機&#8203;械&#8203;学&#8203;習&#8203;の&#8203;手&#8203;法&#8203;に&#8203;は&#8203;<strong>&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;で&#8203;き&#8203;る&#8203;だ&#8203;け&#8203;生&#8203;に&#8203;近&#8203;い&#8203;デー&#8203;タ&#8203;を&#8203;与&#8203;え&#8203;て&#8203;そ&#8203;の&#8203;関&#8203;係&#8203;性&#8203;を&#8203;見&#8203;つ&#8203;け&#8203;る&#8203;手&#8203;法&#8203;</strong>&#8203;と&#8203;<strong>&#8203;ド&#8203;メ&#8203;イ&#8203;ン&#8203;知&#8203;識&#8203;や&#8203;専&#8203;門&#8203;性&#8203;を&#8203;活&#8203;か&#8203;し&#8203;て、&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;設&#8203;計&#8203;す&#8203;る&#8203;手&#8203;法&#8203;</strong>&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>前&#8203;者&#8203;の&#8203;手&#8203;法&#8203;は&#8203;End-To-End Learning&#8203;と&#8203;呼&#8203;ば&#8203;れ、&#8203;生&#8203;に&#8203;近&#8203;い&#8203;デー&#8203;タ&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;与&#8203;え、&#8203;そ&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;自&#8203;体&#8203;に&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;発&#8203;見&#8203;さ&#8203;せ&#8203;る&#8203;手&#8203;法&#8203;で&#8203;す。&#8203;音&#8203;声&#8203;認&#8203;識&#8203;な&#8203;ど&#8203;の&#8203;分&#8203;野&#8203;で&#8203;活&#8203;用&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;<br>
本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は、&#8203;金&#8203;融&#8203;デー&#8203;タ&#8203;に&#8203;慣&#8203;れ&#8203;親&#8203;し&#8203;ん&#8203;で&#8203;い&#8203;た&#8203;だ&#8203;く&#8203;た&#8203;め&#8203;に&#8203;も、&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;影&#8203;響&#8203;を&#8203;細&#8203;か&#8203;く&#8203;考&#8203;察&#8203;し&#8203;な&#8203;が&#8203;ら&#8203;汎&#8203;化&#8203;性&#8203;能&#8203;に&#8203;貢&#8203;献&#8203;す&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;設&#8203;計&#8203;し&#8203;て&#8203;い&#8203;く&#8203;ア&#8203;プ&#8203;ロー&#8203;チ&#8203;で、&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;構&#8203;築&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>特&#8203;徴&#8203;量&#8203;生&#8203;成&#8203;は、&#8203;仮&#8203;説&#8203;を&#8203;考&#8203;え、&#8203;そ&#8203;の&#8203;仮&#8203;説&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;学&#8203;ぶ&#8203;に&#8203;は&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;特&#8203;徴&#8203;量&#8203;が&#8203;必&#8203;要&#8203;か、&#8203;と&#8203;い&#8203;う&#8203;こ&#8203;と&#8203;を&#8203;想&#8203;像&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;重&#8203;要&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は、&#8203;「直&#8203;近&#8203;株&#8203;価&#8203;が&#8203;上&#8203;がっ&#8203;た&#8203;ら、&#8203;高&#8203;値&#8203;も&#8203;よ&#8203;り&#8203;大&#8203;き&#8203;く&#8203;変&#8203;動&#8203;し&#8203;や&#8203;す&#8203;い」&#8203;と&#8203;い&#8203;う&#8203;仮&#8203;説&#8203;を&#8203;立&#8203;て、&#8203;こ&#8203;の&#8203;仮&#8203;説&#8203;を&#8203;基&#8203;に&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;生&#8203;成&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;仮&#8203;説&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;学&#8203;ぶ&#8203;た&#8203;め&#8203;に&#8203;は&#8203;直&#8203;近&#8203;株&#8203;価&#8203;が&#8203;上&#8203;がっ&#8203;た&#8203;こ&#8203;と&#8203;を&#8203;示&#8203;す&#8203;特&#8203;徴&#8203;量&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。&#8203;直&#8203;近&#8203;を&#8203;仮&#8203;に&#8203;1ヶ&#8203;月&#8203;と&#8203;仮&#8203;定&#8203;す&#8203;る&#8203;と、&#8203;20&#8203;日&#8203;リ&#8203;ター&#8203;ン&#8203;や&#8203;20&#8203;日&#8203;移&#8203;動&#8203;平&#8203;均&#8203;乖&#8203;離&#8203;率&#8203;な&#8203;ど&#8203;が&#8203;候&#8203;補&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>ま&#8203;た、&#8203;こ&#8203;の&#8203;仮&#8203;説&#8203;が&#8203;市&#8203;場&#8203;に&#8203;お&#8203;い&#8203;て&#8203;も&#8203;必&#8203;ず&#8203;し&#8203;も&#8203;正&#8203;し&#8203;い&#8203;と&#8203;い&#8203;う&#8203;必&#8203;要&#8203;は&#8203;な&#8203;く、&#8203;仮&#8203;説&#8203;を&#8203;思&#8203;い&#8203;つ&#8203;い&#8203;た&#8203;ら、&#8203;そ&#8203;の&#8203;仮&#8203;説&#8203;を&#8203;学&#8203;ぶ&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;想&#8203;像&#8203;し、&#8203;実&#8203;際&#8203;に&#8203;実&#8203;験&#8203;し&#8203;て&#8203;み&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;重&#8203;要&#8203;で&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_定常性を意識した特徴量設計">2.7.2. 定常性を意識した特徴量設計</h4>
<div class="paragraph">
<p>時&#8203;系&#8203;列&#8203;デー&#8203;タ&#8203;を&#8203;扱&#8203;う&#8203;際&#8203;に&#8203;は、&#8203;定&#8203;常&#8203;性&#8203;を&#8203;意&#8203;識&#8203;し&#8203;て&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;設&#8203;計&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;重&#8203;要&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;株&#8203;価&#8203;を&#8203;そ&#8203;の&#8203;ま&#8203;ま&#8203;学&#8203;習&#8203;さ&#8203;せ&#8203;た&#8203;ケー&#8203;ス&#8203;</strong>&#8203;と&#8203;<strong>&#8203;定&#8203;常&#8203;性&#8203;が&#8203;あ&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;ケー&#8203;ス&#8203;</strong>&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;考&#8203;え&#8203;て&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;株&#8203;価&#8203;を&#8203;そ&#8203;の&#8203;ま&#8203;ま&#8203;学&#8203;習&#8203;さ&#8203;せ&#8203;た&#8203;ケー&#8203;ス&#8203;</strong>: &#8203;例&#8203;え&#8203;ば、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;訓&#8203;練&#8203;期&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る&#8203;株&#8203;価&#8203;が、&#8203;100&#8203;円〜&#8203;110&#8203;円&#8203;の&#8203;範&#8203;囲&#8203;で&#8203;動&#8203;い&#8203;た&#8203;と&#8203;し&#8203;ま&#8203;す。&#8203;も&#8203;し、&#8203;こ&#8203;の&#8203;数&#8203;値&#8203;を&#8203;そ&#8203;の&#8203;ま&#8203;ま&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;投&#8203;入&#8203;す&#8203;る&#8203;と、&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203;株&#8203;価&#8203;が&#8203;100&#8203;円〜&#8203;110&#8203;円&#8203;近&#8203;辺&#8203;で&#8203;動&#8203;く&#8203;こ&#8203;と&#8203;を&#8203;暗&#8203;黙&#8203;に&#8203;学&#8203;習&#8203;し&#8203;ま&#8203;す。&#8203;し&#8203;か&#8203;し、&#8203;こ&#8203;の&#8203;暗&#8203;黙&#8203;の&#8203;仮&#8203;定&#8203;は&#8203;実&#8203;際&#8203;の&#8203;マー&#8203;ケッ&#8203;ト&#8203;で&#8203;は&#8203;成&#8203;立&#8203;し&#8203;て&#8203;お&#8203;ら&#8203;ず、&#8203;テ&#8203;ス&#8203;ト&#8203;期&#8203;間&#8203;で&#8203;株&#8203;価&#8203;が&#8203;高&#8203;騰&#8203;す&#8203;る&#8203;と、&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;う&#8203;ま&#8203;く&#8203;動&#8203;か&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;他&#8203;に&#8203;も&#8203;株&#8203;価&#8203;に&#8203;特&#8203;有&#8203;の&#8203;例&#8203;と&#8203;し&#8203;て&#8203;は&#8203;株&#8203;式&#8203;分&#8203;割&#8203;や&#8203;株&#8203;式&#8203;併&#8203;合&#8203;に&#8203;よ&#8203;り&#8203;株&#8203;価&#8203;の&#8203;レ&#8203;ン&#8203;ジ&#8203;が&#8203;大&#8203;き&#8203;く&#8203;変&#8203;動&#8203;す&#8203;る&#8203;場&#8203;合&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;定&#8203;常&#8203;性&#8203;が&#8203;あ&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;ケー&#8203;ス&#8203;</strong>: &#8203;例&#8203;え&#8203;ば、&#8203;20&#8203;日&#8203;の&#8203;価&#8203;格&#8203;変&#8203;化&#8203;率&#8203;を&#8203;考&#8203;え&#8203;る&#8203;と、&#8203;こ&#8203;れ&#8203;は&#8203;正&#8203;規&#8203;分&#8203;布&#8203;で&#8203;は&#8203;あ&#8203;り&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;一&#8203;部&#8203;の&#8203;マー&#8203;ケッ&#8203;ト&#8203;の&#8203;混&#8203;乱&#8203;期&#8203;を&#8203;除&#8203;け&#8203;ば&#8203;ほ&#8203;ぼ&#8203;0&#8203;を&#8203;中&#8203;心&#8203;と&#8203;し&#8203;た&#8203;正&#8203;規&#8203;分&#8203;布&#8203;に&#8203;近&#8203;い&#8203;分&#8203;布&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;特&#8203;徴&#8203;量&#8203;は、&#8203;2%&#8203;の&#8203;上&#8203;昇&#8203;や&#8203;4%&#8203;の&#8203;下&#8203;落&#8203;と&#8203;いっ&#8203;た&#8203;0&#8203;を&#8203;中&#8203;心&#8203;と&#8203;し&#8203;た&#8203;時&#8203;系&#8203;列&#8203;と&#8203;なっ&#8203;て&#8203;お&#8203;り、&#8203;将&#8203;来&#8203;に&#8203;渡っ&#8203;て&#8203;も&#8203;似&#8203;た&#8203;よ&#8203;う&#8203;な&#8203;分&#8203;布&#8203;に&#8203;な&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;期&#8203;待&#8203;で&#8203;き、&#8203;株&#8203;価&#8203;範&#8203;囲&#8203;に&#8203;対&#8203;す&#8203;る&#8203;暗&#8203;黙&#8203;の&#8203;仮&#8203;定&#8203;を&#8203;学&#8203;ぶ&#8203;恐&#8203;れ&#8203;が&#8203;な&#8203;く&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;将&#8203;来&#8203;に&#8203;渡っ&#8203;て&#8203;も&#8203;似&#8203;た&#8203;よ&#8203;う&#8203;な&#8203;分&#8203;布&#8203;を&#8203;期&#8203;待&#8203;で&#8203;き&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;は&#8203;定&#8203;常&#8203;性&#8203;が&#8203;あ&#8203;る&#8203;と&#8203;い&#8203;え&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>定&#8203;常&#8203;性&#8203;を&#8203;意&#8203;識&#8203;す&#8203;る&#8203;と、&#8203;正&#8203;規&#8203;化&#8203;処&#8203;理&#8203;に&#8203;お&#8203;け&#8203;る&#8203;様々&#8203;な&#8203;注&#8203;意&#8203;点&#8203;が&#8203;見&#8203;え&#8203;て&#8203;き&#8203;ま&#8203;す。&#8203;た&#8203;と&#8203;え&#8203;ば、&#8203;最&#8203;小&#8203;値&#8203;と&#8203;最&#8203;大&#8203;値&#8203;を&#8203;-1&#8203;か&#8203;ら&#8203;1&#8203;な&#8203;ど&#8203;に&#8203;マッ&#8203;ピ&#8203;ン&#8203;グ&#8203;す&#8203;る&#8203;MinMax&#8203;正&#8203;規&#8203;化&#8203;を&#8203;株&#8203;価&#8203;に&#8203;適&#8203;用&#8203;し&#8203;た&#8203;と&#8203;し&#8203;て&#8203;も&#8203;定&#8203;常&#8203;性&#8203;を&#8203;期&#8203;待&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;で&#8203;き&#8203;ま&#8203;せ&#8203;ん。&#8203;株&#8203;価&#8203;を&#8203;MinMax&#8203;正&#8203;規&#8203;化&#8203;し&#8203;た&#8203;と&#8203;き&#8203;に&#8203;そ&#8203;の&#8203;最&#8203;大&#8203;値・&#8203;最&#8203;小&#8203;値&#8203;が&#8203;未&#8203;来&#8203;に&#8203;対&#8203;し&#8203;て&#8203;も&#8203;適&#8203;用&#8203;で&#8203;き&#8203;る&#8203;保&#8203;証&#8203;が&#8203;で&#8203;き&#8203;な&#8203;い&#8203;た&#8203;め&#8203;で&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;時&#8203;系&#8203;列&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;設&#8203;計&#8203;を&#8203;す&#8203;る&#8203;と&#8203;き、&#8203;定&#8203;常&#8203;性&#8203;を&#8203;意&#8203;識&#8203;し&#8203;な&#8203;が&#8203;ら&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;設&#8203;計&#8203;し&#8203;て&#8203;い&#8203;く&#8203;こ&#8203;と&#8203;が&#8203;重&#8203;要&#8203;で&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_特徴量の生成例">2.7.3. 特徴量の生成例</h4>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は、&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;生&#8203;成&#8203;を&#8203; <code>stock_price</code> &#8203;の&#8203;株&#8203;価&#8203;情&#8203;報&#8203;を&#8203;利&#8203;用&#8203;し&#8203;て&#8203;行&#8203;い&#8203;ま&#8203;す。&#8203;株&#8203;価&#8203;情&#8203;報&#8203;に&#8203;は、&#8203;価&#8203;格&#8203;や&#8203;出&#8203;来&#8203;高&#8203;な&#8203;ど&#8203;市&#8203;場&#8203;で&#8203;公&#8203;開&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;株&#8203;価&#8203;の&#8203;四&#8203;本&#8203;値&#8203;(&#8203;始&#8203;値、&#8203;高&#8203;値、&#8203;安&#8203;値、&#8203;終&#8203;値&#8203;)&#8203;の&#8203;時&#8203;系&#8203;列&#8203;デー&#8203;タ&#8203;が&#8203;格&#8203;納&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は、&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;例&#8203;と&#8203;し&#8203;て&#8203;1ヶ&#8203;月、&#8203;2ヶ&#8203;月、&#8203;3ヶ&#8203;月&#8203;間&#8203;の&#8203;「終&#8203;値&#8203;の&#8203;変&#8203;化&#8203;率&#8203;（リ&#8203;ター&#8203;ン）」、&#8203;「ヒ&#8203;ス&#8203;ト&#8203;リ&#8203;カ&#8203;ル・&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ」、&#8203;「移&#8203;動&#8203;平&#8203;均&#8203;線&#8203;か&#8203;ら&#8203;の&#8203;乖&#8203;離&#8203;率」&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。&#8203;<br>
次&#8203;の&#8203;コー&#8203;ド&#8203;で&#8203;具&#8203;体&#8203;的&#8203;な&#8203;計&#8203;算&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;示&#8203;し&#8203;ま&#8203;す&#8203;が、&#8203;定&#8203;義&#8203;は&#8203;以&#8203;下&#8203;の&#8203;と&#8203;お&#8203;り&#8203;で&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;計&#8203;算&#8203;に&#8203;使&#8203;用&#8203;す&#8203;る&#8203;関&#8203;数&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;使&#8203;用&#8203;す&#8203;る&#8203;関&#8203;数&#8203;の&#8203;説&#8203;明&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pct_change(N)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現&#8203;在&#8203;の&#8203;観&#8203;測&#8203;値&#8203;と&#8203;N&#8203;個&#8203;前&#8203;の&#8203;観&#8203;測&#8203;値&#8203;と&#8203;の&#8203;変&#8203;化&#8203;率</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">diff()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現&#8203;在&#8203;の&#8203;観&#8203;測&#8203;値&#8203;と&#8203;一&#8203;つ&#8203;前&#8203;の&#8203;観&#8203;測&#8203;値&#8203;と&#8203;の&#8203;差</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rolling(N)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対&#8203;象&#8203;の&#8203;観&#8203;測&#8203;値&#8203;を&#8203;N&#8203;個&#8203;で&#8203;グ&#8203;ルー&#8203;プ&#8203;化</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">std()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">標&#8203;準&#8203;偏&#8203;差</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mean()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">算&#8203;術&#8203;平&#8203;均</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_priceデータを読み込む</span>
price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 銘柄コード9984にデータを絞る</span>
code = <span class="integer">9984</span>
price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]

<span class="comment"># 終値のみに絞る</span>
feats = price_data[[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]].copy()
<span class="comment"># 終値の20営業日リターン</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_1month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(<span class="integer">20</span>)
<span class="comment"># 終値の40営業日リターン</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_2month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(<span class="integer">40</span>)
<span class="comment"># 終値の60営業日リターン</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_3month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(<span class="integer">60</span>)
<span class="comment"># 終値の20営業日ボラティリティ</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_1month</span><span class="delimiter">&quot;</span></span>] = (
    np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(<span class="integer">20</span>).std()
)
<span class="comment"># 終値の40営業日ボラティリティ</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_2month</span><span class="delimiter">&quot;</span></span>] = (
    np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(<span class="integer">40</span>).std()
)
<span class="comment"># 終値の60営業日ボラティリティ</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_3month</span><span class="delimiter">&quot;</span></span>] = (
    np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(<span class="integer">60</span>).std()
)
<span class="comment"># 終値と20営業日の単純移動平均線の乖離</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_1month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">20</span>).mean()
)
<span class="comment"># 終値と40営業日の単純移動平均線の乖離</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_2month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">40</span>).mean()
)
<span class="comment"># 終値と60営業日の単純移動平均線の乖離</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_3month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">60</span>).mean()
)
<span class="comment"># 欠損値処理</span>
feats = feats.fillna(<span class="integer">0</span>)
<span class="comment"># 元データのカラムを削除</span>
feats = feats.drop([<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>], axis=<span class="integer">1</span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_テクニカル分析を活用した特徴量の生成">2.7.4. テクニカル分析を活用した特徴量の生成</h4>
<div class="paragraph">
<p>他&#8203;に&#8203;株&#8203;価&#8203;を&#8203;扱&#8203;う&#8203;た&#8203;め&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;RSI&#8203;や&#8203;ス&#8203;ト&#8203;キャ&#8203;ス&#8203;ティ&#8203;ク&#8203;ス&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;の&#8203;指&#8203;標&#8203;な&#8203;ど&#8203;を&#8203;活&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;の&#8203;利&#8203;用&#8203;に&#8203;関&#8203;す&#8203;る&#8203;考&#8203;察&#8203;は&#8203;本&#8203;章&#8203;で&#8203;は&#8203;取&#8203;り&#8203;扱&#8203;わ&#8203;ず&#8203;に、&#8203;第&#8203;7&#8203;章&#8203;で&#8203;紹&#8203;介&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_バックテスト用のテストデータ作成">2.8. バックテスト用のテストデータ作成</h3>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は、&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;行&#8203;う&#8203;た&#8203;め&#8203;の&#8203;デー&#8203;タ&#8203;の&#8203;分&#8203;割&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_バックテストとは">2.8.1. バックテストとは</h4>
<div class="paragraph">
<p>バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;と&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;有&#8203;効&#8203;性&#8203;を&#8203;検&#8203;証&#8203;す&#8203;る&#8203;際&#8203;に、&#8203;過&#8203;去&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;一&#8203;定&#8203;期&#8203;間&#8203;に&#8203;ど&#8203;の&#8203;程&#8203;度&#8203;の&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;が&#8203;得&#8203;ら&#8203;れ&#8203;た&#8203;か&#8203;を&#8203;シ&#8203;ミュ&#8203;レー&#8203;ショ&#8203;ン&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;す。&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;有&#8203;効&#8203;性&#8203;を&#8203;検&#8203;証&#8203;す&#8203;る&#8203;上&#8203;で、&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;か&#8203;は&#8203;重&#8203;要&#8203;な&#8203;ポ&#8203;イ&#8203;ン&#8203;ト&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ホールドアウト検証">2.8.2. ホールドアウト検証</h4>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は、&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;訓&#8203;練&#8203;デー&#8203;タ&#8203;と&#8203;テ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;に&#8203;切&#8203;り&#8203;分&#8203;け&#8203;ま&#8203;す。&#8203;ま&#8203;ず&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;分&#8203;け&#8203;る&#8203;理&#8203;由&#8203;を&#8203;説&#8203;明&#8203;し、&#8203;次&#8203;に、&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;分&#8203;け&#8203;方&#8203;及&#8203;び&#8203;コ&#8203;ツ&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;解&#8203;説&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;分&#8203;け&#8203;る&#8203;理&#8203;由&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;汎&#8203;化&#8203;性&#8203;能&#8203;を&#8203;確&#8203;認&#8203;し&#8203;使&#8203;用&#8203;す&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;決&#8203;定&#8203;す&#8203;る&#8203;た&#8203;め&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>汎&#8203;化&#8203;性&#8203;能&#8203;と&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;訓&#8203;練&#8203;デー&#8203;タ&#8203;以&#8203;外&#8203;の&#8203;未&#8203;知&#8203;の&#8203;デー&#8203;タ&#8203;に&#8203;対&#8203;し&#8203;て&#8203;も&#8203;機&#8203;能&#8203;す&#8203;る&#8203;と&#8203;い&#8203;う&#8203;能&#8203;力&#8203;で&#8203;す。&#8203;汎&#8203;化&#8203;性&#8203;能&#8203;が&#8203;低&#8203;い&#8203;モ&#8203;デ&#8203;ル&#8203;は、&#8203;訓&#8203;練&#8203;デー&#8203;タ&#8203;で&#8203;は&#8203;高&#8203;い&#8203;精&#8203;度&#8203;が&#8203;得&#8203;ら&#8203;れ&#8203;ま&#8203;す&#8203;が、&#8203;訓&#8203;練&#8203;デー&#8203;タ&#8203;に&#8203;な&#8203;い&#8203;未&#8203;知&#8203;の&#8203;デー&#8203;タ&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;低&#8203;い&#8203;精&#8203;度&#8203;し&#8203;か&#8203;得&#8203;ら&#8203;れ&#8203;ま&#8203;せ&#8203;ん。&#8203;こ&#8203;の&#8203;現&#8203;象&#8203;を&#8203;<strong>&#8203;過&#8203;学&#8203;習&#8203;</strong>&#8203;と&#8203;呼&#8203;び&#8203;ま&#8203;す。&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;分&#8203;割&#8203;せ&#8203;ず&#8203;に、&#8203;そ&#8203;の&#8203;ま&#8203;ま&#8203;全&#8203;体&#8203;に&#8203;対&#8203;し&#8203;て&#8203;学&#8203;習&#8203;し、&#8203;同&#8203;じ&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;に&#8203;対&#8203;し&#8203;て&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;よ&#8203;る&#8203;予&#8203;測&#8203;を&#8203;す&#8203;る&#8203;と、&#8203;基&#8203;本&#8203;的&#8203;に&#8203;は&#8203;高&#8203;い&#8203;精&#8203;度&#8203;の&#8203;結&#8203;果&#8203;を&#8203;得&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;<br>
し&#8203;か&#8203;し、&#8203;未&#8203;知&#8203;の&#8203;デー&#8203;タ&#8203;に&#8203;対&#8203;し&#8203;て&#8203;予&#8203;測&#8203;す&#8203;る&#8203;と、&#8203;予&#8203;測&#8203;が&#8203;まっ&#8203;た&#8203;く&#8203;当&#8203;た&#8203;ら&#8203;な&#8203;い&#8203;と&#8203;い&#8203;う&#8203;こ&#8203;と&#8203;が&#8203;起&#8203;こ&#8203;り&#8203;得&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;分&#8203;割&#8203;し&#8203;て、&#8203;学&#8203;習&#8203;に&#8203;使&#8203;用&#8203;し&#8203;て&#8203;い&#8203;な&#8203;い&#8203;デー&#8203;タ&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;検&#8203;証&#8203;用&#8203;と&#8203;し&#8203;て&#8203;用&#8203;意&#8203;し&#8203;て&#8203;お&#8203;く&#8203;こ&#8203;と&#8203;で、&#8203;作&#8203;成&#8203;し&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;過&#8203;学&#8203;習&#8203;し&#8203;て&#8203;い&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;出&#8203;来&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>基&#8203;本&#8203;的&#8203;な&#8203;時&#8203;系&#8203;列&#8203;デー&#8203;タ&#8203;の&#8203;分&#8203;割&#8203;手&#8203;法&#8203;(<strong>&#8203;ホー&#8203;ル&#8203;ド&#8203;ア&#8203;ウ&#8203;ト&#8203;検&#8203;証&#8203;</strong>)&#8203;に&#8203;関&#8203;し&#8203;て&#8203;解&#8203;説&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1.全体のデータセットを、訓練期間(TRAIN)/検証期間(VAL)/テスト期間(TEST)で分けます。
2.TRAINデータでモデルを学習させ、VALデータでモデルを評価します。これをモデルのさまざまなパラメーターで何度か行い、一番結果が良かったパラメーターを選びます。
3.そして最後にTESTデータでモデルの予測結果を最終評価します。</pre>
</div>
</div>
<div class="paragraph">
<p>本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は、&#8203;次&#8203;の&#8203;期&#8203;間&#8203;で&#8203;デー&#8203;タ&#8203;を&#8203;分&#8203;割&#8203;し&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even" style="width: 50%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">訓&#8203;練&#8203;期&#8203;間</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016-01-01 - 2017-12-31</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">評&#8203;価&#8203;期&#8203;間</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018-02-01 - 2018-12-01</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">テ&#8203;ス&#8203;ト&#8203;期&#8203;間</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019-01-01 - 2020-12-31</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre>※データの分割に際し、各期間に間隔（1か月）を空けている理由は、未来の情報を含ませないようにするためです。例えば、2017年12月31日の目的変数には5営業日、10営業日、20営業日後の株価リターンの情報が入っているため、2017年12月31日のデータを使って学習したモデルは未来の情報（2018年1月のリターン）を知っていることになってしまいます。したがって、2018年1月のデータを検証データに含めてしまうとリークが発生し、適切なモデルの評価ができなくなってしまいます。</pre>
</div>
</div>
<div class="paragraph">
<p>以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;変&#8203;数&#8203;を&#8203;定&#8203;義&#8203;し&#8203;て&#8203;お&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">TRAIN_END = <span class="string"><span class="delimiter">&quot;</span><span class="content">2017-12-31</span><span class="delimiter">&quot;</span></span>
VAL_START = <span class="string"><span class="delimiter">&quot;</span><span class="content">2018-02-01</span><span class="delimiter">&quot;</span></span>
VAL_END = <span class="string"><span class="delimiter">&quot;</span><span class="content">2018-12-01</span><span class="delimiter">&quot;</span></span>
TEST_START = <span class="string"><span class="delimiter">&quot;</span><span class="content">2019-01-01</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_その他の検証方法">2.8.3. その他の検証方法</h4>
<div class="paragraph">
<p>・&#8203;k-fold &#8203;交&#8203;差&#8203;検&#8203;証&#8203;(k-fold CV): &#8203;デー&#8203;タ&#8203;を&#8203;ま&#8203;ず&#8203;訓&#8203;練&#8203;デー&#8203;タ&#8203;と&#8203;テ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;に&#8203;分&#8203;け、&#8203;そ&#8203;の&#8203;後&#8203;そ&#8203;の&#8203;訓&#8203;練&#8203;デー&#8203;タ&#8203;を&#8203;k&#8203;個&#8203;の&#8203;グ&#8203;ルー&#8203;プ&#8203;に&#8203;分&#8203;割&#8203;し、&#8203;k-1&#8203;個&#8203;の&#8203;グ&#8203;ルー&#8203;プ&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;る&#8203;も&#8203;の&#8203;を&#8203;訓&#8203;練&#8203;デー&#8203;タ、&#8203;残&#8203;り&#8203;の&#8203;1&#8203;個&#8203;の&#8203;グ&#8203;ルー&#8203;プ&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;る&#8203;も&#8203;の&#8203;を&#8203;評&#8203;価&#8203;デー&#8203;タ&#8203;と&#8203;す&#8203;る&#8203;と、&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;分&#8203;割&#8203;方&#8203;法&#8203;は&#8203;k&#8203;通&#8203;り&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;ま&#8203;す。&#8203;<br>
そ&#8203;こ&#8203;で、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;分&#8203;割&#8203;方&#8203;法&#8203;し&#8203;た&#8203;がっ&#8203;て&#8203;k&#8203;回&#8203;訓&#8203;練&#8203;と&#8203;評&#8203;価&#8203;を&#8203;行&#8203;い、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;試&#8203;行&#8203;結&#8203;果&#8203;の&#8203;平&#8203;均&#8203;な&#8203;ど&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て、&#8203;モ&#8203;デ&#8203;ル&#8203;や&#8203;そ&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203;を&#8203;評&#8203;価&#8203;し&#8203;ま&#8203;す。&#8203;な&#8203;お、&#8203;時&#8203;系&#8203;列&#8203;デー&#8203;タ&#8203;で&#8203;は、&#8203;将&#8203;来&#8203;の&#8203;情&#8203;報&#8203;を&#8203;含&#8203;ま&#8203;な&#8203;い&#8203;よ&#8203;う&#8203;に&#8203;注&#8203;意&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_モデルの構築">2.9. モデルの構築</h3>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;学&#8203;習&#8203;に&#8203;用&#8203;い&#8203;る&#8203;た&#8203;め&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;準&#8203;備&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>モ&#8203;デ&#8203;ル&#8203;作&#8203;成&#8203;の&#8203;ス&#8203;テッ&#8203;プ&#8203;は、&#8203;以&#8203;下&#8203;の&#8203;と&#8203;お&#8203;り&#8203;に&#8203;行&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1. 銘柄を一つ選ぶ
2. その銘柄に対して、財務データ及びマーケットデータから特徴量を作る
3. 全銘柄に対して同じことを繰り返す
4. 作成したデータを結合する
5. 全データを訓練データ、評価データ、テストデータに分ける
6. 訓練データで予測モデルを学習させる</pre>
</div>
</div>
<div class="paragraph">
<p>・&#8203;<strong>&#8203;入&#8203;力&#8203;用&#8203;デー&#8203;タ&#8203;の&#8203;作&#8203;成&#8203;方&#8203;法&#8203;</strong></p>
</div>
<div class="paragraph">
<p>前&#8203;回&#8203;ま&#8203;で&#8203;の&#8203;マー&#8203;ケッ&#8203;ト&#8203;デー&#8203;タ&#8203;を&#8203;用&#8203;い&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;生&#8203;成&#8203;方&#8203;法、&#8203;及&#8203;び&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;デー&#8203;タ&#8203;の&#8203;欠&#8203;損&#8203;値&#8203;処&#8203;理&#8203;を&#8203;行っ&#8203;た&#8203;後&#8203;の&#8203;デー&#8203;タ&#8203;処&#8203;理&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;解&#8203;説&#8203;し、&#8203;今&#8203;回&#8203;は&#8203;そ&#8203;れ&#8203;ら&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;結&#8203;合&#8203;さ&#8203;せ、&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;学&#8203;習&#8203;で&#8203;き&#8203;る&#8203;フォー&#8203;マッ&#8203;ト&#8203;に&#8203;直&#8203;す&#8203;こ&#8203;と&#8203;が&#8203;目&#8203;的&#8203;で&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_特徴量の生成">2.9.1. 特徴量の生成</h4>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は、&#8203;特&#8203;徴&#8203;量&#8203;生&#8203;成&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;示&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;コー&#8203;ド&#8203;の&#8203;お&#8203;お&#8203;ま&#8203;か&#8203;な&#8203;流&#8203;れ&#8203;と&#8203;し&#8203;て&#8203;は、&#8203;以&#8203;下&#8203;の&#8203;3&#8203;ス&#8203;テッ&#8203;プ&#8203;に&#8203;分&#8203;け&#8203;ら&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1. 財務データの取得及び前処理（Chapter 2.6.2と同様）
2. マーケットデータの取得及び特徴量定義（Chapter 2.7.2と同様）
3. 財務データと生成した特徴量を結合</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">get_features_for_predict</span>(dfs, code, start_dt=<span class="string"><span class="delimiter">&quot;</span><span class="content">2016-01-01</span><span class="delimiter">&quot;</span></span>):
    <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">    Args:</span><span class="content">
</span><span class="content">        dfs (dict)  : dict of pd.DataFrame include stock_fin, stock_price</span><span class="content">
</span><span class="content">        code (int)  : A local code for a listed company</span><span class="content">
</span><span class="content">        start_dt (str): specify date range</span><span class="content">
</span><span class="content">    Returns:</span><span class="content">
</span><span class="content">        feature DataFrame (pd.DataFrame)</span><span class="content">
</span><span class="content">    </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    <span class="comment"># おおまかな手順の1つ目</span>
    <span class="comment"># stock_finデータを読み込み</span>
    stock_fin = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>]

    <span class="comment"># 特定の銘柄コードのデータに絞る</span>
    fin_data = stock_fin[stock_fin[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
    <span class="comment"># 特徴量の作成には過去60営業日のデータを使用しているため、</span>
    <span class="comment"># 予測対象日からバッファ含めて土日を除く過去90日遡った時点から特徴量を生成します</span>
    n = <span class="integer">90</span>
    <span class="comment"># 特徴量の生成対象期間を指定</span>
    fin_data = fin_data.loc[pd.Timestamp(start_dt) - pd.offsets.BDay(n) :]
    <span class="comment"># fin_dataのnp.float64のデータのみを取得</span>
    fin_data = fin_data.select_dtypes(include=[<span class="string"><span class="delimiter">&quot;</span><span class="content">float64</span><span class="delimiter">&quot;</span></span>])
    <span class="comment"># 欠損値処理</span>
    fin_feats = fin_data.fillna(<span class="integer">0</span>)

    <span class="comment"># おおまかな手順の2つ目</span>
    <span class="comment"># stock_priceデータを読み込む</span>
    price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]
    <span class="comment"># 特定の銘柄コードのデータに絞る</span>
    price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
    <span class="comment"># 終値のみに絞る</span>
    feats = price_data[[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]]
    <span class="comment"># 特徴量の生成対象期間を指定</span>
    feats = feats.loc[pd.Timestamp(start_dt) - pd.offsets.BDay(n) :].copy()

    <span class="comment"># 終値の20営業日リターン</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_1month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(<span class="integer">20</span>)
    <span class="comment"># 終値の40営業日リターン</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_2month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(<span class="integer">40</span>)
    <span class="comment"># 終値の60営業日リターン</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_3month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(<span class="integer">60</span>)
    <span class="comment"># 終値の20営業日ボラティリティ</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_1month</span><span class="delimiter">&quot;</span></span>] = (
        np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(<span class="integer">20</span>).std()
    )
    <span class="comment"># 終値の40営業日ボラティリティ</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_2month</span><span class="delimiter">&quot;</span></span>] = (
        np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(<span class="integer">40</span>).std()
    )
    <span class="comment"># 終値の60営業日ボラティリティ</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_3month</span><span class="delimiter">&quot;</span></span>] = (
        np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(<span class="integer">60</span>).std()
    )
    <span class="comment"># 終値と20営業日の単純移動平均線の乖離</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_1month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">20</span>).mean()
    )
    <span class="comment"># 終値と40営業日の単純移動平均線の乖離</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_2month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">40</span>).mean()
    )
    <span class="comment"># 終値と60営業日の単純移動平均線の乖離</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_3month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">60</span>).mean()
    )

    <span class="comment"># おおまかな手順の3つ目</span>
    <span class="comment"># 欠損値処理</span>
    feats = feats.fillna(<span class="integer">0</span>)
    <span class="comment"># 元データのカラムを削除</span>
    feats = feats.drop([<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>], axis=<span class="integer">1</span>)

    <span class="comment"># 財務データの特徴量とマーケットデータの特徴量のインデックスを合わせる</span>
    feats = feats.loc[feats.index.isin(fin_feats.index)]
    fin_feats = fin_feats.loc[fin_feats.index.isin(feats.index)]

    <span class="comment"># データを結合</span>
    feats = pd.concat([feats, fin_feats], axis=<span class="integer">1</span>).dropna()

    <span class="comment"># 欠損値処理を行います。</span>
    feats = feats.replace([np.inf, -np.inf], <span class="integer">0</span>)

    <span class="comment"># 銘柄コードを設定</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] = code

    <span class="comment"># 生成対象日以降の特徴量に絞る</span>
    feats = feats.loc[pd.Timestamp(start_dt) :]

    <span class="keyword">return</span> feats</code></pre>
</div>
</div>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で、&#8203; <code>np.inf</code> &#8203;を&#8203;0&#8203;に&#8203;置&#8203;換&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;価&#8203;格&#8203;変&#8203;化&#8203;率&#8203;の&#8203;計&#8203;算&#8203;の&#8203;際&#8203;に&#8203;発&#8203;散&#8203;し&#8203;て&#8203;し&#8203;まっ&#8203;た&#8203;も&#8203;の&#8203;を、&#8203;0&#8203;と&#8203;定&#8203;義&#8203;し&#8203;直&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;に、&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;定&#8203;義&#8203;す&#8203;る&#8203;際&#8203;に、&#8203;特&#8203;徴&#8203;量&#8203;変&#8203;換&#8203;に&#8203;よ&#8203;り&#8203;発&#8203;散&#8203;し&#8203;て&#8203;し&#8203;まっ&#8203;た&#8203;時&#8203;や&#8203;nan&#8203;に&#8203;なっ&#8203;た&#8203;時&#8203;の&#8203;処&#8203;理&#8203;を、&#8203;あ&#8203;ら&#8203;か&#8203;じ&#8203;め&#8203;考&#8203;慮&#8203;し&#8203;て&#8203;お&#8203;く&#8203;こ&#8203;と&#8203;が&#8203;ス&#8203;ムー&#8203;ズ&#8203;に&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;構&#8203;築&#8203;す&#8203;る&#8203;上&#8203;で&#8203;重&#8203;要&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>次&#8203;に&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;の&#8203;処&#8203;理&#8203;の&#8203;結&#8203;果&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">df = get_features_for_predict(dfs, <span class="integer">9984</span>)
df.T</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_目的変数の対応付け及び訓練データ評価データテストデータの分割">2.9.2. 目的変数の対応付け及び訓練データ、評価データ、テストデータの分割</h4>
<div class="paragraph">
<p>次&#8203;に&#8203;目&#8203;的&#8203;変&#8203;数&#8203;を&#8203;定&#8203;義&#8203;し&#8203;ま&#8203;す。&#8203;目&#8203;的&#8203;変&#8203;数&#8203;は、&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203; <code>stock_labels</code> &#8203;内&#8203;に&#8203;あ&#8203;り、&#8203;利&#8203;用&#8203;す&#8203;る&#8203;際&#8203;は&#8203;先&#8203;ほ&#8203;ど&#8203;定&#8203;義&#8203;し&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;に&#8203;対&#8203;し&#8203;て、&#8203;行&#8203;（日&#8203;付）&#8203;を&#8203;一&#8203;致&#8203;さ&#8203;せ&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;訓&#8203;練&#8203;期&#8203;間、&#8203;評&#8203;価&#8203;期&#8203;間、&#8203;テ&#8203;ス&#8203;ト&#8203;期&#8203;間&#8203;へ&#8203;の&#8203;分&#8203;割&#8203;処&#8203;理&#8203;も&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">get_features_and_label</span>(dfs, codes, feature, label):
    <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">    Args:</span><span class="content">
</span><span class="content">        dfs (dict[pd.DataFrame]): loaded data</span><span class="content">
</span><span class="content">        codes  (array) : target codes</span><span class="content">
</span><span class="content">        feature (pd.DataFrame): features</span><span class="content">
</span><span class="content">        label (str) : label column name</span><span class="content">
</span><span class="content">    Returns:</span><span class="content">
</span><span class="content">        train_X (pd.DataFrame): training data</span><span class="content">
</span><span class="content">        train_y (pd.DataFrame): label for train_X</span><span class="content">
</span><span class="content">        val_X (pd.DataFrame): validation data</span><span class="content">
</span><span class="content">        val_y (pd.DataFrame): label for val_X</span><span class="content">
</span><span class="content">        test_X (pd.DataFrame): test data</span><span class="content">
</span><span class="content">        test_y (pd.DataFrame): label for test_X</span><span class="content">
</span><span class="content">    </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    <span class="comment"># 分割データ用の変数を定義</span>
    trains_X, vals_X, tests_X = [], [], []
    trains_y, vals_y, tests_y = [], [], []

    <span class="comment"># 銘柄コード毎に特徴量を作成</span>
    <span class="keyword">for</span> code <span class="keyword">in</span> tqdm(codes):
        <span class="comment"># 特徴量取得</span>
        feats = feature[feature[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] == code]

        <span class="comment"># stock_labelデータを読み込み</span>
        stock_labels = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>]
        <span class="comment"># 特定の銘柄コードのデータに絞る</span>
        stock_labels = stock_labels[stock_labels[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]

        <span class="comment"># 特定の目的変数に絞る</span>
        labels = stock_labels[label]
        <span class="comment"># nanを削除</span>
        labels.dropna(inplace=<span class="predefined-constant">True</span>)

        <span class="keyword">if</span> feats.shape[<span class="integer">0</span>] &gt; <span class="integer">0</span> <span class="keyword">and</span> labels.shape[<span class="integer">0</span>] &gt; <span class="integer">0</span>:
            <span class="comment"># 特徴量と目的変数のインデックスを合わせる</span>
            labels = labels.loc[labels.index.isin(feats.index)]
            feats = feats.loc[feats.index.isin(labels.index)]
            labels.index = feats.index

            <span class="comment"># データを分割（ホールドアウト法）</span>
            _train_X = feats[: TRAIN_END]
            _val_X = feats[VAL_START : VAL_END]
            _test_X = feats[TEST_START :]

            _train_y = labels[: TRAIN_END]
            _val_y = labels[VAL_START : VAL_END]
            _test_y = labels[TEST_START :]

            <span class="comment"># データを配列に格納 (後ほど結合するため)</span>
            trains_X.append(_train_X)
            vals_X.append(_val_X)
            tests_X.append(_test_X)

            trains_y.append(_train_y)
            vals_y.append(_val_y)
            tests_y.append(_test_y)

    <span class="comment"># 銘柄毎に作成した説明変数データを結合します。</span>
    train_X = pd.concat(trains_X)
    val_X = pd.concat(vals_X)
    test_X = pd.concat(tests_X)
    <span class="comment"># 銘柄毎に作成した目的変数データを結合します。</span>
    train_y = pd.concat(trains_y)
    val_y = pd.concat(vals_y)
    test_y = pd.concat(tests_y)

    <span class="keyword">return</span> train_X, train_y, val_X, val_y, test_X, test_y</code></pre>
</div>
</div>
<div class="paragraph">
<p>次&#8203;に、&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;の&#8203;結&#8203;果&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 対象銘柄コードを定義</span>
codes = [<span class="integer">9984</span>]
<span class="comment"># 対象の目的変数を定義</span>
label = <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>
<span class="comment"># 特徴量を取得</span>
feat = get_features_for_predict(dfs, codes[<span class="integer">0</span>])
<span class="comment"># 特徴量と目的変数を入力し、分割データを取得</span>
ret = get_features_and_label(dfs, codes, feat, label)
<span class="keyword">for</span> v <span class="keyword">in</span> ret:
    print(v.T)</code></pre>
</div>
</div>
<div class="paragraph">
<p>こ&#8203;こ&#8203;ま&#8203;で&#8203;は&#8203;一&#8203;つ&#8203;の&#8203;銘&#8203;柄&#8203;に&#8203;対&#8203;し&#8203;て&#8203;処&#8203;理&#8203;を&#8203;し&#8203;て&#8203;き&#8203;ま&#8203;し&#8203;た&#8203;が、&#8203;こ&#8203;こ&#8203;か&#8203;ら&#8203;は&#8203;全&#8203;て&#8203;の&#8203;予&#8203;測&#8203;対&#8203;象&#8203;銘&#8203;柄&#8203;に&#8203;対&#8203;し&#8203;て&#8203;上&#8203;記&#8203;の&#8203;処&#8203;理&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に、&#8203;予&#8203;測&#8203;対&#8203;象&#8203;の&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;を&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">get_codes</span>(dfs):
    <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">    Args:</span><span class="content">
</span><span class="content">        dfs (dict[pd.DataFrame]): loaded data</span><span class="content">
</span><span class="content">    Returns:</span><span class="content">
</span><span class="content">        array: list of stock codes</span><span class="content">
</span><span class="content">    </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    stock_list = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>].copy()
    <span class="comment"># 予測対象の銘柄コードを取得</span>
    codes = stock_list[stock_list[<span class="string"><span class="delimiter">&quot;</span><span class="content">prediction_target</span><span class="delimiter">&quot;</span></span>] == <span class="predefined-constant">True</span>][
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>
    ].values
    <span class="keyword">return</span> codes</code></pre>
</div>
</div>
<div class="paragraph">
<p>次&#8203;に、&#8203;目&#8203;的&#8203;変&#8203;数&#8203;毎&#8203;に&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。&#8203;今&#8203;回&#8203;は&#8203;全&#8203;て&#8203;の&#8203;目&#8203;的&#8203;変&#8203;数&#8203;に&#8203;同&#8203;一&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;目&#8203;的&#8203;変&#8203;数&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;チュー&#8203;ニ&#8203;ン&#8203;グ&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;よ&#8203;り&#8203;精&#8203;度&#8203;の&#8203;高&#8203;い&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 対象の目的変数を定義</span>
labels = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_5</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_10</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_low_5</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_low_10</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_low_20</span><span class="delimiter">&quot;</span></span>,
}
<span class="comment"># 目的変数毎にデータを保存するための変数</span>
train_X, val_X, test_X = {}, {}, {}
train_y, val_y, test_y = {}, {}, {}

<span class="comment"># 予測対象銘柄を取得</span>
codes = get_codes(dfs)

<span class="comment"># 特徴量を作成</span>
buff = []
<span class="keyword">for</span> code <span class="keyword">in</span> tqdm(codes):
    feat = get_features_for_predict(dfs, code)
    buff.append(feat)
feature = pd.concat(buff)

<span class="comment"># 目的変数毎に処理</span>
<span class="keyword">for</span> label <span class="keyword">in</span> tqdm(labels):
    <span class="comment"># 特徴量と目的変数を取得</span>
    _train_X, _train_y, _val_X, _val_y, _test_X, _test_y = get_features_and_label(dfs, codes, feature, label)
    <span class="comment"># 目的変数をキーとして値を保存</span>
    train_X[label] = _train_X
    val_X[label] = _val_X
    test_X[label] = _test_X
    train_y[label] = _train_y
    val_y[label] = _val_y
    test_y[label] = _test_y</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_モデル学習の実行方法">2.9.3. <strong>モデル学習の実行方法</strong></h4>
<div class="paragraph">
<p>デー&#8203;タ&#8203;の&#8203;準&#8203;備&#8203;が&#8203;完&#8203;了&#8203;し&#8203;た&#8203;の&#8203;で、&#8203;い&#8203;よ&#8203;い&#8203;よ&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;学&#8203;習&#8203;を&#8203;実&#8203;行&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;sklearn&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;の&#8203;RandomForestRegressor&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;使&#8203;用&#8203;し&#8203;ま&#8203;す。&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;設&#8203;定&#8203;す&#8203;る&#8203;各&#8203;種&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203;は、&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;と&#8203;く&#8203;に&#8203;指&#8203;定&#8203;せ&#8203;ず&#8203;に&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;の&#8203;デ&#8203;フォ&#8203;ル&#8203;ト&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203;を&#8203;使&#8203;用&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>RandomForest&#8203;の&#8203;回&#8203;帰&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;あ&#8203;る&#8203;RandomForestRegressor&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;理&#8203;由&#8203;は、&#8203;予&#8203;測&#8203;す&#8203;る&#8203;目&#8203;的&#8203;変&#8203;数&#8203;が&#8203;連&#8203;続&#8203;値&#8203;で&#8203;あ&#8203;る&#8203;か&#8203;ら&#8203;で&#8203;す。&#8203;RandomForest&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203;決&#8203;定&#8203;木&#8203;を&#8203;ベー&#8203;ス&#8203;と&#8203;す&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;以&#8203;下&#8203;の&#8203;理&#8203;由&#8203;か&#8203;ら&#8203;最&#8203;初&#8203;に&#8203;選&#8203;択&#8203;す&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;と&#8203;し&#8203;て&#8203;扱&#8203;い&#8203;や&#8203;す&#8203;い&#8203;で&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RandomForest&#8203;内&#8203;部&#8203;で&#8203;利&#8203;用&#8203;す&#8203;る&#8203;決&#8203;定&#8203;木&#8203;は、&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;大&#8203;小&#8203;関&#8203;係&#8203;の&#8203;み&#8203;に&#8203;着&#8203;目&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;値&#8203;自&#8203;体&#8203;に&#8203;は&#8203;意&#8203;味&#8203;が&#8203;な&#8203;い&#8203;の&#8203;で&#8203;正&#8203;規&#8203;化&#8203;処&#8203;理&#8203;の&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;せ&#8203;ん</p>
</li>
<li>
<p>特&#8203;徴&#8203;量&#8203;の&#8203;重&#8203;要&#8203;度&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き、&#8203;次&#8203;に&#8203;実&#8203;施&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;の&#8203;道&#8203;筋&#8203;を&#8203;立&#8203;て&#8203;や&#8203;す&#8203;い</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 目的変数を指定</span>
label = <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>
<span class="comment"># モデルの初期化</span>
pred_model = RandomForestRegressor(random_state=<span class="integer">0</span>)
<span class="comment"># モデルの学習</span>
pred_model.fit(train_X[label], train_y[label])</code></pre>
</div>
</div>
<div class="paragraph">
<p>一&#8203;方、&#8203;サ&#8203;ポー&#8203;ト&#8203;ベ&#8203;ク&#8203;ター&#8203;マ&#8203;シ&#8203;ン&#8203;や&#8203;ニュー&#8203;ラ&#8203;ル&#8203;ネッ&#8203;ト&#8203;ワー&#8203;ク&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;際&#8203;は、&#8203;デー&#8203;タ&#8203;の&#8203;前&#8203;処&#8203;理&#8203;に&#8203;お&#8203;け&#8203;る&#8203;注&#8203;意&#8203;点&#8203;が&#8203;増&#8203;え&#8203;ま&#8203;す。&#8203;選&#8203;択&#8203;す&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;特&#8203;性&#8203;に&#8203;応&#8203;じ&#8203;た&#8203;正&#8203;規&#8203;化&#8203;処&#8203;理&#8203;と&#8203;特&#8203;徴&#8203;量&#8203;設&#8203;計&#8203;が&#8203;重&#8203;要&#8203;で&#8203;す。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_モデルの推論">2.10. モデルの推論</h3>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は&#8203;構&#8203;築&#8203;し&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;か&#8203;ら&#8203;予&#8203;測&#8203;結&#8203;果&#8203;を&#8203;出&#8203;力&#8203;し、&#8203;可&#8203;視&#8203;化&#8203;な&#8203;ど&#8203;に&#8203;よ&#8203;る&#8203;分&#8203;析&#8203;を&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_予測結果の出力方法">2.10.1. 予測結果の出力方法</h4>
<div class="paragraph">
<p>こ&#8203;こ&#8203;ま&#8203;で、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;目&#8203;的&#8203;変&#8203;数&#8203;に&#8203;対&#8203;し&#8203;て、&#8203;訓&#8203;練&#8203;デー&#8203;タ、&#8203;評&#8203;価&#8203;デー&#8203;タ、&#8203;テ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;に&#8203;分&#8203;割&#8203;し&#8203;ま&#8203;し&#8203;た。&#8203;こ&#8203;こ&#8203;か&#8203;ら&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;学&#8203;習&#8203;完&#8203;了&#8203;後&#8203;に、&#8203;テ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;を&#8203;入&#8203;力&#8203;と&#8203;し&#8203;て&#8203;予&#8203;測&#8203;を&#8203;出&#8203;力&#8203;し、&#8203;pandas.DataFrame&#8203;形&#8203;式&#8203;に&#8203;変&#8203;換&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># モデルを定義</span>
models = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">rf</span><span class="delimiter">&quot;</span></span>: RandomForestRegressor,
}

<span class="comment"># モデルを選択</span>
model = <span class="string"><span class="delimiter">&quot;</span><span class="content">rf</span><span class="delimiter">&quot;</span></span>

<span class="comment"># 目的変数を指定</span>
label = <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>

<span class="comment"># 学習用データセット定義</span>
<span class="comment"># ファンダメンタル情報</span>
fundamental_cols = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>].select_dtypes(<span class="string"><span class="delimiter">&quot;</span><span class="content">float64</span><span class="delimiter">&quot;</span></span>).columns
fundamental_cols = fundamental_cols[fundamental_cols != <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_Dividend DividendPayableDate</span><span class="delimiter">&quot;</span></span>]
fundamental_cols = fundamental_cols[fundamental_cols != <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>]
<span class="comment"># 価格変化率</span>
returns_cols = [x <span class="keyword">for</span> x <span class="keyword">in</span> train_X[label].columns <span class="keyword">if</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">return</span><span class="delimiter">&quot;</span></span> <span class="keyword">in</span> x]
<span class="comment"># テクニカル</span>
technical_cols = [x <span class="keyword">for</span> x <span class="keyword">in</span> train_X[label].columns <span class="keyword">if</span> (x <span class="keyword">not</span> <span class="keyword">in</span> fundamental_cols) <span class="keyword">and</span> (x != <span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>)]

columns = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental_only</span><span class="delimiter">&quot;</span></span>: fundamental_cols,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">return_only</span><span class="delimiter">&quot;</span></span>: returns_cols,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">technical_only</span><span class="delimiter">&quot;</span></span>: technical_cols,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental+technical</span><span class="delimiter">&quot;</span></span>: <span class="predefined">list</span>(fundamental_cols) + <span class="predefined">list</span>(technical_cols),
}
<span class="comment"># 学習用データセットを指定</span>
col = <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental_only</span><span class="delimiter">&quot;</span></span>

<span class="comment"># 学習</span>
pred_model = models[model](random_state=<span class="integer">0</span>)
pred_model.fit(train_X[label][columns[col]].values, train_y[label])

<span class="comment"># 予測</span>
result = {}
result[label] = pd.DataFrame(
    pred_model.predict(val_X[label][columns[col]]), columns=[<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>]
)

<span class="comment"># 予測結果に日付と銘柄コードを追加</span>
result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = val_X[label][columns[col]].index
result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] = val_X[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>].values

<span class="comment"># 予測の符号を取得</span>
result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">predict_dir</span><span class="delimiter">&quot;</span></span>] = np.sign(result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>])

<span class="comment"># 実際の値を追加</span>
result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>] = val_y[label].values</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_予測結果の可視化方法">2.10.2. 予測結果の可視化方法</h4>
<div class="paragraph">
<p>予&#8203;測&#8203;結&#8203;果&#8203;の&#8203;確&#8203;認&#8203;と&#8203;し&#8203;て、&#8203;実&#8203;際&#8203;に&#8203;決&#8203;算&#8203;開&#8203;示&#8203;等&#8203;の&#8203;あっ&#8203;た&#8203;銘&#8203;柄&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;基&#8203;準&#8203;日&#8203;付&#8203;の&#8203;終&#8203;値&#8203;か&#8203;ら&#8203;最&#8203;高&#8203;値&#8203;へ&#8203;の&#8203;変&#8203;化&#8203;率&#8203;(actual)&#8203;と&#8203;予&#8203;測&#8203;ス&#8203;コ&#8203;ア&#8203;(predict)&#8203;の&#8203;散&#8203;布&#8203;図&#8203;を&#8203;見&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;散&#8203;布&#8203;図&#8203;を&#8203;選&#8203;択&#8203;す&#8203;る&#8203;理&#8203;由&#8203;は、&#8203;予&#8203;測&#8203;対&#8203;象&#8203;に&#8203;対&#8203;し&#8203;て&#8203;予&#8203;測&#8203;ス&#8203;コ&#8203;ア&#8203;が&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;分&#8203;布&#8203;を&#8203;とっ&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;見&#8203;る&#8203;こ&#8203;と&#8203;が、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;挙&#8203;動&#8203;を&#8203;理&#8203;解&#8203;す&#8203;る&#8203;わ&#8203;か&#8203;り&#8203;や&#8203;す&#8203;い&#8203;可&#8203;視&#8203;化&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;挙&#8203;げ&#8203;ら&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">sns.jointplot(data=result[label], x=<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>, y=<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/actual_pred.png" alt="scatter_plot_actual_predict">
</div>
</div>
<div class="paragraph">
<p>こ&#8203;の&#8203;図&#8203;で&#8203;は、&#8203;横&#8203;軸&#8203;が&#8203;予&#8203;測&#8203;値&#8203;で、&#8203;縦&#8203;軸&#8203;が&#8203;真&#8203;の&#8203;値&#8203;で&#8203;す。&#8203;予&#8203;測&#8203;と&#8203;真&#8203;の&#8203;値&#8203;に&#8203;は、&#8203;正&#8203;の&#8203;相&#8203;関&#8203;(0.144192)&#8203;が&#8203;見&#8203;受&#8203;け&#8203;ら&#8203;れ&#8203;る&#8203;の&#8203;で、&#8203;あ&#8203;る&#8203;程&#8203;度&#8203;の&#8203;相&#8203;関&#8203;関&#8203;係&#8203;が&#8203;発&#8203;生&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;一&#8203;般&#8203;的&#8203;な&#8203;デー&#8203;タ&#8203;で&#8203;0.144&#8203;と&#8203;い&#8203;う&#8203;数&#8203;字&#8203;が&#8203;出&#8203;て&#8203;も&#8203;ほ&#8203;ぼ&#8203;無&#8203;相&#8203;関&#8203;に&#8203;見&#8203;え&#8203;ま&#8203;す&#8203;が、&#8203;金&#8203;融&#8203;デー&#8203;タ&#8203;で&#8203;は&#8203;0.144&#8203;と&#8203;い&#8203;う&#8203;ス&#8203;コ&#8203;ア&#8203;は&#8203;高&#8203;い&#8203;部&#8203;類&#8203;に&#8203;入&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;視&#8203;覚&#8203;化&#8203;す&#8203;る&#8203;と、&#8203;予&#8203;測&#8203;値&#8203;と&#8203;真&#8203;の&#8203;値&#8203;の&#8203;関&#8203;係&#8203;性&#8203;を&#8203;可&#8203;視&#8203;化&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_予測結果に対する分析の道筋">2.11. 予測結果に対する分析の道筋</h3>
<div class="paragraph">
<p>予&#8203;測&#8203;精&#8203;度&#8203;を&#8203;向&#8203;上&#8203;さ&#8203;せ&#8203;る&#8203;た&#8203;め&#8203;に&#8203;は、&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;分&#8203;析&#8203;を&#8203;集&#8203;中&#8203;的&#8203;に&#8203;行&#8203;う&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;分&#8203;析&#8203;で&#8203;は、&#8203;さ&#8203;ま&#8203;ざ&#8203;ま&#8203;な&#8203;手&#8203;法&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;重&#8203;要&#8203;度&#8203;の&#8203;分&#8203;析&#8203;と&#8203;SHAP&#8203;と&#8203;い&#8203;う&#8203;手&#8203;法&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_特徴量の重要度">2.11.1. 特徴量の重要度</h4>
<div class="paragraph">
<p>特&#8203;徴&#8203;量&#8203;の&#8203;重&#8203;要&#8203;度&#8203;は、&#8203;Random Forest&#8203;や&#8203;Gradient Boosting&#8203;な&#8203;ど&#8203;の&#8203;い&#8203;く&#8203;つ&#8203;か&#8203;の&#8203;機&#8203;械&#8203;学&#8203;習&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;取&#8203;得&#8203;で&#8203;き、&#8203;モ&#8203;デ&#8203;ル&#8203;内&#8203;で&#8203;ど&#8203;の&#8203;程&#8203;度&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;説&#8203;明&#8203;変&#8203;数&#8203;が、&#8203;目&#8203;的&#8203;変&#8203;数&#8203;に&#8203;対&#8203;し&#8203;て&#8203;重&#8203;要&#8203;で&#8203;あ&#8203;る&#8203;か&#8203;を&#8203;判&#8203;断&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;参&#8203;考&#8203;に&#8203;な&#8203;る&#8203;指&#8203;標&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>重&#8203;要&#8203;度&#8203;が&#8203;極&#8203;端&#8203;に&#8203;低&#8203;い&#8203;も&#8203;の&#8203;は、&#8203;そ&#8203;も&#8203;そ&#8203;も&#8203;説&#8203;明&#8203;変&#8203;数&#8203;か&#8203;ら&#8203;除&#8203;外&#8203;し&#8203;た&#8203;り、&#8203;重&#8203;要&#8203;度&#8203;が&#8203;高&#8203;い&#8203;も&#8203;の&#8203;は&#8203;更&#8203;に&#8203;分&#8203;析&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;性&#8203;能&#8203;の&#8203;向&#8203;上&#8203;が&#8203;期&#8203;待&#8203;で&#8203;き&#8203;な&#8203;い&#8203;か、&#8203;な&#8203;ど&#8203;分&#8203;析&#8203;の&#8203;道&#8203;筋&#8203;を&#8203;つ&#8203;け&#8203;る&#8203;上&#8203;で&#8203;も&#8203;役&#8203;に&#8203;立&#8203;ち&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;訓&#8203;練&#8203;デー&#8203;タ&#8203;(2016&#8203;年&#8203;初&#8203;か&#8203;ら&#8203;2017&#8203;年&#8203;末&#8203;ま&#8203;で&#8203;)&#8203;に&#8203;お&#8203;け&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;重&#8203;要&#8203;度&#8203;を&#8203;調&#8203;査&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>次&#8203;の&#8203;方&#8203;法&#8203;に&#8203;従っ&#8203;て、&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;重&#8203;要&#8203;度&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 学習済みモデルを指定</span>
rf = pred_model

<span class="comment"># 重要度順を取得</span>
sorted_idx = rf.feature_importances_.argsort()
<span class="comment"># プロット</span>
fig, ax = plt.subplots(figsize=(<span class="integer">8</span>, <span class="integer">8</span>))
ax.barh(fundamental_cols[sorted_idx], rf.feature_importances_[sorted_idx])
ax.set_xlabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Random Forest Feature Importance</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/feature_importance.png" alt="ファンダメンタル情報の特徴量重要度">
</div>
</div>
<div class="paragraph">
<p>上&#8203;記&#8203;の&#8203;可&#8203;視&#8203;化&#8203;に&#8203;よ&#8203;り、&#8203; &#8203;一&#8203;番&#8203;上&#8203;に&#8203;あ&#8203;る&#8203; <code>NetAssets(&#8203;純&#8203;資&#8203;産&#8203;)</code> &#8203;に&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;注&#8203;目&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;純&#8203;資&#8203;産&#8203;は&#8203;資&#8203;本&#8203;金&#8203;や&#8203;利&#8203;益&#8203;剰&#8203;余&#8203;金&#8203;な&#8203;ど&#8203;を&#8203;合&#8203;算&#8203;し&#8203;た&#8203;指&#8203;標&#8203;で、&#8203;次&#8203;に&#8203;登&#8203;場&#8203;す&#8203;る&#8203; <code>TotalAssets(&#8203;総&#8203;資&#8203;産&#8203;)</code> &#8203;か&#8203;ら&#8203;負&#8203;債&#8203;を&#8203;引&#8203;い&#8203;た&#8203;も&#8203;の&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203; <code>TotalAssets(&#8203;総&#8203;資&#8203;産&#8203;)</code> &#8203;は、&#8203;流&#8203;動&#8203;資&#8203;産&#8203;や&#8203;固&#8203;定&#8203;資&#8203;産、&#8203;繰&#8203;延&#8203;資&#8203;産&#8203;な&#8203;ど、&#8203;会&#8203;社&#8203;の&#8203;全&#8203;て&#8203;の&#8203;資&#8203;産&#8203;を&#8203;合&#8203;算&#8203;し&#8203;た&#8203;も&#8203;の&#8203;を&#8203;示&#8203;す&#8203;指&#8203;標&#8203;で&#8203;す。&#8203;<br>
こ&#8203;の&#8203;2&#8203;つ&#8203;は&#8203;会&#8203;社&#8203;の&#8203;規&#8203;模&#8203;を&#8203;示&#8203;す&#8203;代&#8203;表&#8203;的&#8203;な&#8203;指&#8203;標&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;<br>
Random Forest&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;内&#8203;部&#8203;で、&#8203;こ&#8203;の&#8203;2&#8203;つ&#8203;を&#8203;利&#8203;用&#8203;し&#8203;た&#8203;分&#8203;岐&#8203;が&#8203;多&#8203;数&#8203;存&#8203;在&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;示&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;会&#8203;社&#8203;規&#8203;模&#8203;が&#8203;重&#8203;要&#8203;な&#8203;指&#8203;標&#8203;で&#8203;あ&#8203;る&#8203;可&#8203;能&#8203;性&#8203;を&#8203;示&#8203;唆&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_shap">2.11.2. SHAP</h4>
<div class="paragraph">
<p>SHAP&#8203;は、&#8203;学&#8203;習&#8203;済&#8203;み&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;各&#8203;特&#8203;徴&#8203;量&#8203;が&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;す&#8203;る&#8203;予&#8203;測&#8203;値&#8203;に&#8203;与&#8203;え&#8203;た&#8203;影&#8203;響&#8203;度&#8203;を&#8203;算&#8203;出&#8203;し&#8203;て&#8203;く&#8203;れ&#8203;る&#8203;も&#8203;の&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は、&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;モ&#8203;デ&#8203;ル&#8203;と&#8203;し&#8203;て&#8203;XGBoost&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;利&#8203;用&#8203;し、&#8203; <code>label_high_20</code> &#8203;と&#8203;い&#8203;う&#8203;目&#8203;的&#8203;変&#8203;数&#8203;に&#8203;対&#8203;し&#8203;て、&#8203;ど&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;が&#8203;学&#8203;習&#8203;に&#8203;効&#8203;果&#8203;的&#8203;な&#8203;特&#8203;徴&#8203;量&#8203;な&#8203;の&#8203;か&#8203;を&#8203;見&#8203;て&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># モデルを定義します</span>
sample_model = xgboost.train({<span class="string"><span class="delimiter">&quot;</span><span class="content">learning_rate</span><span class="delimiter">&quot;</span></span>: <span class="float">0.01</span>}, xgboost.DMatrix(train_X[<span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>], label=train_y[<span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>]), <span class="integer">100</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>次&#8203;に&#8203;shap&#8203;値&#8203;を&#8203;求&#8203;め&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">shap.initjs()
explainer = shap.TreeExplainer(model=sample_model, feature_perturbation=<span class="string"><span class="delimiter">'</span><span class="content">tree_path_dependent</span><span class="delimiter">'</span></span>, model_output=<span class="string"><span class="delimiter">'</span><span class="content">margin</span><span class="delimiter">'</span></span>)
<span class="comment"># SHAP値</span>
shap_values = explainer.shap_values(X=train_X[<span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>])
<span class="comment"># プロット</span>
shap.summary_plot(shap_values, train_X[<span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>], plot_type=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/shap_bar.png" alt="shap importance">
</div>
</div>
<div class="paragraph">
<p>次&#8203;に&#8203;shap&#8203;の&#8203;summary_plot&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;は&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;少&#8203;し&#8203;変&#8203;化&#8203;さ&#8203;せ&#8203;た&#8203;時&#8203;の&#8203;学&#8203;習&#8203;の&#8203;イ&#8203;ン&#8203;パ&#8203;ク&#8203;ト&#8203;を&#8203;表&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">shap.summary_plot(shap_values, train_X[<span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/shap_graph.png" alt="shap summary plot">
</div>
</div>
<div class="paragraph">
<p>こ&#8203;の&#8203;図&#8203;の&#8203;見&#8203;方&#8203;で&#8203;す&#8203;が、&#8203;上&#8203;に&#8203;あ&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;ほ&#8203;ど&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;とっ&#8203;て&#8203;重&#8203;要&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;意&#8203;味&#8203;し&#8203;ま&#8203;す。&#8203;色&#8203;が&#8203;赤&#8203;い&#8203;の&#8203;が&#8203;そ&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;が&#8203;高&#8203;い&#8203;時、&#8203;青&#8203;い&#8203;の&#8203;が&#8203;そ&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;が&#8203;低&#8203;い&#8203;時&#8203;の&#8203;SHAP&#8203;値&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;図&#8203;か&#8203;ら&#8203;は&#8203;例&#8203;え&#8203;ば&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;こ&#8203;と&#8203;が&#8203;読&#8203;み&#8203;取&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Total Assets</code> &#8203;が&#8203;1&#8203;番&#8203;目&#8203;に&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;影&#8203;響&#8203;を&#8203;与&#8203;え&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;プ&#8203;ラ&#8203;ス&#8203;方&#8203;向、&#8203;マ&#8203;イ&#8203;ナ&#8203;ス&#8203;方&#8203;向&#8203;に&#8203;関&#8203;わ&#8203;ら&#8203;ず&#8203;青&#8203;い&#8203;色&#8203;が&#8203;多&#8203;い&#8203;の&#8203;で、&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203; <code>Total Assets</code> &#8203;が&#8203;小&#8203;さ&#8203;い&#8203;場&#8203;合&#8203;に&#8203;こ&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;活&#8203;用&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203; <code>Net Assets</code> &#8203;も&#8203;同&#8203;様&#8203;の&#8203;傾&#8203;向&#8203;が&#8203;観&#8203;測&#8203;さ&#8203;れ&#8203;ま&#8203;す</p>
</li>
<li>
<p><code>volatility_1month</code> &#8203;が&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;大&#8203;き&#8203;な&#8203;影&#8203;響&#8203;を&#8203;与&#8203;え&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;は&#8203;赤&#8203;い&#8203;時&#8203;に&#8203;プ&#8203;ラ&#8203;ス&#8203;方&#8203;向&#8203;(&#8203;高&#8203;値&#8203;が&#8203;大&#8203;き&#8203;く&#8203;な&#8203;る&#8203;)&#8203;の&#8203;影&#8203;響&#8203;が&#8203;大&#8203;き&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;は&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;が&#8203;上&#8203;昇&#8203;す&#8203;る&#8203;と&#8203;高&#8203;値&#8203;が&#8203;高&#8203;く&#8203;な&#8203;る&#8203;と&#8203;い&#8203;う&#8203;こ&#8203;と&#8203;を&#8203;意&#8203;味&#8203;す&#8203;る&#8203;の&#8203;で&#8203;直&#8203;感&#8203;に&#8203;合&#8203;致&#8203;し&#8203;ま&#8203;す。</p>
</li>
<li>
<p><code>MA_gap_1_month</code> &#8203;が&#8203;小&#8203;さ&#8203;い&#8203;時&#8203;に&#8203;プ&#8203;ラ&#8203;ス&#8203;方&#8203;向&#8203;(&#8203;高&#8203;値&#8203;が&#8203;大&#8203;き&#8203;く&#8203;な&#8203;る&#8203;)&#8203;に&#8203;影&#8203;響&#8203;を&#8203;与&#8203;え&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;移&#8203;動&#8203;平&#8203;均&#8203;乖&#8203;離&#8203;率&#8203;が&#8203;小&#8203;さ&#8203;い&#8203;と&#8203;き&#8203;は&#8203;移&#8203;動&#8203;平&#8203;均&#8203;線&#8203;が&#8203;そ&#8203;の&#8203;時&#8203;点&#8203;の&#8203;株&#8203;価&#8203;よ&#8203;り&#8203;も&#8203;下&#8203;に&#8203;い&#8203;る&#8203;期&#8203;間&#8203;な&#8203;の&#8203;で、&#8203;そ&#8203;の&#8203;時&#8203;に&#8203;高&#8203;値&#8203;が&#8203;伸&#8203;び&#8203;る&#8203;の&#8203;は&#8203;株&#8203;価&#8203;が&#8203;反&#8203;転&#8203;し&#8203;て&#8203;い&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;高&#8203;い&#8203;の&#8203;か&#8203;も&#8203;し&#8203;れ&#8203;ま&#8203;せ&#8203;ん。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>上&#8203;記&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;考&#8203;察&#8203;を&#8203;行&#8203;い&#8203;な&#8203;が&#8203;ら、&#8203;さ&#8203;ま&#8203;ざ&#8203;ま&#8203;な&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;考&#8203;え、&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;改&#8203;善&#8203;し&#8203;て&#8203;い&#8203;く&#8203;こ&#8203;と&#8203;が&#8203;重&#8203;要&#8203;で&#8203;す。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_モデルの評価">2.12. モデルの評価</h3>
<div class="sect3">
<h4 id="_複数モデルの学習及び結果をまとめる">2.12.1. 複数モデルの学習及び結果をまとめる</h4>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は、&#8203;複&#8203;数&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;予&#8203;測&#8203;及&#8203;び&#8203;結&#8203;果&#8203;の&#8203;比&#8203;較&#8203;を&#8203;行&#8203;い&#8203;た&#8203;い&#8203;と&#8203;思&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>今&#8203;回&#8203;は&#8203;シ&#8203;ン&#8203;プ&#8203;ル&#8203;な&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;複&#8203;数&#8203;用&#8203;い&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;モ&#8203;デ&#8203;ル&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;パ&#8203;ラ&#8203;メー&#8203;ター&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RandomForestRegressor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random_state = 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ExtraTreesRegressor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random_state = 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GradientBoostingRegressor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random_state = 0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>次&#8203;は&#8203;学&#8203;習&#8203;用&#8203;の&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;も&#8203;複&#8203;数&#8203;用&#8203;意&#8203;し&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;学&#8203;習&#8203;用&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fundamental_only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">財&#8203;務&#8203;諸&#8203;表&#8203;デー&#8203;タ&#8203;の&#8203;み</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">return_only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">価&#8203;格&#8203;変&#8203;化&#8203;率&#8203;の&#8203;デー&#8203;タ&#8203;の&#8203;み</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">technical_only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;指&#8203;標&#8203;の&#8203;み</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fundamental+technical</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">財&#8203;務&#8203;諸&#8203;表&#8203;と&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;指&#8203;標&#8203;の&#8203;両&#8203;方</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># モデルを定義</span>
models = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">rf</span><span class="delimiter">&quot;</span></span>: RandomForestRegressor,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">extraTree</span><span class="delimiter">&quot;</span></span>: ExtraTreesRegressor,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">gbr</span><span class="delimiter">&quot;</span></span>: GradientBoostingRegressor,
}

<span class="comment"># 学習用データセット定義</span>
columns = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental_only</span><span class="delimiter">&quot;</span></span>: fundamental_cols,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">return_only</span><span class="delimiter">&quot;</span></span>: returns_cols,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">technical_only</span><span class="delimiter">&quot;</span></span>: technical_cols,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental+technical</span><span class="delimiter">&quot;</span></span>: <span class="predefined">list</span>(fundamental_cols) + <span class="predefined">list</span>(technical_cols),
}

<span class="comment"># 学習済みモデル保存用</span>
trained_models = <span class="predefined">dict</span>()
<span class="comment"># 結果保存用</span>
all_results = <span class="predefined">dict</span>()
<span class="comment"># モデル毎に処理</span>
<span class="keyword">for</span> model <span class="keyword">in</span> tqdm(models.keys()):
    all_results[model] = <span class="predefined">dict</span>()
    trained_models[model] = <span class="predefined">dict</span>()
    <span class="comment"># データセット毎に処理</span>
    <span class="keyword">for</span> col <span class="keyword">in</span> tqdm(columns.keys()):
        result = <span class="predefined">dict</span>()
        trained_models[model][col] = <span class="predefined">dict</span>()
        <span class="comment"># 目的変数毎に処理</span>
        <span class="keyword">for</span> label <span class="keyword">in</span> tqdm(labels):
            <span class="keyword">if</span> <span class="predefined">len</span>(test_X[label][columns[col]]) &gt; <span class="integer">0</span>:
                <span class="comment"># モデル取得</span>
                pred_model = models[model](random_state=<span class="integer">0</span>)
                <span class="comment"># 学習</span>
                pred_model.fit(train_X[label][columns[col]].values, train_y[label])
                <span class="comment"># 学習済みモデル保存</span>
                trained_models[model][col][label] = pred_model
                <span class="comment"># 結果データ作成</span>
                result[label] = test_X[label][[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>]].copy()
                result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = test_X[label][columns[col]].index
                <span class="comment"># 予測</span>
                result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>] = pred_model.predict(test_X[label][columns[col]])
                result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">predict_dir</span><span class="delimiter">&quot;</span></span>] = np.sign(result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>])
                <span class="comment"># 実際の結果</span>
                result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>] = test_y[label].values
                result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">actual_dir</span><span class="delimiter">&quot;</span></span>] = np.sign(result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>])
                result[label].dropna(inplace=<span class="predefined-constant">True</span>)

        all_results[model][col] = result</code></pre>
</div>
</div>
<div class="paragraph">
<p>次&#8203;に&#8203;デー&#8203;タ&#8203;を&#8203;ま&#8203;と&#8203;め&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">results = []
<span class="keyword">for</span> model <span class="keyword">in</span> all_results.keys():
    <span class="keyword">for</span> col <span class="keyword">in</span> all_results[model]:
        tmp = pd.concat(all_results[model][col])
        tmp[<span class="string"><span class="delimiter">&quot;</span><span class="content">model</span><span class="delimiter">&quot;</span></span>] = model
        tmp[<span class="string"><span class="delimiter">&quot;</span><span class="content">feature</span><span class="delimiter">&quot;</span></span>] = col
        results.append(tmp)
results = pd.concat(results)
results[<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>] = [x[<span class="integer">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> results.index]
results.head(<span class="integer">5</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/multiple_data_results.png" alt="データのフォーマット">
</div>
</div>
<div class="paragraph">
<p>で&#8203;は、&#8203;次&#8203;に&#8203;評&#8203;価&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_モデルの性能を示す評価関数の紹介">2.12.2. モデルの性能を示す評価関数の紹介</h4>
<div class="paragraph">
<p>ま&#8203;ず&#8203;は、&#8203;今&#8203;回&#8203;用&#8203;い&#8203;る&#8203;評&#8203;価&#8203;関&#8203;数&#8203;の&#8203;リ&#8203;ス&#8203;ト&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;評&#8203;価&#8203;関&#8203;数&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RMSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">二&#8203;乗&#8203;平&#8203;均&#8203;平&#8203;方&#8203;根</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">accuracy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">目&#8203;的&#8203;変&#8203;数&#8203;の&#8203;符&#8203;号&#8203;と&#8203;予&#8203;測&#8203;し&#8203;た&#8203;目&#8203;的&#8203;変&#8203;数&#8203;の&#8203;符&#8203;号&#8203;の&#8203;精&#8203;度</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spearman_corr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ス&#8203;ピ&#8203;ア&#8203;マ&#8203;ン&#8203;の&#8203;順&#8203;位&#8203;相&#8203;関</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">corr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ピ&#8203;ア&#8203;ソ&#8203;ン&#8203;の&#8203;相&#8203;関&#8203;係&#8203;数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R^2 score</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">単&#8203;回&#8203;帰&#8203;し&#8203;た&#8203;時&#8203;の&#8203;直&#8203;線&#8203;と&#8203;観&#8203;測&#8203;値&#8203;の&#8203;バ&#8203;ラ&#8203;つ&#8203;き</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 結果保存用変数</span>
all_metrics = []

<span class="comment"># データセット毎に処理</span>
<span class="keyword">for</span> feature <span class="keyword">in</span> columns:
    matrix = <span class="predefined">dict</span>()
    <span class="comment"># モデル毎に処理</span>
    <span class="keyword">for</span> model <span class="keyword">in</span> models:
        <span class="comment"># 目的変数毎に処理</span>
        <span class="keyword">for</span> label <span class="keyword">in</span> labels:
            <span class="comment"># 処理対象データに絞り込み</span>
            tmp_df = results[(results[<span class="string"><span class="delimiter">&quot;</span><span class="content">model</span><span class="delimiter">&quot;</span></span>] == model) &amp; (results[<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>] == label) &amp; (results[<span class="string"><span class="delimiter">&quot;</span><span class="content">feature</span><span class="delimiter">&quot;</span></span>] == feature)]
            <span class="comment"># RMSE</span>
            rmse = np.sqrt(mean_squared_error(tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>], tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>]))
            <span class="comment"># 精度</span>
            accuracy = accuracy_score(tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">predict_dir</span><span class="delimiter">&quot;</span></span>], tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">actual_dir</span><span class="delimiter">&quot;</span></span>])
            <span class="comment"># 相関係数</span>
            corr = np.corrcoef(tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>], tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>])[<span class="integer">0</span>, <span class="integer">1</span>]
            <span class="comment"># 順位相関</span>
            spearman_corr = spearmanr(tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>], tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>])[<span class="integer">0</span>]
            <span class="comment"># 結果を保存</span>
            matrix[label] = [rmse, accuracy, spearman_corr,corr, corr**<span class="integer">2</span>, feature, model, tmp_df.shape[<span class="integer">0</span>]]
        res = pd.DataFrame.from_dict(matrix).T
        res.columns = [<span class="string"><span class="delimiter">&quot;</span><span class="content">RMSE</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">accuracy</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">spearman_corr</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">corr</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">R^2 score</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">feature</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">model</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content"># of samples</span><span class="delimiter">&quot;</span></span>]
        all_metrics.append(res)
all_metrics = pd.concat(all_metrics)
all_metrics.reset_index()</code></pre>
</div>
</div>
<div class="paragraph">
<p>こ&#8203;の&#8203;ま&#8203;ま&#8203;だ&#8203;と&#8203;出&#8203;力&#8203;が&#8203;多&#8203;す&#8203;ぎ&#8203;る&#8203;た&#8203;め、&#8203;集&#8203;計&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">numeric_cols = [<span class="string"><span class="delimiter">&quot;</span><span class="content">RMSE</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">accuracy</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">spearman_corr</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">corr</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">R^2 score</span><span class="delimiter">&quot;</span></span>]
<span class="keyword">for</span> col <span class="keyword">in</span> numeric_cols:
    all_metrics[col] = all_metrics[col].astype(<span class="predefined">float</span>)
<span class="comment"># indexとデータセット毎に平均を計算</span>
agg = all_metrics.reset_index().groupby([<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">feature</span><span class="delimiter">&quot;</span></span>]).agg(<span class="string"><span class="delimiter">&quot;</span><span class="content">mean</span><span class="delimiter">&quot;</span></span>)
agg</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/agg_mutiple_models.png" alt="agg mutiple models">
</div>
</div>
<div class="paragraph">
<p>こ&#8203;の&#8203;表&#8203;の&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;（technical_only）&#8203;と&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;デー&#8203;タ&#8203;（fundamental_only）&#8203;に&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;着&#8203;目&#8203;す&#8203;る&#8203;と、&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;の&#8203;み&#8203;を&#8203;用&#8203;い&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;方&#8203;が、&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;デー&#8203;タ&#8203;よ&#8203;り&#8203;も&#8203;精&#8203;度&#8203;（accuracy）&#8203;と&#8203;い&#8203;う&#8203;観&#8203;点&#8203;で&#8203;若&#8203;干&#8203;優&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;分&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;<br>
ま&#8203;た、&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;と&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;デー&#8203;タ&#8203;の&#8203;両&#8203;方&#8203;を&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;用&#8203;い&#8203;た&#8203;場&#8203;合&#8203;の&#8203;結&#8203;果&#8203;に&#8203;関&#8203;し&#8203;て&#8203;は、&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;よ&#8203;り&#8203;も&#8203;若&#8203;干&#8203;全&#8203;体&#8203;正&#8203;解&#8203;率&#8203;が&#8203;高&#8203;く&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;誤&#8203;差&#8203;の&#8203;範&#8203;囲&#8203;内&#8203;で&#8203;す。&#8203;相&#8203;関&#8203;係&#8203;数&#8203;（corr）&#8203;に&#8203;関&#8203;し、&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;と&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;デー&#8203;タ&#8203;を&#8203;両&#8203;方&#8203;用&#8203;い&#8203;た&#8203;場&#8203;合&#8203;は、&#8203;用&#8203;い&#8203;て&#8203;い&#8203;な&#8203;い&#8203;場&#8203;合&#8203;に&#8203;比&#8203;べ&#8203;て、&#8203;優&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;分&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>こ&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;選&#8203;択&#8203;し&#8203;な&#8203;が&#8203;ら&#8203;複&#8203;数&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;つ&#8203;く&#8203;り、&#8203;複&#8203;数&#8203;の&#8203;評&#8203;価&#8203;関&#8203;数&#8203;で&#8203;評&#8203;価&#8203;を&#8203;行&#8203;う&#8203;こ&#8203;と&#8203;で、&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;と&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;デー&#8203;タ&#8203;を&#8203;組&#8203;み&#8203;合&#8203;わ&#8203;せ&#8203;た&#8203;ア&#8203;プ&#8203;ロー&#8203;チ&#8203;の&#8203;ポ&#8203;テ&#8203;ン&#8203;シャ&#8203;ル&#8203;が&#8203;高&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_モデルの提出">2.13. モデルの提出</h3>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;予&#8203;測&#8203;の&#8203;提&#8203;出&#8203;方&#8203;法&#8203;は&#8203;モ&#8203;デ&#8203;ル&#8203;提&#8203;出&#8203;方&#8203;式&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;以&#8203;下&#8203;で&#8203;は&#8203;こ&#8203;の&#8203;方&#8203;式&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;簡&#8203;単&#8203;に&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す&#8203;が、&#8203;詳&#8203;し&#8203;く&#8203;は&#8203; <a href="https://signate.jp/features/runtime/detail">SIGNATE: Runtime &#8203;投&#8203;稿&#8203;方&#8203;法&#8203;</a>&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="sect3">
<h4 id="_runtimeの概要">2.13.1. Runtimeの概要</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>学&#8203;習&#8203;済&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;投&#8203;稿&#8203;す&#8203;る&#8203;と、&#8203;ア&#8203;ル&#8203;ゴ&#8203;リ&#8203;ズ&#8203;ム&#8203; (&#8203;推&#8203;論&#8203;プ&#8203;ロ&#8203;グ&#8203;ラ&#8203;ム&#8203;) &#8203;が&#8203;実&#8203;行&#8203;さ&#8203;れ、&#8203;推&#8203;論&#8203;時&#8203;間・&#8203;推&#8203;論&#8203;結&#8203;果&#8203;が&#8203;出&#8203;力&#8203;さ&#8203;れ&#8203;ま&#8203;す。
出&#8203;力&#8203;さ&#8203;れ&#8203;た&#8203;推&#8203;論&#8203;結&#8203;果&#8203;は、&#8203;評&#8203;価&#8203;関&#8203;数&#8203;（既&#8203;存&#8203;の&#8203;投&#8203;稿&#8203;機&#8203;能）&#8203;に&#8203;自&#8203;動&#8203;で&#8203;投&#8203;稿&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Runtime 機能でできること<br>
<cite><a href="https://signate.jp/features/runtime/detail">SIGNATE: Runtime 投稿方法</a></cite>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_提出ファイルの作成">2.13.2. 提出ファイルの作成</h4>
<div class="sect4">
<h5 id="_1_提出ファイルのテンプレートをダウンロード">1.提出ファイルのテンプレートをダウンロード</h5>
<div class="paragraph">
<p><a href="https://signate-prd-public.s3.ap-northeast-1.amazonaws.com/features/runtime/archive.zip">こちら</a>&#8203;か&#8203;ら&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド</p>
</div>
</div>
<div class="sect4">
<h5 id="_2_ディレクトリの構造を確認する">2.ディレクトリの構造を確認する</h5>
<div class="paragraph">
<p>アッ&#8203;プ&#8203;ロー&#8203;ド&#8203;す&#8203;る&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;構&#8203;造&#8203;は&#8203;次&#8203;の&#8203;と&#8203;お&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── model                  必須 学習済モデルを置くディレクトリ
│   └── ...
├── src                    必須 Python のプログラムを置くディレクトリ
│   ├── predictor.py       必須 最初のプログラムが呼び出すファイル
│   └── ...                その他のファイル (ディレクトリ作成可能)
└── requirements.txt       任意</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_3_学習済みモデルの作成">3.学習済みモデルの作成</h5>
<div class="paragraph">
<p>以&#8203;下&#8203;の&#8203;環&#8203;境&#8203;で&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;構&#8203;築&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Python3 Anaconda3-2019.03 &#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル&#8203;ガ&#8203;イ&#8203;ド&#8203;は&#8203;次&#8203;の&#8203;と&#8203;お&#8203;り&#8203;で&#8203;す。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>&#8203;一&#8203;般&#8203;的&#8203;な&#8203;ケー&#8203;ス&#8203;</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>https://repo.continuum.io/archive/ からバージョン2019.03をダウンロードしてください</pre>
</div>
</div>
<div class="paragraph">
<p><strong>pyenv</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>pyenv install anaconda3-2019.03</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Docker</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker pull continuumio/anaconda3:2019.03</pre>
</div>
</div>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で、&#8203;学&#8203;習&#8203;済&#8203;み&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;保&#8203;存&#8203;方&#8203;法&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。
学&#8203;習&#8203;済&#8203;み&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203; <code>pickle</code> &#8203;で&#8203;保&#8203;存&#8203;し&#8203;ま&#8203;す。&#8203;保&#8203;存&#8203;場&#8203;所&#8203;は&#8203;Chapter 2.13.2&#8203;で&#8203;説&#8203;明&#8203;し&#8203;た&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;構&#8203;造&#8203;の&#8203;学&#8203;習&#8203;済&#8203;み&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;配&#8203;置&#8203;先&#8203;で&#8203;あ&#8203;る&#8203; <code>model</code> &#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;任&#8203;意&#8203;の&#8203;ファ&#8203;イ&#8203;ル&#8203;名&#8203;を&#8203;設&#8203;定&#8203;可&#8203;能&#8203;な&#8203;の&#8203;で、&#8203;今&#8203;回&#8203;は&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;対&#8203;象&#8203;と&#8203;し&#8203;て&#8203;い&#8203;る&#8203;目&#8203;的&#8203;変&#8203;数&#8203;が&#8203;わ&#8203;か&#8203;る&#8203;よ&#8203;う&#8203;に&#8203; <code>my_model_{label}.pkl</code> &#8203;と&#8203;い&#8203;う&#8203;名&#8203;前&#8203;で&#8203;保&#8203;存&#8203;し&#8203;ま&#8203;す。&#8203;具&#8203;体&#8203;的&#8203;に&#8203;は&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;保&#8203;存&#8203;は&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;行&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># モデル保存用にメソッドを定義します</span>
<span class="keyword">def</span> <span class="function">save_model</span>(model, label, model_path=<span class="string"><span class="delimiter">&quot;</span><span class="content">../model</span><span class="delimiter">&quot;</span></span>):
    <span class="comment"># モデル保存先ディレクトリを作成</span>
    os.makedirs(model_path, exist_ok=<span class="predefined-constant">True</span>)
    <span class="keyword">with</span> <span class="predefined">open</span>(os.path.join(model_path, f<span class="string"><span class="delimiter">&quot;</span><span class="content">my_model_{label}.pkl</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">wb</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
        <span class="comment"># モデルをpickle形式で保存</span>
        pickle.dump(model, f)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 保存した学習済みモデルから、提出するモデルを選択してpickle形式で保存します。</span>
<span class="comment"># 使用するモデルや特徴量を変更する際は、学習時と推論時で同一の特徴量をモデルに</span>
<span class="comment"># 入力するために提出用のpredictor.pyについても変更する必要があることにご注意ください。</span>

<span class="comment"># モデルの保存先を指定します。</span>
model_path = <span class="string"><span class="delimiter">&quot;</span><span class="content">archive/model</span><span class="delimiter">&quot;</span></span>
<span class="comment"># モデルの種類</span>
models = [<span class="string"><span class="delimiter">&quot;</span><span class="content">rf</span><span class="delimiter">&quot;</span></span>]
<span class="comment"># 使用する特徴量カラム</span>
columns = [<span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental+technical</span><span class="delimiter">&quot;</span></span>]
<span class="comment"># 目的変数</span>
labels = [
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_low_20</span><span class="delimiter">&quot;</span></span>,
]

<span class="comment"># モデル毎に処理</span>
<span class="keyword">for</span> model <span class="keyword">in</span> models:
    <span class="comment"># 特徴量毎に処理</span>
    <span class="keyword">for</span> col <span class="keyword">in</span> columns:
        <span class="comment"># 目的変数毎に処理</span>
        <span class="keyword">for</span> label <span class="keyword">in</span> labels:
            <span class="comment"># 学習済みモデルを取得</span>
            pred_model = trained_models[model][col][label]
            <span class="comment"># モデルを保存</span>
            save_model(pred_model, label, model_path=model_path)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_4_predictor_py_を記述する">4.predictor.py を記述する</h5>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は、&#8203;提&#8203;出&#8203;す&#8203;る&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み、&#8203;当&#8203;該&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;用&#8203;い&#8203;て&#8203;予&#8203;測&#8203;を&#8203;出&#8203;力&#8203;さ&#8203;せ&#8203;る&#8203;コー&#8203;ド&#8203;の&#8203;書&#8203;き&#8203;方&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。
<code>predictor.py</code> &#8203;ファ&#8203;イ&#8203;ル&#8203;に&#8203;は、&#8203;少&#8203;な&#8203;く&#8203;と&#8203;も&#8203;以&#8203;下&#8203;の&#8203;ク&#8203;ラ&#8203;ス&#8203;及&#8203;び&#8203;メ&#8203;ソッ&#8203;ド&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ScoringService
推論実行のためのクラスです。
以下のメソッドを実装してください。

get_model
モデルを取得するメソッドです。以下の条件があります。
- クラスメソッドであること
- 引数 model_path (str 型) を指定すること
- 正常終了時は返り値を true (bool 型) とすること

predict
推論を実行するメソッドです。以下の条件があります。
- クラスメソッドであること
- 引数 input (dict[str] 型) を指定すること
※ 詳しくはテンプレート内の、predictor.pyファイルをご確認ください。</pre>
</div>
</div>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;お&#8203;け&#8203;る&#8203;predict&#8203;メ&#8203;ソッ&#8203;ド&#8203;の&#8203;返&#8203;り&#8203;値&#8203;の&#8203;定&#8203;義&#8203;は&#8203;以&#8203;下&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;詳&#8203;細&#8203;は&#8203;以&#8203;下&#8203;に&#8203;記&#8203;載&#8203;し&#8203;た&#8203;コー&#8203;ド&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>結果を以下のcsv形式の文字列として出力する。
１列目:datetimeとcodeをつなげたもの(Ex 2016-05-09-1301)
２列目:label_high_20　終値→最高値への変化率
３列目:label_low_20　終値→最安値への変化率
headerはなし、B列C列はfloat64</code></pre>
</div>
</div>
<div class="paragraph">
<p>以&#8203;下&#8203;は、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;説&#8203;明&#8203;し&#8203;た&#8203;内&#8203;容&#8203;を&#8203;こ&#8203;の&#8203;規&#8203;約&#8203;に&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;記&#8203;載&#8203;し&#8203;た&#8203;predictor.py&#8203;で&#8203;す。
本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Public LB&#8203;の&#8203;評&#8203;価&#8203;期&#8203;間&#8203;と&#8203;一&#8203;致&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;デー&#8203;タ&#8203;の&#8203;分&#8203;割&#8203;期&#8203;間&#8203;を&#8203;調&#8203;整&#8203;し&#8203;て&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># -*- coding: utf-8 -*-</span>
<span class="keyword">import</span> <span class="include">io</span>
<span class="keyword">import</span> <span class="include">os</span>
<span class="keyword">import</span> <span class="include">pickle</span>

<span class="keyword">import</span> <span class="include">numpy</span> <span class="keyword">as</span> np
<span class="keyword">import</span> <span class="include">pandas</span> <span class="keyword">as</span> pd
<span class="keyword">from</span> <span class="include">sklearn.ensemble</span> <span class="keyword">import</span> <span class="include">RandomForestRegressor</span>
<span class="keyword">from</span> <span class="include">tqdm.auto</span> <span class="keyword">import</span> <span class="include">tqdm</span>


<span class="keyword">class</span> <span class="class">ScoringService</span>(<span class="predefined">object</span>):
    <span class="comment"># 訓練期間終了日</span>
    TRAIN_END = <span class="string"><span class="delimiter">&quot;</span><span class="content">2018-12-31</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 評価期間開始日</span>
    VAL_START = <span class="string"><span class="delimiter">&quot;</span><span class="content">2019-02-01</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 評価期間終了日</span>
    VAL_END = <span class="string"><span class="delimiter">&quot;</span><span class="content">2019-12-01</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># テスト期間開始日</span>
    TEST_START = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-01</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 目的変数</span>
    TARGET_LABELS = [<span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">label_low_20</span><span class="delimiter">&quot;</span></span>]

    <span class="comment"># データをこの変数に読み込む</span>
    dfs = <span class="predefined-constant">None</span>
    <span class="comment"># モデルをこの変数に読み込む</span>
    models = <span class="predefined-constant">None</span>
    <span class="comment"># 対象の銘柄コードをこの変数に読み込む</span>
    codes = <span class="predefined-constant">None</span>

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_inputs</span>(cls, dataset_dir):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            dataset_dir (str)  : path to dataset directory</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            dict[str]: path to dataset files</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        inputs = {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_list.csv.gz</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_price.csv.gz</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_fin.csv.gz</span><span class="delimiter">&quot;</span></span>,
            <span class="comment"># &quot;stock_fin_price&quot;: f&quot;{dataset_dir}/stock_fin_price.csv.gz&quot;,</span>
            <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_labels.csv.gz</span><span class="delimiter">&quot;</span></span>,
        }
        <span class="keyword">return</span> inputs

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_dataset</span>(cls, inputs):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            inputs (list[str]): path to dataset files</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            dict[pd.DataFrame]: loaded data</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="keyword">if</span> cls.dfs <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            cls.dfs = {}
        <span class="keyword">for</span> k, v <span class="keyword">in</span> inputs.items():
            cls.dfs[k] = pd.read_csv(v)
            <span class="comment"># DataFrameのindexを設定します。</span>
            <span class="keyword">if</span> k == <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>:
                cls.dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = pd.to_datetime(
                    cls.dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>]
                )
                cls.dfs[k].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
            <span class="keyword">elif</span> k <span class="keyword">in</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin_price</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>]:
                cls.dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = pd.to_datetime(
                    cls.dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">base_date</span><span class="delimiter">&quot;</span></span>]
                )
                cls.dfs[k].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
        <span class="keyword">return</span> cls.dfs

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_codes</span>(cls, dfs):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            dfs (dict[pd.DataFrame]): loaded data</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            array: list of stock codes</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        stock_list = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>].copy()
        <span class="comment"># 予測対象の銘柄コードを取得</span>
        cls.codes = stock_list[stock_list[<span class="string"><span class="delimiter">&quot;</span><span class="content">prediction_target</span><span class="delimiter">&quot;</span></span>] == <span class="predefined-constant">True</span>][
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>
        ].values
        <span class="keyword">return</span> cls.codes

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_features_and_label</span>(cls, dfs, codes, feature, label):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            dfs (dict[pd.DataFrame]): loaded data</span><span class="content">
</span><span class="content">            codes  (array) : target codes</span><span class="content">
</span><span class="content">            feature (pd.DataFrame): features</span><span class="content">
</span><span class="content">            label (str) : label column name</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            train_X (pd.DataFrame): training data</span><span class="content">
</span><span class="content">            train_y (pd.DataFrame): label for train_X</span><span class="content">
</span><span class="content">            val_X (pd.DataFrame): validation data</span><span class="content">
</span><span class="content">            val_y (pd.DataFrame): label for val_X</span><span class="content">
</span><span class="content">            test_X (pd.DataFrame): test data</span><span class="content">
</span><span class="content">            test_y (pd.DataFrame): label for test_X</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="comment"># 分割データ用の変数を定義</span>
        trains_X, vals_X, tests_X = [], [], []
        trains_y, vals_y, tests_y = [], [], []

        <span class="comment"># 銘柄コード毎に特徴量を作成</span>
        <span class="keyword">for</span> code <span class="keyword">in</span> tqdm(codes):
            <span class="comment"># 特徴量取得</span>
            feats = feature[feature[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] == code]

            <span class="comment"># stock_labelデータを読み込み</span>
            stock_labels = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>]
            <span class="comment"># 特定の銘柄コードのデータに絞る</span>
            stock_labels = stock_labels[stock_labels[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]

            <span class="comment"># 特定の目的変数に絞る</span>
            labels = stock_labels[label].copy()
            <span class="comment"># nanを削除</span>
            labels.dropna(inplace=<span class="predefined-constant">True</span>)

            <span class="keyword">if</span> feats.shape[<span class="integer">0</span>] &gt; <span class="integer">0</span> <span class="keyword">and</span> labels.shape[<span class="integer">0</span>] &gt; <span class="integer">0</span>:
                <span class="comment"># 特徴量と目的変数のインデックスを合わせる</span>
                labels = labels.loc[labels.index.isin(feats.index)]
                feats = feats.loc[feats.index.isin(labels.index)]
                labels.index = feats.index

                <span class="comment"># データを分割</span>
                _train_X = feats[: cls.TRAIN_END]
                _val_X = feats[cls.VAL_START : cls.VAL_END]
                _test_X = feats[cls.TEST_START :]

                _train_y = labels[: cls.TRAIN_END]
                _val_y = labels[cls.VAL_START : cls.VAL_END]
                _test_y = labels[cls.TEST_START :]

                <span class="comment"># データを配列に格納 (後ほど結合するため)</span>
                trains_X.append(_train_X)
                vals_X.append(_val_X)
                tests_X.append(_test_X)

                trains_y.append(_train_y)
                vals_y.append(_val_y)
                tests_y.append(_test_y)
        <span class="comment"># 銘柄毎に作成した説明変数データを結合します。</span>
        train_X = pd.concat(trains_X)
        val_X = pd.concat(vals_X)
        test_X = pd.concat(tests_X)
        <span class="comment"># 銘柄毎に作成した目的変数データを結合します。</span>
        train_y = pd.concat(trains_y)
        val_y = pd.concat(vals_y)
        test_y = pd.concat(tests_y)

        <span class="keyword">return</span> train_X, train_y, val_X, val_y, test_X, test_y

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_features_for_predict</span>(cls, dfs, code, start_dt=<span class="string"><span class="delimiter">&quot;</span><span class="content">2016-01-01</span><span class="delimiter">&quot;</span></span>):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            dfs (dict)  : dict of pd.DataFrame include stock_fin, stock_price</span><span class="content">
</span><span class="content">            code (int)  : A local code for a listed company</span><span class="content">
</span><span class="content">            start_dt (str): specify date range</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            feature DataFrame (pd.DataFrame)</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="comment"># stock_finデータを読み込み</span>
        stock_fin = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>]

        <span class="comment"># 特定の銘柄コードのデータに絞る</span>
        fin_data = stock_fin[stock_fin[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
        <span class="comment"># 特徴量の作成には過去60営業日のデータを使用しているため、</span>
        <span class="comment"># 予測対象日からバッファ含めて土日を除く過去90日遡った時点から特徴量を生成します</span>
        n = <span class="integer">90</span>
        <span class="comment"># 特徴量の生成対象期間を指定</span>
        fin_data = fin_data.loc[pd.Timestamp(start_dt) - pd.offsets.BDay(n) :]
        <span class="comment"># fin_dataのnp.float64のデータのみを取得</span>
        fin_data = fin_data.select_dtypes(include=[<span class="string"><span class="delimiter">&quot;</span><span class="content">float64</span><span class="delimiter">&quot;</span></span>])
        <span class="comment"># 欠損値処理</span>
        fin_feats = fin_data.fillna(<span class="integer">0</span>)

        <span class="comment"># stock_priceデータを読み込む</span>
        price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]
        <span class="comment"># 特定の銘柄コードのデータに絞る</span>
        price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
        <span class="comment"># 終値のみに絞る</span>
        feats = price_data[[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]]
        <span class="comment"># 特徴量の生成対象期間を指定</span>
        feats = feats.loc[pd.Timestamp(start_dt) - pd.offsets.BDay(n) :].copy()

        <span class="comment"># 終値の20営業日リターン</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_1month</span><span class="delimiter">&quot;</span></span>] = feats[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>
        ].pct_change(<span class="integer">20</span>)
        <span class="comment"># 終値の40営業日リターン</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_2month</span><span class="delimiter">&quot;</span></span>] = feats[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>
        ].pct_change(<span class="integer">40</span>)
        <span class="comment"># 終値の60営業日リターン</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_3month</span><span class="delimiter">&quot;</span></span>] = feats[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>
        ].pct_change(<span class="integer">60</span>)
        <span class="comment"># 終値の20営業日ボラティリティ</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_1month</span><span class="delimiter">&quot;</span></span>] = (
            np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>])
            .diff()
            .rolling(<span class="integer">20</span>)
            .std()
        )
        <span class="comment"># 終値の40営業日ボラティリティ</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_2month</span><span class="delimiter">&quot;</span></span>] = (
            np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>])
            .diff()
            .rolling(<span class="integer">40</span>)
            .std()
        )
        <span class="comment"># 終値の60営業日ボラティリティ</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_3month</span><span class="delimiter">&quot;</span></span>] = (
            np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>])
            .diff()
            .rolling(<span class="integer">60</span>)
            .std()
        )
        <span class="comment"># 終値と20営業日の単純移動平均線の乖離</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_1month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
            feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">20</span>).mean()
        )
        <span class="comment"># 終値と40営業日の単純移動平均線の乖離</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_2month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
            feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">40</span>).mean()
        )
        <span class="comment"># 終値と60営業日の単純移動平均線の乖離</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_3month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
            feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">60</span>).mean()
        )
        <span class="comment"># 欠損値処理</span>
        feats = feats.fillna(<span class="integer">0</span>)
        <span class="comment"># 元データのカラムを削除</span>
        feats = feats.drop([<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>], axis=<span class="integer">1</span>)

        <span class="comment"># 財務データの特徴量とマーケットデータの特徴量のインデックスを合わせる</span>
        feats = feats.loc[feats.index.isin(fin_feats.index)]
        fin_feats = fin_feats.loc[fin_feats.index.isin(feats.index)]

        <span class="comment"># データを結合</span>
        feats = pd.concat([feats, fin_feats], axis=<span class="integer">1</span>).dropna()

        <span class="comment"># 欠損値処理を行います。</span>
        feats = feats.replace([np.inf, -np.inf], <span class="integer">0</span>)

        <span class="comment"># 銘柄コードを設定</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] = code

        <span class="comment"># 生成対象日以降の特徴量に絞る</span>
        feats = feats.loc[pd.Timestamp(start_dt) :]

        <span class="keyword">return</span> feats

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_feature_columns</span>(cls, dfs, train_X, column_group=<span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental+technical</span><span class="delimiter">&quot;</span></span>):
        <span class="comment"># 特徴量グループを定義</span>
        <span class="comment"># ファンダメンタル</span>
        fundamental_cols = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>].select_dtypes(<span class="string"><span class="delimiter">&quot;</span><span class="content">float64</span><span class="delimiter">&quot;</span></span>).columns
        fundamental_cols = fundamental_cols[
            fundamental_cols != <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_Dividend DividendPayableDate</span><span class="delimiter">&quot;</span></span>
        ]
        fundamental_cols = fundamental_cols[fundamental_cols != <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>]
        <span class="comment"># 価格変化率</span>
        returns_cols = [x <span class="keyword">for</span> x <span class="keyword">in</span> train_X.columns <span class="keyword">if</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">return</span><span class="delimiter">&quot;</span></span> <span class="keyword">in</span> x]
        <span class="comment"># テクニカル</span>
        technical_cols = [
            x <span class="keyword">for</span> x <span class="keyword">in</span> train_X.columns <span class="keyword">if</span> (x <span class="keyword">not</span> <span class="keyword">in</span> fundamental_cols) <span class="keyword">and</span> (x != <span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>)
        ]
        columns = {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental_only</span><span class="delimiter">&quot;</span></span>: fundamental_cols,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">return_only</span><span class="delimiter">&quot;</span></span>: returns_cols,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">technical_only</span><span class="delimiter">&quot;</span></span>: technical_cols,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental+technical</span><span class="delimiter">&quot;</span></span>: <span class="predefined">list</span>(fundamental_cols) + <span class="predefined">list</span>(technical_cols),
        }
        <span class="keyword">return</span> columns[column_group]

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">create_model</span>(cls, dfs, codes, label):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            dfs (dict)  : dict of pd.DataFrame include stock_fin, stock_price</span><span class="content">
</span><span class="content">            codes (list[int]): A local code for a listed company</span><span class="content">
</span><span class="content">            label (str): prediction target label</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            RandomForestRegressor</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="comment"># 特徴量を取得</span>
        buff = []
        <span class="keyword">for</span> code <span class="keyword">in</span> codes:
            buff.append(cls.get_features_for_predict(cls.dfs, code))
        feature = pd.concat(buff)
        <span class="comment"># 特徴量と目的変数を一致させて、データを分割</span>
        train_X, train_y, _, _, _, _ = cls.get_features_and_label(
            dfs, codes, feature, label
        )
        <span class="comment"># 特徴量カラムを指定</span>
        feature_columns = cls.get_feature_columns(dfs, train_X)
        <span class="comment"># モデル作成</span>
        model = RandomForestRegressor(random_state=<span class="integer">0</span>)
        model.fit(train_X[feature_columns], train_y)

        <span class="keyword">return</span> model

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">save_model</span>(cls, model, label, model_path=<span class="string"><span class="delimiter">&quot;</span><span class="content">../model</span><span class="delimiter">&quot;</span></span>):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            model (RandomForestRegressor): trained model</span><span class="content">
</span><span class="content">            label (str): prediction target label</span><span class="content">
</span><span class="content">            model_path (str): path to save model</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            -</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="comment"># tag::save_model_partial[]</span>
        <span class="comment"># モデル保存先ディレクトリを作成</span>
        os.makedirs(model_path, exist_ok=<span class="predefined-constant">True</span>)
        <span class="keyword">with</span> <span class="predefined">open</span>(os.path.join(model_path, f<span class="string"><span class="delimiter">&quot;</span><span class="content">my_model_{label}.pkl</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">wb</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
            <span class="comment"># モデルをpickle形式で保存</span>
            pickle.dump(model, f)
        <span class="comment"># end::save_model_partial[]</span>

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_model</span>(cls, model_path=<span class="string"><span class="delimiter">&quot;</span><span class="content">../model</span><span class="delimiter">&quot;</span></span>, labels=<span class="predefined-constant">None</span>):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">Get model method</span><span class="content">
</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            model_path (str): Path to the trained model directory.</span><span class="content">
</span><span class="content">            labels (arrayt): list of prediction target labels</span><span class="content">
</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            bool: The return value. True for success, False otherwise.</span><span class="content">
</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="keyword">if</span> cls.models <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            cls.models = {}
        <span class="keyword">if</span> labels <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            labels = cls.TARGET_LABELS
        <span class="keyword">for</span> label <span class="keyword">in</span> labels:
            m = os.path.join(model_path, f<span class="string"><span class="delimiter">&quot;</span><span class="content">my_model_{label}.pkl</span><span class="delimiter">&quot;</span></span>)
            <span class="keyword">with</span> <span class="predefined">open</span>(m, <span class="string"><span class="delimiter">&quot;</span><span class="content">rb</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
                <span class="comment"># pickle形式で保存されているモデルを読み込み</span>
                cls.models[label] = pickle.load(f)

        <span class="keyword">return</span> <span class="predefined-constant">True</span>

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">train_and_save_model</span>(
        cls, inputs, labels=<span class="predefined-constant">None</span>, codes=<span class="predefined-constant">None</span>, model_path=<span class="string"><span class="delimiter">&quot;</span><span class="content">../model</span><span class="delimiter">&quot;</span></span>
    ):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">Predict method</span><span class="content">
</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            inputs (str)   : paths to the dataset files</span><span class="content">
</span><span class="content">            labels (array) : labels which is used in prediction model</span><span class="content">
</span><span class="content">            codes  (array) : target codes</span><span class="content">
</span><span class="content">            model_path (str): Path to the trained model directory.</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            Dict[pd.DataFrame]: Inference for the given input.</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="keyword">if</span> cls.dfs <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            cls.get_dataset(inputs)
            cls.get_codes(cls.dfs)
        <span class="keyword">if</span> codes <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            codes = cls.codes
        <span class="keyword">if</span> labels <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            labels = cls.TARGET_LABELS
        <span class="keyword">for</span> label <span class="keyword">in</span> labels:
            print(label)
            model = cls.create_model(cls.dfs, codes=codes, label=label)
            cls.save_model(model, label, model_path=model_path)

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">predict</span>(cls, inputs, labels=<span class="predefined-constant">None</span>, codes=<span class="predefined-constant">None</span>, start_dt=TEST_START):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">Predict method</span><span class="content">
</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            inputs (dict[str]): paths to the dataset files</span><span class="content">
</span><span class="content">            labels (list[str]): target label names</span><span class="content">
</span><span class="content">            codes (list[int]): traget codes</span><span class="content">
</span><span class="content">            start_dt (str): specify date range</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            str: Inference for the given input.</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>

        <span class="comment"># データ読み込み</span>
        <span class="keyword">if</span> cls.dfs <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            cls.get_dataset(inputs)
            cls.get_codes(cls.dfs)

        <span class="comment"># 予測対象の銘柄コードと目的変数を設定</span>
        <span class="keyword">if</span> codes <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            codes = cls.codes
        <span class="keyword">if</span> labels <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            labels = cls.TARGET_LABELS

        <span class="comment"># 特徴量を作成</span>
        buff = []
        <span class="keyword">for</span> code <span class="keyword">in</span> codes:
            buff.append(cls.get_features_for_predict(cls.dfs, code, start_dt))
        feats = pd.concat(buff)

        <span class="comment"># 結果を以下のcsv形式で出力する</span>
        <span class="comment"># １列目:datetimeとcodeをつなげたもの(Ex 2016-05-09-1301)</span>
        <span class="comment"># ２列目:label_high_20　終値→最高値への変化率</span>
        <span class="comment"># ３列目:label_low_20　終値→最安値への変化率</span>
        <span class="comment"># headerはなし、B列C列はfloat64</span>

        <span class="comment"># 日付と銘柄コードに絞り込み</span>
        df = feats.loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>]].copy()
        <span class="comment"># codeを出力形式の１列目と一致させる</span>
        df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] = df.index.strftime(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Y-%m-%d-</span><span class="delimiter">&quot;</span></span>) + df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>].astype(
            <span class="predefined">str</span>
        )

        <span class="comment"># 出力対象列を定義</span>
        output_columns = [<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>]

        <span class="comment"># 特徴量カラムを指定</span>
        feature_columns = cls.get_feature_columns(cls.dfs, feats)

        <span class="comment"># 目的変数毎に予測</span>
        <span class="keyword">for</span> label <span class="keyword">in</span> labels:
            <span class="comment"># 予測実施</span>
            df[label] = cls.models[label].predict(feats[feature_columns])
            <span class="comment"># 出力対象列に追加</span>
            output_columns.append(label)

        out = io.StringIO()
        df.to_csv(out, header=<span class="predefined-constant">False</span>, index=<span class="predefined-constant">False</span>, columns=output_columns)

        <span class="keyword">return</span> out.getvalue()</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_モジュールの追加">モジュールの追加</h6>
<div class="paragraph">
<p><a href="https://docs.anaconda.com/anaconda/packages/py3.7_linux-64/" class="bare">https://docs.anaconda.com/anaconda/packages/py3.7_linux-64/</a>
こ&#8203;の&#8203;表&#8203;の&#8203; [In Installer] &#8203;に&#8203;チェッ&#8203;ク&#8203;が&#8203;入っ&#8203;て&#8203;い&#8203;る&#8203;も&#8203;の&#8203;が、&#8203;す&#8203;で&#8203;に&#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;（た&#8203;だ&#8203;し&#8203;バー&#8203;ジョ&#8203;ン&#8203;は&#8203;異&#8203;な&#8203;り&#8203;ま&#8203;す）。</p>
</div>
<div class="paragraph">
<p>Runtime&#8203;環&#8203;境&#8203;に&#8203;モ&#8203;ジュー&#8203;ル&#8203;を&#8203;追&#8203;加&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;は&#8203; <code>requirements.txt</code> &#8203;に&#8203;追&#8203;記&#8203;し&#8203;ま&#8203;す。&#8203;requirements.txt&#8203;に&#8203;記&#8203;載&#8203;し&#8203;た&#8203;モ&#8203;ジュー&#8203;ル&#8203;は&#8203;実&#8203;行&#8203;時&#8203;に&#8203;pip&#8203;で&#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>モ&#8203;ジュー&#8203;ル&#8203;を&#8203;追&#8203;加&#8203;す&#8203;る&#8203;際&#8203;は&#8203;Runtime&#8203;環&#8203;境&#8203;で&#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル&#8203;及&#8203;び&#8203;使&#8203;用&#8203;可&#8203;能&#8203;か&#8203;を&#8203;ご&#8203;確&#8203;認&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;評&#8203;価&#8203;の&#8203;た&#8203;め&#8203;に&#8203;使&#8203;用&#8203;し&#8203;た&#8203;SHAP&#8203;の&#8203;よ&#8203;う&#8203;に、&#8203;一&#8203;部&#8203;の&#8203;モ&#8203;ジュー&#8203;ル&#8203;は&#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル&#8203;時&#8203;に&#8203;ビ&#8203;ル&#8203;ド&#8203;が&#8203;必&#8203;要&#8203;と&#8203;な&#8203;る&#8203;も&#8203;の&#8203;も&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め&#8203;Runtime&#8203;環&#8203;境&#8203;で&#8203;は&#8203;使&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;の&#8203;で&#8203;き&#8203;な&#8203;い&#8203;モ&#8203;ジュー&#8203;ル&#8203;も&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;実&#8203;行&#8203;環&#8203;境&#8203;の&#8203;docker container&#8203;内&#8203;で&#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;確&#8203;認&#8203;可&#8203;能&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker run --rm -it continuumio/anaconda3:2019.03 bash
# pip install tensorflow==2.4.0</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>requirements.txt</code> &#8203;に&#8203;は&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;モ&#8203;ジュー&#8203;ル&#8203;の&#8203;バー&#8203;ジョ&#8203;ン&#8203;を&#8203;指&#8203;定&#8203;し&#8203;て&#8203;記&#8203;載&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;提&#8203;出&#8203;し&#8203;て&#8203;か&#8203;ら&#8203;全&#8203;て&#8203;の&#8203;評&#8203;価&#8203;が&#8203;完&#8203;了&#8203;す&#8203;る&#8203;ま&#8203;で&#8203;数ヶ&#8203;月&#8203;か&#8203;か&#8203;る&#8203;た&#8203;め&#8203;そ&#8203;の&#8203;間&#8203;に&#8203;モ&#8203;ジュー&#8203;ル&#8203;の&#8203;最&#8203;新&#8203;バー&#8203;ジョ&#8203;ン&#8203;が&#8203;リ&#8203;リー&#8203;ス&#8203;さ&#8203;れ&#8203;て&#8203;も&#8203;影&#8203;響&#8203;を&#8203;受&#8203;け&#8203;な&#8203;い&#8203;よ&#8203;う&#8203;に&#8203;す&#8203;る&#8203;た&#8203;め&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>tensorflow==2.4.0</pre>
</div>
</div>
<div class="paragraph">
<p><code>requirements.txt</code> &#8203;の&#8203;作&#8203;成&#8203;に&#8203;は&#8203; <code>pip freeze</code> &#8203;コ&#8203;マ&#8203;ン&#8203;ド&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;と&#8203;便&#8203;利&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker run --rm -it continuumio/anaconda3:2019.03 bash
# pip install [インストールするモジュール]
# pip freeze</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_デバッグ方法">デバッグ方法</h6>
<div class="paragraph">
<p>通&#8203;常</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ pip install -r requirements.txt   # モジュールが必要な場合は pip でインストールします
$ cd src    # ソースディレクトリに移動
$ python    # python の実行
Python 3.7.3 (default, Mar 27 2019, 16:54:48)
[Clang 4.0.1 (tags/RELEASE_401/final)] :: Anaconda, Inc. on darwin
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; DATASET_DIR= "/path/to" # データ保存先ディレクトリ
&gt;&gt;&gt; from predictor import ScoringService  # モジュール読み込み
&gt;&gt;&gt; inputs = ScoringService.get_inputs(DATASET_DIR)  # 推論入力データ取得
&gt;&gt;&gt; ScoringService.get_model()  # モデルの取得
True
&gt;&gt;&gt; ScoringService.predict(inputs)  # 推論の実行
'[推論結果]'</pre>
</div>
</div>
<div class="paragraph">
<p>pyenv&#8203;を&#8203;使&#8203;用</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ pyenv local anaconda3-2019.03</pre>
</div>
</div>
<div class="paragraph">
<p>以&#8203;降&#8203; &#8203;通&#8203;常&#8203;の&#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル&#8203;の&#8203;場&#8203;合&#8203;と&#8203;同&#8203;様&#8203;の&#8203;デ&#8203;バッ&#8203;グ&#8203;方&#8203;法&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>Docker &#8203;を&#8203;使&#8203;用</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ docker run -it -v $(pwd):/opt/ml continuumio/anaconda3:2019.03 /bin/bash
$ cd /opt/ml</pre>
</div>
</div>
<div class="paragraph">
<p>以&#8203;降&#8203;は、&#8203;通&#8203;常&#8203;の&#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル&#8203;の&#8203;場&#8203;合&#8203;と&#8203;同&#8203;様&#8203;の&#8203;デ&#8203;バッ&#8203;グ&#8203;方&#8203;法&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_5_zip_で圧縮して提出する">5.zip で圧縮して提出する。</h5>
<div class="paragraph">
<p>指&#8203;定&#8203;さ&#8203;れ&#8203;た&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;構&#8203;成&#8203;で&#8203;学&#8203;習&#8203;済&#8203;み&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;保&#8203;存&#8203;し&#8203;た&#8203;上&#8203;で、&#8203;predictor.py&#8203;を&#8203;作&#8203;成&#8203;し&#8203;た&#8203;ら、&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;zip&#8203;で&#8203;圧&#8203;縮&#8203;し&#8203;て&#8203;提&#8203;出&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ls
model  requirements.txt  src
$ zip -v submit.zip requirements.txt src/*.py model/*.pkl
updating: requirements.txt	(in=0) (out=0) (stored 0%)
updating: src/predictor.py	(in=11408) (out=2417) (deflated 79%)
updating: model/my_model_label_high_20.pkl .	(in=18919345) (out=5071005) (deflated 73%)
updating: model/my_model_label_low_20.pkl .	(in=18704305) (out=5006613) (deflated 73%)
total bytes=37635058, compressed=10080035 -&gt; 73% savings</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ランタイム環境に関して">2.13.3. ランタイム環境に関して</h4>
<div class="paragraph">
<p>■&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;で&#8203;の&#8203;利&#8203;用&#8203;可&#8203;能&#8203;な&#8203;デー&#8203;タ&#8203;に&#8203;つ&#8203;い&#8203;て</p>
</div>
<div class="paragraph">
<p>・&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;に&#8203;提&#8203;出&#8203;し&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;は、&#8203;各&#8203;銘&#8203;柄&#8203;の&#8203;株&#8203;価&#8203;の&#8203;最&#8203;高&#8203;値&#8203;及&#8203;び&#8203;最&#8203;安&#8203;値&#8203;を&#8203;予&#8203;測&#8203;す&#8203;る&#8203;際、&#8203;評&#8203;価&#8203;対&#8203;象&#8203;と&#8203;な&#8203;る&#8203;決&#8203;算&#8203;短&#8203;信&#8203;の&#8203;開&#8203;示&#8203;日&#8203;以&#8203;前&#8203;の&#8203;デー&#8203;タ&#8203;（銘&#8203;柄、&#8203;株&#8203;価、&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報）&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>・&#8203;た&#8203;だ&#8203;し、&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;で&#8203;は、&#8203;評&#8203;価&#8203;対&#8203;象&#8203;と&#8203;な&#8203;る&#8203;決&#8203;算&#8203;短&#8203;信&#8203;の&#8203;開&#8203;示&#8203;日&#8203;の&#8203;期&#8203;間&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;全&#8203;て&#8203;格&#8203;納&#8203;し&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;予&#8203;測&#8203;時&#8203;に&#8203;開&#8203;示&#8203;日&#8203;よ&#8203;り&#8203;未&#8203;来&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;と、&#8203;リー&#8203;ク&#8203;が&#8203;生&#8203;じ&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>・&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;で&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;用&#8203;い&#8203;て&#8203;特&#8203;徴&#8203;量&#8203;生&#8203;成&#8203;や&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;再&#8203;学&#8203;習&#8203;を&#8203;行&#8203;う&#8203;際&#8203;は、&#8203;リー&#8203;ク&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;な&#8203;い&#8203;よ&#8203;う&#8203;ご&#8203;留&#8203;意&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>以&#8203;下、&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;実&#8203;行&#8203;日&#8203;が&#8203;5&#8203;月&#8203;10&#8203;日&#8203;の&#8203;ケー&#8203;ス&#8203;（Private 1st）&#8203;を&#8203;例&#8203;と&#8203;し&#8203;て&#8203;取&#8203;り&#8203;上&#8203;げ&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>・ランタイム環境には、2016年1月1日から2021年4月5日までのデータが配置されています
・提出モデルは、3月29日に開示された決算短信について翌営業日より20営業日間の最高値及び最安値を予測する際、3月29日までのデータを利用できます。3月30日以降のデータを利用するとリークとなり、入賞資格を失います
・同様に、4月1日に開示された決算短信について予測する際には、4月2日以降のデータは利用できません</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ポートフォリオを構築しよう">3. ポートフォリオを構築しよう</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ニュース分析チャレンジのチュートリアルの構成">3.1. 「ニュース分析チャレンジ」のチュートリアルの構成</h3>
<div class="paragraph">
<p>　3&#8203;章&#8203;か&#8203;ら&#8203;6&#8203;章&#8203;で&#8203;は、&#8203;J-Quants&#8203;で&#8203;開&#8203;催&#8203;す&#8203;る&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;う&#8203;ち、&#8203;<a href="https://signate.jp/competitions/443">「ニュース分析チャレンジ」</a>&#8203;に&#8203;係&#8203;る&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;を&#8203;提&#8203;供&#8203;し&#8203;ま&#8203;す。
本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;2&#8203;章&#8203;に&#8203;記&#8203;載&#8203;し&#8203;て&#8203;い&#8203;る&#8203;「ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;ズ&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ」&#8203;と&#8203;同&#8203;様&#8203;に、&#8203;デー&#8203;タ&#8203;分&#8203;析&#8203;や&#8203;株&#8203;式&#8203;取&#8203;引&#8203;に&#8203;は&#8203;興&#8203;味&#8203;は&#8203;あ&#8203;る&#8203;が、&#8203;きっ&#8203;か&#8203;け&#8203;が&#8203;な&#8203;い&#8203;と&#8203;い&#8203;う&#8203;方&#8203;を&#8203;主&#8203;な&#8203;対&#8203;象&#8203;と&#8203;し&#8203;て、&#8203;投&#8203;資&#8203;に&#8203;ま&#8203;つ&#8203;わ&#8203;る&#8203;デー&#8203;タ・&#8203;環&#8203; &#8203;境&#8203;を&#8203;提&#8203;供&#8203;し、&#8203;株&#8203;式&#8203;市&#8203;場&#8203;に&#8203;お&#8203;け&#8203;る&#8203;デー&#8203;タ&#8203;利&#8203;活&#8203;用&#8203;の&#8203;可&#8203;能&#8203;性&#8203;を&#8203;試&#8203;し&#8203;て&#8203;い&#8203;た&#8203;だ&#8203;く&#8203;こ&#8203;と&#8203;を&#8203;期&#8203;待&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>大&#8203;ま&#8203;か&#8203;に&#8203;3&#8203;章&#8203;か&#8203;ら&#8203;6&#8203;章&#8203;に&#8203;か&#8203;け&#8203;て&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;こ&#8203;と&#8203;が&#8203;記&#8203;載&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;の&#8203;か&#8203;を&#8203;以&#8203;下&#8203;で&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_3章の概要">3.1.1. 3章の概要</h4>
<div class="paragraph">
<p>　3&#8203;章&#8203;で&#8203;は&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;参&#8203;加&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;基&#8203;本&#8203;知&#8203;識&#8203;を&#8203;学&#8203;ぶ&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;主&#8203;に&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;題&#8203;材&#8203;を&#8203;扱&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;課&#8203;題&#8203;の&#8203;説&#8203;明</p>
</li>
<li>
<p>デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;説&#8203;明</p>
</li>
<li>
<p>提&#8203;出&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;予&#8203;測&#8203;出&#8203;力&#8203;の&#8203;定&#8203;義</p>
</li>
<li>
<p>バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;手&#8203;法</p>
</li>
<li>
<p>シ&#8203;ン&#8203;プ&#8203;ル&#8203;な&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;組&#8203;成&#8203;方&#8203;法</p>
</li>
<li>
<p>ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;評&#8203;価&#8203;方&#8203;法</p>
</li>
<li>
<p>構&#8203;築&#8203;し&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;提&#8203;出&#8203;方&#8203;法</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_4章の概要">3.1.2. 4章の概要</h4>
<div class="paragraph">
<p>　4&#8203;章&#8203;で&#8203;は&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;2&#8203;章&#8203;で&#8203;構&#8203;築&#8203;し&#8203;た&#8203;最&#8203;高&#8203;値・&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;使&#8203;用&#8203;し&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;構&#8203;築&#8203;方&#8203;法&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;3&#8203;章&#8203;で&#8203;は&#8203;機&#8203;械&#8203;学&#8203;習&#8203;的&#8203;な&#8203;手&#8203;法&#8203;を&#8203;用&#8203;い&#8203;て&#8203;い&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;4&#8203;章&#8203;で&#8203;は&#8203;機&#8203;械&#8203;学&#8203;習&#8203;的&#8203;手&#8203;法&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;利&#8203;用&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;提&#8203;供&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;適&#8203;時&#8203;開&#8203;示&#8203;情&#8203;報&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;も&#8203;簡&#8203;単&#8203;に&#8203;触&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;3&#8203;章&#8203;よ&#8203;り&#8203;内&#8203;容&#8203;は&#8203;複&#8203;雑&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;実&#8203;際&#8203;に&#8203;機&#8203;械&#8203;学&#8203;習&#8203;を&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;組&#8203;成&#8203;に&#8203;活&#8203;か&#8203;す&#8203;た&#8203;め&#8203;の&#8203;知&#8203;識&#8203;を&#8203;学&#8203;ぶ&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;主&#8203;に&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;題&#8203;材&#8203;を&#8203;扱&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>2&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;修&#8203;正</p>
</li>
<li>
<p>モ&#8203;デ&#8203;ル&#8203;を&#8203;用&#8203;い&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;組&#8203;成&#8203;方&#8203;法</p>
</li>
<li>
<p>適&#8203;時&#8203;開&#8203;示&#8203;情&#8203;報&#8203;の&#8203;有&#8203;効&#8203;活&#8203;用</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_5章の概要">3.1.3. 5章の概要</h4>
<div class="paragraph">
<p>　5&#8203;章&#8203;で&#8203;は&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;特&#8203;色&#8203;で&#8203;あ&#8203;る&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;を&#8203;活&#8203;用&#8203;し&#8203;た&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;を&#8203;構&#8203;築&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;手&#8203;法&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;近&#8203;年&#8203;の&#8203;ディー&#8203;プ&#8203;ニュー&#8203;ラ&#8203;ル&#8203;ネッ&#8203;ト&#8203;ワー&#8203;ク&#8203;の&#8203;研&#8203;究&#8203;の&#8203;発&#8203;展&#8203;に&#8203;よ&#8203;り、&#8203;自&#8203;然&#8203;言&#8203;語&#8203;処&#8203;理&#8203;の&#8203;分&#8203;野&#8203;に&#8203;お&#8203;い&#8203;て&#8203;も&#8203;大&#8203;き&#8203;な&#8203;技&#8203;術&#8203;の&#8203;発&#8203;展&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;し&#8203;た。&#8203;5&#8203;章&#8203;で&#8203;は&#8203;そ&#8203;の&#8203;中&#8203;で&#8203;も&#8203;大&#8203;き&#8203;な&#8203;成&#8203;果&#8203;の&#8203;一&#8203;つ&#8203;で&#8203;あ&#8203;る&#8203;BERT(Bidirectional Encoder Representations from Transformers) (&#8203;参&#8203;考&#8203;: <a href="https://qiita.com/omiita/items/72998858efc19a368e50">自然言語処理の王様「BERT」の論文を徹底解説</a>) &#8203;を&#8203;用&#8203;い&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;手&#8203;法&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。
　&#8203;ま&#8203;た、&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;の&#8203;前&#8203;処&#8203;理&#8203;や&#8203;可&#8203;視&#8203;化&#8203;も&#8203;丁&#8203;寧&#8203;に&#8203;説&#8203;明&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;の&#8203;特&#8203;色&#8203;で&#8203;あ&#8203;る&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;の&#8203;解&#8203;析&#8203;に&#8203;必&#8203;要&#8203;な&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;基&#8203;礎&#8203;知&#8203;識&#8203;を&#8203;学&#8203;ぶ&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;の&#8203;基&#8203;礎&#8203;知&#8203;識</p>
</li>
<li>
<p>テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;の&#8203;前&#8203;処&#8203;理&#8203;方&#8203;法</p>
</li>
<li>
<p>テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;の&#8203;可&#8203;視&#8203;化&#8203;方&#8203;法</p>
</li>
<li>
<p>BERT&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;よ&#8203;る&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;か&#8203;ら&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;手&#8203;法</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_6章の概要">3.1.4. 6章の概要</h4>
<div class="paragraph">
<p>　6&#8203;章&#8203;で&#8203;は&#8203;5&#8203;章&#8203;で&#8203;取&#8203;得&#8203;し&#8203;た&#8203;BERT&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;用&#8203;い&#8203;た&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;を&#8203;構&#8203;築&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;手&#8203;法&#8203;の&#8203;一&#8203;つ&#8203;と&#8203;し&#8203;て&#8203;LSTM(Long Short Term Memory)(&#8203;参&#8203;考&#8203;: <a href="https://qiita.com/KojiOhki/items/89cd7b69a8a6239d67ca">LSTMネットワークの概要</a>)&#8203;を&#8203;用&#8203;い&#8203;た&#8203;ス&#8203;コ&#8203;ア&#8203;生&#8203;成&#8203;手&#8203;法&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;た&#8203;だ&#8203;し、&#8203;本&#8203;章&#8203;は&#8203;ディー&#8203;プ&#8203;ニュー&#8203;ラ&#8203;ル&#8203;ネッ&#8203;ト&#8203;ワー&#8203;ク&#8203;の&#8203;基&#8203;礎&#8203;知&#8203;識&#8203;等&#8203;を&#8203;前&#8203;提&#8203;と&#8203;し&#8203;た、&#8203;か&#8203;な&#8203;り&#8203;高&#8203;度&#8203;な&#8203;内&#8203;容&#8203;に&#8203;なっ&#8203;て&#8203;お&#8203;り、&#8203;少&#8203;し&#8203;発&#8203;展&#8203;的&#8203;な&#8203;内&#8203;容&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ニュース分析チャレンジについて">3.2. 「ニュース分析チャレンジ」について</h3>
<div class="paragraph">
<p>　&#8203;本&#8203;節&#8203;で&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;の&#8203;概&#8203;要&#8203;や&#8203;ス&#8203;ケ&#8203;ジュー&#8203;ル&#8203;を&#8203;記&#8203;載&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;課&#8203;題&#8203;内&#8203;容&#8203;</strong></p>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;現&#8203;金&#8203;100&#8203;万&#8203;円&#8203;を&#8203;原&#8203;資&#8203;と&#8203;し&#8203;て、&#8203;あ&#8203;る&#8203;週&#8203;の&#8203;週&#8203;初&#8203;営&#8203;業&#8203;日&#8203;に&#8203;始&#8203;値&#8203;で&#8203;購&#8203;入、&#8203;そ&#8203;の&#8203;週&#8203;の&#8203;週&#8203;末&#8203;営&#8203;業&#8203;日&#8203;に&#8203;売&#8203;却&#8203;す&#8203;る&#8203;と&#8203;し&#8203;た&#8203;場&#8203;合&#8203;に、&#8203;で&#8203;き&#8203;る&#8203;限&#8203;り&#8203;利&#8203;益&#8203;を&#8203;得&#8203;る&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;予&#8203;測&#8203;に&#8203;取&#8203;り&#8203;組&#8203;ん&#8203;で&#8203;い&#8203;た&#8203;だ&#8203;き&#8203;ま&#8203;す。&#8203;<br>
　&#8203;そ&#8203;し&#8203;て、&#8203;前&#8203;述&#8203;の&#8203;予&#8203;測&#8203;を&#8203;予&#8203;め&#8203;決&#8203;め&#8203;ら&#8203;れ&#8203;た&#8203;4&#8203;週&#8203;間&#8203;の&#8203;間&#8203;に&#8203;4&#8203;ラ&#8203;ウ&#8203;ン&#8203;ド&#8203;行っ&#8203;て&#8203;い&#8203;た&#8203;だ&#8203;き、&#8203;そ&#8203;の&#8203;4&#8203;ラ&#8203;ウ&#8203;ン&#8203;ド&#8203;全&#8203;て&#8203;の&#8203;合&#8203;計&#8203;の&#8203;利&#8203;益&#8203;を&#8203;競っ&#8203;て&#8203;い&#8203;た&#8203;だ&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;概&#8203;要&#8203;</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;項&#8203;目&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;内&#8203;容&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ニュー&#8203;ス&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">主&#8203;な&#8203;対&#8203;象&#8203;者</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">株&#8203;式&#8203;市&#8203;場&#8203;を&#8203;対&#8203;象&#8203;と&#8203;し&#8203;た&#8203;デー&#8203;タ&#8203;分&#8203;析&#8203;の&#8203;初&#8203;学&#8203;者・&#8203;デー&#8203;タ&#8203;サ&#8203;イ&#8203;エ&#8203;ン&#8203;ス&#8203;に&#8203;知&#8203;見&#8203;の&#8203;あ&#8203;る&#8203;有&#8203;識&#8203;者・&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;分&#8203;析&#8203;の&#8203;有&#8203;識&#8203;者&#8203;等</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">入&#8203;力&#8203;内&#8203;容&#8203;（利&#8203;用&#8203;デー&#8203;タ）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;情&#8203;報・&#8203;株&#8203;価&#8203;情&#8203;報・&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;等・&#8203;日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;見&#8203;出&#8203;し&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ・&#8203;適&#8203;時&#8203;開&#8203;示&#8203;デー&#8203;タ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">出&#8203;力&#8203;内&#8203;容&#8203;（予&#8203;測&#8203;対&#8203;象）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現&#8203;金&#8203;100&#8203;万&#8203;円&#8203;を&#8203;原&#8203;資&#8203;と&#8203;し、&#8203;あ&#8203;る&#8203;週&#8203;の&#8203;週&#8203;初&#8203;営&#8203;業&#8203;日&#8203;に&#8203;複&#8203;数&#8203;銘&#8203;柄&#8203;（最&#8203;低&#8203;5&#8203;銘&#8203;柄&#8203;以&#8203;上）&#8203;を&#8203;始&#8203;値&#8203;で&#8203;購&#8203;入、&#8203;そ&#8203;の&#8203;週&#8203;の&#8203;週&#8203;末&#8203;営&#8203;業&#8203;日&#8203;に&#8203;終&#8203;値&#8203;で&#8203;売&#8203;却&#8203;す&#8203;る&#8203;と&#8203;し&#8203;た&#8203;場&#8203;合&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">参&#8203;加&#8203;を&#8203;通&#8203;じ&#8203;て&#8203;得&#8203;ら&#8203;れ&#8203;る&#8203;知&#8203;見</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">- &#8203;株&#8203;価&#8203;や&#8203;企&#8203;業&#8203;業&#8203;績&#8203;の&#8203;推&#8203;移&#8203;な&#8203;ど&#8203;の&#8203;時&#8203;系&#8203;列&#8203;デー&#8203;タ&#8203;の&#8203;解&#8203;析&#8203;手&#8203;法&#8203;<br>
- &#8203;市&#8203;場&#8203;動&#8203;向&#8203;の&#8203;把&#8203;握&#8203;手&#8203;法&#8203;<br>
- &#8203;リ&#8203;ス&#8203;ク&#8203;分&#8203;析&#8203;<br>
- &#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;の&#8203;解&#8203;析&#8203;手&#8203;法</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>&#8203;ス&#8203;ケ&#8203;ジュー&#8203;ル&#8203;</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;日&#8203;時&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;内&#8203;容&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021&#8203;年&#8203;3&#8203;月&#8203;19&#8203;日&#8203;（金）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;開&#8203;始&#8203;（デー&#8203;タ&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;の&#8203;み&#8203;可&#8203;能、&#8203;モ&#8203;デ&#8203;ル&#8203;提&#8203;出&#8203;は&#8203;不&#8203;可）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021&#8203;年&#8203;3&#8203;月&#8203;26&#8203;日&#8203;（金）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モ&#8203;デ&#8203;ル&#8203;提&#8203;出&#8203;開&#8203;始</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021&#8203;年&#8203;5&#8203;月&#8203;9&#8203;日&#8203;（日）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モ&#8203;デ&#8203;ル&#8203;提&#8203;出&#8203;締&#8203;切</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021&#8203;年&#8203;5&#8203;月&#8203;10&#8203;日&#8203;（月）〜&#8203; 6&#8203;月&#8203;4&#8203;日&#8203;（金）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モ&#8203;デ&#8203;ル&#8203;評&#8203;価&#8203;期&#8203;間&#8203;（4&#8203;週&#8203;間&#8203;4&#8203;ラ&#8203;ウ&#8203;ン&#8203;ド）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021&#8203;年&#8203;7&#8203;月&#8203;頃</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">入&#8203;賞&#8203;者&#8203;の&#8203;決&#8203;定</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_予測対象_2">3.3. 予測対象</h3>
<div class="paragraph">
<p>　&#8203;本&#8203;節&#8203;で&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;予&#8203;測&#8203;対&#8203;象&#8203;で&#8203;あ&#8203;る&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;や&#8203;そ&#8203;の&#8203;構&#8203;成&#8203;銘&#8203;柄&#8203;の&#8203;条&#8203;件&#8203;等&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;詳&#8203;し&#8203;く&#8203;説&#8203;明&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;予&#8203;測&#8203;対&#8203;象&#8203;</strong></p>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;予&#8203;測&#8203;対&#8203;象&#8203;は、&#8203;現&#8203;金&#8203;100&#8203;万&#8203;円&#8203;を&#8203;原&#8203;資&#8203;と&#8203;し&#8203;て、&#8203;あ&#8203;る&#8203;週&#8203;の&#8203;週&#8203;初&#8203;営&#8203;業&#8203;日&#8203;に&#8203;始&#8203;値&#8203;で&#8203;購&#8203;入、&#8203;そ&#8203;の&#8203;週&#8203;の&#8203;週&#8203;末&#8203;営&#8203;業&#8203;日&#8203;に&#8203;売&#8203;却&#8203;す&#8203;る&#8203;と&#8203;し&#8203;た&#8203;場&#8203;合&#8203;に&#8203;高&#8203;い&#8203;利&#8203;益&#8203;を&#8203;得&#8203;る&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;下&#8203;図&#8203;に&#8203;最&#8203;終&#8203;的&#8203;な&#8203;課&#8203;題&#8203;内&#8203;容&#8203;及&#8203;び&#8203;評&#8203;価&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;イ&#8203;メー&#8203;ジ&#8203;を&#8203;示&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;<br>
　&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;と&#8203;は、&#8203;「資&#8203;産&#8203;運&#8203;用&#8203;の&#8203;世&#8203;界&#8203;で&#8203;様々&#8203;な&#8203;資&#8203;産&#8203;ま&#8203;た&#8203;は&#8203;銘&#8203;柄&#8203;の&#8203;組&#8203;み&#8203;合&#8203;わ&#8203;せ&#8203;の&#8203;こ&#8203;と」&#8203;（引&#8203;用：&#8203;<a href="https://www.jpx.co.jp/glossary/ha/417.html">JPXHP用語集</a>）&#8203;を&#8203;指&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/news_predict_target.png" alt="news_predict_target">
</div>
</div>
<div class="sect3">
<h4 id="_ポートフォリオに組入れできる銘柄の条件">3.3.1. ポートフォリオに組入れできる銘柄の条件</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;予&#8203;測&#8203;対&#8203;象&#8203;と&#8203;な&#8203;る&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;構&#8203;成&#8203;す&#8203;る&#8203;銘&#8203;柄&#8203;は、&#8203;次&#8203;に&#8203;挙&#8203;げ&#8203;る&#8203;条&#8203;件&#8203;を&#8203;全&#8203;て&#8203;満&#8203;た&#8203;す&#8203;も&#8203;の&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で&#8203;ご&#8203;注&#8203;意&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>A)	2020&#8203;年&#8203;12&#8203;月&#8203;末&#8203;時&#8203;点&#8203;で、&#8203;東&#8203;京&#8203;証&#8203;券&#8203;取&#8203;引&#8203;所&#8203;に&#8203;上&#8203;場&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と</p>
</div>
<div class="paragraph">
<p>B)	&#8203;普&#8203;通&#8203;株&#8203;式&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;（種&#8203;類&#8203;株&#8203;で&#8203;は&#8203;な&#8203;い&#8203;こ&#8203;と）</p>
</div>
<div class="paragraph">
<p>C)	ETF、&#8203;ETN、&#8203;REIT、&#8203;優&#8203;先&#8203;出&#8203;資&#8203;証&#8203;券、&#8203;イ&#8203;ン&#8203;フ&#8203;ラ&#8203;ファ&#8203;ン&#8203;ド、&#8203;外&#8203;国&#8203;株&#8203;の&#8203;い&#8203;ず&#8203;れ&#8203;に&#8203;も&#8203;該&#8203;当&#8203;し&#8203;な&#8203;い&#8203;こ&#8203;と</p>
</div>
<div class="paragraph">
<p>D)  2020&#8203;年&#8203;12&#8203;月&#8203;末&#8203;時&#8203;点&#8203;で、&#8203;時&#8203;価&#8203;総&#8203;額&#8203;が&#8203;200&#8203;億&#8203;を&#8203;上&#8203;回っ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と</p>
</div>
</div>
<div class="sect3">
<h4 id="_ポートフォリオの条件">3.3.2. ポートフォリオの条件</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;予&#8203;測&#8203;対&#8203;象&#8203;と&#8203;な&#8203;る&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;は、&#8203;次&#8203;に&#8203;挙&#8203;げ&#8203;る&#8203;条&#8203;件&#8203;を&#8203;全&#8203;て&#8203;満&#8203;た&#8203;す&#8203;も&#8203;の&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;条&#8203;件&#8203;を&#8203;満&#8203;た&#8203;さ&#8203;な&#8203;い&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;は&#8203;失&#8203;格&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>A)	&#8203;原&#8203;資&#8203;100&#8203;万&#8203;円&#8203;の&#8203;う&#8203;ち、&#8203;少&#8203;な&#8203;く&#8203;と&#8203;も&#8203;50&#8203;万&#8203;円&#8203;は&#8203;株&#8203;の&#8203;購&#8203;入&#8203;に&#8203;充&#8203;て&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;（す&#8203;な&#8203;わ&#8203;ち、&#8203;原&#8203;資&#8203;100&#8203;万&#8203;円&#8203;全&#8203;て&#8203;を&#8203;投&#8203;資&#8203;し&#8203;な&#8203;く&#8203;て&#8203;も&#8203;良&#8203;く、&#8203;50&#8203;万&#8203;円&#8203;は&#8203;銘&#8203;柄&#8203;購&#8203;入&#8203;に、&#8203;残&#8203;り&#8203;50&#8203;万&#8203;円&#8203;を&#8203;現&#8203;金&#8203;と&#8203;し&#8203;て&#8203;保&#8203;有&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;可&#8203;能）</p>
</div>
<div class="paragraph">
<p>B)	&#8203;少&#8203;な&#8203;く&#8203;と&#8203;も&#8203;5&#8203;銘&#8203;柄&#8203;以&#8203;上&#8203;で&#8203;構&#8203;成&#8203;さ&#8203;れ&#8203;る&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と</p>
</div>
</div>
<div class="sect3">
<h4 id="anchor-3.3.4">3.3.3. 提出するモデルの予測出力の定義</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;提&#8203;出&#8203;し&#8203;て&#8203;い&#8203;た&#8203;だ&#8203;く&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;は&#8203;以&#8203;下&#8203;の&#8203;フォー&#8203;マッ&#8203;ト&#8203;及&#8203;び&#8203;条&#8203;件&#8203;を&#8203;満&#8203;た&#8203;す&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="sect4">
<h5 id="_出力フォーマット">出力フォーマット</h5>
<div class="paragraph">
<p>　&#8203;以&#8203;下&#8203;の&#8203;csv&#8203;形&#8203;式&#8203;で&#8203;出&#8203;力</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;列&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;名&#8203;前&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#8203;列&#8203;目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021-02-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">株&#8203;を&#8203;購&#8203;入&#8203;す&#8203;る&#8203;日&#8203;付&#8203;（各&#8203;週&#8203;の&#8203;月&#8203;曜&#8203;日&#8203;の&#8203;日&#8203;付）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2&#8203;列&#8203;目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8697</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;コー&#8203;ド</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3&#8203;列&#8203;目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">budget</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">購&#8203;入&#8203;金&#8203;額</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>CSV&#8203;の&#8203;出&#8203;力&#8203;例&#8203;を&#8203;以&#8203;下&#8203;に&#8203;示&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/csv_sample.png" alt="csv_format_sample">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_フォーマットの条件">フォーマットの条件</h5>
<div class="ulist">
<ul>
<li>
<p>ヘッ&#8203;ダ&#8203;が&#8203;付&#8203;与&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と</p>
</li>
<li>
<p>5&#8203;銘&#8203;柄&#8203;以&#8203;上&#8203;選&#8203;択&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と</p>
</li>
<li>
<p>date&#8203;は&#8203;予&#8203;測&#8203;対&#8203;象&#8203;の&#8203;週&#8203;の&#8203;月&#8203;曜&#8203;日&#8203;の&#8203;日&#8203;付&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と</p>
</li>
<li>
<p>購&#8203;入&#8203;金&#8203;額&#8203;は&#8203;1&#8203;以&#8203;上&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と</p>
</li>
<li>
<p>銘&#8203;柄&#8203;を&#8203;購&#8203;入&#8203;優&#8203;先&#8203;度&#8203;順&#8203;に&#8203;上&#8203;か&#8203;ら&#8203;出&#8203;力&#8203;す&#8203;る&#8203;こ&#8203;と</p>
</li>
<li>
<p>Nan&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;な&#8203;い&#8203;よ&#8203;う&#8203;に&#8203;す&#8203;る&#8203;こ&#8203;と</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_特記事項及び注意点">特記事項及び注意点</h5>
<div class="paragraph">
<p>　&#8203;以&#8203;下&#8203;で&#8203;は、&#8203;各&#8203;条&#8203;件&#8203;を&#8203;踏&#8203;ま&#8203;え&#8203;た&#8203;特&#8203;記&#8203;事&#8203;項&#8203;及&#8203;び&#8203;注&#8203;意&#8203;点&#8203;に&#8203;つ&#8203;き&#8203;ま&#8203;し&#8203;て、&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;*&#8203;各&#8203;銘&#8203;柄&#8203;は&#8203;1&#8203;株&#8203;単&#8203;位&#8203;で&#8203;購&#8203;入&#8203;可&#8203;能&#8203;* &#8203;と&#8203;し&#8203;ま&#8203;す。</p>
<div class="ulist">
<ul>
<li>
<p>東&#8203;京&#8203;証&#8203;券&#8203;取&#8203;引&#8203;所&#8203;を&#8203;は&#8203;じ&#8203;め&#8203;と&#8203;す&#8203;る&#8203;全&#8203;国&#8203;の&#8203;証&#8203;券&#8203;取&#8203;引&#8203;所&#8203;で&#8203;実&#8203;際&#8203;に&#8203;売&#8203;買&#8203;す&#8203;る&#8203;際&#8203;は、&#8203;売&#8203;買&#8203;単&#8203;位&#8203;は&#8203;100&#8203;株&#8203;単&#8203;位&#8203;に&#8203;統&#8203;一&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;組&#8203;成&#8203;を&#8203;可&#8203;能&#8203;な&#8203;限&#8203;り&#8203;幅&#8203;広&#8203;く&#8203;行っ&#8203;て&#8203;い&#8203;た&#8203;く&#8203;こ&#8203;と&#8203;を&#8203;考&#8203;慮&#8203;し&#8203;て、&#8203;売&#8203;買&#8203;単&#8203;位&#8203;を&#8203;1&#8203;株&#8203;単&#8203;位&#8203;と&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</li>
</ul>
</div>
</li>
<li>
<p>ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;組&#8203;入&#8203;れ&#8203;で&#8203;き&#8203;る&#8203;銘&#8203;柄&#8203;の&#8203;条&#8203;件&#8203;に&#8203;合&#8203;致&#8203;し&#8203;な&#8203;い&#8203;銘&#8203;柄&#8203;が&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;予&#8203;測&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;場&#8203;合&#8203;は、&#8203;評&#8203;価&#8203;の&#8203;際&#8203;に&#8203;該&#8203;当&#8203;の&#8203;レ&#8203;コー&#8203;ド&#8203;は&#8203;評&#8203;価&#8203;対&#8203;象&#8203;外&#8203;と&#8203;し&#8203;て&#8203;無&#8203;視&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;（エ&#8203;ラー&#8203;と&#8203;は&#8203;な&#8203;り&#8203;ま&#8203;せ&#8203;ん。）</p>
</li>
<li>
<p>モ&#8203;デ&#8203;ル&#8203;の&#8203;予&#8203;測&#8203;に&#8203;お&#8203;い&#8203;て&#8203;date&#8203;列&#8203;が&#8203;週&#8203;初&#8203;営&#8203;業&#8203;日&#8203;以&#8203;外&#8203;の&#8203;日&#8203;付&#8203;の&#8203;レ&#8203;コー&#8203;ド&#8203;は、&#8203;評&#8203;価&#8203;対&#8203;象&#8203;外&#8203;と&#8203;し&#8203;て&#8203;無&#8203;視&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</li>
<li>
<p>Budget&#8203;列&#8203;が&#8203;1&#8203;未&#8203;満&#8203;の&#8203;レ&#8203;コー&#8203;ド&#8203;は&#8203;評&#8203;価&#8203;対&#8203;象&#8203;外&#8203;と&#8203;し&#8203;て&#8203;無&#8203;視&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</li>
<li>
<p>週&#8203;初&#8203;営&#8203;業&#8203;日&#8203;に&#8203;値&#8203;段&#8203;が&#8203;付&#8203;か&#8203;な&#8203;かっ&#8203;た&#8203;銘&#8203;柄&#8203;*&#8203;の&#8203;レ&#8203;コー&#8203;ド&#8203;は&#8203;評&#8203;価&#8203;対&#8203;象&#8203;外&#8203;と&#8203;し&#8203;て&#8203;無&#8203;視&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;<br>
※ &#8203;な&#8203;お、&#8203;週&#8203;末&#8203;営&#8203;業&#8203;日&#8203;に&#8203;値&#8203;段&#8203;が&#8203;付&#8203;か&#8203;な&#8203;かっ&#8203;た&#8203;場&#8203;合&#8203;に&#8203;は、&#8203;そ&#8203;の&#8203;日&#8203;よ&#8203;り&#8203;前&#8203;の&#8203;日&#8203;で&#8203;終&#8203;値&#8203;が&#8203;存&#8203;在&#8203;す&#8203;る&#8203;日&#8203;の&#8203;終&#8203;値&#8203;を&#8203;用&#8203;い&#8203;ま&#8203;す。</p>
</li>
<li>
<p>購&#8203;入&#8203;金&#8203;額&#8203;が&#8203;50&#8203;万&#8203;円&#8203;に&#8203;到&#8203;達&#8203;し&#8203;て&#8203;い&#8203;な&#8203;かっ&#8203;た&#8203;場&#8203;合&#8203;は、&#8203;選&#8203;択&#8203;さ&#8203;れ&#8203;た&#8203;銘&#8203;柄&#8203;を&#8203;入&#8203;力&#8203;順&#8203;（テー&#8203;ブ&#8203;ル&#8203;デー&#8203;タ&#8203;の&#8203;並&#8203;び&#8203;順）&#8203;に&#8203;1&#8203;株&#8203;ず&#8203;つ&#8203;50&#8203;万&#8203;円&#8203;以&#8203;上&#8203;に&#8203;な&#8203;る&#8203;ま&#8203;で&#8203;買&#8203;い&#8203;足&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;（評&#8203;価&#8203;時&#8203;の&#8203;具&#8203;体&#8203;的&#8203;な&#8203;処&#8203;理&#8203;は&#8203;<a href="#anchor-3.3.5">3.3.5. &#8203;評&#8203;価&#8203;方&#8203;法&#8203;</a>&#8203;を&#8203;参&#8203;照&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。）</p>
</li>
<li>
<p>購&#8203;入&#8203;金&#8203;額&#8203;が&#8203;100&#8203;万&#8203;円&#8203;を&#8203;超&#8203;え&#8203;る&#8203;場&#8203;合&#8203;は、&#8203;100&#8203;万&#8203;円&#8203;以&#8203;内&#8203;の&#8203;範&#8203;囲&#8203;で&#8203;購&#8203;入&#8203;可&#8203;能&#8203;な&#8203;株&#8203;数&#8203;に&#8203;調&#8203;整&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;（評&#8203;価&#8203;時&#8203;の&#8203;具&#8203;体&#8203;的&#8203;な&#8203;処&#8203;理&#8203;は&#8203;<a href="#anchor-3.3.5">3.3.5. &#8203;評&#8203;価&#8203;方&#8203;法&#8203;</a>&#8203;を&#8203;参&#8203;照&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。）</p>
</li>
<li>
<p><strong>&#8203;最&#8203;終&#8203;的&#8203;に&#8203;購&#8203;入&#8203;さ&#8203;れ&#8203;た&#8203;銘&#8203;柄&#8203;数&#8203;が&#8203;5&#8203;銘&#8203;柄&#8203;未&#8203;満&#8203;の&#8203;場&#8203;合&#8203;若&#8203;し&#8203;く&#8203;は&#8203;購&#8203;入&#8203;し&#8203;た&#8203;金&#8203;額&#8203;が&#8203;50&#8203;万&#8203;円&#8203;未&#8203;満&#8203;の&#8203;場&#8203;合&#8203;は、&#8203;エ&#8203;ラー&#8203;と&#8203;な&#8203;り&#8203;失&#8203;格&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;</strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="anchor-3.3.5">3.3.4. 評価方法</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;予&#8203;測&#8203;し&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;で&#8203;得&#8203;ら&#8203;れ&#8203;る&#8203;利&#8203;益&#8203;の&#8203;総&#8203;合&#8203;計&#8203;に&#8203;よ&#8203;る&#8203;定&#8203;量&#8203;評&#8203;価&#8203;方&#8203;法&#8203;を&#8203;採&#8203;用&#8203;し&#8203;ま&#8203;す。&#8203;<br>
　&#8203;ま&#8203;ず、&#8203;各&#8203;週&#8203;に&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;か&#8203;ら&#8203;得&#8203;ら&#8203;れ&#8203;る&#8203;利&#8203;益&#8203;を&#8203;以&#8203;下&#8203;の&#8203;算&#8203;出&#8203;式&#8203;を&#8203;用&#8203;い&#8203;て&#8203;計&#8203;算&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/math-sample1.svg" alt="math sample1" width="729" height="32">
</div>
</div>
<div class="paragraph">
<p>保&#8203;有&#8203;し&#8203;て&#8203;い&#8203;る&#8203;株&#8203;式&#8203;の&#8203;合&#8203;計&#8203;評&#8203;価&#8203;額&#8203; = &#8203;保&#8203;有&#8203;し&#8203;て&#8203;い&#8203;る&#8203;株&#8203;式&#8203;の&#8203;そ&#8203;の&#8203;週&#8203;の&#8203;週&#8203;末&#8203;営&#8203;業&#8203;日&#8203;の&#8203;終&#8203;値&#8203; × &#8203;保&#8203;持&#8203;す&#8203;る&#8203;株&#8203;数&#8203;<br>
保&#8203;持&#8203;現&#8203;金&#8203; = &#8203;そ&#8203;の&#8203;週&#8203;の&#8203;週&#8203;初&#8203;営&#8203;業&#8203;日&#8203;に&#8203;株&#8203;式&#8203;の&#8203;購&#8203;入&#8203;に&#8203;利&#8203;用&#8203;せ&#8203;ず&#8203;に&#8203;手&#8203;元&#8203;に&#8203;残っ&#8203;た&#8203;現&#8203;金</p>
</div>
</div>
</div>
<div class="paragraph">
<p>　&#8203;そ&#8203;の&#8203;上&#8203;で、&#8203;各&#8203;週&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;を&#8203;合&#8203;計&#8203;し、&#8203;最&#8203;終&#8203;ス&#8203;コ&#8203;ア&#8203;と&#8203;し&#8203;て&#8203;評&#8203;価&#8203;し、&#8203;<strong>&#8203;利&#8203;益&#8203;の&#8203;高&#8203;い&#8203;順&#8203;に&#8203;</strong>&#8203;順&#8203;位&#8203;付&#8203;け&#8203;し&#8203;ま&#8203;す。&#8203;(&#8203;た&#8203;だ&#8203;し、&#8203;利&#8203;益&#8203;が&#8203;全&#8203;く&#8203;同&#8203;じ&#8203;で&#8203;あっ&#8203;た&#8203;場&#8203;合&#8203;に&#8203;は、&#8203;提&#8203;出&#8203;が&#8203;早&#8203;かっ&#8203;た&#8203;方&#8203;を&#8203;上&#8203;位&#8203;と&#8203;し&#8203;ま&#8203;す。&#8203;)</p>
</div>
<div class="sect4">
<h5 id="_バックテスト関数backtest_pyの挙動">バックテスト関数（backtest.py）の挙動</h5>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;お&#8203;け&#8203;る&#8203;評&#8203;価&#8203;で&#8203;は、&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;レ&#8203;ポ&#8203;ジ&#8203;ト&#8203;リ&#8203;に&#8203;配&#8203;置&#8203;し&#8203;て&#8203;あ&#8203;る&#8203;独&#8203;自&#8203;の&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203; <code>backtest.py</code> &#8203;を&#8203;用&#8203;い&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;<br>
　&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;よ&#8203;り&#8203;予&#8203;測&#8203;さ&#8203;れ&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;具&#8203;体&#8203;的&#8203;な&#8203;処&#8203;理&#8203;の&#8203;概&#8203;要&#8203;は&#8203;以&#8203;下&#8203;の&#8203;と&#8203;お&#8203;り&#8203;で&#8203;す。&#8203;な&#8203;お、&#8203;詳&#8203;細&#8203;な&#8203;挙&#8203;動&#8203;に&#8203;つ&#8203;き&#8203;ま&#8203;し&#8203;て&#8203;は、&#8203;実&#8203;際&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>【前&#8203;提&#8203;条&#8203;件&#8203;チェッ&#8203;ク&#8203;等】&#8203;<br>
1. &#8203;予&#8203;測&#8203;さ&#8203;れ&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;フォー&#8203;マッ&#8203;ト&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;以&#8203;下&#8203;の&#8203;チェッ&#8203;ク&#8203;を&#8203;行&#8203;う&#8203;(※)。&#8203;<br>
　　- date&#8203;列&#8203;（ヘッ&#8203;ダー）&#8203;が&#8203;存&#8203;在&#8203;す&#8203;る&#8203;か&#8203;<br>
　　- Local Code&#8203;列&#8203;（ヘッ&#8203;ダー）&#8203;が&#8203;存&#8203;在&#8203;す&#8203;る&#8203;か&#8203;<br>
　　- budget&#8203;列&#8203;（ヘッ&#8203;ダー）&#8203;が&#8203;存&#8203;在&#8203;す&#8203;る&#8203;か&#8203;<br>
　　- &#8203;デー&#8203;タ&#8203;に&#8203;NaN&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;か&#8203;<br>
2. &#8203;予&#8203;測&#8203;さ&#8203;れ&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;Local Code&#8203;列&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;「ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;組&#8203;入&#8203;れ&#8203;で&#8203;き&#8203;る&#8203;条&#8203;件」&#8203;に&#8203;合&#8203;致&#8203;す&#8203;る&#8203;レ&#8203;コー&#8203;ド&#8203;に&#8203;絞&#8203;り&#8203;込&#8203;む。&#8203;<br>
3. &#8203;予&#8203;測&#8203;さ&#8203;れ&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;date&#8203;列&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;月&#8203;曜&#8203;日&#8203;の&#8203;み&#8203;の&#8203;レ&#8203;コー&#8203;ド&#8203;に&#8203;絞&#8203;り&#8203;込&#8203;む。&#8203;<br>
4. &#8203;予&#8203;測&#8203;さ&#8203;れ&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;budget&#8203;列&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;1&#8203;円&#8203;以&#8203;上&#8203;の&#8203;レ&#8203;コー&#8203;ド&#8203;に&#8203;絞&#8203;り&#8203;込&#8203;む。</p>
</div>
<div class="paragraph">
<p>【購&#8203;入&#8203;処&#8203;理】&#8203;<br>
5. 2〜&#8203;4&#8203;で&#8203;絞&#8203;り&#8203;込&#8203;ん&#8203;だ&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;５&#8203;銘&#8203;柄&#8203;以&#8203;上&#8203;選&#8203;択&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;か&#8203;チェッ&#8203;ク&#8203;を&#8203;行&#8203;う&#8203;(※)。&#8203;<br>
6. &#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;Local Code&#8203;列&#8203;の&#8203;上&#8203;か&#8203;ら&#8203;順&#8203;に、&#8203;原&#8203;資&#8203;金&#8203;100&#8203;万&#8203;円&#8203;を&#8203;上&#8203;限&#8203;と&#8203;し&#8203;て、&#8203;budget&#8203;列&#8203;で&#8203;指&#8203;定&#8203;さ&#8203;れ&#8203;た&#8203;金&#8203;額&#8203;で&#8203;購&#8203;入&#8203;処&#8203;理&#8203;を&#8203;行&#8203;う。&#8203;（な&#8203;お、&#8203;各&#8203;ラ&#8203;ウ&#8203;ン&#8203;ド&#8203;の&#8203;週&#8203;初&#8203;営&#8203;業&#8203;日&#8203;の&#8203;始&#8203;値&#8203;で&#8203;購&#8203;入&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;指&#8203;定&#8203;さ&#8203;れ&#8203;た&#8203;金&#8203;額&#8203;と&#8203;実&#8203;際&#8203;の&#8203;購&#8203;入&#8203;金&#8203;額&#8203;は&#8203;異&#8203;な&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;想&#8203;定&#8203;さ&#8203;れ、&#8203;予&#8203;算&#8203;と&#8203;実&#8203;際&#8203;の&#8203;購&#8203;入&#8203;金&#8203;額&#8203;の&#8203;差&#8203;額&#8203;は&#8203;残&#8203;額&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。）&#8203;<br>
7. &#8203;予&#8203;測&#8203;さ&#8203;れ&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;全&#8203;て&#8203;の&#8203;レ&#8203;コー&#8203;ド&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;6&#8203;の&#8203;処&#8203;理&#8203;を&#8203;行&#8203;い、&#8203;実&#8203;際&#8203;の&#8203;購&#8203;入&#8203;金&#8203;額&#8203;が&#8203;50&#8203;万&#8203;円&#8203;未&#8203;満&#8203;の&#8203;場&#8203;合&#8203;は、&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;Local Code&#8203;列&#8203;の&#8203;上&#8203;か&#8203;ら&#8203;順&#8203;に、&#8203;更&#8203;に&#8203;1&#8203;株&#8203;ず&#8203;つ&#8203;50&#8203;万&#8203;円&#8203;以&#8203;上&#8203;と&#8203;な&#8203;る&#8203;ま&#8203;で&#8203;購&#8203;入&#8203;処&#8203;理&#8203;を&#8203;繰&#8203;り&#8203;返&#8203;す。&#8203;<br>
8. &#8203;購&#8203;入&#8203;処&#8203;理&#8203;後&#8203;に&#8203;残っ&#8203;た&#8203;原&#8203;資&#8203;金&#8203;は&#8203;現&#8203;金&#8203;保&#8203;有&#8203;と&#8203;す&#8203;る。&#8203;<br>
9. 6〜&#8203;8 &#8203;ま&#8203;で&#8203;の&#8203;購&#8203;入&#8203;処&#8203;理&#8203;を&#8203;終&#8203;え&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;実&#8203;際&#8203;に&#8203;購&#8203;入&#8203;し&#8203;た&#8203;銘&#8203;柄&#8203;数&#8203;が&#8203;５&#8203;銘&#8203;柄&#8203;以&#8203;上&#8203;か&#8203;つ&#8203;実&#8203;際&#8203;の&#8203;購&#8203;入&#8203;金&#8203;額&#8203;が&#8203;50&#8203;万&#8203;円&#8203;以&#8203;上&#8203;か&#8203;チェッ&#8203;ク&#8203;を&#8203;行&#8203;う&#8203;(※)。</p>
</div>
<div class="paragraph">
<p>【売&#8203;却&#8203;処&#8203;理・&#8203;評&#8203;価】&#8203;<br>
10. &#8203;購&#8203;入&#8203;し&#8203;た&#8203;各&#8203;銘&#8203;柄&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;各&#8203;ラ&#8203;ウ&#8203;ン&#8203;ド&#8203;の&#8203;週&#8203;末&#8203;営&#8203;業&#8203;日&#8203;の&#8203;終&#8203;値&#8203;で&#8203;売&#8203;却&#8203;し&#8203;た&#8203;こ&#8203;と&#8203;と&#8203;し、&#8203;週&#8203;初&#8203;営&#8203;業&#8203;日&#8203;か&#8203;ら&#8203;の&#8203;始&#8203;値&#8203;か&#8203;ら&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;（保&#8203;有&#8203;し&#8203;て&#8203;い&#8203;る&#8203;株&#8203;式&#8203;の&#8203;合&#8203;計&#8203;評&#8203;価&#8203;額&#8203; ＋ &#8203;保&#8203;持&#8203;現&#8203;金&#8203; - &#8203;購&#8203;入&#8203;原&#8203;資&#8203;金）&#8203;を&#8203;算&#8203;出&#8203;す&#8203;る。&#8203;<br>
　<strong>&#8203;な&#8203;お、&#8203;(※)&#8203;と&#8203;記&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;チェッ&#8203;ク&#8203;項&#8203;目&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;チェッ&#8203;ク&#8203;で&#8203;エ&#8203;ラー&#8203;と&#8203;なっ&#8203;た&#8203;場&#8203;合&#8203;は、&#8203;評&#8203;価&#8203;算&#8203;出&#8203;さ&#8203;れ&#8203;ず&#8203;失&#8203;格&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;ご&#8203;注&#8203;意&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;以&#8203;下&#8203;に、&#8203;Public&#8203;期&#8203;間&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;具&#8203;体&#8203;例&#8203;を&#8203;用&#8203;い&#8203;て&#8203;処&#8203;理&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;例&#8203;示&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。&#8203;</strong></p>
</div>
<div class="paragraph">
<p>以&#8203;下&#8203;に、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Public&#8203;期&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る&#8203;評&#8203;価&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;具&#8203;体&#8203;例&#8203;を&#8203;用&#8203;い&#8203;て&#8203;処&#8203;理&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;例&#8203;示&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/public_csv_sample.png" alt="public_csv_sample">
</div>
</div>
<div class="paragraph">
<p>　&#8203;上&#8203;表&#8203;の&#8203;左&#8203;側&#8203;が&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;予&#8203;測&#8203;し&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;出&#8203;力&#8203;例&#8203;で&#8203;す。&#8203;上&#8203;表&#8203;の&#8203;右&#8203;側&#8203;は&#8203;説&#8203;明&#8203;の&#8203;た&#8203;め&#8203;に&#8203;付&#8203;け&#8203;加&#8203;え&#8203;た&#8203;も&#8203;の&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>・&#8203;前&#8203;提&#8203;条&#8203;件&#8203;チェッ&#8203;ク&#8203;等&#8203;の&#8203;1〜&#8203;4&#8203;に&#8203;従&#8203;い、&#8203;条&#8203;件&#8203;の&#8203;確&#8203;認&#8203;と&#8203;銘&#8203;柄&#8203;等&#8203;の&#8203;絞&#8203;り&#8203;込&#8203;み&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。&#8203;<br>
・&#8203;購&#8203;入&#8203;処&#8203;理&#8203;の&#8203;5&#8203;で&#8203;５&#8203;銘&#8203;柄&#8203;以&#8203;上&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;し、&#8203;6&#8203;の&#8203;処&#8203;理&#8203;に&#8203;よ&#8203;り&#8203;購&#8203;入&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。&#8203;<br>
・&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;全&#8203;て&#8203;の&#8203;レ&#8203;コー&#8203;ド&#8203;列&#8203;を&#8203;処&#8203;理&#8203;し&#8203;た&#8203;結&#8203;果、&#8203;実&#8203;際&#8203;の&#8203;購&#8203;入&#8203;金&#8203;額&#8203;の&#8203;総&#8203;額&#8203;は&#8203;474,860&#8203;円&#8203;/5&#8203;銘&#8203;柄&#8203;だっ&#8203;た&#8203;（9983&#8203;の&#8203;始&#8203;値&#8203;が&#8203;指&#8203;定&#8203;し&#8203;て&#8203;budget&#8203;を&#8203;超&#8203;過&#8203;し&#8203;購&#8203;入&#8203;で&#8203;き&#8203;て&#8203;い&#8203;な&#8203;い）&#8203;た&#8203;め、&#8203;7&#8203;の&#8203;処&#8203;理&#8203;に&#8203;よ&#8203;り&#8203;再&#8203;度&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;上&#8203;か&#8203;ら&#8203;１&#8203;株&#8203;ず&#8203;つ&#8203;追&#8203;加&#8203;で&#8203;購&#8203;入&#8203;す&#8203;る&#8203;処&#8203;理&#8203;が&#8203;行&#8203;わ&#8203;れ&#8203;ま&#8203;す。&#8203;具&#8203;体&#8203;的&#8203;に&#8203;は&#8203;7203&#8203;を&#8203;１&#8203;株&#8203;購&#8203;入&#8203;→50&#8203;万&#8203;円&#8203;check→&#8203;未&#8203;達&#8203;→9984&#8203;を&#8203;１&#8203;株&#8203;購&#8203;入&#8203;→50&#8203;万&#8203;円&#8203;check→&#8203;未&#8203;達&#8203;→9983&#8203;を&#8203;1&#8203;株&#8203;購&#8203;入&#8203;→50&#8203;万&#8203;円&#8203;基&#8203;準&#8203;達&#8203;成&#8203;（実&#8203;際&#8203;の&#8203;購&#8203;入&#8203;金&#8203;額&#8203;588,960&#8203;円&#8203;/６&#8203;銘&#8203;柄、&#8203;保&#8203;持&#8203;現&#8203;金&#8203;411,040&#8203;円）&#8203;<br>
・&#8203;6〜&#8203;８&#8203;ま&#8203;で&#8203;の&#8203;処&#8203;理&#8203;を&#8203;終&#8203;え、&#8203;９&#8203;で&#8203;実&#8203;際&#8203;に&#8203;購&#8203;入&#8203;し&#8203;た&#8203;銘&#8203;柄&#8203;数&#8203;が&#8203;５&#8203;銘&#8203;柄&#8203;以&#8203;上&#8203;及&#8203;び&#8203;実&#8203;際&#8203;の&#8203;購&#8203;入&#8203;金&#8203;額&#8203;が&#8203;50&#8203;万&#8203;円&#8203;以&#8203;上&#8203;か&#8203;を&#8203;チェッ&#8203;ク&#8203;し、&#8203;購&#8203;入&#8203;処&#8203;理&#8203;は&#8203;完&#8203;了&#8203;し&#8203;ま&#8203;す。&#8203;<br>
・&#8203;最&#8203;後&#8203;に&#8203;購&#8203;入&#8203;し&#8203;た&#8203;銘&#8203;柄&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;そ&#8203;の&#8203;ラ&#8203;ウ&#8203;ン&#8203;ド&#8203;の&#8203;週&#8203;末&#8203;営&#8203;業&#8203;日&#8203;の&#8203;終&#8203;値&#8203;で&#8203;評&#8203;価&#8203;し、&#8203;保&#8203;持&#8203;現&#8203;金&#8203;と&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;そ&#8203;の&#8203;ラ&#8203;ウ&#8203;ン&#8203;ド&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;と&#8203;し&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_リーダーボード_2">3.3.5. リーダーボード</h4>
<div class="paragraph">
<p>　&#8203;一&#8203;般&#8203;的&#8203;に、&#8203;デー&#8203;タ&#8203;分&#8203;析&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;お&#8203;け&#8203;る&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;（Leaderboard）&#8203;と&#8203;は、&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;参&#8203;加&#8203;者&#8203;の&#8203;投&#8203;稿&#8203;内&#8203;容&#8203;に&#8203;対&#8203;す&#8203;る&#8203;評&#8203;価&#8203;（ス&#8203;コ&#8203;ア、&#8203;実&#8203;行&#8203;時&#8203;間&#8203;等）&#8203;を&#8203;ラ&#8203;ン&#8203;キ&#8203;ン&#8203;グ&#8203;形&#8203;式&#8203;で&#8203;並&#8203;べ&#8203;る&#8203;表&#8203;を&#8203;意&#8203;味&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;提&#8203;供&#8203;す&#8203;る&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;は、&#8203;パ&#8203;ブ&#8203;リッ&#8203;ク&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;（以&#8203;下、&#8203;Public LB）&#8203;と&#8203;プ&#8203;ラ&#8203;イ&#8203;ベー&#8203;ト&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;（以&#8203;下、&#8203;Private LB）&#8203;の&#8203;2&#8203;つ&#8203;で&#8203;構&#8203;成&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;以&#8203;下&#8203;で&#8203;は、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;の&#8203;仕&#8203;様&#8203;等&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;ま&#8203;ず、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Public LB&#8203;は、&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;開&#8203;催&#8203;日&#8203;よ&#8203;り&#8203;過&#8203;去&#8203;の&#8203;期&#8203;間&#8203;を&#8203;対&#8203;象&#8203;と&#8203;し&#8203;て&#8203;評&#8203;価&#8203;を&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。&#8203;具&#8203;体&#8203;的&#8203;に&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Public LB&#8203;で&#8203;は、&#8203;2021&#8203;年&#8203;2&#8203;月&#8203;1&#8203;日&#8203;（月）&#8203;に&#8203;始&#8203;値&#8203;で&#8203;購&#8203;入&#8203;し、&#8203;2021&#8203;年&#8203;2&#8203;月&#8203;5&#8203;日&#8203;（金）&#8203;の&#8203;終&#8203;値&#8203;で&#8203;売&#8203;却&#8203;す&#8203;る&#8203;と&#8203;し&#8203;た&#8203;際&#8203;に、&#8203;で&#8203;き&#8203;る&#8203;限&#8203;り&#8203;利&#8203;益&#8203;を&#8203;得&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;予&#8203;測&#8203;し&#8203;ま&#8203;す。&#8203;よっ&#8203;て&#8203;Public LB&#8203;で&#8203;は、&#8203;予&#8203;測&#8203;さ&#8203;れ&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;で&#8203;利&#8203;益&#8203;の&#8203;高&#8203;い&#8203;順&#8203;に&#8203;順&#8203;位&#8203;付&#8203;け&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;な&#8203;お、&#8203;Public LB&#8203;の&#8203;評&#8203;価&#8203;期&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る&#8203;各&#8203;銘&#8203;柄&#8203;の&#8203;株&#8203;価&#8203;は、&#8203;各&#8203;Web&#8203;サ&#8203;イ&#8203;ト&#8203;等&#8203;で&#8203;取&#8203;得&#8203;可&#8203;能&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Public LB&#8203;で&#8203;は&#8203;チー&#8203;ティ&#8203;ン&#8203;グ&#8203;が&#8203;容&#8203;易&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Public LB&#8203;は、&#8203;他&#8203;の&#8203;一&#8203;般&#8203;的&#8203;な&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;お&#8203;け&#8203;る&#8203;Public LB&#8203;と&#8203;は&#8203;異&#8203;な&#8203;り、&#8203;ス&#8203;コ&#8203;ア&#8203;を&#8203;競&#8203;う&#8203;と&#8203;い&#8203;う&#8203;よ&#8203;り&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;正&#8203;常&#8203;に&#8203;投&#8203;稿&#8203;で&#8203;き&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;環&#8203;境&#8203;と&#8203;し&#8203;て&#8203;位&#8203;置&#8203;付&#8203;け&#8203;と&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;ご&#8203;留&#8203;意&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;以&#8203;下&#8203;に、&#8203;Public LB&#8203;の&#8203;評&#8203;価&#8203;例&#8203;と&#8203;し&#8203;て&#8203;図&#8203;を&#8203;示&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/public_evaluation.png" alt="public_evaluation">
</div>
</div>
<div class="paragraph">
<p>　&#8203;次&#8203;に、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Private LB&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;Private LB&#8203;で&#8203;は、&#8203;リー&#8203;ク&#8203;を&#8203;可&#8203;能&#8203;な&#8203;限&#8203;り&#8203;防&#8203;止&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;モ&#8203;デ&#8203;ル&#8203;提&#8203;出&#8203;締&#8203;切&#8203;日&#8203;よ&#8203;り&#8203;も&#8203;将&#8203;来&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;Private LB&#8203;を&#8203;出&#8203;力&#8203;し&#8203;ま&#8203;す。&#8203;<br>
　Private LB&#8203;の&#8203;各&#8203;ラ&#8203;ウ&#8203;ン&#8203;ド&#8203;の&#8203;具&#8203;体&#8203;的&#8203;な&#8203;評&#8203;価&#8203;期&#8203;間&#8203;は&#8203;以&#8203;下&#8203;の&#8203;と&#8203;お&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>2021&#8203;年&#8203;5&#8203;月&#8203;10&#8203;日&#8203;（月）&#8203;の&#8203;始&#8203;値&#8203;で&#8203;購&#8203;入&#8203;し、&#8203;2021&#8203;年&#8203;5&#8203;月&#8203;14&#8203;日&#8203;（金）&#8203;の&#8203;終&#8203;値&#8203;で&#8203;売&#8203;却&#8203;と&#8203;し&#8203;た&#8203;際&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;（ラ&#8203;ウ&#8203;ン&#8203;ド&#8203;1）</p>
</li>
<li>
<p>2021&#8203;年&#8203;5&#8203;月&#8203;17&#8203;日&#8203;（月）&#8203;の&#8203;始&#8203;値&#8203;で&#8203;購&#8203;入&#8203;し、&#8203;2021&#8203;年&#8203;5&#8203;月&#8203;21&#8203;日&#8203;（金）&#8203;の&#8203;終&#8203;値&#8203;で&#8203;売&#8203;却&#8203;と&#8203;し&#8203;た&#8203;際&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;（ラ&#8203;ウ&#8203;ン&#8203;ド&#8203;2）</p>
</li>
<li>
<p>2021&#8203;年&#8203;5&#8203;月&#8203;24&#8203;日&#8203;（月）&#8203;の&#8203;始&#8203;値&#8203;で&#8203;購&#8203;入&#8203;し、&#8203;2021&#8203;年&#8203;5&#8203;月&#8203;28&#8203;日&#8203;（金）&#8203;の&#8203;終&#8203;値&#8203;で&#8203;売&#8203;却&#8203;と&#8203;し&#8203;た&#8203;際&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;（ラ&#8203;ウ&#8203;ン&#8203;ド&#8203;3）</p>
</li>
<li>
<p>2021&#8203;年&#8203;5&#8203;月&#8203;31&#8203;日&#8203;（月）&#8203;の&#8203;始&#8203;値&#8203;で&#8203;購&#8203;入&#8203;し、&#8203;2021&#8203;年&#8203;6&#8203;月&#8203; 4&#8203;日&#8203;（金）&#8203;の&#8203;終&#8203;値&#8203;で&#8203;売&#8203;却&#8203;と&#8203;し&#8203;た&#8203;際&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;（ラ&#8203;ウ&#8203;ン&#8203;ド&#8203;4）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>&#8203;上&#8203;記&#8203;期&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る&#8203;4&#8203;ラ&#8203;ウ&#8203;ン&#8203;ド&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;を&#8203;合&#8203;計&#8203;し、&#8203;総&#8203;利&#8203;益&#8203;の&#8203;高&#8203;い&#8203;順&#8203;に&#8203;順&#8203;位&#8203;付&#8203;け&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;</strong></p>
</div>
<div class="paragraph">
<p>以&#8203;下&#8203;に、&#8203;Private LB&#8203;の&#8203;評&#8203;価&#8203;例&#8203;と&#8203;し&#8203;て&#8203;図&#8203;を&#8203;示&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/private_evaluation.png" alt="private_evaluation">
</div>
</div>
<div class="paragraph">
<p>以&#8203;上&#8203;を&#8203;踏&#8203;ま&#8203;え、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;お&#8203;け&#8203;る&#8203;Public LB&#8203;と&#8203;Private LB&#8203;の&#8203;概&#8203;要&#8203;を、&#8203;表&#8203;に&#8203;ま&#8203;と&#8203;め&#8203;ま&#8203;す。</p>
</div>
<div class="sect4">
<h5 id="_本コンペティションにおけるリーダーボードの仕様">本コンペティションにおけるリーダーボードの仕様</h5>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;項&#8203;目&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>Public LB</strong></th>
<th class="tableblock halign-left valign-top"><strong>Private LB</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用&#8203;途</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モ&#8203;デ&#8203;ル&#8203;が&#8203;正&#8203;常&#8203;に&#8203;投&#8203;稿&#8203;で&#8203;き&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;環&#8203;境</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;最&#8203;終&#8203;的&#8203;な&#8203;ラ&#8203;ン&#8203;キ&#8203;ン&#8203;グ&#8203;を&#8203;表&#8203;示</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;測&#8203;対&#8203;象&#8203;の&#8203;期&#8203;間</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021&#8203;年&#8203;2&#8203;月&#8203;1&#8203;日&#8203;（月）〜&#8203;2021&#8203;年&#8203;2&#8203;月&#8203;5&#8203;日&#8203;（金）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021&#8203;年&#8203;5&#8203;月&#8203;10&#8203;日&#8203;（月）〜&#8203;2021&#8203;年&#8203;6&#8203;月&#8203;4&#8203;日&#8203;（金）&#8203;ま&#8203;で&#8203;の&#8203;4&#8203;ラ&#8203;ウ&#8203;ン&#8203;ド</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;測&#8203;対&#8203;象&#8203;の&#8203;条&#8203;件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3.1&#8203;及&#8203;び&#8203;3.3.2&#8203;項&#8203;に&#8203;示&#8203;す&#8203;と&#8203;お&#8203;り&#8203;　</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">同&#8203;左</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;測&#8203;内&#8203;容</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;測&#8203;対&#8203;象&#8203;期&#8203;間&#8203;の&#8203;週&#8203;初&#8203;営&#8203;業&#8203;日&#8203;に&#8203;購&#8203;入&#8203;し、&#8203;当&#8203;該&#8203;期&#8203;間&#8203;の&#8203;週&#8203;末&#8203;営&#8203;業&#8203;日&#8203;に&#8203;売&#8203;却&#8203;し&#8203;た&#8203;際&#8203;に&#8203;で&#8203;き&#8203;る&#8203;限&#8203;り&#8203;利&#8203;益&#8203;を&#8203;得&#8203;る&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各&#8203;週&#8203;の&#8203;週&#8203;初&#8203;営&#8203;業&#8203;日&#8203;に&#8203;購&#8203;入&#8203;し、&#8203;そ&#8203;の&#8203;週&#8203;の&#8203;週&#8203;末&#8203;営&#8203;業&#8203;日&#8203;に&#8203;売&#8203;却&#8203;し&#8203;た&#8203;際&#8203;に&#8203;で&#8203;き&#8203;る&#8203;限&#8203;り&#8203;利&#8203;益&#8203;を&#8203;得&#8203;る&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">評&#8203;価&#8203;方&#8203;法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3.3&#8203;項&#8203;に&#8203;示&#8203;す&#8203;評&#8203;価&#8203;方&#8203;法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3.3&#8203;項&#8203;に&#8203;示&#8203;す&#8203;評&#8203;価&#8203;方&#8203;法&#8203;を、&#8203;4&#8203;ラ&#8203;ウ&#8203;ン&#8203;ド&#8203;行&#8203;い&#8203;そ&#8203;の&#8203;合&#8203;計</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="anchor-3.4">3.4. データセットの説明</h3>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;る&#8203;各&#8203;デー&#8203;タ&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。&#8203;提&#8203;供&#8203;さ&#8203;れ&#8203;る&#8203;デー&#8203;タ&#8203;は&#8203;以&#8203;下&#8203;の&#8203;13&#8203;種&#8203;類&#8203;で&#8203;す。&#8203;<br>
<a href="https://signate.jp/competitions/443/data">SIGNATEのコンペティションサイト</a>&#8203;よ&#8203;り&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;デー&#8203;タ&#8203;概&#8203;要&#8203;</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;ファ&#8203;イ&#8203;ル&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各&#8203;銘&#8203;柄&#8203;の&#8203;情&#8203;報&#8203;が&#8203;記&#8203;録&#8203;さ&#8203;れ&#8203;た&#8203;デー&#8203;タ&#8203; ※1 ※2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_price</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各&#8203;銘&#8203;柄&#8203;の&#8203;株&#8203;価&#8203;情&#8203;報&#8203;（始&#8203;値・&#8203;高&#8203;値・&#8203;安&#8203;値・&#8203;終&#8203;値&#8203;等）&#8203;が&#8203;記&#8203;録&#8203;さ&#8203;れ&#8203;た&#8203;デー&#8203;タ&#8203; ※1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_fin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各&#8203;銘&#8203;柄&#8203;の&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;（決&#8203;算&#8203;数&#8203;値&#8203;デー&#8203;タ&#8203;や&#8203;配&#8203;当&#8203;デー&#8203;タ&#8203;等）&#8203;が&#8203;記&#8203;録&#8203;さ&#8203;れ&#8203;た&#8203;デー&#8203;タ&#8203; ※1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_labels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各&#8203;銘&#8203;柄&#8203;で&#8203;決&#8203;算&#8203;発&#8203;表&#8203;が&#8203;行&#8203;わ&#8203;れ&#8203;た&#8203;日&#8203;の&#8203;取&#8203;引&#8203;所&#8203;公&#8203;式&#8203;終&#8203;値&#8203;か&#8203;ら、&#8203;そ&#8203;の&#8203;日&#8203;の&#8203;翌&#8203;営&#8203;業&#8203;日&#8203;以&#8203;降&#8203;N&#8203;営&#8203;業&#8203;日&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る&#8203;取&#8203;引&#8203;所&#8203;公&#8203;式&#8203;終&#8203;値&#8203;の&#8203;最&#8203;高&#8203;値&#8203;お&#8203;よ&#8203;び&#8203;最&#8203;安&#8203;値&#8203;へ&#8203;の&#8203;変&#8203;化&#8203;率&#8203;を&#8203;記&#8203;録&#8203;し&#8203;た&#8203;デー&#8203;タ&#8203; ※1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_fin_price</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デー&#8203;タ&#8203;が&#8203;扱&#8203;い&#8203;や&#8203;す&#8203;い&#8203;よ&#8203;う&#8203;に&#8203;stock_price&#8203;及&#8203;び&#8203;stock_fin&#8203;を&#8203;マー&#8203;ジ&#8203;し&#8203;た&#8203;デー&#8203;タ&#8203; ※1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nikkei_article</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;見&#8203;出&#8203;し・&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203; *3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">article</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;見&#8203;出&#8203;し・&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203;の&#8203;分&#8203;類&#8203;語&#8203; &#8203;記&#8203;事&#8203;種&#8203;別</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">industry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;見&#8203;出&#8203;し・&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203;の&#8203;分&#8203;類&#8203;語&#8203; &#8203;業&#8203;界&#8203;コー&#8203;ド</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">industry2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;見&#8203;出&#8203;し・&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203;の&#8203;分&#8203;類&#8203;語&#8203; &#8203;業&#8203;界&#8203;コー&#8203;ド&#8203;(PD&#8203;コー&#8203;ド&#8203;)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">region</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;見&#8203;出&#8203;し・&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203;の&#8203;分&#8203;類&#8203;語&#8203; &#8203;地&#8203;域</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">theme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;見&#8203;出&#8203;し・&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203;の&#8203;分&#8203;類&#8203;語&#8203; &#8203;記&#8203;事&#8203;内&#8203;容&#8203;の&#8203;テー&#8203;マ&#8203;コー&#8203;ド</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tdnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">適&#8203;時&#8203;開&#8203;示&#8203;資&#8203;料&#8203;の&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203; (API&#8203;経&#8203;由&#8203;で&#8203;PDF&#8203;を&#8203;取&#8203;得&#8203;可&#8203;能&#8203; ※4)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disclosureItems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">適&#8203;時&#8203;開&#8203;示&#8203;資&#8203;料&#8203;の&#8203;公&#8203;開&#8203;項&#8203;目&#8203;コー&#8203;ド</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headline_features.pkl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;5&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;ヘッ&#8203;ド&#8203;ラ&#8203;イ&#8203;ン&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;pkl&#8203;化&#8203;し&#8203;た&#8203;ファ&#8203;イ&#8203;ル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keywords_features.pkl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;5&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;キー&#8203;ワー&#8203;ド&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;pkl&#8203;化&#8203;し&#8203;た&#8203;ファ&#8203;イ&#8203;ル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headline_features.zip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;6&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;ヘッ&#8203;ド&#8203;ラ&#8203;イ&#8203;ン&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;及&#8203;び&#8203;sentiment score&#8203;を&#8203;pkl&#8203;化&#8203;し&#8203;た&#8203;ファ&#8203;イ&#8203;ル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keywords_features.zip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;6&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;キー&#8203;ワー&#8203;ド&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;及&#8203;び&#8203;sentiment score&#8203;を&#8203;pkl&#8203;化&#8203;し&#8203;た&#8203;ファ&#8203;イ&#8203;ル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">purchase_date.csv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">評&#8203;価&#8203;対&#8203;象&#8203;週&#8203;に&#8203;お&#8203;け&#8203;る&#8203; &#8203;初&#8203;日&#8203;の&#8203;日&#8203;付&#8203;を&#8203;指&#8203;定&#8203;す&#8203;る&#8203;ファ&#8203;イ&#8203;ル</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>　&#8203;提&#8203;供&#8203;デー&#8203;タ&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;一&#8203;部&#8203;デー&#8203;タ&#8203;を&#8203;除&#8203;き&#8203;2016&#8203;年&#8203;1&#8203;月&#8203;初&#8203;か&#8203;ら&#8203;2020&#8203;年&#8203;12&#8203;月&#8203;末&#8203;を&#8203;csv&#8203;ファ&#8203;イ&#8203;ル&#8203;形&#8203;式、&#8203;2021&#8203;年&#8203;1&#8203;月&#8203;初&#8203;か&#8203;ら&#8203;の&#8203;デー&#8203;タ&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;専&#8203;用&#8203;の&#8203;API&#8203;に&#8203;て&#8203;提&#8203;供&#8203;い&#8203;た&#8203;し&#8203;ま&#8203;す。&#8203;API&#8203;に&#8203;よ&#8203;る&#8203;デー&#8203;タ&#8203;取&#8203;得&#8203;に&#8203;つ&#8203;き&#8203;ま&#8203;し&#8203;て&#8203;は、&#8203;8&#8203;章&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>※1 &#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;ズ&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ&#8203;と&#8203;共&#8203;通&#8203;の&#8203;5&#8203;種&#8203;類&#8203;の&#8203;デー&#8203;タ&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;「2.2. &#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;説&#8203;明」&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;<br>
※2 stock_list&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;ニュー&#8203;ス&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ&#8203;で&#8203;は&#8203;「universe_comp2」&#8203;と&#8203;い&#8203;う&#8203;列&#8203;が&#8203;追&#8203;加&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;以&#8203;下&#8203;に&#8203;説&#8203;明&#8203;を&#8203;記&#8203;載&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;<br>
*3 &#8203;当&#8203;該&#8203;デー&#8203;タ&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;2020&#8203;年&#8203;以&#8203;降&#8203;の&#8203;デー&#8203;タ&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;<br>
※4 PDF&#8203;の&#8203;ファ&#8203;イ&#8203;ル&#8203;取&#8203;得&#8203;は、&#8203;2020&#8203;年&#8203;1&#8203;月&#8203;以&#8203;降&#8203;の&#8203;も&#8203;の&#8203;が&#8203;対&#8203;象&#8203;で&#8203;す。&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;で&#8203;は&#8203;PDF/XBRL&#8203;の&#8203;提&#8203;供&#8203;は&#8203;ご&#8203;ざ&#8203;い&#8203;ま&#8203;せ&#8203;ん。</p>
</div>
<div class="sect3">
<h4 id="_銘柄情報_stock_list_2">3.4.1. 銘柄情報: stock_list</h4>
<div class="paragraph">
<p>　stock_list&#8203;は、&#8203;基&#8203;本&#8203;的&#8203;に&#8203;は&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;ズ&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ&#8203;と&#8203;共&#8203;通&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;ニュー&#8203;ス&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ&#8203;の&#8203;予&#8203;測&#8203;対&#8203;象&#8203;銘&#8203;柄&#8203;を&#8203;判&#8203;別&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;「universe_comp2」&#8203;と&#8203;い&#8203;う&#8203;カ&#8203;ラ&#8203;ム&#8203;が&#8203;追&#8203;加&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;「universe_comp2」&#8203;が&#8203; True &#8203;と&#8203;設&#8203;定&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;銘&#8203;柄&#8203;の&#8203;み&#8203;を&#8203;組&#8203;み&#8203;入&#8203;れ&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;<br>
　<strong>&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;予&#8203;測&#8203;対&#8203;象&#8203;銘&#8203;柄&#8203;以&#8203;外&#8203;を&#8203;組&#8203;み&#8203;入&#8203;れ&#8203;た&#8203;場&#8203;合&#8203;は、&#8203;そ&#8203;の&#8203;銘&#8203;柄&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;の&#8203;購&#8203;入&#8203;指&#8203;示&#8203;は&#8203;無&#8203;視&#8203;さ&#8203;れ&#8203;て&#8203;評&#8203;価&#8203;対&#8203;象&#8203;外&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">prediction_target</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予&#8203;測&#8203;対&#8203;象&#8203;銘&#8203;柄</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Effective Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;情&#8203;報&#8203;の&#8203;基&#8203;準&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20201030</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">株&#8203;式&#8203;銘&#8203;柄&#8203;コー&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1301</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name (English)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KYOKUYO CO.,LTD.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Section/Products</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">市&#8203;場・&#8203;商&#8203;品&#8203;区&#8203;分</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First Section (Domestic)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">33 Sector(Code)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;の&#8203;33&#8203;業&#8203;種&#8203;区&#8203;分&#8203;(&#8203;コー&#8203;ド&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">33 Sector(name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;の&#8203;33&#8203;業&#8203;種&#8203;区&#8203;分&#8203;(&#8203;名&#8203;前&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fishery, Agriculture and Forestry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">17 Sector(Code)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;の&#8203;17&#8203;業&#8203;種&#8203;区&#8203;分&#8203;(&#8203;コー&#8203;ド&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">17 Sector(name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;の&#8203;17&#8203;業&#8203;種&#8203;区&#8203;分&#8203;(&#8203;名&#8203;前&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FOODS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size Code (New Index Series)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPIX&#8203;ニュー&#8203;イ&#8203;ン&#8203;デッ&#8203;ク&#8203;ス&#8203;シ&#8203;リー&#8203;ズ&#8203;規&#8203;模&#8203;区&#8203;分&#8203;(&#8203;コー&#8203;ド&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size (New Index Series)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPIX&#8203;ニュー&#8203;イ&#8203;ン&#8203;デッ&#8203;ク&#8203;ス&#8203;シ&#8203;リー&#8203;ズ&#8203;規&#8203;模&#8203;区&#8203;分</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPIX Small 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IssuedShareEquityQuote AccountingStandard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会&#8203;計&#8203;基&#8203;準&#8203; &#8203;単&#8203;独&#8203;:NonConsolidated、&#8203;連&#8203;結&#8203;国&#8203;内&#8203;:ConsolidatedJP、&#8203;連&#8203;結&#8203;SEC:ConsolidatedUS、&#8203;連&#8203;結&#8203;IFRS:ConsolidatedIFRS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConsolidatedJP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IssuedShareEquityQuote ModifyDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">更&#8203;新&#8203;日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020/11/06</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IssuedShareEquityQuote IssuedShare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">発&#8203;行&#8203;済&#8203;株&#8203;式&#8203;数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10928283.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">universe_comp2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&#8203;ニュー&#8203;ス&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ&#8203;の&#8203;予&#8203;測&#8203;対&#8203;象&#8203;銘&#8203;柄&#8203;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(JPX&#8203;東&#8203;証&#8203;上&#8203;場&#8203;銘&#8203;柄&#8203;一&#8203;覧&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.jpx.co.jp/markets/statistics-equities/misc/01.html" class="bare">https://www.jpx.co.jp/markets/statistics-equities/misc/01.html</a>)<br>
(Quick xignite API Market Data API Catalog&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.marketdata-cloud.quick-co.jp/Products/" class="bare">https://www.marketdata-cloud.quick-co.jp/Products/</a>)</p>
</div>
</div>
<div class="sect3">
<h4 id="_日経電子版見出しメタデータ_nikkei_article">3.4.2. 日経電子版見出し・メタデータ: nikkei_article</h4>
<div class="paragraph">
<p>　nikkei_article&#8203;で&#8203;は、&#8203;日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;の&#8203;見&#8203;出&#8203;し&#8203;お&#8203;よ&#8203;び&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203;を&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;記&#8203;事&#8203;見&#8203;出&#8203;し&#8203;や&#8203;キー&#8203;ワー&#8203;ド&#8203;な&#8203;ど&#8203;の&#8203;言&#8203;語&#8203;デー&#8203;タ&#8203;に&#8203;加&#8203;え、&#8203;一&#8203;部&#8203;の&#8203;レ&#8203;コー&#8203;ド&#8203;に&#8203;は&#8203;該&#8203;当&#8203;の&#8203;記&#8203;事&#8203;に&#8203;関&#8203;連&#8203;す&#8203;る&#8203;株&#8203;式&#8203;コー&#8203;ド&#8203;や、&#8203;記&#8203;事&#8203;の&#8203;分&#8203;類&#8203;情&#8203;報&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;分&#8203;類&#8203;情&#8203;報&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;別&#8203;途&#8203;CSV&#8203;ファ&#8203;イ&#8203;ル&#8203;で&#8203;も&#8203;提&#8203;供&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">article_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記&#8203;事&#8203;ID(DB&#8203;ユ&#8203;ニー&#8203;ク&#8203;キー&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDSKDBDGXMZO5518670003022020QM8000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">publish_datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"&#8203;掲&#8203;載&#8203;日&#8203;(datetime&#8203;型&#8203;)""2016-09-25T23:33:26Z"" &#8203;な&#8203;ど&#8203; ※&#8203;新&#8203;聞&#8203;各&#8203;紙&#8203;の&#8203;時&#8203;分&#8203;は&#8203;00:00:00&#8203;固&#8203;定&#8203;"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-02-03T17:58:25+09:00</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">media_code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"&#8203;媒&#8203;体&#8203;略&#8203;号&#8203; &#8203;媒&#8203;体&#8203;の&#8203;ユ&#8203;ニー&#8203;ク&#8203;コー&#8203;ド&#8203; ・&#8203;日&#8203;本&#8203;経&#8203;済&#8203;新&#8203;聞&#8203;朝&#8203;刊&#8203;:NKM、&#8203;NK2、&#8203;NK3、&#8203;NK4、&#8203;NK5、&#8203;NK6 ・&#8203;日&#8203;本&#8203;経&#8203;済&#8203;新&#8203;聞&#8203;夕&#8203;刊&#8203;:NKE ・&#8203;日&#8203;本&#8203;経&#8203;済&#8203;新&#8203;聞&#8203;地&#8203;方&#8203;経&#8203;済&#8203;面&#8203;:NKL ・&#8203;日&#8203;経&#8203;産&#8203;業&#8203;新&#8203;聞&#8203;:NSS、&#8203;SS2・&#8203;日&#8203;経&#8203;MJ:NRS、&#8203;RS2 ・&#8203;日&#8203;経&#8203;速&#8203;報&#8203;ニュー&#8203;ス&#8203;アー&#8203;カ&#8203;イ&#8203;ブ&#8203;:NKR"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NKE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">media_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"&#8203;媒&#8203;体&#8203;名&#8203;称&#8203; ""&#8203;日&#8203;本&#8203;経&#8203;済&#8203;新&#8203;聞&#8203; &#8203;朝&#8203;刊&#8203;""、&#8203;""&#8203;日&#8203;経&#8203;速&#8203;報&#8203;ニュー&#8203;ス&#8203;アー&#8203;カ&#8203;イ&#8203;ブ&#8203;""&#8203;な&#8203;ど&#8203;"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日&#8203;本&#8203;経&#8203;済&#8203;新&#8203;聞&#8203;電&#8203;子&#8203;版</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">men_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"&#8203;面&#8203;名&#8203; &#8203;地&#8203;方&#8203;経&#8203;済&#8203;面&#8203;の&#8203;場&#8203;合&#8203;に&#8203;収&#8203;録。&#8203;""&#8203;名&#8203;古&#8203;屋&#8203;朝&#8203;刊&#8203;社&#8203;会&#8203;面&#8203;""、&#8203;""&#8203;埼&#8203;玉”&#8203;な&#8203;ど&#8203;"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">名&#8203;古&#8203;屋&#8203;朝&#8203;刊&#8203;社&#8203;会&#8203;面</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">page_from</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"&#8203;検&#8203;索&#8203;掲&#8203;載&#8203;開&#8203;始&#8203;ペー&#8203;ジ&#8203;掲&#8203;載&#8203;ペー&#8203;ジ。&#8203;但&#8203;し、&#8203;地&#8203;方&#8203;経&#8203;済&#8203;面&#8203;の&#8203;ペー&#8203;ジ&#8203;情&#8203;報&#8203;は、&#8203;掲&#8203;載&#8203;さ&#8203;れ&#8203;た&#8203;ペー&#8203;ジ&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;ど&#8203;の&#8203;地&#8203;方&#8203;の&#8203;記&#8203;事&#8203;で&#8203;あ&#8203;る&#8203;か&#8203;を&#8203;意&#8203;味&#8203;す&#8203;る。&#8203;※&#8203;対&#8203;応&#8203;表&#8203;参&#8203;照&#8203;"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">picture_flag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"&#8203;絵・&#8203;写&#8203;真・&#8203;表&#8203;の&#8203;有&#8203;無””&#8203; or ”&#8203;有”&#8203;"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">paragraph_cnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"&#8203;記&#8203;事&#8203;本&#8203;文&#8203;段&#8203;落&#8203;数&#8203;"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">char_length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"&#8203;記&#8203;事&#8203;本&#8203;文&#8203;文&#8203;字&#8203;数&#8203;"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">221</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headline</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"&#8203;記&#8203;事&#8203;見&#8203;出&#8203;し&#8203;"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">東&#8203;商&#8203;取&#8203;の&#8203;売&#8203;買&#8203;高、&#8203;１&#8203;月&#8203;は&#8203;10％&#8203;増、&#8203;４&#8203;カ&#8203;月&#8203;ぶ&#8203;り&#8203;前&#8203;年&#8203;越&#8203;え</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keywords</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"&#8203;キー&#8203;ワー&#8203;ド&#8203; &#8203;記&#8203;事&#8203;の&#8203;文&#8203;中&#8203;か&#8203;ら&#8203;主&#8203;題&#8203;語&#8203;と&#8203;し&#8203;て&#8203;切&#8203;り&#8203;出&#8203;し&#8203;た&#8203;ワー&#8203;ド&#8203;(&#8203;ま&#8203;た&#8203;は&#8203;そ&#8203;の&#8203;正&#8203;式&#8203;名&#8203;称&#8203;)"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">東&#8203;京&#8203;商&#8203;品&#8203;取&#8203;引&#8203;所&#8203;\n&#8203;売&#8203;買&#8203;高&#8203;\n&#8203;前&#8203;年&#8203;\n&#8203;日&#8203;本&#8203;取&#8203;引&#8203;所&#8203;グ&#8203;ルー&#8203;プ&#8203;\n&#8203;同&#8203;月</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classifications</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"&#8203;分&#8203;類&#8203;情&#8203;報&#8203; &#8203;記&#8203;事&#8203;内&#8203;容&#8203;の&#8203;テー&#8203;マ&#8203;コー&#8203;ド&#8203;(#W〜&#8203;)・&#8203;業&#8203;界&#8203;コー&#8203;ド&#8203;(#B〜&#8203;)、&#8203;証&#8203;券&#8203;コー&#8203;ド&#8203;等&#8203;の&#8203;会&#8203;社&#8203;コー&#8203;ド&#8203;(T〜、&#8203;N〜、&#8203;PD〜&#8203;)、&#8203;紙&#8203; &#8203;面&#8203;名&#8203;等&#8203;の&#8203;記&#8203;事&#8203;分&#8203;類&#8203;キー&#8203;ワー&#8203;ド&#8203;($〜&#8203;)、&#8203;コ&#8203;ラ&#8203;ム&#8203;名&#8203;(&#8203;「〜」&#8203;)"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">＄&#8203;絵&#8203;写&#8203;表&#8203;記&#8203;事&#8203;\nＴ８６９７\nＰＤ５２１\nＮ００４０４３１\nＮ００７５１０７</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">company_g.stock_code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">株&#8203;式&#8203;コー&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8697</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_日経電子版見出しメタデータの確認">日経電子版見出し・メタデータの確認</h5>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は&#8203;「日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;見&#8203;出&#8203;し・&#8203;メ&#8203;タ&#8203;デー&#8203;タ」&#8203;を&#8203;把&#8203;握&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に、&#8203;デー&#8203;タ&#8203;を&#8203;確&#8203;認&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。&#8203;デー&#8203;タ&#8203;の&#8203;確&#8203;認&#8203;に&#8203;使&#8203;用&#8203;し&#8203;た&#8203;notebook&#8203;は&#8203;「handson/Chapter03/20210415_chapter03_news_data_visualization.ipynb」&#8203;に&#8203;配&#8203;置&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;必&#8203;要&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>デー&#8203;タ&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 入力パラメーターを設定します。ランタイム環境での実行時と同一フォーマットにします</span>
inputs = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_list.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">nikkei_article</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/nikkei_article.csv.gz</span><span class="delimiter">&quot;</span></span>,
}
<span class="comment"># 銘柄リストを取得</span>
df_stock_list = pd.read_csv(inputs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>])
<span class="comment"># 投資対象銘柄を取得</span>
stock_codes = df_stock_list.loc[df_stock_list.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">universe_comp2</span><span class="delimiter">&quot;</span></span>] == <span class="predefined-constant">True</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>]
<span class="comment"># 日経電子版見出し・メタデータ読み込み</span>
df_nikkei_article = pd.read_csv(inputs[<span class="string"><span class="delimiter">&quot;</span><span class="content">nikkei_article</span><span class="delimiter">&quot;</span></span>])
<span class="comment"># インデックスを記事の掲載日に設定</span>
df_nikkei_article.set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">publish_datetime</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
<span class="comment"># インデックスを日付型に変換</span>
df_nikkei_article.index = pd.to_datetime(df_nikkei_article.index)
<span class="comment"># インデックスで安定ソート</span>
df_nikkei_article.sort_index(kind=<span class="string"><span class="delimiter">&quot;</span><span class="content">mergesort</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>デー&#8203;タ&#8203;の&#8203;件&#8203;数&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 件数を確認</span>
df_nikkei_article.info()</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
DatetimeIndex: 178393 entries, 2020-01-01 00:00:00+09:00 to 2020-12-31 23:26:35+09:00
Data columns (total 12 columns):
 #   Column                Non-Null Count   Dtype
---  ------                --------------   -----
 0   article_id            178393 non-null  object
 1   media_code            178393 non-null  object
 2   media_name            178393 non-null  object
 3   men_name              0 non-null       float64
 4   page_from             0 non-null       float64
 5   picture_flag          75294 non-null   object
 6   paragraph_cnt         178393 non-null  int64
 7   char_length           178393 non-null  int64
 8   headline              178393 non-null  object
 9   keywords              177894 non-null  object
 10  classifications       173346 non-null  object
 11  company_g.stock_code  68369 non-null   object
dtypes: float64(2), int64(2), object(8)
memory usage: 17.7+ MB</code></pre>
</div>
</div>
<div class="paragraph">
<p>上&#8203;記&#8203;か&#8203;ら&#8203;デー&#8203;タ&#8203;の&#8203;件&#8203;数&#8203;と&#8203;デー&#8203;タ&#8203;の&#8203;範&#8203;囲&#8203;が&#8203;わ&#8203;かっ&#8203;た&#8203;の&#8203;で、&#8203;よ&#8203;り&#8203;具&#8203;体&#8203;的&#8203;な&#8203;値&#8203;を&#8203;把&#8203;握&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;先&#8203;頭&#8203;の&#8203;1&#8203;レ&#8203;コー&#8203;ド&#8203;を&#8203;出&#8203;力&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># データの開始日と内容を確認</span>
df_nikkei_article.head(<span class="integer">1</span>).T</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/nikkei_article/nikkei_article01.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>デー&#8203;タ&#8203;の&#8203;最&#8203;終&#8203;行&#8203;を&#8203;表&#8203;示&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># データの最終日を確認</span>
df_nikkei_article.tail(<span class="integer">1</span>).T</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/nikkei_article/nikkei_article02.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>記&#8203;事&#8203;の&#8203;見&#8203;出&#8203;し&#8203;で&#8203;あ&#8203;る&#8203; headline &#8203;列&#8203;の&#8203;文&#8203;字&#8203;数&#8203;の&#8203;分&#8203;布&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 見出しの文字数の分布をプロット</span>
df_nikkei_article.headline.str.len().hist(figsize=(<span class="integer">10</span>,<span class="integer">10</span>), bins=<span class="integer">50</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/nikkei_article/nikkei_article03.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>記&#8203;事&#8203;の&#8203;見&#8203;出&#8203;し&#8203;は&#8203;25&#8203;文&#8203;字&#8203;が&#8203;ピー&#8203;ク&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>company_g.stock_code &#8203;列&#8203;に&#8203;は&#8203;ニュー&#8203;ス&#8203;に&#8203;関&#8203;連&#8203;す&#8203;る&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;デー&#8203;タ&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 銘柄コードが含まれているデータを確認</span>
df_nikkei_article.loc[~df_nikkei_article.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">company_g.stock_code</span><span class="delimiter">&quot;</span></span>].isnull()].head().T</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/nikkei_article/nikkei_article04.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>一&#8203;つ&#8203;の&#8203;ニュー&#8203;ス&#8203;記&#8203;事&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;「\n」&#8203;を&#8203;区&#8203;切&#8203;り&#8203;文&#8203;字&#8203;と&#8203;し&#8203;て&#8203;複&#8203;数&#8203;の&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;が&#8203;格&#8203;納&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>1&#8203;週&#8203;間&#8203;毎&#8203;の&#8203;ニュー&#8203;ス&#8203;の&#8203;記&#8203;事&#8203;件&#8203;数&#8203;と&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;記&#8203;事&#8203;の&#8203;件&#8203;数&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 月曜日を開始日として、週次の記事件数と銘柄コードを含む記事件数を取得</span>
df_weekly_count = df_nikkei_article.resample(<span class="string"><span class="delimiter">&quot;</span><span class="content">W-MON</span><span class="delimiter">&quot;</span></span>, label=<span class="string"><span class="delimiter">&quot;</span><span class="content">left</span><span class="delimiter">&quot;</span></span>, closed=<span class="string"><span class="delimiter">&quot;</span><span class="content">left</span><span class="delimiter">&quot;</span></span>)[[<span class="string"><span class="delimiter">&quot;</span><span class="content">article_id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">company_g.stock_code</span><span class="delimiter">&quot;</span></span>]].count()
<span class="comment"># 集計内容を確認</span>
df_weekly_count.head(<span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/nikkei_article/nikkei_article05.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>1&#8203;週&#8203;間&#8203;毎&#8203;の&#8203;記&#8203;事&#8203;件&#8203;数&#8203;の&#8203;統&#8203;計&#8203;量&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 週次件数の統計量を確認</span>
df_weekly_count.describe()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/nikkei_article/nikkei_article06.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>1&#8203;週&#8203;間&#8203;毎&#8203;の&#8203;記&#8203;事&#8203;件&#8203;数&#8203;の&#8203;平&#8203;均&#8203;は&#8203;3,300&#8203;件&#8203;超、&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;記&#8203;事&#8203;件&#8203;数&#8203;の&#8203;平&#8203;均&#8203;は&#8203;1,200&#8203;件&#8203;超&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>次&#8203;に、&#8203;1&#8203;週&#8203;間&#8203;毎&#8203;の&#8203;記&#8203;事&#8203;件&#8203;数&#8203;の&#8203;分&#8203;布&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment">#  週次件数の分布を確認</span>
df_weekly_count.hist(figsize=(<span class="integer">20</span>, <span class="integer">10</span>), alpha=<span class="float">0.5</span>, bins=<span class="integer">25</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/nikkei_article/nikkei_article07.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>1&#8203;週&#8203;間&#8203;毎&#8203;の&#8203;記&#8203;事&#8203;件&#8203;数&#8203;の&#8203;推&#8203;移&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># プロット</span>
ax = df_weekly_count.plot(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))
<span class="comment"># グリッド設定</span>
ax.grid(<span class="predefined-constant">True</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/nikkei_article/nikkei_article08.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>デー&#8203;タ&#8203;の&#8203;始&#8203;点・&#8203;終&#8203;点&#8203;で&#8203;は&#8203;月&#8203;曜&#8203;日&#8203;を&#8203;起&#8203;点&#8203;と&#8203;し&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め&#8203;曜&#8203;日&#8203;の&#8203;数&#8203;が&#8203;十&#8203;分&#8203;で&#8203;な&#8203;い&#8203;こ&#8203;と、&#8203;5,7,8,9&#8203;月&#8203;は&#8203;祝&#8203;日&#8203;が&#8203;影&#8203;響&#8203;し&#8203;て&#8203;記&#8203;事&#8203;件&#8203;数&#8203;が&#8203;少&#8203;な&#8203;く&#8203;なっ&#8203;て&#8203;い&#8203;る&#8203;よ&#8203;う&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>こ&#8203;こ&#8203;か&#8203;ら&#8203;は&#8203;記&#8203;事&#8203;に&#8203;紐&#8203;付&#8203;け&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。
記&#8203;事&#8203;デー&#8203;タ&#8203;か&#8203;ら&#8203;抽&#8203;出&#8203;し&#8203;た&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;毎&#8203;に&#8203;記&#8203;事&#8203;件&#8203;数&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;対&#8203;象&#8203;と&#8203;す&#8203;る&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;を&#8203;投&#8203;資&#8203;対&#8203;象&#8203;銘&#8203;柄&#8203;に&#8203;限&#8203;定&#8203;し&#8203;て&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 記事に記載されている銘柄コードを取得</span>
s_stocks = df_nikkei_article.loc[~df_nikkei_article.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">company_g.stock_code</span><span class="delimiter">&quot;</span></span>].isnull(), <span class="string"><span class="delimiter">&quot;</span><span class="content">company_g.stock_code</span><span class="delimiter">&quot;</span></span>].str.split(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># 銘柄コード別の件数を取得し、記事件数の多い順にソート</span>
s_stock_counts = pd.Series(Counter(chain.from_iterable(s_stocks))).sort_values(ascending=<span class="predefined-constant">False</span>)
<span class="comment"># 投資対象銘柄に絞り込み</span>
s_stock_counts = s_stock_counts.loc[s_stock_counts.index.astype(<span class="predefined">int</span>).isin(stock_codes)]
<span class="comment"># データフレームに変換して、インデックスをリセット</span>
df_stock_counts = s_stock_counts.to_frame().reset_index(drop=<span class="predefined-constant">True</span>)
<span class="comment"># カラム名を設定</span>
df_stock_counts.rename(columns={<span class="integer">0</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">article_count</span><span class="delimiter">&quot;</span></span>}, inplace=<span class="predefined-constant">True</span>)
<span class="comment"># 投資対象銘柄全体におけるdisclosureItems別の件数の割合を算出</span>
df_stock_counts.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">percentage</span><span class="delimiter">&quot;</span></span>] = (df_stock_counts[<span class="string"><span class="delimiter">&quot;</span><span class="content">article_count</span><span class="delimiter">&quot;</span></span>] / df_stock_counts[<span class="string"><span class="delimiter">&quot;</span><span class="content">article_count</span><span class="delimiter">&quot;</span></span>].sum()) * <span class="integer">100</span>
<span class="comment"># 件数割合の累積を計算</span>
df_stock_counts.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">cumulative_percentage</span><span class="delimiter">&quot;</span></span>] = df_stock_counts[<span class="string"><span class="delimiter">&quot;</span><span class="content">percentage</span><span class="delimiter">&quot;</span></span>].cumsum()
<span class="comment"># 投資対象銘柄コード別の件数をプロット (全銘柄)</span>
ax = df_stock_counts[[<span class="string"><span class="delimiter">&quot;</span><span class="content">article_count</span><span class="delimiter">&quot;</span></span>]].plot(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))
<span class="comment">#  グリッド設定</span>
ax.grid(<span class="predefined-constant">True</span>)
<span class="comment"># 凡例を左上に表示</span>
ax.legend(loc=<span class="string"><span class="delimiter">&quot;</span><span class="content">upper left</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># 2つ目のy軸を作成</span>
ax2 = ax.twinx()
<span class="comment"># 開示件数割合の累積をプロット</span>
df_stock_counts[[<span class="string"><span class="delimiter">&quot;</span><span class="content">cumulative_percentage</span><span class="delimiter">&quot;</span></span>]].reset_index(drop=<span class="predefined-constant">True</span>).plot(ax=ax2, color=<span class="string"><span class="delimiter">&quot;</span><span class="content">orange</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># 凡例を右上に表示</span>
ax2.legend(loc=<span class="string"><span class="delimiter">&quot;</span><span class="content">upper right</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/nikkei_article/nikkei_article09.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>x&#8203;軸&#8203;は&#8203;銘&#8203;柄&#8203;の&#8203;数&#8203;を&#8203;示&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;青&#8203;色&#8203;線&#8203;は&#8203;左&#8203;側&#8203;の&#8203;y&#8203;軸&#8203;に&#8203;対&#8203;応&#8203;し&#8203;て&#8203;お&#8203;り&#8203;記&#8203;事&#8203;件&#8203;数&#8203;を&#8203;表&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す、&#8203;黄&#8203;色&#8203;線&#8203;は&#8203;右&#8203;側&#8203;の&#8203;y&#8203;軸&#8203;に&#8203;対&#8203;応&#8203;し&#8203;て&#8203;お&#8203;り&#8203;記&#8203;事&#8203;件&#8203;数&#8203;全&#8203;体&#8203;に&#8203;お&#8203;け&#8203;る&#8203;累&#8203;積&#8203;割&#8203;合&#8203;を&#8203;示&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;一&#8203;部&#8203;の&#8203;銘&#8203;柄&#8203;に&#8203;記&#8203;事&#8203;件&#8203;数&#8203;が&#8203;集&#8203;中&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;約&#8203;1750&#8203;銘&#8203;柄&#8203;中&#8203;250&#8203;銘&#8203;柄&#8203;で&#8203;記&#8203;事&#8203;件&#8203;数&#8203;全&#8203;体&#8203;の&#8203;70%&#8203;程&#8203;度&#8203;を&#8203;占&#8203;め&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>記&#8203;事&#8203;件&#8203;数&#8203;の&#8203;多&#8203;い&#8203;順&#8203;に&#8203;上&#8203;位&#8203;50&#8203;銘&#8203;柄&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 投資対象銘柄コード別の記事件数 (件数上位50銘柄)</span>
ax = s_stock_counts.head(<span class="integer">50</span>).plot.bar(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))
<span class="comment">#  グリッド設定</span>
ax.grid(<span class="predefined-constant">True</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/nikkei_article/nikkei_article10.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p><code>7203</code> &#8203;の&#8203;ト&#8203;ヨ&#8203;タ&#8203;自&#8203;動&#8203;車、&#8203;お&#8203;よ&#8203;び&#8203; <code>9984</code> &#8203;の&#8203;ソ&#8203;フ&#8203;ト&#8203;バ&#8203;ン&#8203;ク&#8203;グ&#8203;ルー&#8203;プ&#8203;に&#8203;関&#8203;す&#8203;る&#8203;記&#8203;事&#8203;件&#8203;数&#8203;が&#8203;突&#8203;出&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;以&#8203;後&#8203;記&#8203;事&#8203;件&#8203;数&#8203;が&#8203;減&#8203;少&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;ニュー&#8203;ス&#8203;の&#8203;件&#8203;数&#8203;は&#8203;銘&#8203;柄&#8203;ご&#8203;と&#8203;に&#8203;か&#8203;な&#8203;り&#8203;偏っ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_日経電子版見出しメタデータの分類語_記事種別_article">3.4.3. 日経電子版見出し・メタデータの分類語 記事種別: article</h4>
<div class="paragraph">
<p>　article&#8203;で&#8203;は、&#8203;日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;見&#8203;出&#8203;し・&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203;の&#8203;分&#8203;類&#8203;情&#8203;報&#8203;(classifications)&#8203;に&#8203;記&#8203;載&#8203;の&#8203;記&#8203;事&#8203;種&#8203;類&#8203;の&#8203;項&#8203;目&#8203;一&#8203;覧&#8203;を&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">分&#8203;類&#8203;情&#8203;報&#8203;コー&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#K1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">article</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記&#8203;事&#8203;種&#8203;類&#8203;項&#8203;目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">人&#8203;事&#8203;記&#8203;事</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_日経電子版見出しメタデータの分類語_業界コード_industry">3.4.4. 日経電子版見出し・メタデータの分類語 業界コード: industry</h4>
<div class="paragraph">
<p>　industry&#8203;で&#8203;は、&#8203;日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;見&#8203;出&#8203;し・&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203;の&#8203;分&#8203;類&#8203;情&#8203;報&#8203;に&#8203;記&#8203;載&#8203;の&#8203;業&#8203;界&#8203;一&#8203;覧&#8203;を&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">分&#8203;類&#8203;情&#8203;報&#8203;コー&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">＃Ｂ００１０</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">industry1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">業&#8203;界&#8203;項&#8203;目&#8203;一&#8203;覧&#8203;の&#8203;大&#8203;項&#8203;目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">資&#8203;源・&#8203;エ&#8203;ネ&#8203;ル&#8203;ギー</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">industry2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">業&#8203;界&#8203;項&#8203;目&#8203;一&#8203;覧&#8203;の&#8203;小&#8203;項&#8203;目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">石&#8203;油・&#8203;鉱&#8203;業・&#8203;エ&#8203;ネ&#8203;ル&#8203;ギー</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_日経電子版見出しメタデータの分類語_業界コードpdコード_industry2">3.4.5. 日経電子版見出し・メタデータの分類語 業界コード(PDコード): industry2</h4>
<div class="paragraph">
<p>　industry2&#8203;で&#8203;は、&#8203;日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;見&#8203;出&#8203;し・&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203;の&#8203;分&#8203;類&#8203;情&#8203;報&#8203;の&#8203;業&#8203;界&#8203;(PD&#8203;コー&#8203;ド&#8203;)&#8203;一&#8203;覧&#8203;を&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">分&#8203;類&#8203;情&#8203;報</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ＰＤ０１１</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Industry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">業&#8203;界&#8203;項&#8203;目&#8203;一&#8203;覧</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">飼&#8203;料</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_日経電子版見出しメタデータの分類語_地域_region">3.4.6. 日経電子版見出し・メタデータの分類語 地域: region</h4>
<div class="paragraph">
<p>　region&#8203;で&#8203;は、&#8203;日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;見&#8203;出&#8203;し・&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203;の&#8203;分&#8203;類&#8203;情&#8203;報&#8203;の&#8203;地&#8203;域&#8203;一&#8203;覧&#8203;を&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">分&#8203;類&#8203;情&#8203;報</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">＃Ａ７００</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">地&#8203;域&#8203;一&#8203;覧&#8203;の&#8203;大&#8203;項&#8203;目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">外&#8203;国</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">地&#8203;域&#8203;一&#8203;覧&#8203;の&#8203;小&#8203;項&#8203;目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イ&#8203;ン&#8203;ド</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_日経電子版見出しメタデータの分類語_記事内容のテーマコード_theme">3.4.7. 日経電子版見出し・メタデータの分類語 記事内容のテーマコード: theme</h4>
<div class="paragraph">
<p>　theme&#8203;で&#8203;は、&#8203;日&#8203;経&#8203;電&#8203;子&#8203;版&#8203;見&#8203;出&#8203;し・&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203;の&#8203;分&#8203;類&#8203;情&#8203;報&#8203;の&#8203;テー&#8203;マ&#8203;一&#8203;覧&#8203;を&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">分&#8203;類&#8203;情&#8203;報</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">＃Ｗ１０１０１</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">テー&#8203;マ&#8203;一&#8203;覧&#8203;の&#8203;大&#8203;項&#8203;目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">企&#8203;業</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">テー&#8203;マ&#8203;一&#8203;覧&#8203;の&#8203;中&#8203;項&#8203;目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">事&#8203;業&#8203;組&#8203;み&#8203;替&#8203;え</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">テー&#8203;マ&#8203;一&#8203;覧&#8203;の&#8203;小&#8203;項&#8203;目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">事&#8203;業&#8203;組&#8203;み&#8203;替&#8203;え</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_適時開示資料のメタデータ_tdnet">3.4.8. 適時開示資料のメタデータ: tdnet</h4>
<div class="paragraph">
<p>　tdnet&#8203;で&#8203;は、&#8203;適&#8203;時&#8203;開&#8203;示&#8203;資&#8203;料&#8203;の&#8203;メ&#8203;タ&#8203;デー&#8203;タ&#8203;を&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;適&#8203;時&#8203;開&#8203;示&#8203;資&#8203;料&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;「2.1.5. &#8203;決&#8203;算&#8203;短&#8203;信・&#8203;財&#8203;務&#8203;諸&#8203;表」&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;「disclosureItems (&#8203;公&#8203;開&#8203;項&#8203;目&#8203;コー&#8203;ド&#8203;)」&#8203;の&#8203;一&#8203;覧&#8203;は&#8203;別&#8203;途&#8203;csv&#8203;ファ&#8203;イ&#8203;ル&#8203;で&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">開&#8203;示&#8203;日&#8203;付&#8203;お&#8203;よ&#8203;び&#8203;開&#8203;示&#8203;番&#8203;号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016-02-19:16:00:00#20160210412154</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disclosedDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">開&#8203;示&#8203;日&#8203;付</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016-02-19</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disclosedTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">開&#8203;示&#8203;時&#8203;刻</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16:00:00</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disclosureNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">開&#8203;示&#8203;番&#8203;号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20160210412154</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;コー&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">79860</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘&#8203;柄&#8203;略&#8203;称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ｊ－&#8203;日&#8203;本&#8203;ア&#8203;イ&#8203;エ&#8203;ス&#8203;ケ&#8203;イ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disclosureItems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">公&#8203;開&#8203;項&#8203;目&#8203;コー&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">["11301"]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表&#8203;題</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">平&#8203;成&#8203;27&#8203;年&#8203;12&#8203;月&#8203;期&#8203;　&#8203;決&#8203;算&#8203;短&#8203;信&#8203;〔日&#8203;本&#8203;基&#8203;準〕&#8203;（連&#8203;結）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">handlingType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">取&#8203;扱&#8203;属&#8203;性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modifiedHistory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">開&#8203;示&#8203;履&#8203;歴&#8203;番&#8203;号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdfGeneralFlag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全&#8203;文&#8203;情&#8203;報&#8203;PDF&#8203;ファ&#8203;イ&#8203;ル&#8203;存&#8203;在&#8203;フ&#8203;ラ&#8203;グ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdfSumaryFlag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サ&#8203;マ&#8203;リ&#8203;情&#8203;報&#8203;PDF&#8203;ファ&#8203;イ&#8203;ル&#8203;存&#8203;在&#8203;フ&#8203;ラ&#8203;グ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xbrlFlag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XBRL&#8203;関&#8203;連&#8203;ファ&#8203;イ&#8203;ル&#8203;存&#8203;在&#8203;フ&#8203;ラ&#8203;グ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_適時開示資料のメタデータの確認">適時開示資料のメタデータの確認</h5>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は&#8203;「適&#8203;時&#8203;開&#8203;示&#8203;資&#8203;料&#8203;の&#8203;メ&#8203;タ&#8203;デー&#8203;タ」&#8203;を&#8203;把&#8203;握&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に、&#8203;デー&#8203;タ&#8203;を&#8203;確&#8203;認&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。&#8203;デー&#8203;タ&#8203;の&#8203;確&#8203;認&#8203;に&#8203;使&#8203;用&#8203;し&#8203;た&#8203;notebook&#8203;は&#8203;「handson/Chapter03/20210415_chapter03_news_data_visualization.ipynb」&#8203;に&#8203;配&#8203;置&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;必&#8203;要&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>デー&#8203;タ&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 入力パラメーターを設定します。ランタイム環境での実行時と同一フォーマットにします</span>
inputs = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_list.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">nikkei_article</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/nikkei_article.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/disclosureItems.csv.gz</span><span class="delimiter">&quot;</span></span>,
}
<span class="comment"># 銘柄リストを取得</span>
df_stock_list = pd.read_csv(inputs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>])
<span class="comment"># 投資対象銘柄を取得</span>
stock_codes = df_stock_list.loc[df_stock_list.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">universe_comp2</span><span class="delimiter">&quot;</span></span>] == <span class="predefined-constant">True</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>]
<span class="comment"># 適時開示資料のメタデータ読み込み</span>
df_tdnet = pd.read_csv(inputs[<span class="string"><span class="delimiter">&quot;</span><span class="content">tdnet</span><span class="delimiter">&quot;</span></span>])
<span class="comment"># インデックスを開示日時に設定</span>
df_tdnet.index = pd.to_datetime(df_tdnet[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosedDate</span><span class="delimiter">&quot;</span></span>].astype(<span class="predefined">str</span>) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span> + df_tdnet[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosedTime</span><span class="delimiter">&quot;</span></span>])
<span class="comment"># インデックスで安定ソート</span>
df_tdnet.sort_index(kind=<span class="string"><span class="delimiter">&quot;</span><span class="content">mergesort</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
<span class="comment"># 公開項目コード一覧を読み込み</span>
df_disclosureitems = pd.read_csv(inputs[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>デー&#8203;タ&#8203;の&#8203;件&#8203;数&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 件数を確認</span>
df_tdnet.info()</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
DatetimeIndex: 510962 entries, 2016-01-12 08:00:00 to 2020-12-30 21:00:00
Data columns (total 13 columns):
 #   Column            Non-Null Count   Dtype
---  ------            --------------   -----
 0   datetime          510962 non-null  object
 1   disclosedDate     510962 non-null  object
 2   disclosedTime     510962 non-null  object
 3   disclosureNumber  510962 non-null  int64
 4   code              510962 non-null  int64
 5   name              510962 non-null  object
 6   disclosureItems   510962 non-null  object
 7   title             510962 non-null  object
 8   handlingType      1694 non-null    object
 9   pdfGeneralFlag    510962 non-null  int64
 10  modifiedHistory   510962 non-null  int64
 11  pdfSumaryFlag     510962 non-null  int64
 12  xbrlFlag          510962 non-null  int64
dtypes: int64(6), object(7)
memory usage: 54.6+ MB</code></pre>
</div>
</div>
<div class="paragraph">
<p>上&#8203;記&#8203;か&#8203;ら&#8203;デー&#8203;タ&#8203;の&#8203;件&#8203;数&#8203;と&#8203;デー&#8203;タ&#8203;の&#8203;範&#8203;囲&#8203;が&#8203;わ&#8203;かっ&#8203;た&#8203;の&#8203;で、&#8203;よ&#8203;り&#8203;具&#8203;体&#8203;的&#8203;な&#8203;値&#8203;を&#8203;把&#8203;握&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;先&#8203;頭&#8203;の&#8203;1&#8203;レ&#8203;コー&#8203;ド&#8203;を&#8203;出&#8203;力&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># データの開始日と内容を確認</span>
df_tdnet.head(<span class="integer">1</span>).T</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/tdnet/tdnet01.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>デー&#8203;タ&#8203;の&#8203;最&#8203;終&#8203;行&#8203;を&#8203;表&#8203;示&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># データの最終日を確認</span>
df_tdnet.tail(<span class="integer">1</span>).T</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/tdnet/tdnet02.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>デー&#8203;タ&#8203;を&#8203;加&#8203;工&#8203;し&#8203;て&#8203;解&#8203;析&#8203;し&#8203;や&#8203;す&#8203;く&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 銘柄コードを4桁に変更</span>
df_tdnet.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_code</span><span class="delimiter">&quot;</span></span>] = df_tdnet.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>].astype(<span class="predefined">str</span>).str[:<span class="integer">4</span>].astype(<span class="predefined">int</span>)
<span class="comment"># 投資対象銘柄に絞り込み</span>
filter_universe = df_tdnet.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_code</span><span class="delimiter">&quot;</span></span>].isin(stock_codes)
<span class="comment"># 月曜日を開始日として、投資対象銘柄の週次の件数を取得</span>
df_tdnet_weekly_count = df_tdnet.loc[filter_universe].resample(<span class="string"><span class="delimiter">&quot;</span><span class="content">W-MON</span><span class="delimiter">&quot;</span></span>, label=<span class="string"><span class="delimiter">&quot;</span><span class="content">left</span><span class="delimiter">&quot;</span></span>, closed=<span class="string"><span class="delimiter">&quot;</span><span class="content">left</span><span class="delimiter">&quot;</span></span>)[[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>]].count()
<span class="comment"># 集計内容を確認</span>
df_tdnet_weekly_count.head(<span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/tdnet/tdnet03.png" alt="処理結果" width="30%">
</div>
</div>
<div class="paragraph">
<p>週&#8203;毎&#8203;の&#8203;開&#8203;示&#8203;件&#8203;数&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># プロット</span>
ax = df_tdnet_weekly_count.plot(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))
<span class="comment"># グリッド設定</span>
ax.grid(<span class="predefined-constant">True</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/tdnet/tdnet04.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>開&#8203;示&#8203;件&#8203;数&#8203;に&#8203;は&#8203;波&#8203;が&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>週&#8203;毎&#8203;の&#8203;開&#8203;示&#8203;件&#8203;数&#8203;の&#8203;分&#8203;布&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment">#  資対象銘柄の週次件数の分布を確認</span>
df_tdnet_weekly_count.hist(figsize=(<span class="integer">10</span>, <span class="integer">10</span>))</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/tdnet/tdnet05.png" alt="処理結果" width="50%">
</div>
</div>
<div class="paragraph">
<p>開&#8203;示&#8203;情&#8203;報&#8203;の&#8203;公&#8203;開&#8203;項&#8203;目&#8203;コー&#8203;ド&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;確&#8203;認&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>ま&#8203;ず&#8203;は、&#8203;公&#8203;開&#8203;項&#8203;目&#8203;コー&#8203;ド&#8203;を&#8203;リ&#8203;ス&#8203;ト&#8203;と&#8203;し&#8203;て&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 投資対象銘柄のdisclosureItemsをリスト形式のシリーズとして取得</span>
s_disclosureItems = df_tdnet.loc[filter_universe, <span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>].apply(literal_eval)
<span class="comment"># データを確認</span>
s_disclosureItems[:<span class="integer">10</span>]</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/tdnet/tdnet06.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>次&#8203;に、&#8203;公&#8203;開&#8203;項&#8203;目&#8203;毎&#8203;の&#8203;件&#8203;数&#8203;を&#8203;集&#8203;計&#8203;し&#8203;た&#8203;あ&#8203;と&#8203;に、&#8203;公&#8203;開&#8203;項&#8203;目&#8203;コー&#8203;ド&#8203;と&#8203;日&#8203;本&#8203;語&#8203;名&#8203;を&#8203;結&#8203;合&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 投資対象銘柄のdisclosureItems別の件数を取得</span>
s_disclosureitems_count = pd.Series(Counter(chain.from_iterable(s_disclosureItems)))
<span class="comment"># カラム名を設定</span>
s_disclosureitems_count.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems_count</span><span class="delimiter">&quot;</span></span>
<span class="comment"># 公開項目コードをint型に変更</span>
s_disclosureitems_count.index = s_disclosureitems_count.index.astype(<span class="predefined">int</span>)
<span class="comment"># 項目の日本語名を表示するために適時開示資料の公開項目コードと結合</span>
df_disclosureitems_with_label = pd.merge(s_disclosureitems_count, df_disclosureitems, left_index=<span class="predefined-constant">True</span>, right_on=[<span class="string"><span class="delimiter">&quot;</span><span class="content">公開項目コード</span><span class="delimiter">&quot;</span></span>])
<span class="comment"># indexを設定</span>
df_disclosureitems_with_label.set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">コード値定義</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
<span class="comment"># 項目の日本語名を表示するために適時開示資料の公開項目コードと結合</span>
df_disclosureitems_with_label = pd.merge(s_disclosureitems_count, df_disclosureitems, left_index=<span class="predefined-constant">True</span>, right_on=[<span class="string"><span class="delimiter">&quot;</span><span class="content">公開項目コード</span><span class="delimiter">&quot;</span></span>])
<span class="comment"># indexを設定</span>
df_disclosureitems_with_label.set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">コード値定義</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>公&#8203;開&#8203;項&#8203;目&#8203;コー&#8203;ド&#8203;毎&#8203;の&#8203;開&#8203;示&#8203;情&#8203;報&#8203;件&#8203;数&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 投資対象銘柄のdisclosureItems別の件数を多い順に並び替え</span>
df_count_by_disclosureitems_with_label = df_disclosureitems_with_label.loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems_count</span><span class="delimiter">&quot;</span></span>]].sort_values(<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems_count</span><span class="delimiter">&quot;</span></span>, ascending=<span class="predefined-constant">False</span>).reset_index(drop=<span class="predefined-constant">True</span>)
<span class="comment"># 投資対象銘柄全体におけるdisclosureItems別の件数の割合を算出</span>
df_count_by_disclosureitems_with_label.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">percentage</span><span class="delimiter">&quot;</span></span>] = (df_count_by_disclosureitems_with_label[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems_count</span><span class="delimiter">&quot;</span></span>] / df_count_by_disclosureitems_with_label[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems_count</span><span class="delimiter">&quot;</span></span>].sum()) * <span class="integer">100</span>
<span class="comment"># 件数割合の累積を計算</span>
df_count_by_disclosureitems_with_label.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">cumulative_percentage</span><span class="delimiter">&quot;</span></span>] = df_count_by_disclosureitems_with_label[<span class="string"><span class="delimiter">&quot;</span><span class="content">percentage</span><span class="delimiter">&quot;</span></span>].cumsum()
<span class="comment"># プロット (全て)</span>
ax = df_count_by_disclosureitems_with_label[[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems_count</span><span class="delimiter">&quot;</span></span>]].plot(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))
<span class="comment">#  グリッド設定</span>
ax.grid(<span class="predefined-constant">True</span>)
<span class="comment"># 凡例を左上に表示</span>
ax.legend(loc=<span class="string"><span class="delimiter">&quot;</span><span class="content">upper left</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># 2つ目のy軸を作成</span>
ax2 = ax.twinx()
<span class="comment"># 開示件数割合の累積をプロット</span>
df_count_by_disclosureitems_with_label[[<span class="string"><span class="delimiter">&quot;</span><span class="content">cumulative_percentage</span><span class="delimiter">&quot;</span></span>]].reset_index(drop=<span class="predefined-constant">True</span>).plot(ax=ax2, color=<span class="string"><span class="delimiter">&quot;</span><span class="content">orange</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># 凡例を右上に表示</span>
ax2.legend(loc=<span class="string"><span class="delimiter">&quot;</span><span class="content">upper right</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/tdnet/tdnet07.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>件&#8203;数&#8203;の&#8203;多&#8203;い&#8203;上&#8203;位&#8203;50&#8203;項&#8203;目&#8203;を&#8203;公&#8203;開&#8203;項&#8203;目&#8203;名&#8203;を&#8203;X&#8203;軸&#8203;に&#8203;し&#8203;て&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 投資対象銘柄のdisclosureItems別に件数を多い順にプロット (上位50項目)</span>
ax = df_disclosureitems_with_label.loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems_count</span><span class="delimiter">&quot;</span></span>]].sort_values(<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems_count</span><span class="delimiter">&quot;</span></span>, ascending=<span class="predefined-constant">False</span>).head(<span class="integer">50</span>).plot(kind=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, figsize=(<span class="integer">20</span>, <span class="integer">8</span>))
<span class="comment">#  グリッド設定</span>
ax.grid(<span class="predefined-constant">True</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/tdnet/tdnet08.png" alt="処理結果" width="100%">
</div>
</div>
<div class="paragraph">
<p>銘&#8203;柄&#8203;毎&#8203;に&#8203;開&#8203;示&#8203;情&#8203;報&#8203;の&#8203;件&#8203;数&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 投資対象銘柄別に開示件数を集計して、開示件数の多い順に並び替え</span>
df_tdnet_count_by_stock_code = df_tdnet.loc[filter_universe].groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_code</span><span class="delimiter">&quot;</span></span>)[[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>]].count().sort_values(<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>, ascending=<span class="predefined-constant">False</span>)
<span class="comment"># 投資対象銘柄全体における開示件数の割合を集計</span>
df_tdnet_count_by_stock_code.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">percentage</span><span class="delimiter">&quot;</span></span>] = (df_tdnet_count_by_stock_code[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>] / df_tdnet_count_by_stock_code[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>].sum()) * <span class="integer">100</span>
<span class="comment"># 開示件数割合の累積を計算</span>
df_tdnet_count_by_stock_code.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">cumulative_percentage</span><span class="delimiter">&quot;</span></span>] = df_tdnet_count_by_stock_code[<span class="string"><span class="delimiter">&quot;</span><span class="content">percentage</span><span class="delimiter">&quot;</span></span>].cumsum()
<span class="comment"># 投資対象銘柄別に開示件数を多い順にプロット</span>
ax = df_tdnet_count_by_stock_code[[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>]].reset_index(drop=<span class="predefined-constant">True</span>).plot(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))
<span class="comment"># グリッド設定</span>
ax.grid(<span class="predefined-constant">True</span>)
<span class="comment"># 凡例を左上に表示</span>
ax.legend(loc=<span class="string"><span class="delimiter">&quot;</span><span class="content">upper left</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># 2つ目のy軸を作成</span>
ax2 = ax.twinx()
<span class="comment"># 開示件数割合の累積をプロット</span>
df_tdnet_count_by_stock_code[[<span class="string"><span class="delimiter">&quot;</span><span class="content">cumulative_percentage</span><span class="delimiter">&quot;</span></span>]].reset_index(drop=<span class="predefined-constant">True</span>).plot(ax=ax2, color=<span class="string"><span class="delimiter">&quot;</span><span class="content">orange</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># 凡例を右上に表示</span>
ax2.legend(loc=<span class="string"><span class="delimiter">&quot;</span><span class="content">upper right</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/tdnet/tdnet09.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>開&#8203;示&#8203;件&#8203;数&#8203;の&#8203;多&#8203;い&#8203;上&#8203;位&#8203;50&#8203;銘&#8203;柄&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 投資対象銘柄別に開示件数を多い順にプロット (上位50銘柄)</span>
ax = df_tdnet.loc[filter_universe].groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_code</span><span class="delimiter">&quot;</span></span>)[[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>]].count().sort_values(<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>, ascending=<span class="predefined-constant">False</span>).head(<span class="integer">50</span>).plot(kind=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, figsize=(<span class="integer">20</span>, <span class="integer">8</span>))
<span class="comment"># 　グリッド設定</span>
ax.grid(<span class="predefined-constant">True</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/tdnet/tdnet10.png" alt="処理結果" width="70%">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_適時開示資料の公開項目コード_disclosureitems">3.4.9. 適時開示資料の公開項目コード: disclosureItems</h4>
<div class="paragraph">
<p>　disclosureItems&#8203;は、&#8203;適&#8203;時&#8203;開&#8203;示&#8203;資&#8203;料&#8203;の&#8203;公&#8203;開&#8203;項&#8203;目&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;例&#8203;え&#8203;ば、&#8203;一&#8203;般&#8203;に&#8203;「自&#8203;己&#8203;株&#8203;式&#8203;の&#8203;取&#8203;得」&#8203;は&#8203;ポ&#8203;ジ&#8203;ティ&#8203;ブ&#8203;な&#8203;イ&#8203;ベ&#8203;ン&#8203;ト、&#8203;「災&#8203;害&#8203;に&#8203;起&#8203;因&#8203;す&#8203;る&#8203;損&#8203;害&#8203;又&#8203;は&#8203;業&#8203;務&#8203;遂&#8203;行&#8203;の&#8203;過&#8203;程&#8203;で&#8203;生&#8203;じ&#8203;た&#8203;損&#8203;害」&#8203;は&#8203;ネ&#8203;ガ&#8203;ティ&#8203;ブ&#8203;な&#8203;イ&#8203;ベ&#8203;ン&#8203;ト&#8203;と&#8203;し&#8203;て&#8203;認&#8203;識&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">分&#8203;類</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">分&#8203;類&#8203;番&#8203;号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">公&#8203;開&#8203;項&#8203;目&#8203;番&#8203;号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">公&#8203;開&#8203;項&#8203;目&#8203;番&#8203;号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">公&#8203;開&#8203;項&#8203;目&#8203;コー&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">公&#8203;開&#8203;項&#8203;目&#8203;コー&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11102</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">コー&#8203;ド&#8203;値&#8203;定&#8203;義</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">内&#8203;容&#8203;説&#8203;明</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">発&#8203;行&#8203;登&#8203;録&#8203;及&#8203;び&#8203;需&#8203;要&#8203;状&#8203;況&#8203;調&#8203;査&#8203;の&#8203;開&#8203;始</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ニュース記事ヘッドライン特徴量_headline_features_pkl">3.4.10. ニュース記事ヘッドライン特徴量: headline_features.pkl</h4>
<div class="paragraph">
<p>　headline_features.pkl&#8203;は、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;5&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;ヘッ&#8203;ド&#8203;ラ&#8203;イ&#8203;ン&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;pkl&#8203;化&#8203;し&#8203;た&#8203;ファ&#8203;イ&#8203;ル&#8203;で&#8203;す。&#8203;詳&#8203;細&#8203;は&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;5.8.4&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ニュース記事キーワード特徴量_keywords_features_pkl">3.4.11. ニュース記事キーワード特徴量: keywords_features.pkl</h4>
<div class="paragraph">
<p>　keywords_features.pkl&#8203;は、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;5&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;キー&#8203;ワー&#8203;ド&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;pkl&#8203;化&#8203;し&#8203;た&#8203;ファ&#8203;イ&#8203;ル&#8203;で&#8203;す。&#8203;詳&#8203;細&#8203;は&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;5.8.4&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ニュース記事ヘッドライン特徴量lstm_headline_features_zip">3.4.12. ニュース記事ヘッドライン特徴量（LSTM）: headline_features.zip</h4>
<div class="paragraph">
<p>　headline_features.zip&#8203;は、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;6&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;ヘッ&#8203;ド&#8203;ラ&#8203;イ&#8203;ン&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;及&#8203;び&#8203;sentiment score&#8203;を&#8203;pkl&#8203;化&#8203;し&#8203;た&#8203;ファ&#8203;イ&#8203;ル&#8203;で&#8203;す。&#8203;詳&#8203;細&#8203;は&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;6.2.9. &#8203;特&#8203;徴&#8203;量&#8203;合&#8203;成&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;学&#8203;習&#8203;及&#8203;び&#8203;特&#8203;徴&#8203;量&#8203;合&#8203;成&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ニュース記事キーワード特徴量lstm_keywords_features_zip">3.4.13. ニュース記事キーワード特徴量（LSTM）: keywords_features.zip</h4>
<div class="paragraph">
<p>　keywords_features.zip&#8203;は、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;6&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;キー&#8203;ワー&#8203;ド&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;及&#8203;び&#8203;sentiment score&#8203;を&#8203;pkl&#8203;化&#8203;し&#8203;た&#8203;ファ&#8203;イ&#8203;ル&#8203;で&#8203;す。&#8203;詳&#8203;細&#8203;は&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;6.2.9. &#8203;特&#8203;徴&#8203;量&#8203;合&#8203;成&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;学&#8203;習&#8203;及&#8203;び&#8203;特&#8203;徴&#8203;量&#8203;合&#8203;成&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
</div>
<div class="sect3">
<h4 id="_日付指定ファイル_purchase_date_csv">3.4.14. 日付指定ファイル: purchase_date.csv</h4>
<div class="paragraph">
<p>　&#8203;評&#8203;価&#8203;対&#8203;象&#8203;週&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;初&#8203;日&#8203;の&#8203;日&#8203;付&#8203;を&#8203;指&#8203;定&#8203;す&#8203;る&#8203;ファ&#8203;イ&#8203;ル&#8203;で&#8203;す。&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;で&#8203;は&#8203;こ&#8203;の&#8203;ファ&#8203;イ&#8203;ル&#8203;か&#8203;ら&#8203;日&#8203;付&#8203;を&#8203;取&#8203;得&#8203;し&#8203;て&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;際&#8203;に&#8203;株&#8203;価&#8203;デー&#8203;タ&#8203;な&#8203;ど&#8203;は&#8203;指&#8203;定&#8203;さ&#8203;れ&#8203;た&#8203;日&#8203;付&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;含&#8203;ん&#8203;で&#8203;い&#8203;な&#8203;い&#8203;点&#8203;に&#8203;注&#8203;意&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。&#8203;例&#8203;え&#8203;ば、&#8203;purchase_date&#8203;に&#8203; <code>2021/02/01</code> &#8203;が&#8203;指&#8203;定&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;場&#8203;合、&#8203;stock_price&#8203;デー&#8203;タ&#8203;の&#8203;最&#8203;も&#8203;日&#8203;付&#8203;の&#8203;新&#8203;し&#8203;い&#8203;デー&#8203;タ&#8203;は&#8203; <code>2021/01/29</code> &#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は&#8203;主&#8203;に&#8203;金&#8203;曜&#8203;日&#8203;の&#8203;日&#8203;付&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;予&#8203;測&#8203;を&#8203;出&#8203;力&#8203;し&#8203;た&#8203;後、&#8203;予&#8203;測&#8203;か&#8203;ら&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;組&#8203;成&#8203;す&#8203;る&#8203;際&#8203;に&#8203;対&#8203;象&#8203;日&#8203;付&#8203;が&#8203;翌&#8203;週&#8203;の&#8203;月&#8203;曜&#8203;日&#8203;と&#8203;な&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;調&#8203;整&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;変&#8203;数&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;型&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;例&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">purchase date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">評&#8203;価&#8203;対&#8203;象&#8203;週&#8203;の&#8203;初&#8203;日&#8203;の&#8203;日&#8203;付</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021/02/01</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_環境構築">3.5. 環境構築</h3>
<div class="sect3">
<h4 id="_実行環境の選択">3.5.1. 実行環境の選択</h4>
<div class="paragraph">
<p>　&#8203;環&#8203;境&#8203;構&#8203;築&#8203;方&#8203;法&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203; <a href="https://signate.jp/features/runtime/detail">SIGNATE: Runtime &#8203;投&#8203;稿&#8203;方&#8203;法&#8203;: &#8203;ロー&#8203;カ&#8203;ル&#8203;開&#8203;発&#8203;環&#8203;境&#8203;の&#8203;構&#8203;築&#8203;方&#8203;法&#8203;は？&#8203;</a> &#8203;に&#8203;も&#8203;説&#8203;明&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;の&#8203;特&#8203;色&#8203;を&#8203;考&#8203;慮&#8203;し、&#8203;実&#8203;行&#8203;環&#8203;境&#8203;の&#8203;選&#8203;択&#8203;方&#8203;法&#8203;を&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　3&#8203;章・&#8203;4&#8203;章&#8203;の&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は&#8203;Docker&#8203;と&#8203;Google Colaboratory&#8203;の&#8203;両&#8203;方&#8203;を&#8203;利&#8203;用&#8203;可&#8203;能&#8203;で&#8203;す。&#8203;特&#8203;に&#8203;Windows&#8203;環&#8203;境&#8203;を&#8203;ご&#8203;利&#8203;用&#8203;で&#8203;Docker&#8203;環&#8203;境&#8203;の&#8203;構&#8203;築&#8203;が&#8203;難&#8203;し&#8203;い&#8203;場&#8203;合&#8203;は、&#8203;ぜ&#8203;ひ&#8203;Google Colaboratory&#8203;を&#8203;ご&#8203;利&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;提&#8203;供&#8203;さ&#8203;れ&#8203;る&#8203;notebook&#8203;は&#8203;Google Colaboratory&#8203;で&#8203;も&#8203;動&#8203;作&#8203;可&#8203;能&#8203;と&#8203;なっ&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。&#8203;*&#8203;な&#8203;お、&#8203;Google Colaboratory&#8203;を&#8203;ご&#8203;利&#8203;用&#8203;に&#8203;な&#8203;る&#8203;場&#8203;合&#8203;に&#8203;は、&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;各&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;の&#8203;バー&#8203;ジョ&#8203;ン&#8203;を&#8203;指&#8203;定&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;ご&#8203;ざ&#8203;い&#8203;ま&#8203;す。&#8203;*</p>
</div>
<div class="listingblock">
<div class="content">
<pre>joblib==1.0.1
numpy==1.19.5
pandas==1.1.5
scikit-learn==0.20.3
scipy==1.2.1
seaborn==0.9.0</pre>
</div>
</div>
<div class="paragraph">
<p>　5&#8203;章・&#8203;6&#8203;章&#8203;で&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;る&#8203;notebook&#8203;を&#8203;最&#8203;後&#8203;ま&#8203;で&#8203;実&#8203;行&#8203;す&#8203;る&#8203;場&#8203;合、&#8203;ディー&#8203;プ&#8203;ニュー&#8203;ラ&#8203;ル&#8203;ネッ&#8203;ト&#8203;ワー&#8203;ク&#8203;の&#8203;学&#8203;習・&#8203;推&#8203;論&#8203;を&#8203;行&#8203;う&#8203;た&#8203;め、&#8203;*CPU&#8203;環&#8203;境&#8203;で&#8203;は&#8203;か&#8203;な&#8203;り&#8203;時&#8203;間&#8203;が&#8203;か&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;GPU&#8203;環&#8203;境&#8203;で&#8203;の&#8203;実&#8203;行&#8203;を&#8203;お&#8203;す&#8203;す&#8203;め&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。&#8203;* &#8203;な&#8203;お、&#8203;Google Colaboratory&#8203;で&#8203;は&#8203;GPU&#8203;環&#8203;境&#8203;が&#8203;ご&#8203;利&#8203;用&#8203;い&#8203;た&#8203;だ&#8203;け&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;GPU&#8203;環&#8203;境&#8203;を&#8203;お&#8203;持&#8203;ち&#8203;で&#8203;な&#8203;い&#8203;場&#8203;合&#8203;は&#8203;Google Colaboratory&#8203;を&#8203;ご&#8203;利&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
</div>
<div class="sect3">
<h4 id="anchor-3.5.2">3.5.2. Google Colaboratoryをご利用の場合</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;3&#8203;章、&#8203;4&#8203;章&#8203;の&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;を&#8203;Google Colaboratory&#8203;上&#8203;で&#8203;動&#8203;か&#8203;す&#8203;た&#8203;め&#8203;に&#8203;は、&#8203;ま&#8203;ず&#8203;以&#8203;下&#8203;の&#8203;手&#8203;順&#8203;で&#8203;Google Drive&#8203;上&#8203;に&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;設&#8203;置&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Google Drive&#8203;の&#8203;My Drive&#8203;に&#8203;<code>JPX_competition</code>&#8203;と&#8203;い&#8203;う&#8203;フォ&#8203;ル&#8203;ダー&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</li>
<li>
<p>1&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;<code>JPX_competition</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;に&#8203;デー&#8203;タ&#8203;を&#8203;保&#8203;存&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;<code>data_dir_comp2</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</li>
<li>
<p>1&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;<code>JPX_competition</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;に&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;用&#8203;コー&#8203;ド&#8203;を&#8203;保&#8203;存&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;<code>backtest</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</li>
<li>
<p><a href="https://signate.jp/competitions/443/data">SIGNATEのコンペティションサイト</a> &#8203;よ&#8203;り&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;た&#8203;各&#8203;種&#8203;デー&#8203;タ&#8203;を&#8203;2&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;<code>data_dir_comp2</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;に&#8203;アッ&#8203;プ&#8203;ロー&#8203;ド&#8203;し&#8203;ま&#8203;す。</p>
</li>
<li>
<p><code>backtest.py</code> &#8203;を&#8203; <a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial/tree/main/handson/Chapter03/backtest/backtest.py">こちら</a> &#8203;か&#8203;ら&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し、&#8203;3&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;<code>backtest</code>&#8203;フォ&#8203;ル&#8203;ダ&#8203;に&#8203;アッ&#8203;プ&#8203;ロー&#8203;ド&#8203;し&#8203;ま&#8203;す。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>　&#8203;次&#8203;に&#8203;Google Colaboratory&#8203;上&#8203;で&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;notebook&#8203;を&#8203;展&#8203;開&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;notebook&#8203;は&#8203;Google Colaboratory&#8203;上&#8203;で&#8203;も&#8203;実&#8203;行&#8203;可&#8203;能&#8203;と&#8203;なっ&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。&#8203;各&#8203;章&#8203;の&#8203;notebook&#8203;は&#8203;以&#8203;下&#8203;の&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;リ&#8203;ン&#8203;ク&#8203;先&#8203;を&#8203;開&#8203;き、&#8203;開&#8203;い&#8203;た&#8203;ペー&#8203;ジ&#8203;で&#8203;Raw&#8203;を&#8203;右&#8203;ク&#8203;リッ&#8203;ク&#8203;し、&#8203;「リ&#8203;ン&#8203;ク&#8203;先&#8203;を&#8203;名&#8203;前&#8203;を&#8203;つ&#8203;け&#8203;て&#8203;保&#8203;存」&#8203;を&#8203;選&#8203;択&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;可&#8203;能&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial/blob/main/handson/Chapter03/20210224_chapter03_tutorial.ipynb">3章のnotebook</a><br>
<a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial/blob/main/handson/Chapter04/20210224_chapter04_tutorial.ipynb">4章のnotebook</a></p>
</div>
<div class="paragraph">
<p>以&#8203;下、&#8203;3&#8203;章&#8203;を&#8203;例&#8203;に&#8203;Google Colaboratory&#8203;で&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;noteboook&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;方&#8203;法&#8203;を&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Google Drive &#8203;の&#8203; My Drive &#8203;内&#8203;に&#8203;作&#8203;成&#8203;し&#8203;た&#8203;<code>JPX_competition</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;に&#8203;3&#8203;章&#8203;用&#8203;の&#8203;notebook&#8203;を&#8203;保&#8203;存&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;<code>Chapter03</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</li>
<li>
<p>上&#8203;記&#8203;の&#8203;リ&#8203;ン&#8203;ク&#8203;先&#8203;か&#8203;ら&#8203;3&#8203;章&#8203;の&#8203;notebook&#8203;を&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;て、&#8203;先&#8203;程&#8203;作&#8203;成&#8203;し&#8203;た&#8203;<code>Chapter03</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;に&#8203;<code>20210224_chapter03_tutorial.ipynb</code>&#8203;と&#8203;い&#8203;う&#8203;ファ&#8203;イ&#8203;ル&#8203;名&#8203;で&#8203;保&#8203;存&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</li>
<li>
<p>Google Drive&#8203;に&#8203;アッ&#8203;プ&#8203;ロー&#8203;ド&#8203;し&#8203;た&#8203; <code>20210224_chapter03_tutorial.ipynb</code> &#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;ダ&#8203;ブ&#8203;ル&#8203;ク&#8203;リッ&#8203;ク&#8203;し&#8203;て&#8203; Google Colaboratory &#8203;で&#8203;開&#8203;き&#8203;ま&#8203;す。</p>
</li>
<li>
<p>Google Colaboratory&#8203;の&#8203;環&#8203;境&#8203;で&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;を&#8203;実&#8203;行&#8203;す&#8203;る&#8203;場&#8203;合、&#8203;最&#8203;初&#8203;に&#8203;以&#8203;下&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;実&#8203;行&#8203;し&#8203;て&#8203; Google Colaboratory &#8203;上&#8203;の&#8203; notebook &#8203;か&#8203;ら&#8203; Google Drive &#8203;に&#8203;ア&#8203;ク&#8203;セ&#8203;ス&#8203;で&#8203;き&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># Google Colab環境ではGoogle Driveをマウントしてアクセスできるようにします。</span>
<span class="keyword">import</span> <span class="include">sys</span>

<span class="keyword">if</span> <span class="string"><span class="delimiter">'</span><span class="content">google.colab</span><span class="delimiter">'</span></span> <span class="keyword">in</span> sys.modules:
    <span class="comment"># Google Drive をマウントします</span>
    <span class="keyword">from</span> <span class="include">google.colab</span> <span class="keyword">import</span> <span class="include">drive</span>
    mount_dir = <span class="string"><span class="delimiter">&quot;</span><span class="content">/content/drive</span><span class="delimiter">&quot;</span></span>
    drive.mount(mount_dir)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;の&#8203;作&#8203;業&#8203;を&#8203;実&#8203;施&#8203;し&#8203;た&#8203;結&#8203;果、&#8203;Google Drive&#8203;の&#8203;<code>JPX_competition</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;は&#8203;以&#8203;下&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/content/drive/MyDrive/JPX_competition/
├── Chapter03
│   ├── 20210224_chapter03_tutorial.ipynb
│   └── backtest
│       └── backtest.py
└── data_dir_comp2
    ├── article.csv.gz
    ├── disclosureItems.csv.gz
    ├── industry2.csv.gz
    ├── industry.csv.gz
    ├── nikkei_article.csv.gz
    ├── region.csv.gz
    ├── stock_fin.csv.gz
    ├── stock_fin_price.csv.gz
    ├── stock_labels.csv.gz
    ├── stock_list.csv.gz
    ├── stock_price.csv.gz
    ├── tdnet.csv.gz
    └── theme.csv.gz</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dockerをご利用の場合">3.5.3. Dockerをご利用の場合</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;リ&#8203;ポ&#8203;ジ&#8203;ト&#8203;リ&#8203;を&#8203; <code>git clone</code> &#8203;し&#8203;た&#8203;後、&#8203;以&#8203;下&#8203;の&#8203;手&#8203;順&#8203;を&#8203;実&#8203;行&#8203;し&#8203;て&#8203;い&#8203;た&#8203;だ&#8203;く&#8203;こ&#8203;と&#8203;で、&#8203;Docker&#8203;コ&#8203;ン&#8203;テ&#8203;ナ&#8203;内&#8203;で&#8203;jupyter notebook&#8203;を&#8203;動&#8203;か&#8203;す&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;リ&#8203;ポ&#8203;ジ&#8203;ト&#8203;リ&#8203;内&#8203;の&#8203; <code>Chapter03</code> &#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;に&#8203;は、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;記&#8203;載&#8203;し&#8203;た&#8203; ipynb(<code>20210224_chapter03_tutorial.ipynb</code>) &#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;配&#8203;置&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で&#8203;必&#8203;要&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;ご&#8203;活&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>　Windows&#8203;環&#8203;境&#8203;の&#8203;場&#8203;合、&#8203;コ&#8203;マ&#8203;ン&#8203;ド&#8203;実&#8203;行&#8203;に&#8203;は&#8203;「PowerShell」&#8203;な&#8203;ど&#8203;を&#8203;ご&#8203;使&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;な&#8203;お、&#8203;PowerShell&#8203;の&#8203;利&#8203;用&#8203;に&#8203;当&#8203;たっ&#8203;て&#8203;は、&#8203;最&#8203;新&#8203;の&#8203;セ&#8203;キュ&#8203;リ&#8203;ティ&#8203;事&#8203;情&#8203;を&#8203;踏&#8203;ま&#8203;え&#8203;ご&#8203;自&#8203;身&#8203;で&#8203;ご&#8203;判&#8203;断&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;Docker&#8203;の&#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;<a href="http://docs.docker.jp/get-docker.html">こちら</a>&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;Docker&#8203;の&#8203;制&#8203;約&#8203;と&#8203;し&#8203;て&#8203;マ&#8203;ウ&#8203;ン&#8203;ト&#8203;す&#8203;る&#8203;パ&#8203;ス&#8203;に&#8203;は&#8203;ア&#8203;ル&#8203;ファ&#8203;ベッ&#8203;ト、&#8203;数&#8203;字、&#8203;「_」、&#8203;「.」、&#8203;「-」&#8203;以&#8203;外&#8203;の&#8203;文&#8203;字&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;と&#8203;エ&#8203;ラー&#8203;と&#8203;な&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;パ&#8203;ス&#8203;が&#8203;前&#8203;述&#8203;の&#8203;文&#8203;字&#8203;の&#8203;み&#8203;で&#8203;構&#8203;成&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;ご&#8203;使&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;<br>
　&#8203;な&#8203;お、&#8203;Windows 10 Home&#8203;を&#8203;ご&#8203;利&#8203;用&#8203;の&#8203;場&#8203;合、&#8203;Docker&#8203;の&#8203;利&#8203;用&#8203;に&#8203;制&#8203;限&#8203;が&#8203;あ&#8203;る&#8203;場&#8203;合&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;Docker&#8203;に&#8203;習&#8203;熟&#8203;し&#8203;た&#8203;方&#8203;以&#8203;外&#8203;は&#8203;Google Colaboratory&#8203;の&#8203;利&#8203;用&#8203;を&#8203;推&#8203;奨&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd handson/

# 実行するコンテナはsignateユーザーで実行されるため、マウントした領域に書き込めるようにパーミッションを変更します。
chmod -R 777 .

# データ配置先のディレクトリを作成
mkdir data_dir_comp2
# その後作成したhandson/data_dir_comp2に、コンペティションサイトよりデータをダウンロードし配置します。

# Dockerでjupyter notebookを起動します。(初回実行時は約10GBのコンテナイメージをダウンロードします。)
# jupyter notebook作業用に handson ディレクトリを /notebook としてマウントしています。
# jupyter notebook は port 8888でtokenとpasswordを空にして、vscode のjupyter pluginからアクセスできるように xsrf 対策を無効化しています。
docker run --name tutorial --shm-size=2G -v ${PWD}:/notebook -p8888:8888 --rm -it signate/runtime-jpx:2021.03 jupyter notebook --ip 0.0.0.0 --allow-root --no-browser --no-mathjax --NotebookApp.disable_check_xsrf=True  --NotebookApp.token='' --NotebookApp.password='' /notebook

# ブラウザで以下のURLにアクセスしてjupyter notebookの画面が表示されていて、本チュートリアル用のnotebookが表示されていることを確認します。
http://localhost:8888/</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="anchor-3.6">3.6. バックテスト環境の構築</h3>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;用&#8203;の&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;環&#8203;境&#8203;を&#8203;構&#8203;築&#8203;し&#8203;ま&#8203;す。&#8203;金&#8203;融&#8203;の&#8203;世&#8203;界&#8203;で&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;と&#8203;は&#8203;一&#8203;般&#8203;に&#8203;価&#8203;格&#8203;時&#8203;系&#8203;列&#8203;デー&#8203;タ&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;取&#8203;引&#8203;を&#8203;シ&#8203;ミュ&#8203;レー&#8203;ショ&#8203;ン&#8203;し&#8203;取&#8203;引&#8203;ルー&#8203;ル&#8203;や&#8203;ア&#8203;ル&#8203;ゴ&#8203;リ&#8203;ズ&#8203;ム&#8203;な&#8203;ど&#8203;を&#8203;評&#8203;価&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;言&#8203;い&#8203;ま&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;課&#8203;題&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;よ&#8203;り&#8203;予&#8203;測&#8203;さ&#8203;れ&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;を&#8203;競&#8203;う&#8203;課&#8203;題&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;実&#8203;際&#8203;に&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;と&#8203;し&#8203;て&#8203;運&#8203;用&#8203;し&#8203;た&#8203;際&#8203;の&#8203;期&#8203;待&#8203;収&#8203;益&#8203;性&#8203;等&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;確&#8203;認・&#8203;評&#8203;価&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;重&#8203;要&#8203;で&#8203;す。&#8203;ま&#8203;た、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;評&#8203;価&#8203;に&#8203;お&#8203;い&#8203;て&#8203;も&#8203;使&#8203;用&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。&#8203;実&#8203;際&#8203;の&#8203;評&#8203;価&#8203;の&#8203;具&#8203;体&#8203;的&#8203;な&#8203;流&#8203;れ&#8203;は、&#8203;<a href="#anchor-3.3.5">3.3.5. &#8203;評&#8203;価&#8203;方&#8203;法&#8203;</a>&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;最&#8203;初&#8203;に&#8203;必&#8203;要&#8203;な&#8203;こ&#8203;と&#8203;は&#8203;要&#8203;件&#8203;を&#8203;適&#8203;切&#8203;に&#8203;把&#8203;握&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;す。&#8203;例&#8203;え&#8203;ば、&#8203;投&#8203;資&#8203;対&#8203;象&#8203;と&#8203;な&#8203;る&#8203;銘&#8203;柄&#8203;群&#8203; (&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;と&#8203;も&#8203;言&#8203;い&#8203;ま&#8203;す&#8203;)、&#8203;取&#8203;引&#8203;の&#8203;時&#8203;間&#8203;間&#8203;隔&#8203; (&#8203;数&#8203;分、&#8203;数&#8203;時&#8203;間、&#8203;数&#8203;日&#8203;)、&#8203;投&#8203;資&#8203;予&#8203;算&#8203;の&#8203;上&#8203;限、&#8203;同&#8203;時&#8203;に&#8203;保&#8203;有&#8203;可&#8203;能&#8203;な&#8203;銘&#8203;柄&#8203;数、&#8203;1&#8203;銘&#8203;柄&#8203;に&#8203;投&#8203;資&#8203;可&#8203;能&#8203;な&#8203;上&#8203;限&#8203;等&#8203;で&#8203;す。&#8203;こ&#8203;れ&#8203;ら&#8203;を&#8203;把&#8203;握&#8203;し&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;装&#8203;し&#8203;て&#8203;い&#8203;く&#8203;こ&#8203;と&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;要&#8203;件&#8203;を&#8203;把&#8203;握&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;る&#8203;際&#8203;に&#8203;も&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;要&#8203;件&#8203;や&#8203;評&#8203;価&#8203;方&#8203;法&#8203;を&#8203;把&#8203;握&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;も&#8203;つ&#8203;な&#8203;が&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;評&#8203;価&#8203;を&#8203;公&#8203;正&#8203;に&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;評&#8203;価&#8203;に&#8203;用&#8203;い&#8203;る&#8203;も&#8203;の&#8203;と&#8203;全&#8203;く&#8203;同&#8203;じ&#8203;ロ&#8203;ジッ&#8203;ク&#8203;が&#8203;実&#8203;装&#8203;さ&#8203;れ&#8203;た&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;用&#8203;の&#8203;コー&#8203;ド&#8203; <code>backtest.py</code> &#8203;を&#8203;公&#8203;開&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;ファ&#8203;イ&#8203;ル&#8203;は、&#8203;<a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial/tree/main/handson/Chapter03/backtest/backtest.py">こちら</a>&#8203;か&#8203;ら&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>　&#8203;な&#8203;お、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;ス&#8203;ク&#8203;ラッ&#8203;チ&#8203;で&#8203;実&#8203;装&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;ア&#8203;ル&#8203;ゴ&#8203;リ&#8203;ズ&#8203;ム&#8203;ト&#8203;レー&#8203;ディ&#8203;ン&#8203;グ&#8203;用&#8203;の&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;も&#8203;存&#8203;在&#8203;し&#8203;ま&#8203;す。&#8203;有&#8203;名&#8203;な&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;を&#8203;tips&#8203;集&#8203;の&#8203;「バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;用&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ」&#8203;で&#8203;ご&#8203;紹&#8203;介&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;の&#8203;で&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="sect3">
<h4 id="_必要なデータ">3.6.1. 必要なデータ</h4>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;実&#8203;行&#8203;に&#8203;は&#8203;以&#8203;下&#8203;の&#8203;デー&#8203;タ&#8203;が&#8203;必&#8203;要&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;: &#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;対&#8203;象&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;デー&#8203;タ&#8203;で&#8203;す。&#8203;（モ&#8203;デ&#8203;ル&#8203;に&#8203;よ&#8203;り&#8203;予&#8203;測&#8203;さ&#8203;れ&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ）</p>
</li>
<li>
<p>stock_price: &#8203;株&#8203;価&#8203;情&#8203;報&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;算&#8203;出&#8203;し&#8203;ま&#8203;す。&#8203;（stock_price.csv.gz）</p>
</li>
<li>
<p>stock_list: &#8203;銘&#8203;柄&#8203;リ&#8203;ス&#8203;ト&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;予&#8203;測&#8203;対&#8203;象&#8203;銘&#8203;柄&#8203;の&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。&#8203;（stock_list.csv.gz）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>　&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;は、&#8203;<a href="#anchor-3.3.4">3.3.4. &#8203;提&#8203;出&#8203;す&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;予&#8203;測&#8203;出&#8203;力&#8203;の&#8203;定&#8203;義&#8203;</a>&#8203;に&#8203;記&#8203;載&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;フォー&#8203;マッ&#8203;ト&#8203;の&#8203;csv&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使い方">3.6.2. 使い方</h4>
<div class="paragraph">
<p>　Backtest&#8203;モ&#8203;ジュー&#8203;ル&#8203;を&#8203;イ&#8203;ン&#8203;ポー&#8203;ト&#8203;し&#8203;ま&#8203;す。&#8203;パ&#8203;ス&#8203;が&#8203;通っ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;場&#8203;合&#8203;は&#8203;必&#8203;要&#8203;に&#8203;応&#8203;じ&#8203;て、&#8203;sys.path&#8203;に&#8203;Backtest&#8203;モ&#8203;ジュー&#8203;ル&#8203;を&#8203;配&#8203;置&#8203;し&#8203;て&#8203;い&#8203;る&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;追&#8203;加&#8203;し&#8203;て&#8203;か&#8203;ら&#8203;import&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 以下はパスを通すためのコードになりますので、必要に応じてアンコメントして実行してください。</span>
<span class="comment"># import sys</span>
<span class="comment"># module_dir = &quot;Backtestモジュールを配置したディレクトリへのフルパス&quot;</span>
<span class="comment"># sys.path.append(module_dir)</span>

<span class="keyword">from</span> <span class="include">backtest</span> <span class="keyword">import</span> <span class="include">Backtest</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;行&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;事&#8203;前&#8203;準&#8203;備&#8203;と&#8203;し&#8203;て、&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;に&#8203;必&#8203;要&#8203;な&#8203;デー&#8203;タ&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">data_dir = <span class="string"><span class="delimiter">&quot;</span><span class="content">/notebook/data_dir_comp2</span><span class="delimiter">&quot;</span></span>  <span class="comment"># &quot;左記パスは例です。各自データを配置してるディレクトリへのパスへ変更してください&quot;</span>

<span class="comment"># バックテストに必要なデータを取得します。</span>
backtest_codes, backtest_price = Backtest.prepare_data(data_dir)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;行&#8203;し&#8203;た&#8203;い&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;デー&#8203;タ&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">portofolio_file_path = <span class="string"><span class="delimiter">&quot;</span><span class="content">SUBMIT.csv</span><span class="delimiter">&quot;</span></span>  <span class="comment"># 左記パスは例です。各自モデルにより予測されたポートフォリオデータが格納されているパスへ変更してください。</span>
df_submit = Backtest.load_submit(portofolio_file_path)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;行&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">df_results, df_stocks = Backtest.run(df_submit, backtest_codes, backtest_price)</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_backtest_runメソッドの説明">「Backtest.run」メソッドの説明</h5>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;実&#8203;行&#8203;用&#8203;メ&#8203;ソッ&#8203;ド&#8203;で&#8203;あ&#8203;る&#8203; Backtest.run() &#8203;へ&#8203;の&#8203;入&#8203;力&#8203;デー&#8203;タ&#8203;は&#8203;以&#8203;下&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>第一引数: ポートフォリオ (DataFrame)
第二引数: ユニバース (銘柄コード) (List)
第三引数: 株価情報 (DataFrame)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;返&#8203;り&#8203;値&#8203;は&#8203;以&#8203;下&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>df_results: バックテスト結果のサマリー (DataFrame)
df_stocks: 個別銘柄の購入数や日々の価格情報 (DataFrame)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_結果の見方">3.6.3. 結果の見方</h4>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;行&#8203;す&#8203;る&#8203;と&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;結&#8203;果&#8203;の&#8203;サ&#8203;マ&#8203;リー&#8203;が&#8203;格&#8203;納&#8203;さ&#8203;れ&#8203;た&#8203; <code>df_results</code> &#8203;と、&#8203;購&#8203;入&#8203;数&#8203;お&#8203;よ&#8203;び&#8203;日々&#8203;の&#8203;価&#8203;格&#8203;情&#8203;報&#8203;が&#8203;格&#8203;納&#8203;さ&#8203;れ&#8203;た&#8203; <code>df_stocks</code> &#8203;の&#8203;2&#8203;つ&#8203;の&#8203;DataFrame&#8203;が&#8203;返&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;DataFrame&#8203;の&#8203;項&#8203;目&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>　<code>df_results</code> &#8203;の&#8203;項&#8203;目&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>bought: 購入金額
cash: 現金
date: 対象週の開始日
day_1: ポートフォリオの月曜日終値での基準価格 (現金含む)
day_2: ポートフォリオの火曜日終値での基準価格 (現金含む)
day_3: ポートフォリオの水曜日終値での基準価格 (現金含む)
day_4: ポートフォリオの木曜日終値での基準価格 (現金含む)
day_5: ポートフォリオの金曜日終値での基準価格 (現金含む)
day_1_return: 月曜日のリターン (%)
day_2_return: 火曜日のリターン (%)
day_3_return: 水曜日のリターン (%)
day_4_return: 木曜日のリターン (%)
day_5_return: 金曜日のリターン (%)
day_1_pl: 月曜日の損益
day_2_pl: 火曜日の損益
day_3_pl: 水曜日の損益
day_4_pl: 木曜日の損益
day_5_pl: 金曜日の損益
exp: 日次リターンの平均
holiday: 祝日の曜日 (0: 月曜日, 4: 金曜日)
sharp: 日次リターンのシャープレシオ
std: 日次リターンの標準偏差
week_pl: 週の損益
week_return: 週のリターン</code></pre>
</div>
</div>
<div class="paragraph">
<p>　<code>df_stocks</code> &#8203;の&#8203;項&#8203;目&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>actual: 実際に購入した数量
date: 基準日付 (月曜日日付)
Local Code: 銘柄コード
budget: 指定した購入金額
n: 購入順
entry: 週の始値
day_1: 月曜日の終値
day_2: 火曜日の終値
day_3: 水曜日の終値
day_4: 木曜日の終値
day_5: 金曜日の終値
bought: 購入金額
actual: 購入株数</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="anchor-3.6.4">3.6.4. バックテストの評価軸と取引戦略</h4>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;行&#8203;す&#8203;る&#8203;と&#8203;ト&#8203;レー&#8203;ド&#8203;の&#8203;履&#8203;歴&#8203;を&#8203;得&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;そ&#8203;れ&#8203;ら&#8203;の&#8203;ト&#8203;レー&#8203;ド&#8203;履&#8203;歴&#8203;を&#8203;分&#8203;析&#8203;し&#8203;て&#8203;評&#8203;価&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;しょ&#8203;う。&#8203;ト&#8203;レー&#8203;ド&#8203;の&#8203;代&#8203;表&#8203;的&#8203;な&#8203;評&#8203;価&#8203;軸&#8203;と&#8203;し&#8203;て&#8203;は、&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;も&#8203;の&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">評&#8203;価&#8203;軸</th>
<th class="tableblock halign-left valign-top">説&#8203;明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">勝&#8203;率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ト&#8203;レー&#8203;ド&#8203;が&#8203;ど&#8203;の&#8203;程&#8203;度&#8203;勝&#8203;つ&#8203;か&#8203;を&#8203;示&#8203;す&#8203;指&#8203;標&#8203;で&#8203;す。&#8203;勝&#8203;ち&#8203;ト&#8203;レー&#8203;ド&#8203;数&#8203; (&#8203;利&#8203;益&#8203;が&#8203;0&#8203;を&#8203;超&#8203;え&#8203;る&#8203;ト&#8203;レー&#8203;ド&#8203;数&#8203;) &#8203;を&#8203;総&#8203;ト&#8203;レー&#8203;ド&#8203;数&#8203;で&#8203;割&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;算&#8203;出&#8203;し&#8203;ま&#8203;す。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">平&#8203;均&#8203;リ&#8203;ター&#8203;ン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ト&#8203;レー&#8203;ド&#8203;1&#8203;回&#8203;あ&#8203;た&#8203;り&#8203;の&#8203;平&#8203;均&#8203;の&#8203;利&#8203;益&#8203;率&#8203;を&#8203;示&#8203;し&#8203;ま&#8203;す。&#8203;合&#8203;計&#8203;損&#8203;益&#8203;を&#8203;総&#8203;ト&#8203;レー&#8203;ド&#8203;数&#8203;で&#8203;割&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;算&#8203;出&#8203;し&#8203;ま&#8203;す。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">最&#8203;大&#8203;ド&#8203;ロー&#8203;ダ&#8203;ウ&#8203;ン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">累&#8203;積&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;最&#8203;大&#8203;地&#8203;点&#8203;か&#8203;ら&#8203;の&#8203;下&#8203;落&#8203;率&#8203;の&#8203;こ&#8203;と&#8203;で&#8203;す。&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;の&#8203;リ&#8203;ス&#8203;ク&#8203;を&#8203;知&#8203;る&#8203;上&#8203;で&#8203;重&#8203;要&#8203;な&#8203;指&#8203;標&#8203;で&#8203;す。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ベー&#8203;タ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;と&#8203;な&#8203;る&#8203;指&#8203;数&#8203;や&#8203;取&#8203;引&#8203;対&#8203;象&#8203;の&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;に&#8203;対&#8203;す&#8203;る&#8203;合&#8203;計&#8203;収&#8203;益&#8203;の&#8203;連&#8203;動&#8203;率&#8203;で&#8203;す。&#8203;た&#8203;と&#8203;え&#8203;ば、&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;と&#8203;な&#8203;る&#8203;指&#8203;数&#8203;が&#8203;10%&#8203;上&#8203;昇&#8203;し&#8203;た&#8203;と&#8203;き&#8203;に&#8203;11%&#8203;上&#8203;昇&#8203;し&#8203;た&#8203;ら&#8203;ベー&#8203;タ&#8203;は&#8203;1.1&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ペ&#8203;イ&#8203;オ&#8203;フ&#8203;レ&#8203;シ&#8203;オ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ト&#8203;レー&#8203;ド&#8203;1&#8203;回&#8203;あ&#8203;た&#8203;り&#8203;の&#8203;損&#8203;益&#8203;率&#8203;を&#8203;示&#8203;し&#8203;ま&#8203;す。&#8203;ト&#8203;レー&#8203;ド&#8203;の&#8203;平&#8203;均&#8203;利&#8203;益&#8203;を&#8203;平&#8203;均&#8203;損&#8203;失&#8203;で&#8203;割&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;算&#8203;出&#8203;し&#8203;ま&#8203;す。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">シャー&#8203;プ&#8203;レ&#8203;シ&#8203;オ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">リ&#8203;ス&#8203;ク&#8203;に&#8203;応&#8203;じ&#8203;た&#8203;利&#8203;益&#8203;を&#8203;得&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;示&#8203;し&#8203;ま&#8203;す。&#8203;リ&#8203;ター&#8203;ン&#8203;か&#8203;ら&#8203;安&#8203;全&#8203;資&#8203;産&#8203;利&#8203;回&#8203;り&#8203;を&#8203;引&#8203;い&#8203;て&#8203;そ&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;標&#8203;準&#8203;偏&#8203;差&#8203;で&#8203;割&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;算&#8203;出&#8203;し&#8203;ま&#8203;す。&#8203;週・&#8203;月・&#8203;年&#8203;な&#8203;ど&#8203;の&#8203;計&#8203;算&#8203;の&#8203;単&#8203;位&#8203;で&#8203;大&#8203;き&#8203;く&#8203;結&#8203;果&#8203;が&#8203;変&#8203;わ&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;注&#8203;意&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。&#8203;日&#8203;本&#8203;株&#8203;の&#8203;ア&#8203;ル&#8203;ゴ&#8203;リ&#8203;ズ&#8203;ム&#8203;ト&#8203;レー&#8203;ド&#8203;の&#8203;評&#8203;価&#8203;で&#8203;は、&#8203;安&#8203;定&#8203;資&#8203;産&#8203;利&#8203;回&#8203;り&#8203;は&#8203;0%&#8203;で&#8203;計&#8203;算&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;多&#8203;い&#8203;で&#8203;す。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">イ&#8203;ン&#8203;フォ&#8203;メー&#8203;ショ&#8203;ン・&#8203;レ&#8203;シ&#8203;オ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;と&#8203;比&#8203;べ&#8203;て&#8203;安&#8203;定&#8203;し&#8203;た&#8203;利&#8203;益&#8203;を&#8203;得&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;示&#8203;し&#8203;ま&#8203;す。&#8203;リ&#8203;ター&#8203;ン&#8203;か&#8203;ら&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;利&#8203;回&#8203;り&#8203;を&#8203;引&#8203;い&#8203;た&#8203;も&#8203;の&#8203;を&#8203;平&#8203;均&#8203;し&#8203;て&#8203;標&#8203;準&#8203;偏&#8203;差&#8203;で&#8203;割&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;算&#8203;出&#8203;し&#8203;ま&#8203;す。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;実&#8203;行&#8203;時&#8203;は、&#8203;一&#8203;つ&#8203;の&#8203;評&#8203;価&#8203;軸&#8203;の&#8203;み&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;の&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;複&#8203;数&#8203;の&#8203;評&#8203;価&#8203;軸&#8203;を&#8203;組&#8203;み&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;解&#8203;釈&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;ト&#8203;レー&#8203;ド&#8203;戦&#8203;略&#8203;の&#8203;特&#8203;性&#8203;を&#8203;把&#8203;握&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;重&#8203;要&#8203;で&#8203;す。&#8203;考&#8203;慮&#8203;す&#8203;べ&#8203;き&#8203;観&#8203;点&#8203;は&#8203;多&#8203;数&#8203;存&#8203;在&#8203;し&#8203;ま&#8203;す&#8203;が、&#8203;そ&#8203;の&#8203;一&#8203;部&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>勝&#8203;率&#8203;の&#8203;み&#8203;に&#8203;注&#8203;目&#8203;す&#8203;る&#8203;と、&#8203;小&#8203;さ&#8203;い&#8203;勝&#8203;ち&#8203;を&#8203;積&#8203;み&#8203;重&#8203;ね&#8203;て&#8203;い&#8203;て&#8203;も、&#8203;実&#8203;際&#8203;に&#8203;は&#8203;大&#8203;き&#8203;な&#8203;負&#8203;け&#8203;に&#8203;よ&#8203;り&#8203;収&#8203;益&#8203;を&#8203;失っ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;気&#8203;づ&#8203;か&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;平&#8203;均&#8203;リ&#8203;ター&#8203;ン&#8203;や&#8203;ペ&#8203;イ&#8203;オ&#8203;フ&#8203;レ&#8203;シ&#8203;オ&#8203;と&#8203;セッ&#8203;ト&#8203;で&#8203;確&#8203;認&#8203;し、&#8203;高&#8203;い&#8203;勝&#8203;率&#8203;を&#8203;実&#8203;現&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;何&#8203;を&#8203;ト&#8203;レー&#8203;ド&#8203;オ&#8203;フ&#8203;に&#8203;し&#8203;て&#8203;い&#8203;る&#8203;か&#8203;に&#8203;注&#8203;目&#8203;し&#8203;ま&#8203;しょ&#8203;う。</p>
</li>
<li>
<p>取&#8203;引&#8203;戦&#8203;略&#8203;は&#8203;マー&#8203;ケッ&#8203;ト&#8203;全&#8203;体&#8203;の&#8203;動&#8203;き&#8203;の&#8203;影&#8203;響&#8203;を&#8203;強&#8203;く&#8203;受&#8203;け&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;の&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;に&#8203;対&#8203;す&#8203;る&#8203;特&#8203;性&#8203;を&#8203;知&#8203;る&#8203;た&#8203;め&#8203;に、&#8203;ま&#8203;ず&#8203;は&#8203;ベー&#8203;タ&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;しょ&#8203;う。&#8203;一&#8203;般&#8203;的&#8203;に&#8203;ベー&#8203;タ&#8203;が&#8203;高&#8203;い&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;を&#8203;取っ&#8203;て&#8203;い&#8203;る&#8203;場&#8203;合、&#8203;マー&#8203;ケッ&#8203;ト&#8203;全&#8203;体&#8203;の&#8203;暴&#8203;落&#8203;時&#8203;に&#8203;大&#8203;き&#8203;な&#8203;暴&#8203;落&#8203;が&#8203;発&#8203;生&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;な&#8203;る&#8203;た&#8203;め、&#8203;ベー&#8203;タ&#8203;が&#8203;高&#8203;い&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;で&#8203;は&#8203;最&#8203;大&#8203;ド&#8203;ロー&#8203;ダ&#8203;ウ&#8203;ン&#8203;が&#8203;大&#8203;き&#8203;く&#8203;な&#8203;る&#8203;傾&#8203;向&#8203;が&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;注&#8203;意&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。&#8203;逆&#8203;に&#8203;低&#8203;い&#8203;ベー&#8203;タ&#8203;で&#8203;同&#8203;等&#8203;の&#8203;収&#8203;益&#8203;性&#8203;が&#8203;実&#8203;現&#8203;で&#8203;き&#8203;て&#8203;い&#8203;る&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;は、&#8203;高&#8203;い&#8203;ベー&#8203;タ&#8203;の&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;よ&#8203;り&#8203;も&#8203;相&#8203;対&#8203;的&#8203;に&#8203;リ&#8203;ス&#8203;ク&#8203;が&#8203;低&#8203;く、&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;が&#8203;安&#8203;定&#8203;す&#8203;る&#8203;と&#8203;考&#8203;え&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</li>
<li>
<p>最&#8203;大&#8203;ド&#8203;ロー&#8203;ダ&#8203;ウ&#8203;ン&#8203;は、&#8203;そ&#8203;の&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;の&#8203;リ&#8203;ス&#8203;ク&#8203;を&#8203;評&#8203;価&#8203;す&#8203;る&#8203;上&#8203;で&#8203;重&#8203;要&#8203;な&#8203;評&#8203;価&#8203;軸&#8203;で&#8203;す。&#8203;自&#8203;分&#8203;の&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;が&#8203;過&#8203;去&#8203;に&#8203;最&#8203;大&#8203;で&#8203;ど&#8203;の&#8203;く&#8203;ら&#8203;い&#8203;の&#8203;下&#8203;落&#8203;を&#8203;し&#8203;た&#8203;か&#8203;は&#8203;常&#8203;に&#8203;把&#8203;握&#8203;し&#8203;ま&#8203;しょ&#8203;う。</p>
</li>
<li>
<p>取&#8203;引&#8203;戦&#8203;略&#8203;の&#8203;評&#8203;価&#8203;を&#8203;す&#8203;る&#8203;際&#8203;に&#8203;対&#8203;比&#8203;軸&#8203;と&#8203;な&#8203;る&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;を&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;設&#8203;定&#8203;す&#8203;る&#8203;か&#8203;を&#8203;常&#8203;に&#8203;考&#8203;え&#8203;ま&#8203;しょ&#8203;う。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は、&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;の&#8203;効&#8203;果&#8203;を&#8203;評&#8203;価&#8203;す&#8203;る&#8203;た&#8203;め&#8203;取&#8203;引&#8203;可&#8203;能&#8203;な&#8203;全&#8203;銘&#8203;柄&#8203;の&#8203;平&#8203;均&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;に&#8203;採&#8203;用&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は&#8203;デー&#8203;タ&#8203;は&#8203;提&#8203;供&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;TOPIX&#8203;や&#8203;日&#8203;経&#8203;平&#8203;均&#8203;株&#8203;価&#8203;等&#8203;も&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;と&#8203;し&#8203;て&#8203;採&#8203;用&#8203;さ&#8203;れ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;多&#8203;く、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;特&#8203;性&#8203;が&#8203;異&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</li>
<li>
<p>取&#8203;引&#8203;戦&#8203;略&#8203;を&#8203;評&#8203;価&#8203;す&#8203;る&#8203;際&#8203;は、&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;行&#8203;う&#8203;期&#8203;間&#8203;に&#8203;お&#8203;け&#8203;る&#8203;マー&#8203;ケッ&#8203;ト&#8203;の&#8203;特&#8203;性&#8203;を&#8203;把&#8203;握&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;重&#8203;要&#8203;で&#8203;す。&#8203;例&#8203;え&#8203;ば、&#8203;2020&#8203;年&#8203;は&#8203;新&#8203;型&#8203;コ&#8203;ロ&#8203;ナ&#8203;ウ&#8203;イ&#8203;ル&#8203;ス&#8203;感&#8203;染&#8203;症&#8203;(COVID‑19)&#8203;の&#8203;影&#8203;響&#8203;で、&#8203;前&#8203;半&#8203;マー&#8203;ケッ&#8203;ト&#8203;は&#8203;大&#8203;き&#8203;く&#8203;値&#8203;下&#8203;が&#8203;り&#8203;し&#8203;た&#8203;後、&#8203;世&#8203;界&#8203;的&#8203;に&#8203;経&#8203;済&#8203;対&#8203;策&#8203;の&#8203;た&#8203;め&#8203;の&#8203;金&#8203;融&#8203;緩&#8203;和&#8203;が&#8203;加&#8203;速&#8203;し&#8203;結&#8203;果&#8203;的&#8203;に&#8203;歴&#8203;史&#8203;的&#8203;な&#8203;株&#8203;高&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;し&#8203;た。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;期&#8203;間&#8203;で&#8203;も&#8203;安&#8203;定&#8203;的&#8203;に&#8203;勝&#8203;て&#8203;る&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;は、&#8203;前&#8203;半&#8203;の&#8203;暴&#8203;落&#8203;に&#8203;対&#8203;す&#8203;る&#8203;備&#8203;え&#8203;と、&#8203;後&#8203;半&#8203;の&#8203;ト&#8203;レ&#8203;ン&#8203;ド&#8203;が&#8203;発&#8203;生&#8203;し&#8203;た&#8203;時&#8203;に&#8203;収&#8203;益&#8203;化&#8203;で&#8203;き&#8203;る&#8203;特&#8203;性&#8203;を&#8203;両&#8203;方&#8203;備&#8203;え&#8203;て&#8203;い&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;2016&#8203;年&#8203;か&#8203;ら&#8203;2019&#8203;年&#8203;に&#8203;お&#8203;い&#8203;て&#8203;も&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;マー&#8203;ケッ&#8203;ト&#8203;の&#8203;特&#8203;性&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;の&#8203;評&#8203;価&#8203;を&#8203;す&#8203;る&#8203;際&#8203;は&#8203;で&#8203;き&#8203;る&#8203;だ&#8203;け&#8203;多&#8203;角&#8203;的&#8203;に&#8203;多&#8203;用&#8203;な&#8203;期&#8203;間&#8203;を&#8203;評&#8203;価&#8203;し、&#8203;そ&#8203;の&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;の&#8203;強&#8203;み・&#8203;弱&#8203;み&#8203;を&#8203;しっ&#8203;か&#8203;り&#8203;と&#8203;把&#8203;握&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;重&#8203;要&#8203;で&#8203;す。</p>
</li>
<li>
<p>取&#8203;引&#8203;戦&#8203;略&#8203;を&#8203;評&#8203;価&#8203;す&#8203;る&#8203;上&#8203;で&#8203;重&#8203;要&#8203;と&#8203;な&#8203;る&#8203;の&#8203;が&#8203;実&#8203;現&#8203;可&#8203;能&#8203;性&#8203;で&#8203;す。&#8203;今&#8203;回&#8203;は&#8203;取&#8203;引&#8203;コ&#8203;ス&#8203;ト&#8203;を&#8203;0&#8203;と&#8203;仮&#8203;定&#8203;し&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;細&#8203;か&#8203;く&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;入&#8203;れ&#8203;替&#8203;え&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;の&#8203;ペ&#8203;ナ&#8203;ル&#8203;ティ&#8203;は&#8203;発&#8203;生&#8203;し&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;実&#8203;際&#8203;に&#8203;取&#8203;引&#8203;を&#8203;行&#8203;う&#8203;場&#8203;合&#8203;は&#8203;取&#8203;引&#8203;手&#8203;数&#8203;料&#8203;は&#8203;重&#8203;要&#8203;な&#8203;要&#8203;素&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;の&#8203;評&#8203;価&#8203;手&#8203;法&#8203;に&#8203;関&#8203;連&#8203;す&#8203;る&#8203;箇&#8203;所&#8203;と&#8203;し&#8203;て&#8203;は、&#8203;取&#8203;引&#8203;対&#8203;象&#8203;と&#8203;し&#8203;て&#8203;指&#8203;定&#8203;し&#8203;た&#8203;数&#8203;量&#8203;を&#8203;市&#8203;場&#8203;の&#8203;始&#8203;値&#8203;で&#8203;本&#8203;当&#8203;に&#8203;購&#8203;入&#8203;で&#8203;き&#8203;る&#8203;か、&#8203;と&#8203;い&#8203;う&#8203;ポ&#8203;イ&#8203;ン&#8203;ト&#8203;も&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;で&#8203;は&#8203;取&#8203;引&#8203;対&#8203;象&#8203;の&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;を&#8203;時&#8203;価&#8203;総&#8203;額&#8203;200&#8203;億&#8203;円&#8203;以&#8203;上&#8203;と&#8203;し&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;個&#8203;人&#8203;で&#8203;取&#8203;引&#8203;を&#8203;行&#8203;う&#8203;上&#8203;で&#8203;も&#8203;流&#8203;動&#8203;性&#8203;等&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;そ&#8203;こ&#8203;ま&#8203;で&#8203;大&#8203;き&#8203;な&#8203;問&#8203;題&#8203;に&#8203;は&#8203;な&#8203;り&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;よ&#8203;り&#8203;時&#8203;価&#8203;総&#8203;額&#8203;が&#8203;小&#8203;型&#8203;の&#8203;株&#8203;式&#8203;銘&#8203;柄&#8203;を&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;と&#8203;し&#8203;て&#8203;利&#8203;用&#8203;す&#8203;る&#8203;場&#8203;合&#8203;は&#8203;こ&#8203;の&#8203;観&#8203;点&#8203;も&#8203;注&#8203;意&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</li>
<li>
<p>平&#8203;均&#8203;リ&#8203;ター&#8203;ン&#8203;や&#8203;勝&#8203;率&#8203;な&#8203;ど&#8203;を&#8203;株&#8203;価&#8203;の&#8203;動&#8203;き&#8203;そ&#8203;の&#8203;も&#8203;の&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;取&#8203;引&#8203;対&#8203;象&#8203;銘&#8203;柄&#8203;の&#8203;平&#8203;均&#8203;を&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;と&#8203;し&#8203;て、&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;と&#8203;の&#8203;相&#8203;対&#8203;的&#8203;な&#8203;差&#8203;を&#8203;計&#8203;算&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;相&#8203;対&#8203;的&#8203;な&#8203;リ&#8203;ター&#8203;ン&#8203;(&#8203;残&#8203;差&#8203;リ&#8203;ター&#8203;ン&#8203;な&#8203;ど&#8203;と&#8203;呼&#8203;ば&#8203;れ&#8203;ま&#8203;す&#8203;)&#8203;や&#8203;相&#8203;対&#8203;的&#8203;な&#8203;勝&#8203;率&#8203;を&#8203;計&#8203;算&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;例&#8203;え&#8203;ば、&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;が&#8203;10％&#8203;下&#8203;落&#8203;し&#8203;た&#8203;と&#8203;き&#8203;に、&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;が&#8203;1%&#8203;の&#8203;下&#8203;落&#8203;に&#8203;収&#8203;まっ&#8203;て&#8203;い&#8203;る&#8203;場&#8203;合、&#8203;相&#8203;対&#8203;的&#8203;な&#8203;リ&#8203;ター&#8203;ン&#8203;は&#8203;+9%&#8203;勝っ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;対&#8203;比&#8203;の&#8203;計&#8203;算&#8203;も&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;行&#8203;う&#8203;こ&#8203;と&#8203;で、&#8203;よ&#8203;り&#8203;多&#8203;角&#8203;的&#8203;な&#8203;評&#8203;価&#8203;を&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;可&#8203;能&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_シンプルなポートフォリオ組成モデルの作成">3.7. シンプルなポートフォリオ組成モデルの作成</h3>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;実&#8203;行&#8203;方&#8203;法&#8203;を&#8203;理&#8203;解&#8203;し&#8203;た&#8203;の&#8203;で、&#8203;い&#8203;よ&#8203;い&#8203;よ&#8203;シ&#8203;ン&#8203;プ&#8203;ル&#8203;な&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;組&#8203;成&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;しょ&#8203;う。&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;組&#8203;成&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;通&#8203;し&#8203;て、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;投&#8203;稿&#8203;す&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;や&#8203;評&#8203;価&#8203;方&#8203;法&#8203;を&#8203;把&#8203;握&#8203;し、&#8203;最&#8203;終&#8203;的&#8203;に&#8203;は&#8203;作&#8203;成&#8203;し&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;投&#8203;稿&#8203;し&#8203;て&#8203;結&#8203;果&#8203;が&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;に&#8203;掲&#8203;載&#8203;さ&#8203;れ&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;節&#8203;で&#8203;は&#8203;以&#8203;下&#8203;を&#8203;説&#8203;明&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;組&#8203;成&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;作&#8203;成&#8203;方&#8203;法</p>
</li>
<li>
<p>バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;使&#8203;用&#8203;方&#8203;法</p>
</li>
<li>
<p>投&#8203;稿&#8203;用&#8203;パッ&#8203;ケー&#8203;ジ&#8203;の&#8203;作&#8203;成&#8203;方&#8203;法</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>　&#8203;具&#8203;体&#8203;的&#8203;に&#8203;は、&#8203;以&#8203;下&#8203;の&#8203;ス&#8203;テッ&#8203;プ&#8203;で&#8203;進&#8203;め&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>1. 必要なライブラリの読み込み
2. データセットの読み込み
3. ポートフォリオ組成戦略の策定
4. ポートフォリオの組成
5. 出力の調整
6. バックテストの実行
7. バックテストの評価
8. 投稿用パッケージのディレクトリ作成
9. 作成したコードをランタイム実行用にクラスにまとめる
10. 提出用パッケージの作成と提出</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_必要な入力データ等">3.7.1. 必要な入力データ等</h4>
<div class="paragraph">
<p>■&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;用&#8203;ク&#8203;ラ&#8203;ス&#8203;<br>
本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;評&#8203;価&#8203;方&#8203;法&#8203;と&#8203;同&#8203;等&#8203;の&#8203;ロ&#8203;ジッ&#8203;ク&#8203;を&#8203;実&#8203;装&#8203;し&#8203;た&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;用&#8203;の&#8203;ク&#8203;ラ&#8203;ス&#8203;を&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;本&#8203;notebook&#8203;か&#8203;ら&#8203;import&#8203;で&#8203;き&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;import&#8203;時&#8203;に&#8203;エ&#8203;ラー&#8203;と&#8203;な&#8203;る&#8203;場&#8203;合&#8203;は、&#8203;`backtest.py` &#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;て&#8203;い&#8203;る&#8203;確&#8203;認&#8203;の&#8203;上、&#8203;sys.path &#8203;に&#8203;追&#8203;加&#8203;し&#8203;て&#8203;再&#8203;実&#8203;行&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;な&#8203;お、&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;用&#8203;の&#8203;ク&#8203;ラ&#8203;ス&#8203;の&#8203;取&#8203;得&#8203;方&#8203;法&#8203;は、&#8203;「<a href="#anchor-3.6">3.6. &#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;環&#8203;境&#8203;の&#8203;構&#8203;築&#8203;</a>」&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>■&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;<br>
本&#8203;章&#8203;で&#8203;構&#8203;築&#8203;す&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;お&#8203;い&#8203;て&#8203;は、&#8203;以&#8203;下&#8203;の&#8203;デー&#8203;タ&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;使&#8203;用&#8203;し&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;サ&#8203;イ&#8203;ト&#8203;か&#8203;ら&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;た&#8203;デー&#8203;タ&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;配&#8203;置&#8203;し、&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;パ&#8203;ス&#8203;を&#8203; <code>dataset_dir</code> &#8203;変&#8203;数&#8203;に&#8203;設&#8203;定&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>stock_list.csv.gz</p>
</li>
<li>
<p>stock_price.csv.gz</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_必要なライブラリの読み込み">3.7.2. 必要なライブラリの読み込み</h4>
<div class="paragraph">
<p>　&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;と&#8203;Google Colaboratory&#8203;環&#8203;境&#8203;の&#8203;両&#8203;者&#8203;で&#8203;共&#8203;通&#8203;の&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;バー&#8203;ジョ&#8203;ン&#8203;を&#8203;調&#8203;整&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="error">!</span>pip install --no-cache-<span class="predefined">dir</span> joblib==<span class="float">1.0</span><span class="float">.1</span> numpy==<span class="float">1.19</span><span class="float">.5</span> pandas==<span class="float">1.1</span><span class="float">.5</span> scikit-learn==<span class="float">0.20</span><span class="float">.3</span> scipy==<span class="float">1.2</span><span class="float">.1</span> seaborn==<span class="float">0.9</span><span class="float">.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;以&#8203;下&#8203;の&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">import</span> <span class="include">io</span>
<span class="keyword">import</span> <span class="include">os</span>
<span class="keyword">import</span> <span class="include">sys</span>
<span class="keyword">import</span> <span class="include">zipfile</span>

<span class="keyword">import</span> <span class="include">matplotlib</span>
<span class="keyword">import</span> <span class="include">matplotlib.pyplot</span> <span class="keyword">as</span> plt
<span class="keyword">import</span> <span class="include">numpy</span> <span class="keyword">as</span> np
<span class="keyword">import</span> <span class="include">pandas</span> <span class="keyword">as</span> pd
<span class="keyword">import</span> <span class="include">seaborn</span> <span class="keyword">as</span> sns
<span class="keyword">from</span> <span class="include">tqdm.auto</span> <span class="keyword">import</span> <span class="include">tqdm</span>
<span class="keyword">from</span> <span class="include">scipy</span> <span class="keyword">import</span> <span class="include">stats</span>
<span class="keyword">from</span> <span class="include">IPython.core.magic</span> <span class="keyword">import</span> <span class="include">register_cell_magic</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;次&#8203;に&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;評&#8203;価&#8203;検&#8203;証&#8203;用&#8203;の&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;モ&#8203;ジュー&#8203;ル&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。&#8203;イ&#8203;ン&#8203;ポー&#8203;ト&#8203;時&#8203;に&#8203;エ&#8203;ラー&#8203;が&#8203;出&#8203;た&#8203;場&#8203;合&#8203;は、&#8203;sys.path &#8203;に&#8203; backtest.py &#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;配&#8203;置&#8203;し&#8203;た&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;追&#8203;加&#8203;し&#8203;て&#8203;か&#8203;ら&#8203;再&#8203;度&#8203;イ&#8203;ン&#8203;ポー&#8203;ト&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># インポート時にエラーが出た場合は、以下のmodule_dirをbacktest.pyを配置したディレクトリに変更してください。</span>
<span class="keyword">import</span> <span class="include">sys</span>
<span class="keyword">if</span> <span class="string"><span class="delimiter">'</span><span class="content">google.colab</span><span class="delimiter">'</span></span> <span class="keyword">in</span> sys.modules:
  <span class="comment"># Backtestを配置したディレクトリへのフルパスを指定します</span>
  module_dir = f<span class="string"><span class="delimiter">&quot;</span><span class="content">{mount_dir}/MyDrive/JPX_competition/Chapter03/backtest</span><span class="delimiter">&quot;</span></span>
<span class="keyword">else</span>:
  <span class="comment"># Backtestを配置したディレクトリへのフルパスを指定します</span>
  module_dir = <span class="string"><span class="delimiter">&quot;</span><span class="content">/notebook/Chapter03/backtest</span><span class="delimiter">&quot;</span></span>
sys.path.append(module_dir)

<span class="keyword">from</span> <span class="include">backtest</span> <span class="keyword">import</span> <span class="include">Backtest</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　Pandas&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;表&#8203;示&#8203;す&#8203;る&#8203;際&#8203;に&#8203;表&#8203;略&#8203;さ&#8203;れ&#8203;な&#8203;い&#8203;よ&#8203;う&#8203;に&#8203;設&#8203;定&#8203;を&#8203;変&#8203;更&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 表示用の設定を変更します</span>
pd.options.display.max_rows = <span class="integer">100</span>
pd.options.display.max_columns = <span class="integer">100</span>
pd.options.display.width = <span class="integer">120</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_データセットの読み込み_2">3.7.3. データセットの読み込み</h4>
<div class="paragraph">
<p>　&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;配&#8203;置&#8203;し&#8203;た&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;の&#8203;パ&#8203;ス&#8203;を&#8203;設&#8203;定&#8203;し&#8203;ま&#8203;す。&#8203;Google Colab&#8203;を&#8203;ご&#8203;利&#8203;用&#8203;の&#8203;場&#8203;合&#8203;は&#8203; Google Drive &#8203;に&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;アッ&#8203;プ&#8203;ロー&#8203;ド&#8203;し&#8203;て、&#8203;そ&#8203;の&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;指&#8203;定&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;ま&#8203;た、&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;取&#8203;得&#8203;方&#8203;法&#8203;お&#8203;よ&#8203;び&#8203;内&#8203;容&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;「<a href="#anchor-3.4">3.4. &#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;説&#8203;明&#8203;</a>」&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># データセットを配置したディレクトリのパスを設定</span>
<span class="keyword">if</span> <span class="string"><span class="delimiter">'</span><span class="content">google.colab</span><span class="delimiter">'</span></span> <span class="keyword">in</span> sys.modules:
    dataset_dir = f<span class="string"><span class="delimiter">&quot;</span><span class="content">{mount_dir}/MyDrive/JPX_competition/data_dir_comp2</span><span class="delimiter">&quot;</span></span>
<span class="keyword">else</span>:
    dataset_dir = <span class="string"><span class="delimiter">&quot;</span><span class="content">/notebook/data_dir_comp2</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;に&#8203;お&#8203;け&#8203;る&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;へ&#8203;の&#8203;ア&#8203;ク&#8203;セ&#8203;ス&#8203;は、&#8203; <code>ScoringService.predict()</code> &#8203;メ&#8203;ソッ&#8203;ド&#8203;に&#8203;渡&#8203;さ&#8203;れ&#8203;る&#8203;inputs&#8203;パ&#8203;ラ&#8203;メー&#8203;ター&#8203;を&#8203;通&#8203;し&#8203;て&#8203;行&#8203;う&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;本&#8203;notebook&#8203;環&#8203;境&#8203;で&#8203;も&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;と&#8203;共&#8203;通&#8203;の&#8203;方&#8203;法&#8203;で&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;に&#8203;ア&#8203;ク&#8203;セ&#8203;ス&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;コー&#8203;ド&#8203;が&#8203;複&#8203;雑&#8203;に&#8203;なっ&#8203;た&#8203;り&#8203;投&#8203;稿&#8203;用&#8203;に&#8203;コー&#8203;ド&#8203;を&#8203;編&#8203;集&#8203;し&#8203;た&#8203;り&#8203;し&#8203;な&#8203;く&#8203;て&#8203;も&#8203;済&#8203;む&#8203;よ&#8203;う&#8203;に&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 入力パラメーターを設定します。ランタイム環境での実行時と同一フォーマットにします</span>
inputs = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_list.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_price.csv.gz</span><span class="delimiter">&quot;</span></span>,
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は&#8203;2016&#8203;年&#8203;以&#8203;降&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;本&#8203;notebook&#8203;で&#8203;は&#8203;モ&#8203;デ&#8203;ル&#8203;作&#8203;成・&#8203;評&#8203;価&#8203;時&#8203;の&#8203;処&#8203;理&#8203;時&#8203;間&#8203;を&#8203;短&#8203;く&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203; 2020-01-01 &#8203;以&#8203;降&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;施・&#8203;評&#8203;価&#8203;し&#8203;ま&#8203;す。&#8203;な&#8203;お、&#8203;実&#8203;際&#8203;に&#8203;評&#8203;価&#8203;を&#8203;す&#8203;る&#8203;場&#8203;合&#8203;は&#8203;可&#8203;能&#8203;な&#8203;限&#8203;り&#8203;長&#8203;い&#8203;期&#8203;間&#8203;を&#8203;評&#8203;価&#8203;に&#8203;利&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;推&#8203;奨&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 投資対象日付を指定します</span>
start_dt = pd.Timestamp(<span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-01</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;に&#8203;お&#8203;い&#8203;て&#8203;は&#8203; <code>ScoringService.predict()</code> &#8203;メ&#8203;ソッ&#8203;ド&#8203;に&#8203;渡&#8203;さ&#8203;れ&#8203;る&#8203;inputs&#8203;パ&#8203;ラ&#8203;メー&#8203;ター&#8203;に&#8203; <code>purchase_date</code> &#8203;と&#8203;い&#8203;う&#8203;キー&#8203;名&#8203;で&#8203;予&#8203;測&#8203;対&#8203;象&#8203;日&#8203;が&#8203;記&#8203;載&#8203;さ&#8203;れ&#8203;た&#8203;CSV&#8203;形&#8203;式&#8203;の&#8203;ファ&#8203;イ&#8203;ル&#8203;へ&#8203;の&#8203;パ&#8203;ス&#8203;が&#8203;渡&#8203;さ&#8203;れ、&#8203;そ&#8203;の&#8203;ファ&#8203;イ&#8203;ル&#8203;内&#8203;に&#8203;記&#8203;載&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;日&#8203;付&#8203;を&#8203;予&#8203;測&#8203;対&#8203;象&#8203;日&#8203;と&#8203;し&#8203;て&#8203;使&#8203;用&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;に&#8203;対&#8203;応&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203; <code>purchase_date</code> &#8203;が&#8203;存&#8203;在&#8203;す&#8203;る&#8203;場&#8203;合&#8203;は、&#8203;指&#8203;定&#8203;さ&#8203;れ&#8203;た&#8203;日&#8203;付&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;ロ&#8203;ジッ&#8203;ク&#8203;を&#8203;組&#8203;み&#8203;込&#8203;ん&#8203;で&#8203;お&#8203;き&#8203;ま&#8203;す。&#8203;purchase_date &#8203;の&#8203;フォー&#8203;マッ&#8203;ト&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203; <a href="https://signate.jp/competitions/443/data">SIGNATEのコンペティションサイト</a> &#8203;に&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;ファ&#8203;イ&#8203;ル&#8203;が&#8203;配&#8203;置&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め&#8203;そ&#8203;ち&#8203;ら&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">if</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">purchase_date</span><span class="delimiter">&quot;</span></span> <span class="keyword">in</span> inputs.keys():
    <span class="comment"># ランタイム環境では指定された投資対象日付を使用します</span>
    <span class="comment"># purchase_dateを読み込み</span>
    df_purchase_date = pd.read_csv(inputs[<span class="string"><span class="delimiter">&quot;</span><span class="content">purchase_date</span><span class="delimiter">&quot;</span></span>])
    <span class="comment"># purchase_dateの最も古い日付を投資対象日付として使用します</span>
    start_dt = pd.Timestamp(df_purchase_date.sort_values(<span class="string"><span class="delimiter">&quot;</span><span class="content">Purchase Date</span><span class="delimiter">&quot;</span></span>).iloc[<span class="integer">0</span>, <span class="integer">0</span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は&#8203;投&#8203;資&#8203;対&#8203;象&#8203;と&#8203;な&#8203;る&#8203;銘&#8203;柄&#8203;群&#8203; (&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;) &#8203;が&#8203;設&#8203;定&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;内&#8203;の&#8203;銘&#8203;柄&#8203;に&#8203;絞っ&#8203;て&#8203;処&#8203;理&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;銘&#8203;柄&#8203;情&#8203;報&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 銘柄情報読み込み</span>
df_stock_list = pd.read_csv(inputs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>])
<span class="comment"># 問題2のユニバース (投資対象の条件を満たす銘柄群) 取得</span>
codes = df_stock_list.loc[
    df_stock_list.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">universe_comp2</span><span class="delimiter">&quot;</span></span>] == <span class="predefined-constant">True</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>
].unique()</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;以&#8203;下&#8203;で&#8203;は、&#8203;シ&#8203;ン&#8203;プ&#8203;ル&#8203;に&#8203;株&#8203;価&#8203;情&#8203;報&#8203;の&#8203;み&#8203;を&#8203;利&#8203;用&#8203;し&#8203;て&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;組&#8203;成&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;株&#8203;価&#8203;情&#8203;報&#8203;を&#8203;読&#8203;み&#8203;込&#8203;ん&#8203;で&#8203;い&#8203;ま&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;は&#8203;csv.gz&#8203;形&#8203;式&#8203;で&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;デー&#8203;タ&#8203;の&#8203;型&#8203;情&#8203;報&#8203;が&#8203;保&#8203;存&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;せ&#8203;ん。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;特&#8203;に&#8203;日&#8203;付&#8203;型&#8203;の&#8203;カ&#8203;ラ&#8203;ム&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;明&#8203;示&#8203;的&#8203;に&#8203;変&#8203;換&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;read_csv&#8203;の&#8203;parse_date&#8203;パ&#8203;ラ&#8203;メー&#8203;ター&#8203;等、&#8203;日&#8203;付&#8203;型&#8203;を&#8203;指&#8203;定&#8203;す&#8203;る&#8203;方&#8203;法&#8203;は&#8203;複&#8203;数&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;本&#8203;notebook&#8203;で&#8203;は&#8203;一&#8203;度&#8203;読&#8203;み&#8203;込&#8203;ん&#8203;で&#8203;か&#8203;ら&#8203;変&#8203;換&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 価格情報読み込み、インデックス作成</span>
df_price = pd.read_csv(inputs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]).set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># 日付型に変換</span>
df_price.index = pd.to_datetime(df_price.index, format=<span class="string"><span class="delimiter">&quot;</span><span class="content">%Y-%m-%d</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;処&#8203;理&#8203;時&#8203;間&#8203;を&#8203;最&#8203;適&#8203;化&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;処&#8203;理&#8203;対&#8203;象&#8203;デー&#8203;タ&#8203;を&#8203;日&#8203;付&#8203;で&#8203;フィ&#8203;ル&#8203;タ&#8203;を&#8203;し&#8203;て&#8203;絞&#8203;り&#8203;込&#8203;み&#8203;ま&#8203;す。&#8203;本&#8203;notebook&#8203;で&#8203;は&#8203;過&#8203;去&#8203;20&#8203;営&#8203;業&#8203;日&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;投&#8203;資&#8203;対&#8203;象&#8203;日&#8203;付&#8203;か&#8203;ら&#8203;過&#8203;去&#8203;20&#8203;営&#8203;業&#8203;日&#8203;時&#8203;点&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;含&#8203;め&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;バッ&#8203;ファ&#8203;と&#8203;し&#8203;て&#8203;過&#8203;去&#8203;30&#8203;日&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;含&#8203;め&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;し&#8203;ま&#8203;す。&#8203;同&#8203;時&#8203;に&#8203;株&#8203;価&#8203;情&#8203;報&#8203;を&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;と&#8203;一&#8203;致&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;絞&#8203;り&#8203;込&#8203;ん&#8203;で&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 投資対象日の前週金曜日時点で予測を出力するため、予測出力用の日付を設定します。</span>
pred_start_dt = pd.Timestamp(start_dt) - pd.Timedelta(<span class="string"><span class="delimiter">&quot;</span><span class="content">3D</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># 特徴量の生成に必要な日数をバッファとして設定</span>
n = <span class="integer">30</span>
<span class="comment"># データ絞り込み日付設定</span>
data_start_dt = pred_start_dt - pd.offsets.BDay(n)
<span class="comment"># 日付で絞り込み</span>
filter_date = df_price.index &gt;= data_start_dt
<span class="comment"># 銘柄をユニバースで絞り込み</span>
filter_universe = df_price.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>].isin(codes)
<span class="comment"># 絞り込み実施</span>
df_price = df_price.loc[filter_date &amp; filter_universe]</code></pre>
</div>
</div>
<div class="paragraph">
<p>　<code>head()</code> &#8203;や&#8203; <code>tail()</code> &#8203;メ&#8203;ソッ&#8203;ド&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;処&#8203;理&#8203;結&#8203;果&#8203;が&#8203;期&#8203;待&#8203;通&#8203;り&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;し&#8203;な&#8203;が&#8203;ら&#8203;進&#8203;め&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;デー&#8203;タ&#8203;が&#8203;2019&#8203;年&#8203;11&#8203;月&#8203;20&#8203;日&#8203;以&#8203;降&#8203;に&#8203;絞&#8203;り&#8203;込&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;確&#8203;認&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;`.T`  &#8203;プ&#8203;ロ&#8203;パ&#8203;ティ&#8203; <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.transpose.html#pandas.DataFrame.transpose" class="bare">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.transpose.html#pandas.DataFrame.transpose</a> &#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;行&#8203;と&#8203;列&#8203;を&#8203;入&#8203;れ&#8203;替&#8203;え&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;可&#8203;読&#8203;性&#8203;が&#8203;上&#8203;が&#8203;る&#8203;場&#8203;合&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;で&#8203;計&#8203;算&#8203;し&#8203;た&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;フォー&#8203;マッ&#8203;ト&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に、&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;先&#8203;頭&#8203;を&#8203;見&#8203;て&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">df_price.head(<span class="integer">3</span>).T</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple.png" alt="処理結果" width="70%">
</div>
</div>
</div>
<div class="sect3">
<h4 id="anchor-3.7.4">3.7.4. ポートフォリオ構築戦略の策定</h4>
<div class="paragraph">
<p>　&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;組&#8203;成&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。&#8203;今&#8203;回&#8203;は&#8203;以&#8203;下&#8203;の&#8203;2&#8203;種&#8203;類&#8203;の&#8203;戦&#8203;略&#8203;を&#8203;採&#8203;用&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>リ&#8203;ター&#8203;ン・&#8203;リ&#8203;バー&#8203;サ&#8203;ル&#8203; (&#8203;逆&#8203;張&#8203;り&#8203;) &#8203;戦&#8203;略&#8203;を&#8203;採&#8203;用&#8203;し&#8203;て、&#8203;過&#8203;去&#8203;1ヶ&#8203;月&#8203;(&#8203;約&#8203;20&#8203;営&#8203;業&#8203;日&#8203;)&#8203;の&#8203;株&#8203;価&#8203;下&#8203;落&#8203;率&#8203;の&#8203;上&#8203;位&#8203;25&#8203;銘&#8203;柄&#8203;を&#8203;選&#8203;択&#8203;し&#8203;ま&#8203;す。&#8203;
(&#8203;「リ&#8203;ター&#8203;ン・&#8203;リ&#8203;バー&#8203;サ&#8203;ル」&#8203; &#8203;野&#8203;村&#8203;證&#8203;券&#8203;証&#8203;券&#8203;用&#8203;語&#8203;解&#8203;説&#8203;集&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.nomura.co.jp/terms/japan/ri/A01944.html" class="bare">https://www.nomura.co.jp/terms/japan/ri/A01944.html</a>)</p>
</li>
<li>
<p>ト&#8203;レ&#8203;ン&#8203;ド&#8203;フォ&#8203;ロー&#8203; (&#8203;順&#8203;張&#8203;り&#8203;) &#8203;戦&#8203;略&#8203;を&#8203;採&#8203;用&#8203;し&#8203;て、&#8203;過&#8203;去&#8203;1ヶ&#8203;月&#8203;(&#8203;約&#8203;20&#8203;営&#8203;業&#8203;日&#8203;)&#8203;の&#8203;株&#8203;価&#8203;上&#8203;昇&#8203;率&#8203;の&#8203;上&#8203;位&#8203;25&#8203;銘&#8203;柄&#8203;を&#8203;選&#8203;択&#8203;し&#8203;ま&#8203;す。&#8203;
(&#8203;「ト&#8203;レ&#8203;ン&#8203;ド&#8203;フォ&#8203;ロー」&#8203; &#8203;野&#8203;村&#8203;證&#8203;券&#8203;証&#8203;券&#8203;用&#8203;語&#8203;解&#8203;説&#8203;集&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.nomura.co.jp/terms/japan/ta/A02002.html" class="bare">https://www.nomura.co.jp/terms/japan/ta/A02002.html</a>)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>　&#8203;過&#8203;去&#8203;1ヶ&#8203;月&#8203;(20&#8203;営&#8203;業&#8203;日&#8203;)&#8203;の&#8203;株&#8203;価&#8203;下&#8203;落&#8203;率&#8203;/&#8203;上&#8203;昇&#8203;率&#8203;を&#8203;計&#8203;算&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に、&#8203;銘&#8203;柄&#8203;毎&#8203;に&#8203;グ&#8203;ルー&#8203;プ&#8203;化&#8203;し&#8203;て&#8203;か&#8203;ら&#8203;株&#8203;価&#8203;変&#8203;化&#8203;率&#8203;を&#8203;計&#8203;算&#8203;し&#8203;ま&#8203;す。&#8203;<br>
　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;提&#8203;出&#8203;す&#8203;る&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;は&#8203;各&#8203;週&#8203;の&#8203;週&#8203;初&#8203;の&#8203;営&#8203;業&#8203;日&#8203;に&#8203;買&#8203;付&#8203;実&#8203;施&#8203;さ&#8203;れ&#8203;る&#8203;た&#8203;め、&#8203;買&#8203;付&#8203;日&#8203;前&#8203;週&#8203;の&#8203;金&#8203;曜&#8203;日&#8203;終&#8203;値&#8203;時&#8203;点&#8203;を&#8203;銘&#8203;柄&#8203;選&#8203;択&#8203;の&#8203;基&#8203;準&#8203;と&#8203;し&#8203;ま&#8203;す。&#8203;基&#8203;準&#8203;日&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;単&#8203;純&#8203;に&#8203;金&#8203;曜&#8203;日&#8203;に&#8203;の&#8203;み&#8203;絞&#8203;り&#8203;込&#8203;ん&#8203;だ&#8203;場&#8203;合、&#8203;金&#8203;曜&#8203;日&#8203;が&#8203;祝&#8203;日&#8203;の&#8203;場&#8203;合&#8203;に&#8203;そ&#8203;の&#8203;翌&#8203;週&#8203;の&#8203;銘&#8203;柄&#8203;を&#8203;選&#8203;択&#8203;で&#8203;き&#8203;な&#8203;く&#8203;な&#8203;る&#8203;お&#8203;そ&#8203;れ&#8203;が&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;平&#8203;日&#8203;で&#8203;リ&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;(pandas&#8203;に&#8203;お&#8203;い&#8203;て&#8203;平&#8203;日&#8203;を&#8203;意&#8203;味&#8203;す&#8203;る&#8203; <code>B</code> &#8203;を&#8203;指&#8203;定&#8203;し&#8203;て&#8203;resample&#8203;関&#8203;数&#8203;を&#8203;呼&#8203;ん&#8203;で&#8203;い&#8203;ま&#8203;す&#8203;)&#8203;し、&#8203;欠&#8203;損&#8203;値&#8203;が&#8203;あ&#8203;る&#8203;場&#8203;合&#8203;に&#8203;は&#8203;前&#8203;日&#8203;の&#8203;値&#8203;を&#8203;使&#8203;う&#8203;よ&#8203;う&#8203;に&#8203;前&#8203;方&#8203;補&#8203;完&#8203;(pandas&#8203;で&#8203;は&#8203;ffill&#8203;関&#8203;数&#8203;を&#8203;利&#8203;用&#8203;)&#8203;を&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;に&#8203;よ&#8203;り、&#8203;金&#8203;曜&#8203;日&#8203;に&#8203;必&#8203;ず&#8203;デー&#8203;タ&#8203;が&#8203;存&#8203;在&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 欠損値がある場合にも正しく動作しているかを確認するため、処理前に木曜日、金曜日が祝日である2020-07-23、2020-07-24のレコードが存在しないことを確認しておきます。</span>
df_price.loc[<span class="string"><span class="delimiter">&quot;</span><span class="content">2020-07-22</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">2020-07-27</span><span class="delimiter">&quot;</span></span>].head(<span class="integer">4</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple1.png" alt="処理結果" width="90%">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># groupby を使用して処理するために並び替え</span>
df_price.sort_values([<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>], inplace=<span class="predefined-constant">True</span>)
<span class="comment"># 銘柄毎にグループにします。</span>
grouped_price = df_price.groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>)[
    <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>
]
<span class="comment"># 銘柄毎に20営業日の変化率を作成してから、金曜日に必ずデータが存在するようにリサンプルして前方補完します。</span>
df_feature = grouped_price.apply(
    <span class="keyword">lambda</span> x: x.pct_change(<span class="integer">20</span>).resample(<span class="string"><span class="delimiter">&quot;</span><span class="content">B</span><span class="delimiter">&quot;</span></span>).ffill().dropna()
).to_frame()</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;大&#8203;量&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;処&#8203;理&#8203;す&#8203;る&#8203;場&#8203;合、&#8203;処&#8203;理&#8203;に&#8203;よっ&#8203;て&#8203;は&#8203;数&#8203;分&#8203;か&#8203;ら&#8203;数&#8203;時&#8203;間&#8203;か&#8203;か&#8203;る&#8203;場&#8203;合&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;処&#8203;理&#8203;済&#8203;み&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;保&#8203;存&#8203;し&#8203;て&#8203;お&#8203;く&#8203;こ&#8203;と&#8203;で、&#8203;処&#8203;理&#8203;時&#8203;間&#8203;の&#8203;か&#8203;か&#8203;る&#8203;処&#8203;理&#8203;を&#8203;省&#8203;略&#8203;し&#8203;て&#8203;作&#8203;業&#8203;で&#8203;き&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;重&#8203;要&#8203;な&#8203;テ&#8203;ク&#8203;ニッ&#8203;ク&#8203;の&#8203;一&#8203;つ&#8203;で&#8203;す。&#8203;今&#8203;回&#8203;は&#8203;メ&#8203;モ&#8203;リ&#8203;上&#8203;に&#8203;別&#8203;の&#8203;変&#8203;数&#8203;と&#8203;し&#8203;て&#8203;保&#8203;存&#8203;し&#8203;て&#8203;お&#8203;き&#8203;ま&#8203;す&#8203;が、&#8203;セッ&#8203;ショ&#8203;ン&#8203;が&#8203;閉&#8203;じ&#8203;ら&#8203;れ&#8203;る&#8203;際&#8203;に&#8203;処&#8203;理&#8203;済&#8203;み&#8203;デー&#8203;タ&#8203;も&#8203;ク&#8203;リ&#8203;ア&#8203;さ&#8203;れ&#8203;て&#8203;し&#8203;ま&#8203;う&#8203;こ&#8203;と&#8203;に&#8203;加&#8203;え&#8203;て、&#8203;大&#8203;量&#8203;の&#8203;デー&#8203;タ&#8203;で&#8203;あ&#8203;る&#8203;場&#8203;合&#8203;は&#8203;メ&#8203;モ&#8203;リ&#8203;上&#8203;に&#8203;保&#8203;存&#8203;し&#8203;て&#8203;お&#8203;く&#8203;と&#8203;メ&#8203;モ&#8203;リ&#8203;を&#8203;圧&#8203;迫&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;ファ&#8203;イ&#8203;ル&#8203;に&#8203;書&#8203;き&#8203;出&#8203;し&#8203;て&#8203;お&#8203;い&#8203;て&#8203;必&#8203;要&#8203;な&#8203;時&#8203;に&#8203;ファ&#8203;イ&#8203;ル&#8203;か&#8203;ら&#8203;読&#8203;み&#8203;込&#8203;む&#8203;の&#8203;が&#8203;良&#8203;い&#8203;方&#8203;法&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>　Pandas&#8203;に&#8203;は&#8203;様々&#8203;な&#8203;形&#8203;式&#8203;で&#8203;の&#8203;デー&#8203;タ&#8203;の&#8203;入&#8203;出&#8203;力&#8203;用&#8203;メ&#8203;ソッ&#8203;ド&#8203; (<a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html">リンク</a>) &#8203;が&#8203;用&#8203;意&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;例&#8203;え&#8203;ば、&#8203;デー&#8203;タ&#8203;が&#8203;圧&#8203;縮&#8203;さ&#8203;れ&#8203;て&#8203;型&#8203;が&#8203;保&#8203;存&#8203;さ&#8203;れ&#8203;る&#8203; <code>to_hdf</code> &#8203;メ&#8203;ソッ&#8203;ド&#8203; (<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_hdf.html">リンク</a>)&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;ファ&#8203;イ&#8203;ル&#8203;に&#8203;書&#8203;き&#8203;出&#8203;し、&#8203;対&#8203;応&#8203;す&#8203;る&#8203; <code>read_hdf</code> &#8203;メ&#8203;ソッ&#8203;ド&#8203; (<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_hdf.html">リンク</a>)&#8203;で&#8203;読&#8203;み&#8203;出&#8203;す&#8203;こ&#8203;と&#8203;で&#8203;簡&#8203;単&#8203;に&#8203;デー&#8203;タ&#8203;フ&#8203;レー&#8203;ム&#8203;を&#8203;読&#8203;み&#8203;書&#8203;き&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;平&#8203;日&#8203;を&#8203;指&#8203;定&#8203;し&#8203;て&#8203;デー&#8203;タ&#8203;の&#8203;リ&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;行&#8203;い、&#8203;欠&#8203;損&#8203;値&#8203;に&#8203;前&#8203;日&#8203;の&#8203;値&#8203;を&#8203;使&#8203;う&#8203;よ&#8203;う&#8203;に&#8203;前&#8203;方&#8203;補&#8203;完&#8203;し&#8203;た&#8203;結&#8203;果&#8203;が&#8203;期&#8203;待&#8203;通&#8203;り&#8203;に&#8203;なっ&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;しょ&#8203;う。&#8203;2020-07-23&#8203;及&#8203;び&#8203;2020-07-24&#8203;は&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;木&#8203;曜&#8203;日&#8203;及&#8203;び&#8203;金&#8203;曜&#8203;日&#8203;の&#8203;祝&#8203;日&#8203;で&#8203;し&#8203;た&#8203;の&#8203;で、&#8203;2020-07-23&#8203;及&#8203;び&#8203;2020-07-24&#8203;に&#8203;2020-07-22&#8203;の&#8203;値&#8203;が&#8203;入っ&#8203;て&#8203;い&#8203;れ&#8203;ば&#8203;良&#8203;い&#8203;こ&#8203;と&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 上記は比較的時間のかかる処理なので、処理済みデータを別に残しておきます。</span>
df_work = df_feature.copy()

<span class="comment"># 処理後に木曜日、金曜日が祝日である2020-07-23、2020-07-24のレコードが前方補完されていることを確認します。</span>
df_work.loc[(<span class="predefined">slice</span>(<span class="predefined-constant">None</span>), <span class="predefined">slice</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">2020-07-22</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-07-27</span><span class="delimiter">&quot;</span></span>)),].head(<span class="integer">4</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;下&#8203;図&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;木&#8203;曜&#8203;及&#8203;び&#8203;金&#8203;曜&#8203;の&#8203;祝&#8203;日&#8203;で&#8203;あ&#8203;る&#8203;2020-07-23&#8203;及&#8203;び&#8203;2020-07-24&#8203;に&#8203;2020-07-22&#8203;の&#8203;値&#8203;が&#8203;入っ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;確&#8203;認&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple2.png" alt="処理結果" width="50%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;以&#8203;下&#8203;の&#8203;コー&#8203;ド&#8203;で&#8203;デー&#8203;タ&#8203;を&#8203;整&#8203;え&#8203;ま&#8203;す。&#8203;イ&#8203;ン&#8203;デッ&#8203;ク&#8203;ス&#8203;と&#8203;カ&#8203;ラ&#8203;ム&#8203;名&#8203;を&#8203;調&#8203;整&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># インデックスが銘柄コードと日付になっているため、日付のみに変更します。</span>
df_work = df_work.reset_index(level=[<span class="integer">0</span>])
<span class="comment"># カラム名を変更します。</span>
df_work.rename(
    columns={<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">pct_change</span><span class="delimiter">&quot;</span></span>},
    inplace=<span class="predefined-constant">True</span>,
)
<span class="comment"># データをpred_start_dt以降の日付に絞り込みます。</span>
df_work = df_work.loc[df_work.index &gt;= pred_start_dt]</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;特&#8203;徴&#8203;量&#8203;が&#8203;生&#8203;成&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># df_workの最初の3行を出力する。</span>
df_work.head(<span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple3.png" alt="処理結果" width="50%">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ポートフォリオ組成を行う上での注意事項">3.7.5. ポートフォリオ組成を行う上での注意事項</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;デー&#8203;タ&#8203;サ&#8203;イ&#8203;エ&#8203;ン&#8203;ス&#8203;的&#8203;な&#8203;手&#8203;法&#8203;で&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;を&#8203;構&#8203;築&#8203;す&#8203;る&#8203;上&#8203;で&#8203;重&#8203;要&#8203;な&#8203;の&#8203;は、&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;に&#8203;合&#8203;致&#8203;し&#8203;た&#8203;銘&#8203;柄&#8203;選&#8203;択&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;組&#8203;成&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;す。&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;を&#8203;デー&#8203;タ&#8203;サ&#8203;イ&#8203;エ&#8203;ン&#8203;ス&#8203;な&#8203;的&#8203;手&#8203;法&#8203;で&#8203;構&#8203;築&#8203;し&#8203;て&#8203;い&#8203;る&#8203;場&#8203;合、&#8203;そ&#8203;こ&#8203;か&#8203;ら&#8203;実&#8203;現&#8203;し&#8203;た&#8203;い&#8203;収&#8203;益&#8203;は、&#8203;統&#8203;計&#8203;的&#8203;に&#8203;他&#8203;の&#8203;銘&#8203;柄&#8203;よ&#8203;り&#8203;も&#8203;収&#8203;益&#8203;性&#8203;が&#8203;高&#8203;い&#8203;銘&#8203;柄&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;選&#8203;択&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;達&#8203;成&#8203;し&#8203;て&#8203;い&#8203;る&#8203;は&#8203;ず&#8203;で&#8203;す。&#8203;し&#8203;か&#8203;し、&#8203;実&#8203;際&#8203;に&#8203;良&#8203;い&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;て&#8203;も、&#8203;そ&#8203;こ&#8203;か&#8203;ら&#8203;収&#8203;益&#8203;を&#8203;実&#8203;現&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;は&#8203;工&#8203;夫&#8203;が&#8203;必&#8203;要&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;そ&#8203;の&#8203;際&#8203;の&#8203;注&#8203;意&#8203;点&#8203;を&#8203;考&#8203;察&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect4">
<h5 id="_取引対象銘柄数の選択">取引対象銘柄数の選択</h5>
<div class="paragraph">
<p>　&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;か&#8203;ら&#8203;収&#8203;益&#8203;を&#8203;実&#8203;現&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;は、&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;組&#8203;成&#8203;す&#8203;る&#8203;取&#8203;引&#8203;対&#8203;象&#8203;銘&#8203;柄&#8203;の&#8203;数&#8203;の&#8203;選&#8203;択&#8203;が&#8203;重&#8203;要&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;か&#8203;ら&#8203;算&#8203;出&#8203;さ&#8203;れ&#8203;る&#8203;ス&#8203;コ&#8203;ア&#8203;が&#8203;高&#8203;い&#8203;収&#8203;益&#8203;を&#8203;仮&#8203;に&#8203;予&#8203;測&#8203;で&#8203;き&#8203;て&#8203;い&#8203;た&#8203;と&#8203;し&#8203;て&#8203;も、&#8203;取&#8203;引&#8203;対&#8203;象&#8203;銘&#8203;柄&#8203;の&#8203;数&#8203;が&#8203;少&#8203;な&#8203;す&#8203;ぎ&#8203;る&#8203;と&#8203;決&#8203;算&#8203;な&#8203;ど&#8203;の&#8203;銘&#8203;柄&#8203;の&#8203;個々&#8203;の&#8203;要&#8203;因&#8203;に&#8203;よ&#8203;り&#8203;予&#8203;測&#8203;し&#8203;た&#8203;収&#8203;益&#8203;性&#8203;の&#8203;効&#8203;果&#8203;が&#8203;消&#8203;さ&#8203;れ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;同&#8203;一&#8203;の&#8203;合&#8203;計&#8203;金&#8203;額&#8203;で&#8203;株&#8203;式&#8203;を&#8203;購&#8203;入&#8203;す&#8203;る&#8203;際、&#8203;ス&#8203;コ&#8203;ア&#8203;の&#8203;上&#8203;位&#8203;5&#8203;銘&#8203;柄&#8203;で&#8203;組&#8203;成&#8203;し&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;と&#8203;上&#8203;位&#8203;20&#8203;銘&#8203;柄&#8203;で&#8203;組&#8203;成&#8203;し&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;ど&#8203;ち&#8203;ら&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;が、&#8203;銘&#8203;柄&#8203;の&#8203;個々&#8203;の&#8203;要&#8203;因&#8203;の&#8203;影&#8203;響&#8203;を&#8203;受&#8203;け&#8203;に&#8203;く&#8203;い&#8203;か&#8203;を&#8203;考&#8203;え&#8203;る&#8203;と、&#8203;20&#8203;銘&#8203;柄&#8203;の&#8203;方&#8203;が&#8203;影&#8203;響&#8203;を&#8203;受&#8203;け&#8203;に&#8203;く&#8203;い&#8203;こ&#8203;と&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;た&#8203;だ&#8203;し、&#8203;取&#8203;引&#8203;銘&#8203;柄&#8203;数&#8203;を&#8203;増&#8203;や&#8203;し&#8203;す&#8203;ぎ&#8203;る&#8203;と&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;の&#8203;実&#8203;現&#8203;に&#8203;必&#8203;要&#8203;な&#8203;現&#8203;金&#8203;が&#8203;増&#8203;え&#8203;た&#8203;り、&#8203;ス&#8203;コ&#8203;ア&#8203;の&#8203;有&#8203;効&#8203;性&#8203;が&#8203;あ&#8203;ま&#8203;り&#8203;無&#8203;い&#8203;銘&#8203;柄&#8203;も&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;最&#8203;終&#8203;的&#8203;な&#8203;購&#8203;入&#8203;銘&#8203;柄&#8203;数&#8203;は&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;通&#8203;し&#8203;て&#8203;調&#8203;整&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;な&#8203;お、&#8203;デー&#8203;タ&#8203;サ&#8203;イ&#8203;エ&#8203;ン&#8203;ス&#8203;的&#8203;手&#8203;法&#8203;の&#8203;利&#8203;用&#8203;用&#8203;途&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;ま&#8203;れ&#8203;に&#8203;発&#8203;生&#8203;す&#8203;る&#8203;現&#8203;象&#8203;を&#8203;探&#8203;索&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;な&#8203;方&#8203;法&#8203;(&#8203;ア&#8203;ノ&#8203;マ&#8203;リー&#8203;ディ&#8203;テ&#8203;ク&#8203;ショ&#8203;ン&#8203;な&#8203;ど&#8203;と&#8203;呼&#8203;ば&#8203;れ&#8203;ま&#8203;す&#8203;)&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;は&#8203;20&#8203;銘&#8203;柄&#8203;も&#8203;有&#8203;効&#8203;な&#8203;ス&#8203;コ&#8203;ア&#8203;が&#8203;出&#8203;て&#8203;い&#8203;な&#8203;い&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;場&#8203;合、&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;通&#8203;し&#8203;て、&#8203;有&#8203;効&#8203;性&#8203;が&#8203;高&#8203;い&#8203;ス&#8203;コ&#8203;ア&#8203;の&#8203;し&#8203;き&#8203;い&#8203;値&#8203;を&#8203;探&#8203;索&#8203;し、&#8203;あ&#8203;る&#8203;一&#8203;定&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;を&#8203;超&#8203;え&#8203;て&#8203;い&#8203;た&#8203;ら&#8203;売&#8203;買&#8203;を&#8203;行&#8203;う&#8203;よ&#8203;う&#8203;な&#8203;ロ&#8203;ジッ&#8203;ク&#8203;を&#8203;構&#8203;築&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_購入金額の決定">購入金額の決定</h5>
<div class="paragraph">
<p>　&#8203;購&#8203;入&#8203;金&#8203;額&#8203;は&#8203;特&#8203;別&#8203;な&#8203;理&#8203;由&#8203;が&#8203;無&#8203;い&#8203;限&#8203;り&#8203;は、&#8203;銘&#8203;柄&#8203;ご&#8203;と&#8203;に&#8203;あ&#8203;る&#8203;程&#8203;度&#8203;均&#8203;等&#8203;に&#8203;な&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;購&#8203;入&#8203;す&#8203;る&#8203;の&#8203;が&#8203;良&#8203;い&#8203;で&#8203;しょ&#8203;う。&#8203;直&#8203;感&#8203;的&#8203;に&#8203;は&#8203;予&#8203;測&#8203;ス&#8203;コ&#8203;ア&#8203;の&#8203;上&#8203;位&#8203;の&#8203;銘&#8203;柄&#8203;を、&#8203;よ&#8203;り&#8203;多&#8203;く&#8203;購&#8203;入&#8203;し&#8203;た&#8203;い&#8203;と&#8203;考&#8203;え&#8203;る&#8203;か&#8203;も&#8203;し&#8203;れ&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;こ&#8203;の&#8203;試&#8203;み&#8203;は&#8203;結&#8203;果&#8203;的&#8203;に&#8203;予&#8203;測&#8203;ス&#8203;コ&#8203;ア&#8203;の&#8203;上&#8203;位&#8203;の&#8203;銘&#8203;柄&#8203;の&#8203;個々&#8203;の&#8203;要&#8203;因&#8203;に&#8203;よ&#8203;り&#8203;負&#8203;け&#8203;る&#8203;可&#8203;能&#8203;性&#8203;を&#8203;増&#8203;や&#8203;す&#8203;こ&#8203;と&#8203;に&#8203;繋&#8203;が&#8203;り&#8203;ま&#8203;す。&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;収&#8203;益&#8203;性&#8203;を&#8203;予&#8203;測&#8203;し&#8203;て&#8203;み&#8203;る&#8203;と、&#8203;そ&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;の&#8203;統&#8203;計&#8203;的&#8203;な&#8203;効&#8203;果&#8203;は&#8203;さ&#8203;ほ&#8203;ど&#8203;強&#8203;く&#8203;な&#8203;い&#8203;(&#8203;未&#8203;来&#8203;の&#8203;値&#8203;動&#8203;き&#8203;に&#8203;対&#8203;す&#8203;る&#8203;相&#8203;関&#8203;係&#8203;数&#8203;は&#8203;0.1&#8203;か&#8203;ら&#8203;高&#8203;く&#8203;て&#8203;も&#8203;0.2&#8203;程&#8203;度&#8203;に&#8203;収&#8203;ま&#8203;る&#8203;)&#8203;こ&#8203;と&#8203;が&#8203;多&#8203;く、&#8203;上&#8203;位&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;の&#8203;銘&#8203;柄&#8203;に&#8203;対&#8203;し&#8203;て&#8203;取&#8203;引&#8203;金&#8203;額&#8203;の&#8203;割&#8203;合&#8203;を&#8203;よ&#8203;り&#8203;多&#8203;く&#8203;す&#8203;る&#8203;ほ&#8203;ど&#8203;の&#8203;統&#8203;計&#8203;的&#8203;な&#8203;強&#8203;度&#8203;は&#8203;観&#8203;測&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;多&#8203;い&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;ま&#8203;た、&#8203;最&#8203;上&#8203;位&#8203;の&#8203;予&#8203;測&#8203;ス&#8203;コ&#8203;ア&#8203;の&#8203;銘&#8203;柄&#8203;に&#8203;は&#8203;注&#8203;意&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。&#8203;デー&#8203;タ&#8203;サ&#8203;イ&#8203;エ&#8203;ン&#8203;ス&#8203;的&#8203;な&#8203;手&#8203;法&#8203;で&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;る&#8203;と、&#8203;外&#8203;れ&#8203;値&#8203;等&#8203;に&#8203;反&#8203;応&#8203;す&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;出&#8203;来&#8203;上&#8203;が&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;動&#8203;き&#8203;は、&#8203;例&#8203;え&#8203;ば&#8203;特&#8203;別&#8203;損&#8203;失&#8203;の&#8203;適&#8203;時&#8203;開&#8203;示&#8203;等&#8203;の&#8203;コー&#8203;ポ&#8203;レー&#8203;ショ&#8203;ン&#8203;ア&#8203;ク&#8203;ショ&#8203;ン&#8203;で&#8203;引&#8203;き&#8203;起&#8203;こ&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;事&#8203;が&#8203;多&#8203;く、&#8203;リ&#8203;ス&#8203;ク&#8203;回&#8203;避&#8203;の&#8203;観&#8203;点&#8203;か&#8203;ら&#8203;は&#8203;そ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203;取&#8203;引&#8203;対&#8203;象&#8203;に&#8203;含&#8203;め&#8203;る&#8203;べ&#8203;き&#8203;で&#8203;は&#8203;あ&#8203;り&#8203;ま&#8203;せ&#8203;ん。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;デー&#8203;タ&#8203;に&#8203;は、&#8203;TDnet&#8203;の&#8203;デー&#8203;タ&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;そ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;銘&#8203;柄&#8203;を&#8203;予&#8203;め&#8203;取&#8203;引&#8203;対&#8203;象&#8203;の&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;か&#8203;ら&#8203;除&#8203;外&#8203;す&#8203;る&#8203;ア&#8203;プ&#8203;ロー&#8203;チ&#8203;も&#8203;後&#8203;ほ&#8203;ど&#8203;紹&#8203;介&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ポートフォリオの組成手順">3.7.6. ポートフォリオの組成手順</h4>
<div class="paragraph">
<p>　&#8203;今&#8203;回&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;で&#8203;は&#8203;買&#8203;付&#8203;日&#8203;前&#8203;週&#8203;の&#8203;金&#8203;曜&#8203;日&#8203;終&#8203;値&#8203;時&#8203;点&#8203;を&#8203;銘&#8203;柄&#8203;選&#8203;択&#8203;の&#8203;基&#8203;準&#8203;と&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;金&#8203;曜&#8203;日&#8203;の&#8203;デー&#8203;タ&#8203;の&#8203;み&#8203;に&#8203;絞&#8203;り&#8203;込&#8203;み&#8203;ま&#8203;す。&#8203;す&#8203;で&#8203;に&#8203;「<a href="#anchor-3.7.4">3.7.4. &#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;構&#8203;築&#8203;戦&#8203;略&#8203;の&#8203;策&#8203;定&#8203;</a>」&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;金&#8203;曜&#8203;日&#8203;が&#8203;祝&#8203;日&#8203;の&#8203;場&#8203;合&#8203;の&#8203;処&#8203;理&#8203;は&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;そ&#8203;の&#8203;ま&#8203;ま&#8203;金&#8203;曜&#8203;日&#8203;に&#8203;絞&#8203;り&#8203;込&#8203;ん&#8203;で&#8203;問&#8203;題&#8203;あ&#8203;り&#8203;ま&#8203;せ&#8203;ん。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 金曜日のデータのみに絞り込みます</span>
df_work = df_work.loc[df_work.index.dayofweek == <span class="integer">4</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;金&#8203;曜&#8203;日&#8203;の&#8203;デー&#8203;タ&#8203;の&#8203;み&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># df_workの最初の2行を出力する。</span>
df_work.head(<span class="integer">2</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple4.png" alt="処理結果" width="50%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;次&#8203;に、&#8203;日&#8203;付&#8203;毎&#8203;に&#8203;グ&#8203;ルー&#8203;プ&#8203;化&#8203;し&#8203;て&#8203;か&#8203;ら、&#8203;下&#8203;落&#8203;率&#8203;上&#8203;位&#8203;25&#8203;銘&#8203;柄&#8203;を&#8203;選&#8203;択&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;評&#8203;価&#8203;で&#8203;は、&#8203;出&#8203;力&#8203;さ&#8203;れ&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;記&#8203;載&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;順&#8203;番&#8203;で&#8203;銘&#8203;柄&#8203;が&#8203;購&#8203;入&#8203;さ&#8203;れ&#8203;る&#8203;た&#8203;め、&#8203;な&#8203;る&#8203;べ&#8203;く&#8203;リ&#8203;ター&#8203;ン&#8203;が&#8203;高&#8203;く&#8203;な&#8203;る&#8203;銘&#8203;柄&#8203;か&#8203;ら&#8203;先&#8203;に&#8203;出&#8203;力&#8203;し&#8203;て&#8203;購&#8203;入&#8203;さ&#8203;れ&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;最&#8203;適&#8203;と&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;下&#8203;落&#8203;率&#8203;が&#8203;高&#8203;い&#8203;銘&#8203;柄&#8203;ほ&#8203;ど&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;大&#8203;き&#8203;く&#8203;な&#8203;る&#8203;と&#8203;の&#8203;仮&#8203;説&#8203;を&#8203;立&#8203;て&#8203;て、&#8203;`pct_change` &#8203;に&#8203;つ&#8203;い&#8203;て&#8203;昇&#8203;順&#8203;で&#8203;並&#8203;べ&#8203;替&#8203;え&#8203;て&#8203;か&#8203;ら&#8203;銘&#8203;柄&#8203;を&#8203;選&#8203;択&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;こ&#8203;う&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;下&#8203;落&#8203;率&#8203;が&#8203;高&#8203;い&#8203;銘&#8203;柄&#8203;順&#8203;に&#8203;出&#8203;力&#8203;さ&#8203;れ&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;な&#8203;お、&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;説&#8203;明&#8203;を&#8203;シ&#8203;ン&#8203;プ&#8203;ル&#8203;に&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;特&#8203;に&#8203;理&#8203;由&#8203;な&#8203;く&#8203;25&#8203;銘&#8203;柄&#8203;を&#8203;選&#8203;択&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;例&#8203;え&#8203;ば、&#8203;5&#8203;銘&#8203;柄&#8203;か&#8203;ら&#8203;50&#8203;銘&#8203;柄&#8203;ま&#8203;で&#8203;5&#8203;銘&#8203;柄&#8203;ず&#8203;つ&#8203;増&#8203;加&#8203;さ&#8203;せ&#8203;た&#8203;合&#8203;計&#8203;10&#8203;個&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;組&#8203;成&#8203;し&#8203;て&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;で&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;を&#8203;比&#8203;較&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;こ&#8203;の&#8203;戦&#8203;略&#8203;に&#8203;お&#8203;け&#8203;る&#8203;最&#8203;適&#8203;な&#8203;選&#8203;択&#8203;銘&#8203;柄&#8203;数&#8203;を&#8203;見&#8203;つ&#8203;け&#8203;ら&#8203;れ&#8203;る&#8203;か&#8203;も&#8203;し&#8203;れ&#8203;ま&#8203;せ&#8203;ん。&#8203;ま&#8203;た、&#8203;そ&#8203;の&#8203;場&#8203;合、&#8203;50&#8203;銘&#8203;柄&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;組&#8203;成&#8203;し&#8203;て&#8203;お&#8203;い&#8203;て、&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;投&#8203;入&#8203;時&#8203;に&#8203;銘&#8203;柄&#8203;数&#8203;を&#8203;絞&#8203;り&#8203;込&#8203;む&#8203;ロ&#8203;ジッ&#8203;ク&#8203;を&#8203;組&#8203;む&#8203;こ&#8203;と&#8203;で&#8203;処&#8203;理&#8203;時&#8203;間&#8203;を&#8203;最&#8203;適&#8203;化&#8203;で&#8203;き&#8203;る&#8203;か&#8203;も&#8203;し&#8203;れ&#8203;ま&#8203;せ&#8203;ん。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 日付毎に処理するためグループ化します</span>
grouped_work = df_work.groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>, as_index=<span class="predefined-constant">False</span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 選択する銘柄数を指定します</span>
number_of_portfolio_stocks = <span class="integer">25</span>

<span class="comment"># ポートフォリオの組成方法を戦略に応じて調整します</span>
strategies = {
    <span class="comment"># リターン・リバーサル戦略</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">reversal</span><span class="delimiter">&quot;</span></span>: {<span class="string"><span class="delimiter">&quot;</span><span class="content">asc</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">True</span>},
    <span class="comment"># トレンドフォロー戦略</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">trend</span><span class="delimiter">&quot;</span></span>: {<span class="string"><span class="delimiter">&quot;</span><span class="content">asc</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">False</span>},
}

<span class="comment"># 戦略に応じたポートフォリオを保存します</span>
df_portfolios = {}

<span class="comment"># strategy_id が設定されていない場合は全ての戦略のポートフォリオを作成します</span>
<span class="keyword">if</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">strategy_id</span><span class="delimiter">&quot;</span></span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="predefined">locals</span>():
    strategy_id = <span class="predefined-constant">None</span>

<span class="keyword">for</span> i <span class="keyword">in</span> [strategy_id] <span class="keyword">if</span> strategy_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="predefined-constant">None</span> <span class="keyword">else</span> strategies.keys():
    <span class="comment">#  日付毎に戦略に応じた上位25銘柄を選択します。</span>
    df_portfolios[i] = grouped_work.apply(
        <span class="keyword">lambda</span> x: x.sort_values(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">pct_change</span><span class="delimiter">&quot;</span></span>, ascending=strategies[i][<span class="string"><span class="delimiter">&quot;</span><span class="content">asc</span><span class="delimiter">&quot;</span></span>]
        ).head(number_of_portfolio_stocks)
    )</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;以&#8203;下&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>1&#8203;つ&#8203;の&#8203;週&#8203;に&#8203;対&#8203;し&#8203;て&#8203;25&#8203;銘&#8203;柄&#8203;選&#8203;択&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と</p>
</li>
<li>
<p>戦&#8203;略&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;pct_change&#8203;の&#8203;値&#8203;が&#8203;反&#8203;転&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 結果結合用</span>
buff = []
<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i <span class="keyword">in</span> df_portfolios.keys():
    <span class="comment"># ポートフォリオを表示用に保存</span>
    buff.append(
        df_portfolios[i]
        <span class="comment"># マルチインデックスは操作しにくいので日付のみに変更します</span>
        .reset_index(level=[<span class="integer">0</span>])
        <span class="comment"># 先頭の26レコードを取得します</span>
        .head(<span class="integer">26</span>)
        <span class="comment"># 結合した後の列名をわかりやすくするために変更します</span>
        .rename(columns={v: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{i}_</span><span class="delimiter">&quot;</span></span> + v <span class="keyword">for</span> v <span class="keyword">in</span> df_portfolios[i].columns})
    )
<span class="comment"># 結合して保存</span>
pd.concat(buff, axis=<span class="integer">1</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple5.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;組&#8203;み&#8203;入&#8203;れ&#8203;る&#8203;銘&#8203;柄&#8203;を&#8203;決&#8203;め&#8203;た&#8203;の&#8203;で、&#8203;各&#8203;銘&#8203;柄&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;購&#8203;入&#8203;金&#8203;額&#8203;を&#8203;指&#8203;定&#8203;し&#8203;ま&#8203;す。&#8203;今&#8203;回&#8203;は&#8203;シ&#8203;ン&#8203;プ&#8203;ル&#8203;に&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;50,000&#8203;円&#8203;を&#8203;一&#8203;律&#8203;で&#8203;指&#8203;定&#8203;し&#8203;て&#8203;購&#8203;入&#8203;金&#8203;額&#8203;の&#8203;総&#8203;額&#8203;を&#8203;25&#8203;銘&#8203;柄&#8203;分&#8203;で&#8203;合&#8203;計&#8203;125&#8203;万&#8203;と&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;1&#8203;株&#8203;の&#8203;価&#8203;格&#8203;が&#8203;5&#8203;万&#8203;円&#8203;を&#8203;超&#8203;え&#8203;て&#8203;い&#8203;る&#8203;銘&#8203;柄&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;て&#8203;も&#8203;予&#8203;算&#8203;上&#8203;限&#8203;に&#8203;近&#8203;い&#8203;金&#8203;額&#8203;を&#8203;購&#8203;入&#8203;で&#8203;き&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;株&#8203;価&#8203;を&#8203;参&#8203;照&#8203;し&#8203;て&#8203;銘&#8203;柄&#8203;数&#8203;や&#8203;購&#8203;入&#8203;金&#8203;額&#8203;を&#8203;調&#8203;整&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;検&#8203;討&#8203;し&#8203;て&#8203;み&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;な&#8203;お、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;は、&#8203;対&#8203;象&#8203;週&#8203;の&#8203;月&#8203;曜&#8203;日&#8203;日&#8203;付&#8203;を&#8203;指&#8203;定&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;金&#8203;曜&#8203;日&#8203;か&#8203;ら&#8203;月&#8203;曜&#8203;日&#8203;日&#8203;付&#8203;に&#8203;変&#8203;更&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 銘柄ごとの購入金額を指定</span>
budget = <span class="integer">50000</span>
<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i <span class="keyword">in</span> df_portfolios.keys():
    <span class="comment"># 購入株式数を設定</span>
    df_portfolios[i].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">budget</span><span class="delimiter">&quot;</span></span>] = budget
    <span class="comment"># インデックスを日付のみにします</span>
    df_portfolios[i].reset_index(level=[<span class="integer">0</span>], inplace=<span class="predefined-constant">True</span>)
    <span class="comment"># 金曜日から月曜日日付に変更</span>
    df_portfolios[i].index = df_portfolios[i].index + pd.Timedelta(<span class="string"><span class="delimiter">&quot;</span><span class="content">3D</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>こ&#8203;れ&#8203;で&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;が&#8203;完&#8203;成&#8203;し&#8203;ま&#8203;し&#8203;た。&#8203;完&#8203;成&#8203;し&#8203;た&#8203;デー&#8203;タ&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i <span class="keyword">in</span> df_portfolios.keys():
    <span class="comment"># 戦略名を表示</span>
    display(i)
    <span class="comment"># 表示</span>
    display(df_portfolios[i].head(<span class="integer">3</span>))</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple6.png" alt="処理結果" width="50%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;組&#8203;成&#8203;に&#8203;用&#8203;い&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;や&#8203;そ&#8203;の&#8203;他&#8203;の&#8203;カ&#8203;ラ&#8203;ム&#8203;が&#8203;残っ&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;決&#8203;め&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;出&#8203;力&#8203;フォー&#8203;マッ&#8203;ト&#8203;と&#8203;一&#8203;致&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;出&#8203;力&#8203;を&#8203;調&#8203;整&#8203;し&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_出力の調整">3.7.7. 出力の調整</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;出&#8203;力&#8203;フォー&#8203;マッ&#8203;ト&#8203;は&#8203;「<a href="#anchor-3.3.4">3.3.4. &#8203;提&#8203;出&#8203;す&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;予&#8203;測&#8203;出&#8203;力&#8203;の&#8203;定&#8203;義&#8203;</a>」&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;出&#8203;力&#8203;フォー&#8203;マッ&#8203;ト&#8203;に&#8203;合&#8203;わ&#8203;せ&#8203;る&#8203;た&#8203;め&#8203;に&#8203;イ&#8203;ン&#8203;デッ&#8203;ク&#8203;ス&#8203;名&#8203;や&#8203;カ&#8203;ラ&#8203;ム&#8203;数&#8203;を&#8203;調&#8203;整&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i <span class="keyword">in</span> df_portfolios.keys():
    <span class="comment"># インデックス名を設定</span>
    df_portfolios[i].index.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 出力するカラムを絞り込みます</span>
    df_portfolios[i] = df_portfolios[i].loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">budget</span><span class="delimiter">&quot;</span></span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;が&#8203;出&#8203;力&#8203;フォー&#8203;マッ&#8203;ト&#8203;と&#8203;一&#8203;致&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i <span class="keyword">in</span> df_portfolios.keys():
    <span class="comment"># ポートフォリオを確認</span>
    display(df_portfolios[i].head(<span class="integer">3</span>))</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple7.png" alt="処理結果" width="30%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203; <code>ScoringService.predict</code> &#8203;の&#8203;出&#8203;力&#8203;仕&#8203;様&#8203;は&#8203;csv&#8203;形&#8203;式&#8203;の&#8203;文&#8203;字&#8203;列&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;仕&#8203;様&#8203;に&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;出&#8203;力&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 出力保存用</span>
outputs = {}
<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i <span class="keyword">in</span> df_portfolios.keys():
    <span class="comment"># 出力します</span>
    out = io.StringIO()
    <span class="comment"># CSV形式で出力</span>
    df_portfolios[i].to_csv(out, header=<span class="predefined-constant">True</span>)
    <span class="comment"># 出力を保存</span>
    outputs[i] = out.getvalue()</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i <span class="keyword">in</span> outputs.keys():
    <span class="comment"># 戦略名を表示</span>
    print(f<span class="string"><span class="delimiter">'</span><span class="content">// &quot;{i}&quot;</span><span class="delimiter">'</span></span>)
    <span class="comment"># 出力を確認</span>
    print(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>.join(outputs[i].split(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>)[:<span class="integer">4</span>]))</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>// &quot;reversal&quot;
date,Local Code,budget
2020-01-06,4592,50000
2020-01-06,3254,50000
2020-01-06,6875,50000
// &quot;trend&quot;
date,Local Code,budget
2020-01-06,6387,50000
2020-01-06,4772,50000
2020-01-06,6195,50000</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;用&#8203;に&#8203;出&#8203;力&#8203;を&#8203;保&#8203;存&#8203;し&#8203;て&#8203;お&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i <span class="keyword">in</span> outputs.keys():
    <span class="comment"># 出力を保存します。</span>
    <span class="keyword">with</span> <span class="predefined">open</span>(f<span class="string"><span class="delimiter">&quot;</span><span class="content">chapter03-tutorial-01-{i}.csv</span><span class="delimiter">&quot;</span></span>, mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">w</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
        <span class="comment"># ポートフォリオをファイルに書き出します。</span>
        f.write(outputs[i])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_バックテストの実行">3.7.8. バックテストの実行</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203; Public LB &#8203;お&#8203;よ&#8203;び&#8203; Private LB &#8203;と&#8203;同&#8203;等&#8203;の&#8203;評&#8203;価&#8203;ロ&#8203;ジッ&#8203;ク&#8203;を&#8203;実&#8203;装&#8203;し&#8203;た&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;用&#8203;の&#8203; <code>backtest.py</code> &#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て、&#8203;作&#8203;成&#8203;し&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;評&#8203;価&#8203;し&#8203;ま&#8203;す。
バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;使&#8203;用&#8203;法&#8203;な&#8203;ど&#8203;の&#8203;詳&#8203;細&#8203;は、&#8203;「<a href="#anchor-3.6">3.6. &#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;環&#8203;境&#8203;の&#8203;構&#8203;築&#8203;</a>」&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>　&#8203;初&#8203;め&#8203;に&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;際&#8203;に&#8203;必&#8203;要&#8203;な&#8203;デー&#8203;タ&#8203;を&#8203;準&#8203;備&#8203;し&#8203;ま&#8203;す。&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;実&#8203;行&#8203;に&#8203;は&#8203;以&#8203;下&#8203;の&#8203;3&#8203;つ&#8203;の&#8203;デー&#8203;タ&#8203;が&#8203;必&#8203;要&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ユ&#8203;ニ&#8203;バー&#8203;ス&#8203; (stock_list.csv.gz)</p>
</li>
<li>
<p>株&#8203;価&#8203; (stock_price.csv.gz)</p>
</li>
<li>
<p>テ&#8203;ス&#8203;ト&#8203;対&#8203;象&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>　<code>Backtest.prepare_data</code> &#8203;に&#8203;1&#8203;お&#8203;よ&#8203;び&#8203;2&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;保&#8203;存&#8203;し&#8203;て&#8203;い&#8203;る&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;へ&#8203;の&#8203;パ&#8203;ス&#8203;を&#8203;指&#8203;定&#8203;し&#8203;て、&#8203;必&#8203;要&#8203;な&#8203;デー&#8203;タ&#8203;を&#8203;ロー&#8203;ド&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># データを保存しているディレクトリを指定します。</span>
backtest_dataset_dir = dataset_dir
<span class="comment"># バックテストに必要なデータを読み込みます。</span>
backtest_codes, backtest_price = Backtest.prepare_data(backtest_dataset_dir)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;対&#8203;象&#8203;の&#8203;戦&#8203;略&#8203;で&#8203;あ&#8203;る&#8203;リ&#8203;ター&#8203;ン・&#8203;リ&#8203;バー&#8203;サ&#8203;ル&#8203;戦&#8203;略&#8203;と&#8203;ト&#8203;レ&#8203;ン&#8203;ド&#8203;フォ&#8203;ロー&#8203;戦&#8203;略&#8203;を&#8203;定&#8203;義&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># ポートフォリオの組成方法</span>
backtest_strategies = {
    <span class="comment"># リターン・リバーサル戦略</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">reversal</span><span class="delimiter">&quot;</span></span>: {},
    <span class="comment"># トレンドフォロー戦略</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">trend</span><span class="delimiter">&quot;</span></span>: {},
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>　<code>Backtest.load_submit</code> &#8203;に&#8203;テ&#8203;ス&#8203;ト&#8203;対&#8203;象&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;保&#8203;存&#8203;し&#8203;た&#8203;ファ&#8203;イ&#8203;ル&#8203;へ&#8203;の&#8203;パ&#8203;ス&#8203;を&#8203;指&#8203;定&#8203;し&#8203;て&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。&#8203;`load_submit` &#8203;で&#8203;は&#8203;デー&#8203;タ&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;時&#8203;に&#8203;フォー&#8203;マッ&#8203;ト&#8203;の&#8203;チェッ&#8203;ク&#8203;を&#8203;し&#8203;た&#8203;り、&#8203;レ&#8203;コー&#8203;ド&#8203;順&#8203;を&#8203;付&#8203;与&#8203;す&#8203;る&#8203;な&#8203;ど&#8203;の&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;実&#8203;行&#8203;の&#8203;た&#8203;め&#8203;の&#8203;前&#8203;処&#8203;理&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># ポートフォリオデータ保存用</span>
df_submits = {}
<span class="comment"># 先ほど出力したポートフィリオデータを読み込みます</span>
<span class="keyword">for</span> i <span class="keyword">in</span> backtest_strategies.keys():
    <span class="comment"># ポートフォリオを読み込み</span>
    df_submits[i] = Backtest.load_submit(f<span class="string"><span class="delimiter">&quot;</span><span class="content">chapter03-tutorial-01-{i}.csv</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　3&#8203;つ&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;指&#8203;定&#8203;し&#8203;て&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;行&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># バックテスト結果リターン情報保存用</span>
results = {}
<span class="comment"># バックテスト結果銘柄情報保存用</span>
stocks = {}
<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i <span class="keyword">in</span> tqdm(backtest_strategies.keys()):
    <span class="comment"># バックテストを実行します</span>
    results[i], stocks[i] = Backtest.run(df_submits[i], backtest_codes, backtest_price)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple8.png" alt="処理結果" width="50%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;返&#8203;り&#8203;値&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203;評&#8203;価&#8203;は&#8203;下&#8203;記&#8203;で&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># バックテスト結果のサマリー</span>
results[<span class="string"><span class="delimiter">&quot;</span><span class="content">reversal</span><span class="delimiter">&quot;</span></span>].head(<span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple9.png" alt="処理結果" width="100%">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 銘柄毎の情報</span>
stocks[<span class="string"><span class="delimiter">&quot;</span><span class="content">reversal</span><span class="delimiter">&quot;</span></span>].head(<span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple10.png" alt="処理結果" width="70%">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_バックテストの評価">3.7.9. バックテストの評価</h4>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;行&#8203;し&#8203;て&#8203;取&#8203;得&#8203;し&#8203;た、&#8203;週&#8203;毎&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;情&#8203;報&#8203;と&#8203;各&#8203;銘&#8203;柄&#8203;毎&#8203;の&#8203;購&#8203;入&#8203;結&#8203;果&#8203;数&#8203;の&#8203;情&#8203;報&#8203;を&#8203;評&#8203;価&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。&#8203;各&#8203;評&#8203;価&#8203;項&#8203;目&#8203;の&#8203;定&#8203;義&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;「<a href="#anchor-3.6.4">3.6.4. &#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;評&#8203;価&#8203;軸&#8203;と&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;</a>」&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>　&#8203;結&#8203;果&#8203;の&#8203;評&#8203;価&#8203;と&#8203;し&#8203;て&#8203;以&#8203;下&#8203;を&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;週&#8203;毎&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;デー&#8203;タ&#8203;</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>週&#8203;毎&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;（PL）&#8203;の&#8203;分&#8203;布&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203; (&#8203;週&#8203;毎&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;の&#8203;合&#8203;計&#8203;値&#8203;が&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;評&#8203;価&#8203;項&#8203;目&#8203;)</p>
</li>
<li>
<p>週&#8203;毎&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;の&#8203;統&#8203;計&#8203;量&#8203;の&#8203;算&#8203;出</p>
</li>
<li>
<p>週&#8203;毎&#8203;の&#8203;勝&#8203;率・&#8203;ペ&#8203;イ&#8203;オ&#8203;フ&#8203;レ&#8203;シ&#8203;オ・&#8203;シャー&#8203;プ&#8203;レ&#8203;シ&#8203;オ&#8203;の&#8203;算&#8203;出</p>
</li>
<li>
<p>週&#8203;毎&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;推&#8203;移&#8203;の&#8203;プ&#8203;ロッ&#8203;ト</p>
</li>
<li>
<p>曜&#8203;日&#8203;別&#8203;分&#8203;析&#8203;の&#8203;た&#8203;め&#8203;の&#8203;バ&#8203;イ&#8203;オ&#8203;リ&#8203;ン&#8203;プ&#8203;ロッ&#8203;ト</p>
</li>
<li>
<p>週&#8203;毎&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;累&#8203;積&#8203;プ&#8203;ロッ&#8203;ト</p>
</li>
<li>
<p>ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;と&#8203;の&#8203;散&#8203;布&#8203;図</p>
</li>
<li>
<p>ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;に&#8203;対&#8203;す&#8203;る&#8203;ベー&#8203;タ&#8203;を&#8203;計&#8203;算</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_1_週毎の運用実績の分布をプロット">1.週毎の運用実績の分布をプロット</h5>
<div class="paragraph">
<p>　&#8203;ま&#8203;ず、&#8203;週&#8203;毎&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;の&#8203;分&#8203;布&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 描画領域を定義</span>
fig, axes = plt.subplots(<span class="integer">1</span>, <span class="predefined">len</span>(results), figsize=(<span class="integer">8</span> * <span class="predefined">len</span>(results), <span class="integer">8</span>), sharex=<span class="predefined-constant">True</span>, sharey=<span class="predefined-constant">True</span>)

<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="predefined">enumerate</span>(results.keys()):
    <span class="comment"># 描画位置を指定</span>
    ax = axes[i]
    <span class="comment"># 分布をプロット</span>
    results[k].week_pl.hist(bins=<span class="integer">25</span>, ax=ax)
    <span class="comment"># タイトルを設定</span>
    ax.set_title(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: week pl distribution</span><span class="delimiter">&quot;</span></span>)
<span class="comment">#　描画</span>
plt.show()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple11.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>　trend&#8203;と&#8203;reversal&#8203;は&#8203;共&#8203;に&#8203;ほ&#8203;ぼ&#8203;0&#8203;平&#8203;均&#8203;に&#8203;見&#8203;え&#8203;ま&#8203;す&#8203;が、&#8203;reversal&#8203;は&#8203;分&#8203;布&#8203;が&#8203;若&#8203;干&#8203;広&#8203;い&#8203;よ&#8203;う&#8203;に&#8203;見&#8203;え、&#8203;週&#8203;に&#8203;よっ&#8203;て&#8203;は&#8203;大&#8203;き&#8203;な&#8203;マ&#8203;イ&#8203;ナ&#8203;ス&#8203;も&#8203;観&#8203;測&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;お&#8203;そ&#8203;ら&#8203;く&#8203;COVID-19&#8203;の&#8203;暴&#8203;落&#8203;が&#8203;発&#8203;生&#8203;し&#8203;た&#8203;週&#8203;が&#8203;該&#8203;当&#8203;す&#8203;る&#8203;と&#8203;想&#8203;像&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;た&#8203;だ&#8203;し、&#8203;大&#8203;き&#8203;な&#8203;プ&#8203;ラ&#8203;ス&#8203;の&#8203;週&#8203;も&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;そ&#8203;の&#8203;負&#8203;け&#8203;を&#8203;取&#8203;り&#8203;返&#8203;し&#8203;て&#8203;い&#8203;る&#8203;か&#8203;も&#8203;し&#8203;れ&#8203;ま&#8203;せ&#8203;ん。&#8203;た&#8203;だ、&#8203;こ&#8203;の&#8203;プ&#8203;ロッ&#8203;ト&#8203;だ&#8203;け&#8203;で&#8203;は&#8203;あ&#8203;ま&#8203;り&#8203;戦&#8203;略&#8203;の&#8203;良&#8203;し&#8203;悪&#8203;し&#8203;は&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;せ&#8203;ん。</p>
</div>
</div>
<div class="sect4">
<h5 id="_2_週毎の運用実績の統計量を算出">2.週毎の運用実績の統計量を算出</h5>
<div class="paragraph">
<p>　&#8203;週&#8203;毎&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;の&#8203;統&#8203;計&#8203;量&#8203;を&#8203;算&#8203;出&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># week_plの分布の統計量</span>

<span class="comment"># 結合用データ保存</span>
buff = []
<span class="comment"># ストラテジー毎に処理</span>
<span class="keyword">for</span> k <span class="keyword">in</span> results.keys():
    <span class="comment"># week_plの統計量を取得します。</span>
    df = results[k].loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">week_pl</span><span class="delimiter">&quot;</span></span>]].describe().T
    <span class="comment"># インデックスを編集してストラテジーのIDにする</span>
    df.index = [k]
    <span class="comment"># インデックス名変更</span>
    df.index.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">strategy_id</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 結合用に保存</span>
    buff.append(df)
<span class="comment"># 結合して表示</span>
pd.concat(buff)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple12.png" alt="処理結果" width="70%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;週&#8203;毎&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;の&#8203;統&#8203;計&#8203;量&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;と、&#8203;reversal&#8203;が&#8203;trend&#8203;よ&#8203;り&#8203;平&#8203;均&#8203;(mean)&#8203;が&#8203;高&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;た&#8203;だ&#8203;し、&#8203;中&#8203;央&#8203;値&#8203;(50%)&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;と&#8203;trend&#8203;の&#8203;方&#8203;が&#8203;高&#8203;い&#8203;の&#8203;で&#8203;reversal&#8203;は&#8203;小&#8203;さ&#8203;な&#8203;勝&#8203;ち&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;大&#8203;き&#8203;な&#8203;勝&#8203;ち&#8203;を&#8203;利&#8203;用&#8203;し&#8203;て&#8203;平&#8203;均&#8203;を&#8203;押&#8203;し&#8203;上&#8203;げ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;25%&#8203;分&#8203;位&#8203;点&#8203;で&#8203;は&#8203;大&#8203;き&#8203;な&#8203;差&#8203;異&#8203;は&#8203;な&#8203;い&#8203;の&#8203;に&#8203;最&#8203;小&#8203;値&#8203;は&#8203;reversal&#8203;が&#8203;ずっ&#8203;と&#8203;小&#8203;さ&#8203;い&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;大&#8203;き&#8203;な&#8203;負&#8203;け&#8203;が&#8203;あ&#8203;る&#8203;と&#8203;想&#8203;定&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_3_週毎の勝率ペイオフレシオシャープレシオを算出">3.週毎の勝率、ペイオフレシオ、シャープレシオを算出</h5>
<div class="paragraph">
<p>　&#8203;週&#8203;毎&#8203;の&#8203;勝&#8203;率、&#8203;ペ&#8203;イ&#8203;オ&#8203;フ&#8203;レ&#8203;シ&#8203;オ、&#8203;シャー&#8203;プ&#8203;レ&#8203;シ&#8203;オ&#8203;を&#8203;算&#8203;出&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 結合用データ保存</span>
buff = []
<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> k <span class="keyword">in</span> results.keys():
    df_return = results[k]
    <span class="comment"># 計算結果保存用</span>
    d = {}
    <span class="comment"># 件数</span>
    d[<span class="string"><span class="delimiter">&quot;</span><span class="content">count</span><span class="delimiter">&quot;</span></span>] = df_return.shape[<span class="integer">0</span>]
    <span class="comment"># 勝率</span>
    d[<span class="string"><span class="delimiter">&quot;</span><span class="content">win_ratio</span><span class="delimiter">&quot;</span></span>] = (
        df_return.loc[df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>] &gt; <span class="integer">0</span>].shape[<span class="integer">0</span>] / d[<span class="string"><span class="delimiter">&quot;</span><span class="content">count</span><span class="delimiter">&quot;</span></span>]
    )
    <span class="comment"># ペイオフレシオ</span>
    d[<span class="string"><span class="delimiter">&quot;</span><span class="content">payoff_ratio</span><span class="delimiter">&quot;</span></span>] = df_return.loc[
        df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>] &gt; <span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>
    ].mean() / (
        -<span class="integer">1</span> * df_return.loc[df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>] &lt;= <span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>].mean()
    )
    <span class="comment"># シャープレシオ</span>
    d[<span class="string"><span class="delimiter">&quot;</span><span class="content">sharp</span><span class="delimiter">&quot;</span></span>] = (
        df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>].mean() / df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>].std()
    )
    <span class="comment"># 平均PL</span>
    d[<span class="string"><span class="delimiter">&quot;</span><span class="content">avgPL</span><span class="delimiter">&quot;</span></span>] = df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_pl</span><span class="delimiter">&quot;</span></span>].mean()
    <span class="comment"># week_plの合計</span>
    d[<span class="string"><span class="delimiter">&quot;</span><span class="content">PL</span><span class="delimiter">&quot;</span></span>] = df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_pl</span><span class="delimiter">&quot;</span></span>].sum()
    <span class="comment"># strategy_idを設定</span>
    df = pd.DataFrame([d], index=[k])
    <span class="comment"># インデックス名を指定</span>
    df.index.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">strategy_id</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 結合用に保存</span>
    buff.append(df)
<span class="comment"># 結合して表示</span>
pd.concat(buff)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple13.png" alt="処理結果" width="50%">
</div>
</div>
<div class="paragraph">
<p>　reversal&#8203;の&#8203;週&#8203;毎&#8203;の&#8203;勝&#8203;率&#8203;は&#8203;50%&#8203;で&#8203;す&#8203;が、&#8203;payoff_ratio&#8203;も&#8203;1&#8203;が&#8203;よ&#8203;り&#8203;大&#8203;き&#8203;く&#8203;一&#8203;回&#8203;の&#8203;勝&#8203;ち&#8203;が&#8203;負&#8203;け&#8203;よ&#8203;り&#8203;お&#8203;お&#8203;き&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;trend&#8203;は&#8203;を&#8203;勝&#8203;率&#8203;が&#8203;60%&#8203;を&#8203;超&#8203;え&#8203;て&#8203;お&#8203;り、&#8203;reversal&#8203;よ&#8203;り&#8203;も&#8203;安&#8203;定&#8203;的&#8203;に&#8203;勝&#8203;て&#8203;る&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_4_週毎に曜日別のリターンをプロット">4.週毎に曜日別のリターンをプロット</h5>
<div class="paragraph">
<p>　&#8203;週&#8203;毎&#8203;の&#8203;1&#8203;日&#8203;目&#8203;か&#8203;ら&#8203;5&#8203;日&#8203;目&#8203;ま&#8203;で&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;推&#8203;移&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し、&#8203;曜&#8203;日&#8203;毎&#8203;に&#8203;勝&#8203;ち&#8203;負&#8203;け&#8203;の&#8203;分&#8203;布&#8203;に&#8203;差&#8203;異&#8203;が&#8203;無&#8203;い&#8203;か&#8203;を&#8203;確&#8203;認&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 描画領域を定義</span>
fig, axes = plt.subplots(
    <span class="predefined">len</span>(results), <span class="integer">1</span>, figsize=(<span class="integer">20</span>, <span class="integer">4</span> * <span class="predefined">len</span>(results)), sharex=<span class="predefined-constant">True</span>, sharey=<span class="predefined-constant">True</span>
)

<span class="comment"># 描画用データ保存用</span>
dfs_plot = {}

<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="predefined">enumerate</span>(results.keys()):
    <span class="comment"># 描画位置を指定</span>
    ax = axes[i]
    <span class="comment"># 列を行に変換</span>
    dfs_plot[k] = (
        results[k]
        .set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>)
        .loc[
            :,
            [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">day_1_return</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">day_2_return</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">day_3_return</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">day_4_return</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">day_5_return</span><span class="delimiter">&quot;</span></span>,
            ],
        ]
        .stack()
        .to_frame()
        .reset_index()
        .rename(columns={<span class="integer">0</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">return</span><span class="delimiter">&quot;</span></span>})
    )
    <span class="comment"># 作業用に変数設定</span>
    df_plot = dfs_plot[k]
    <span class="comment"># 曜日毎のreturnをプロット</span>
    df_plot.groupby([<span class="string"><span class="delimiter">&quot;</span><span class="content">level_1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>]).first().unstack().plot(ax=ax, legend=<span class="predefined-constant">False</span>)
    <span class="comment"># タイトルを設定</span>
    ax.set_title(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: Daily returns</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># リターンが0の位置に基準線を描画</span>
    ax.axhline(y=<span class="integer">0</span>, color=<span class="string"><span class="delimiter">&quot;</span><span class="content">black</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># グリッドを表示</span>
    ax.grid(<span class="predefined-constant">True</span>)
<span class="comment"># 描画</span>
plt.show()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple14.png" alt="処理結果" width="70%">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_5_曜日別分析のためのバイオリンプロット">5. 曜日別分析のためのバイオリンプロット</h5>
<div class="paragraph">
<p>　&#8203;上&#8203;の&#8203;グ&#8203;ラ&#8203;フ&#8203;で&#8203;は&#8203;何&#8203;が&#8203;起&#8203;き&#8203;て&#8203;い&#8203;る&#8203;か&#8203;わ&#8203;か&#8203;り&#8203;に&#8203;く&#8203;い&#8203;の&#8203;で、&#8203;seaborn&#8203;の&#8203;バ&#8203;イ&#8203;オ&#8203;リ&#8203;ン&#8203;プ&#8203;ロッ&#8203;ト&#8203;(<a href="https://seaborn.pydata.org/generated/seaborn.violinplot.html">リンク</a>)&#8203;を&#8203;利&#8203;用&#8203;し&#8203;ま&#8203;す。&#8203;バ&#8203;イ&#8203;オ&#8203;リ&#8203;ン&#8203;プ&#8203;ロッ&#8203;ト&#8203;は&#8203;デー&#8203;タ&#8203;の&#8203;密&#8203;度&#8203;分&#8203;布&#8203;を&#8203;確&#8203;認&#8203;で&#8203;き&#8203;る&#8203;グ&#8203;ラ&#8203;フ&#8203;で&#8203;あ&#8203;り、&#8203;統&#8203;計&#8203;的&#8203;な&#8203;差&#8203;異&#8203;が&#8203;あ&#8203;り&#8203;そ&#8203;う&#8203;な&#8203;箇&#8203;所&#8203;を&#8203;発&#8203;見&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;便&#8203;利&#8203;で&#8203;す。&#8203;バ&#8203;イ&#8203;オ&#8203;リ&#8203;ン&#8203;の&#8203;形&#8203;状&#8203;は&#8203;カー&#8203;ネ&#8203;ル&#8203;密&#8203;度&#8203;推&#8203;定&#8203;に&#8203;よ&#8203;る&#8203;確&#8203;率&#8203;密&#8203;度&#8203;関&#8203;数&#8203;を&#8203;表&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;バ&#8203;イ&#8203;オ&#8203;リ&#8203;ン&#8203;の&#8203;中&#8203;心&#8203;部&#8203;分&#8203;に&#8203;平&#8203;均、&#8203;中&#8203;央&#8203;値、&#8203;25%&#8203;タ&#8203;イ&#8203;ル、&#8203;75%&#8203;タ&#8203;イ&#8203;ル&#8203;を&#8203;示&#8203;す&#8203;箱&#8203;が&#8203;表&#8203;示&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 描画領域を定義</span>
fig, axes = plt.subplots(<span class="predefined">len</span>(results), <span class="integer">1</span>, figsize=(<span class="integer">15</span>, <span class="integer">4</span> * <span class="predefined">len</span>(results)), sharex=<span class="predefined-constant">True</span>, sharey=<span class="predefined-constant">True</span>)

<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="predefined">enumerate</span>(results.keys()):
    <span class="comment"># 描画位置を指定</span>
    ax = axes[i]
    <span class="comment"># 箱が見やすいように横方向を指定してプロット</span>
    sns.violinplot(x=<span class="string"><span class="delimiter">&quot;</span><span class="content">return</span><span class="delimiter">&quot;</span></span>, y=<span class="string"><span class="delimiter">&quot;</span><span class="content">level_1</span><span class="delimiter">&quot;</span></span>, data=dfs_plot[k], ax=ax, orient=<span class="string"><span class="delimiter">&quot;</span><span class="content">h</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># タイトルを設定</span>
    ax.set_title(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: daily return</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># グリッドを表示</span>
    ax.grid(<span class="predefined-constant">True</span>)
<span class="comment"># 文字が重なって読みにくいので間隔調整</span>
fig.tight_layout(pad=<span class="float">2.0</span>)
<span class="comment"># 描画</span>
plt.show()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple15.png" alt="処理結果" width="100%">
</div>
</div>
<div class="paragraph">
<p>　reversal/trend&#8203;は&#8203;木・&#8203;金&#8203;曜&#8203;日&#8203;に&#8203;負&#8203;け&#8203;る&#8203;傾&#8203;向&#8203;が&#8203;あ&#8203;り&#8203;そ&#8203;う&#8203;で&#8203;す。&#8203;trend&#8203;は&#8203;プ&#8203;ラ&#8203;ス&#8203;側&#8203;の&#8203;裾&#8203;野&#8203;が&#8203;若&#8203;干&#8203;広&#8203;い&#8203;よ&#8203;う&#8203;に&#8203;思&#8203;わ&#8203;れ&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;は&#8203;ト&#8203;レ&#8203;ン&#8203;ド&#8203;フォ&#8203;ロー&#8203;を&#8203;行&#8203;う&#8203;と&#8203;大&#8203;き&#8203;な&#8203;勝&#8203;ち&#8203;が&#8203;取&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;示&#8203;唆&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;に&#8203;よっ&#8203;て&#8203;は&#8203;月&#8203;曜&#8203;日&#8203;に&#8203;大&#8203;き&#8203;く&#8203;勝&#8203;つ&#8203;モ&#8203;デ&#8203;ル&#8203;や&#8203;金&#8203;曜&#8203;日&#8203;に&#8203;大&#8203;き&#8203;く&#8203;負&#8203;け&#8203;る&#8203;な&#8203;ど&#8203;曜&#8203;日&#8203;に&#8203;よっ&#8203;て&#8203;強&#8203;さ&#8203;が&#8203;異&#8203;な&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;多&#8203;く、&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;曜&#8203;日&#8203;ご&#8203;と&#8203;の&#8203;プ&#8203;ロッ&#8203;ト&#8203;は&#8203;そ&#8203;の&#8203;銘&#8203;柄&#8203;の&#8203;特&#8203;性&#8203;を&#8203;知&#8203;る&#8203;上&#8203;で、&#8203;確&#8203;認&#8203;す&#8203;る&#8203;価&#8203;値&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;特&#8203;に&#8203;曜&#8203;日&#8203;や&#8203;月&#8203;な&#8203;ど&#8203;の&#8203;周&#8203;期&#8203;で&#8203;チェッ&#8203;ク&#8203;す&#8203;る&#8203;場&#8203;合、&#8203;負&#8203;け&#8203;て&#8203;い&#8203;る&#8203;方&#8203;(&#8203;こ&#8203;の&#8203;グ&#8203;ラ&#8203;フ&#8203;で&#8203;い&#8203;う&#8203;と&#8203;と&#8203;マ&#8203;イ&#8203;ナ&#8203;ス&#8203;側&#8203;の&#8203;分&#8203;布&#8203;)&#8203;に&#8203;注&#8203;目&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;重&#8203;要&#8203;で&#8203;す。&#8203;周&#8203;期&#8203;性&#8203;を&#8203;狙っ&#8203;て&#8203;収&#8203;益&#8203;を&#8203;意&#8203;図&#8203;的&#8203;に&#8203;取&#8203;得&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;難&#8203;易&#8203;度&#8203;の&#8203;高&#8203;い&#8203;テ&#8203;ク&#8203;ニッ&#8203;ク&#8203;で&#8203;す&#8203;が、&#8203;負&#8203;け&#8203;の&#8203;場&#8203;合&#8203;は&#8203;理&#8203;由&#8203;を&#8203;しっ&#8203;か&#8203;り&#8203;と&#8203;分&#8203;析&#8203;す&#8203;る&#8203;と&#8203;防&#8203;げ&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;る&#8203;た&#8203;め&#8203;で&#8203;す。&#8203;例&#8203;え&#8203;ば、&#8203;よ&#8203;く&#8203;あ&#8203;る&#8203;の&#8203;が&#8203;金&#8203;曜&#8203;日&#8203;特&#8203;有&#8203;の&#8203;週&#8203;末&#8203;に&#8203;発&#8203;生&#8203;す&#8203;る&#8203;ク&#8203;ロー&#8203;ズ&#8203;オー&#8203;ダー&#8203;な&#8203;ど、&#8203;機&#8203;関&#8203;投&#8203;資&#8203;家&#8203;の&#8203;ルー&#8203;ル&#8203;に&#8203;よ&#8203;り&#8203;発&#8203;生&#8203;す&#8203;る&#8203;取&#8203;引&#8203;で&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_6_収益率の時系列を累積プロット">6.収益率の時系列を累積プロット</h5>
<div class="paragraph">
<p>　&#8203;次&#8203;に&#8203;い&#8203;よ&#8203;い&#8203;よ&#8203;取&#8203;得&#8203;し&#8203;た&#8203;収&#8203;益&#8203;率&#8203;の&#8203;時&#8203;系&#8203;列&#8203;を&#8203;累&#8203;積&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。&#8203;ま&#8203;ず、&#8203;比&#8203;較&#8203;対&#8203;象&#8203;と&#8203;し&#8203;て&#8203;取&#8203;引&#8203;対&#8203;象&#8203;の&#8203;全&#8203;銘&#8203;柄&#8203;の&#8203;平&#8203;均&#8203;週&#8203;次&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;計&#8203;算&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 変数名を調整します。</span>
<span class="comment"># backtest_priceはユニバースで絞り込み済みです</span>
df_price = backtest_price</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 週毎に始値と終値を取得</span>
df_wp = (
    <span class="comment"># start_dt以降の日付のみ計算</span>
    df_price.loc[df_price.index &gt;= start_dt].sort_values([<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>])
    <span class="comment"># 銘柄コード毎に処理</span>
    .groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># 月曜日スタートで週にリサンプル</span>
    .resample(<span class="string"><span class="delimiter">&quot;</span><span class="content">W-MON</span><span class="delimiter">&quot;</span></span>, label=<span class="string"><span class="delimiter">&quot;</span><span class="content">left</span><span class="delimiter">&quot;</span></span>, closed=<span class="string"><span class="delimiter">&quot;</span><span class="content">left</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># 始値は最初のレコード、終値は最後のレコードを取得</span>
    .agg({<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Open</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">first</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">last</span><span class="delimiter">&quot;</span></span>})
    <span class="comment"># マルチインデックスを解除</span>
    .reset_index(level=[<span class="integer">0</span>])
)
<span class="comment"># Open が 0.0 の銘柄は値段が付かなかった銘柄で、バックテストでは購入対象外であるため除外する</span>
df_wp = df_wp.loc[df_wp.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Open</span><span class="delimiter">&quot;</span></span>] != <span class="float">0.0</span>]
<span class="comment"># 銘柄毎の週次リターンを計算</span>
df_wp.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">universe</span><span class="delimiter">&quot;</span></span>] = (
    (
        (
            df_wp.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]
            / df_wp.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Open</span><span class="delimiter">&quot;</span></span>]
        )
        - <span class="integer">1</span>
    )
    * <span class="integer">100</span>
)
<span class="comment"># ユニバースの週毎のリターンを計算します。</span>
df_universe_return = df_wp.groupby(df_wp.index)[<span class="string"><span class="delimiter">&quot;</span><span class="content">universe</span><span class="delimiter">&quot;</span></span>].mean().to_frame()</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;対&#8203;比&#8203;軸&#8203;で&#8203;あ&#8203;る&#8203;取&#8203;引&#8203;対&#8203;象&#8203;の&#8203;全&#8203;銘&#8203;柄&#8203;の&#8203;平&#8203;均&#8203;週&#8203;次&#8203;リ&#8203;ター&#8203;ン&#8203;が&#8203;準&#8203;備&#8203;で&#8203;き&#8203;た&#8203;ら、&#8203;今&#8203;回&#8203;の&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;の&#8203;結&#8203;果&#8203;と&#8203;一&#8203;緒&#8203;に&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 描画領域を定義</span>
fig, axes = plt.subplots(<span class="integer">1</span>, <span class="integer">1</span>, figsize=(<span class="integer">20</span>, <span class="integer">8</span>), sharex=<span class="predefined-constant">True</span>, sharey=<span class="predefined-constant">True</span>)

<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> k <span class="keyword">in</span> results.keys():
    <span class="comment"># 描画位置を指定</span>
    ax = axes
    <span class="comment"># 戦略別の累積リターンを描画</span>
    results[k].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>).loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>]].rename(
        columns={<span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: week_return</span><span class="delimiter">&quot;</span></span>}
    ).cumsum().plot(ax=ax)

<span class="comment"># ユニバースの週次リターンの累積をプロット</span>
df_universe_return.cumsum().plot(ax=ax, color=<span class="string"><span class="delimiter">&quot;</span><span class="content">black</span><span class="delimiter">&quot;</span></span>, label=<span class="string"><span class="delimiter">&quot;</span><span class="content">universe</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># 表示を調整</span>
ax.set_title(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cumulative week_return</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># グリッドを表示</span>
ax.grid(<span class="predefined-constant">True</span>)
<span class="comment"># 描画</span>
plt.show()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple16.png" alt="処理結果" width="90%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;の&#8203;プ&#8203;ロッ&#8203;ト&#8203;は&#8203;興&#8203;味&#8203;深&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;ま&#8203;ず&#8203;reversal&#8203;は、&#8203;3&#8203;月&#8203;に&#8203;発&#8203;生&#8203;し&#8203;た&#8203;負&#8203;け&#8203;が&#8203;非&#8203;常&#8203;に&#8203;大&#8203;き&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;は&#8203;お&#8203;よ&#8203;そ&#8203;-20%&#8203;の&#8203;負&#8203;け&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;る&#8203;の&#8203;に&#8203;対&#8203;し、&#8203;reversal&#8203;で&#8203;は&#8203;-40%&#8203;に&#8203;到&#8203;達&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;は&#8203;リ&#8203;ター&#8203;ン・&#8203;リ&#8203;バー&#8203;サ&#8203;ル&#8203;戦&#8203;略&#8203;を&#8203;採&#8203;用&#8203;し&#8203;た&#8203;場&#8203;合、&#8203;マー&#8203;ケッ&#8203;ト&#8203;暴&#8203;落&#8203;時&#8203;に&#8203;負&#8203;け&#8203;が&#8203;積&#8203;み&#8203;重&#8203;な&#8203;る&#8203;現&#8203;象&#8203;と&#8203;し&#8203;て&#8203;知&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;一&#8203;方、&#8203;そ&#8203;の&#8203;後&#8203;に&#8203;0%&#8203;近&#8203;辺&#8203;ま&#8203;で&#8203;戻&#8203;し&#8203;て&#8203;い&#8203;る&#8203;の&#8203;で&#8203;3&#8203;月&#8203;後&#8203;半&#8203;か&#8203;ら&#8203;5&#8203;月&#8203;末&#8203;に&#8203;か&#8203;け&#8203;て、&#8203;取&#8203;得&#8203;で&#8203;き&#8203;た&#8203;リ&#8203;ター&#8203;ン&#8203;は&#8203;非&#8203;常&#8203;に&#8203;大&#8203;き&#8203;い&#8203;こ&#8203;と&#8203;も&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;た&#8203;だ、&#8203;対&#8203;比&#8203;軸&#8203;で&#8203;あ&#8203;る&#8203;取&#8203;引&#8203;対&#8203;象&#8203;の&#8203;全&#8203;銘&#8203;柄&#8203;の&#8203;平&#8203;均&#8203;週&#8203;次&#8203;リ&#8203;ター&#8203;ン&#8203;に&#8203;は&#8203;到&#8203;達&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;せ&#8203;ん。&#8203;そ&#8203;の&#8203;後、&#8203;reversal&#8203;戦&#8203;略&#8203;の&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;に&#8203;対&#8203;す&#8203;る&#8203;有&#8203;意&#8203;性&#8203;は&#8203;6&#8203;月&#8203;以&#8203;降&#8203;は&#8203;あ&#8203;ま&#8203;り&#8203;観&#8203;測&#8203;で&#8203;き&#8203;ず、&#8203;12&#8203;月&#8203;ま&#8203;で&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;の&#8203;平&#8203;均&#8203;に&#8203;勝&#8203;て&#8203;な&#8203;い&#8203;ま&#8203;ま&#8203;最&#8203;終&#8203;的&#8203;に&#8203;負&#8203;け&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;次&#8203;に、&#8203;trend&#8203;は&#8203;3&#8203;月&#8203;上&#8203;旬&#8203;の&#8203;負&#8203;け&#8203;が&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;の&#8203;平&#8203;均&#8203;と&#8203;比&#8203;較&#8203;す&#8203;る&#8203;と&#8203;小&#8203;さ&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;一&#8203;方、&#8203;reversal&#8203;戦&#8203;略&#8203;の&#8203;場&#8203;合&#8203;に&#8203;観&#8203;測&#8203;さ&#8203;れ&#8203;た&#8203;大&#8203;き&#8203;な&#8203;収&#8203;益&#8203;性&#8203;は&#8203;観&#8203;測&#8203;で&#8203;き&#8203;ず、&#8203;6&#8203;月&#8203;に&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;の&#8203;平&#8203;均&#8203;と&#8203;同&#8203;一&#8203;の&#8203;水&#8203;準&#8203;に&#8203;な&#8203;る&#8203;と、&#8203;以&#8203;降&#8203;は&#8203;reversal&#8203;と&#8203;同&#8203;等&#8203;に&#8203;12&#8203;月&#8203;ま&#8203;で&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;の&#8203;平&#8203;均&#8203;に&#8203;勝&#8203;て&#8203;な&#8203;い&#8203;ま&#8203;ま&#8203;最&#8203;終&#8203;的&#8203;に&#8203;負&#8203;け&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_7_ユニバースとリターンの散布図をプロット">7.ユニバースとリターンの散布図をプロット</h5>
<div class="paragraph">
<p>　&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;と&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;散&#8203;布&#8203;図&#8203;は、&#8203;マー&#8203;ケッ&#8203;ト&#8203;の&#8203;動&#8203;き&#8203;に&#8203;対&#8203;し&#8203;て&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;が&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;分&#8203;布&#8203;す&#8203;る&#8203;か&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;利&#8203;用&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> k <span class="keyword">in</span> results.keys():
    <span class="comment"># 散布図をプロット</span>
    p = sns.jointplot(
        x=df_universe_return.iloc[:, <span class="integer">0</span>],
        y=results[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>],
        kind=<span class="string"><span class="delimiter">&quot;</span><span class="content">reg</span><span class="delimiter">&quot;</span></span>,
        height=<span class="integer">5</span>,
        stat_func=stats.pearsonr,
    )
    <span class="comment"># タイトルを設定</span>
    p.fig.suptitle(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: week_return vs universe</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># タイトル表示用に位置を調整</span>
    p.fig.subplots_adjust(top=<span class="float">0.95</span>)
    <span class="comment"># 描画</span>
    plt.show()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple17.png" alt="処理結果" width="100%">
</div>
</div>
<div class="paragraph">
<p>　reversal&#8203;は&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;に&#8203;対&#8203;し&#8203;て、&#8203;全&#8203;体&#8203;が&#8203;下&#8203;がっ&#8203;た&#8203;時&#8203;に&#8203;負&#8203;け&#8203;が&#8203;大&#8203;き&#8203;く、&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;が&#8203;上&#8203;がっ&#8203;た&#8203;時&#8203;に&#8203;勝&#8203;ち&#8203;が&#8203;わ&#8203;ず&#8203;か&#8203;に&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;を&#8203;上&#8203;回&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;観&#8203;測&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;trend&#8203;は&#8203;分&#8203;布&#8203;が&#8203;広&#8203;がっ&#8203;て&#8203;お&#8203;り、&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;の&#8203;影&#8203;響&#8203;を&#8203;あ&#8203;ま&#8203;り&#8203;受&#8203;け&#8203;て&#8203;い&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;0&#8203;で&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;稼&#8203;い&#8203;で&#8203;い&#8203;る&#8203;週&#8203;が&#8203;多&#8203;く&#8203;観&#8203;測&#8203;出&#8203;来、&#8203;マー&#8203;ケッ&#8203;ト&#8203;が&#8203;動&#8203;い&#8203;て&#8203;い&#8203;な&#8203;い&#8203;時&#8203;に&#8203;細&#8203;か&#8203;く&#8203;勝&#8203;て&#8203;て&#8203;い&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;示&#8203;唆&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_8_ベータ値の算出">8.ベータ値の算出</h5>
<div class="paragraph">
<p>　&#8203;上&#8203;記&#8203;の&#8203;傾&#8203;向&#8203;は&#8203;ベー&#8203;タ&#8203;を&#8203;計&#8203;算&#8203;す&#8203;る&#8203;と&#8203;一&#8203;目&#8203;瞭&#8203;然&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 結合用に保存</span>
buff = []
<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> k <span class="keyword">in</span> results.keys():
    <span class="comment"># ベータを計算</span>
    res = stats.linregress(df_universe_return.iloc[:,<span class="integer">0</span>], results[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>])
    <span class="comment"># 一覧表示用にデータフレームを作成</span>
    df_beta = pd.DataFrame([res.slope], index=[k], columns=[<span class="string"><span class="delimiter">&quot;</span><span class="content">beta</span><span class="delimiter">&quot;</span></span>])
    <span class="comment"># インデックス名を設定</span>
    df_beta.index.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">storategy_id</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 保存</span>
    buff.append(df_beta)
<span class="comment"># 結合して表示</span>
pd.concat(buff)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple19.png" alt="処理結果" width="30%">
</div>
</div>
<div class="paragraph">
<p>　reversal&#8203;は&#8203;ベー&#8203;タ&#8203;が&#8203;お&#8203;よ&#8203;そ&#8203;1.6&#8203;と&#8203;なっ&#8203;て&#8203;お&#8203;り、&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;が&#8203;10%&#8203;変&#8203;動&#8203;す&#8203;る&#8203;と&#8203;16%&#8203;程&#8203;度&#8203;の&#8203;変&#8203;動&#8203;が&#8203;発&#8203;生&#8203;す&#8203;る&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;が&#8203;-20%&#8203;変&#8203;動&#8203;し&#8203;た&#8203;と&#8203;き&#8203;は&#8203;-32%&#8203;変&#8203;動&#8203;し&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;暴&#8203;落&#8203;時&#8203;の&#8203;大&#8203;き&#8203;な&#8203;負&#8203;け&#8203;も&#8203;こ&#8203;の&#8203;ベー&#8203;タ&#8203;値&#8203;の&#8203;高&#8203;さ&#8203;で&#8203;説&#8203;明&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;3&#8203;月&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;ド&#8203;ロー&#8203;ダ&#8203;ウ&#8203;ン&#8203;が&#8203;深&#8203;く&#8203;な&#8203;る&#8203;現&#8203;象&#8203;は、&#8203;高&#8203;い&#8203;ベー&#8203;タ&#8203;を&#8203;持&#8203;つ&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;に&#8203;は&#8203;よ&#8203;く&#8203;観&#8203;測&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;trend&#8203;は&#8203;ベー&#8203;タ&#8203;が&#8203;0.8&#8203;近&#8203;辺&#8203;と&#8203;なっ&#8203;て&#8203;お&#8203;り、&#8203;reversal&#8203;と&#8203;比&#8203;較&#8203;す&#8203;る&#8203;と&#8203;低&#8203;い&#8203;ベー&#8203;タ&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_銘柄毎に分析するための準備">銘柄毎に分析するための準備</h5>
<div class="paragraph">
<p>　&#8203;最&#8203;後&#8203;に&#8203;銘&#8203;柄&#8203;毎&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;分&#8203;析&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;各&#8203;銘&#8203;柄&#8203;毎&#8203;の&#8203;デー&#8203;タ&#8203;</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>銘&#8203;柄&#8203;毎&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;の&#8203;分&#8203;布&#8203;を&#8203;プ&#8203;ロッ&#8203;ト</p>
</li>
<li>
<p>銘&#8203;柄&#8203;毎&#8203;の&#8203;return&#8203;の&#8203;分&#8203;布&#8203;を&#8203;プ&#8203;ロッ&#8203;ト</p>
</li>
<li>
<p>週&#8203;毎&#8203;の&#8203;勝&#8203;ち&#8203;銘&#8203;柄&#8203;率&#8203;を&#8203;プ&#8203;ロッ&#8203;ト、&#8203;統&#8203;計&#8203;量&#8203;の&#8203;算&#8203;出</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>銘&#8203;柄&#8203;毎&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;分&#8203;析&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;必&#8203;要&#8203;な&#8203;計&#8203;算&#8203;を&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 分析用データ保存用</span>
dfs_analyze = {}
<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i <span class="keyword">in</span> stocks.keys():
    <span class="comment"># 分析用にデータをコピー</span>
    df_analyze = stocks[i].copy()
    <span class="comment"># day5に必ず値が存在するように調整します</span>
    df_analyze.loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">day_1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_3</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_4</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_5</span><span class="delimiter">&quot;</span></span>]] = (
        df_analyze.loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">day_1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_3</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_4</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_5</span><span class="delimiter">&quot;</span></span>]]
        .replace(<span class="float">0.0</span>, np.nan)
        .ffill(axis=<span class="integer">1</span>)
    )
    <span class="comment"># 終値とエントリーの差分を計算</span>
    df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">diff</span><span class="delimiter">&quot;</span></span>] = df_analyze.loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_5</span><span class="delimiter">&quot;</span></span>]].diff(axis=<span class="integer">1</span>)[
        <span class="string"><span class="delimiter">&quot;</span><span class="content">day_5</span><span class="delimiter">&quot;</span></span>
    ]
    <span class="comment"># 損益を計算します</span>
    df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">pl</span><span class="delimiter">&quot;</span></span>] = df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">diff</span><span class="delimiter">&quot;</span></span>] * df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>]
    <span class="comment"># リターンを計算します</span>
    df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">return</span><span class="delimiter">&quot;</span></span>] = (
        (df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_5</span><span class="delimiter">&quot;</span></span>] / df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>]) - <span class="integer">1</span>
    ) * <span class="integer">100</span>
    <span class="comment"># infを0.0に変換</span>
    df_analyze = df_analyze.replace(np.inf, <span class="float">0.0</span>)
    <span class="comment"># 処理結果を保存</span>
    dfs_analyze[i] = df_analyze</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_1_銘柄毎の運用実績の分布をプロット">1.銘柄毎の運用実績の分布をプロット</h5>
<div class="paragraph">
<p>分&#8203;析&#8203;用&#8203;デー&#8203;タ&#8203;を&#8203;表&#8203;示&#8203;し&#8203;て&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">dfs_analyze[<span class="string"><span class="delimiter">&quot;</span><span class="content">reversal</span><span class="delimiter">&quot;</span></span>].head(<span class="integer">2</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple20.png" alt="処理結果" width="80%">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_2_銘柄毎のリターンの分布をヒストグラムでプロット">2.銘柄毎のリターンの分布をヒストグラムでプロット</h5>
<div class="paragraph">
<p>銘&#8203;柄&#8203;毎&#8203;の&#8203;各&#8203;週&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203;銘&#8203;柄&#8203;毎&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;分&#8203;布&#8203;を&#8203;ヒ&#8203;ス&#8203;ト&#8203;グ&#8203;ラ&#8203;ム&#8203;で&#8203;ま&#8203;ず&#8203;は&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 描画領域を定義</span>
fig, axes = plt.subplots(<span class="integer">1</span>, <span class="predefined">len</span>(dfs_analyze), figsize=(<span class="integer">8</span> * <span class="predefined">len</span>(dfs_analyze), <span class="integer">8</span>), sharex=<span class="predefined-constant">True</span>, sharey=<span class="predefined-constant">True</span>)

<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="predefined">enumerate</span>(dfs_analyze.keys()):
    <span class="comment"># 描画位置を指定</span>
    ax = axes[i]
    <span class="comment"># ヒストグラムをプロット</span>
    dfs_analyze[k].groupby([<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>])[<span class="string"><span class="delimiter">&quot;</span><span class="content">return</span><span class="delimiter">&quot;</span></span>].sum().hist(bins=<span class="integer">50</span>, log=<span class="predefined-constant">True</span>, ax=ax)
    <span class="comment"># タイトルを設定</span>
    ax.set_title(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: Weekly PL distribution</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># 描画</span>
plt.show()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple21.png" alt="処理結果" width="70%"">
</div>
</div>
<div class="paragraph">
<p>　&#8203;銘&#8203;柄&#8203;毎&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;分&#8203;布&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;し&#8203;た&#8203;が、&#8203;こ&#8203;こ&#8203;か&#8203;ら&#8203;何&#8203;か&#8203;知&#8203;見&#8203;は&#8203;得&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;難&#8203;し&#8203;そ&#8203;う&#8203;で&#8203;す。&#8203;上&#8203;の&#8203;プ&#8203;ロッ&#8203;ト&#8203;か&#8203;ら&#8203;も&#8203;こ&#8203;れ&#8203;と&#8203;いっ&#8203;た&#8203;知&#8203;見&#8203;を&#8203;え&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;で&#8203;き&#8203;ま&#8203;せ&#8203;ん。&#8203;あ&#8203;え&#8203;て&#8203;言&#8203;う&#8203;な&#8203;ら、&#8203;reversal&#8203;が&#8203;若&#8203;干&#8203;trend&#8203;と&#8203;比&#8203;較&#8203;す&#8203;る&#8203;と&#8203;裾&#8203;野&#8203;が&#8203;広&#8203;い&#8203;程&#8203;度&#8203;で&#8203;す。&#8203;た&#8203;だ&#8203;し、&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;大&#8203;き&#8203;な&#8203;勝&#8203;ち&#8203;に&#8203;依&#8203;存&#8203;し&#8203;て&#8203;い&#8203;る&#8203;戦&#8203;略&#8203;や、&#8203;負&#8203;け&#8203;の&#8203;裾&#8203;野&#8203;が&#8203;非&#8203;常&#8203;に&#8203;広&#8203;い&#8203;戦&#8203;略&#8203;な&#8203;ど&#8203;も&#8203;こ&#8203;の&#8203;プ&#8203;ロッ&#8203;ト&#8203;で&#8203;観&#8203;測&#8203;で&#8203;き&#8203;る&#8203;た&#8203;め、&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;分&#8203;布&#8203;は&#8203;常&#8203;に&#8203;確&#8203;認&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;お&#8203;す&#8203;す&#8203;め&#8203;し&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_3_週毎に勝ち銘柄率を算出統計量の算出">3.週毎に勝ち銘柄率を算出、統計量の算出</h5>
<div class="paragraph">
<p>最&#8203;後&#8203;に&#8203;週&#8203;毎&#8203;の&#8203;銘&#8203;柄&#8203;の&#8203;勝&#8203;率&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 描画領域を定義</span>
fig, ax = plt.subplots(<span class="integer">1</span>, <span class="integer">1</span>, figsize=(<span class="integer">20</span>, <span class="integer">8</span>), sharex=<span class="predefined-constant">True</span>, sharey=<span class="predefined-constant">True</span>)

<span class="comment"># 統計量表示用</span>
buff = []
<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> k <span class="keyword">in</span> dfs_analyze.keys():
    <span class="comment"># 週毎の勝ち銘柄率を計算</span>
    win_ratio = (
        dfs_analyze[k]
        .set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>)
        .groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>)
        .apply(<span class="keyword">lambda</span> x: (x.pl &gt; <span class="integer">0</span>).sum() / x.shape[<span class="integer">0</span>])
        .to_frame()
        .rename(columns={<span class="integer">0</span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: win_ratio</span><span class="delimiter">&quot;</span></span>})
    )
    <span class="comment"># プロット</span>
    win_ratio.plot(ax=ax)
    <span class="comment"># 統計量を保存</span>
    buff.append(win_ratio.describe().T)
<span class="comment"># ユニバースの勝ち銘柄率をプロット</span>
df_wp.groupby(df_wp.index).apply(<span class="keyword">lambda</span> x: (x.universe &gt; <span class="integer">0</span>).sum() / x.shape[<span class="integer">0</span>]).rename(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">universe</span><span class="delimiter">&quot;</span></span>
).to_frame().plot(ax=ax, color=<span class="string"><span class="delimiter">&quot;</span><span class="content">black</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># タイトルを設定</span>
ax.set_title(<span class="string"><span class="delimiter">&quot;</span><span class="content">win ratio of selected stocks</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># グリッド表示</span>
ax.grid(<span class="predefined-constant">True</span>)
<span class="comment"># 0.5に基準線を描画</span>
ax.axhline(y=<span class="float">0.5</span>, color=<span class="string"><span class="delimiter">&quot;</span><span class="content">red</span><span class="delimiter">&quot;</span></span>)
<span class="comment">#  描画</span>
plt.show()
<span class="comment"># 週毎の勝ち銘柄率の統計量</span>
display(pd.concat(buff))</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter03/images/simple/simple22.png" alt="処理結果" width="90%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;の&#8203;プ&#8203;ロッ&#8203;ト&#8203;は&#8203;黒&#8203;線&#8203;の&#8203;universe&#8203;に&#8203;対&#8203;し&#8203;て&#8203;ど&#8203;の&#8203;時&#8203;期&#8203;に&#8203;銘&#8203;柄&#8203;単&#8203;位&#8203;で&#8203;勝&#8203;率&#8203;が&#8203;低&#8203;く、&#8203;ど&#8203;の&#8203;時&#8203;期&#8203;に&#8203;勝&#8203;率&#8203;が&#8203;高&#8203;かっ&#8203;た&#8203;を&#8203;確&#8203;認&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;trend&#8203;は&#8203;暴&#8203;落&#8203;後&#8203;に&#8203;あ&#8203;ま&#8203;り&#8203;収&#8203;益&#8203;を&#8203;得&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;せ&#8203;ん&#8203;で&#8203;し&#8203;た&#8203;が、&#8203;revesal&#8203;や&#8203;univere&#8203;と&#8203;の&#8203;差&#8203;異&#8203;が&#8203;観&#8203;測&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;<br>
も&#8203;し、&#8203;銘&#8203;柄&#8203;単&#8203;位&#8203;の&#8203;勝&#8203;率&#8203;で&#8203;大&#8203;き&#8203;な&#8203;差&#8203;異&#8203;が&#8203;発&#8203;生&#8203;し&#8203;て&#8203;い&#8203;な&#8203;い&#8203;の&#8203;に、&#8203;収&#8203;益&#8203;に&#8203;差&#8203;異&#8203;が&#8203;出&#8203;て&#8203;い&#8203;る&#8203;場&#8203;合&#8203;は&#8203;そ&#8203;の&#8203;時&#8203;の&#8203;銘&#8203;柄&#8203;の&#8203;勝&#8203;ち&#8203;幅&#8203;が&#8203;大&#8203;き&#8203;い&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;9&#8203;月&#8203;以&#8203;降&#8203;に&#8203;も&#8203;み&#8203;合&#8203;い&#8203;に&#8203;なっ&#8203;て&#8203;し&#8203;まっ&#8203;た&#8203;時&#8203;期&#8203;は&#8203;こ&#8203;の&#8203;勝&#8203;率&#8203;で&#8203;も&#8203;50%&#8203;近&#8203;辺&#8203;で&#8203;揉&#8203;み&#8203;合っ&#8203;て&#8203;お&#8203;り、&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;の&#8203;優&#8203;位&#8203;性&#8203;が&#8203;発&#8203;揮&#8203;で&#8203;き&#8203;て&#8203;い&#8203;な&#8203;い&#8203;時&#8203;期&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_考察">考察</h5>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;で&#8203;い&#8203;ろ&#8203;い&#8203;ろ&#8203;な&#8203;観&#8203;点&#8203;か&#8203;ら&#8203;reversal&#8203;と&#8203;trend&#8203;の&#8203;評&#8203;価&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;き&#8203;ま&#8203;し&#8203;た。&#8203;3&#8203;月&#8203;末&#8203;以&#8203;降&#8203;の&#8203;リ&#8203;ター&#8203;ン・&#8203;リ&#8203;バー&#8203;サ&#8203;ル&#8203;戦&#8203;略&#8203;が&#8203;有&#8203;効&#8203;に&#8203;働&#8203;い&#8203;て&#8203;い&#8203;る&#8203;時&#8203;期&#8203;も&#8203;あ&#8203;り&#8203;ま&#8203;し&#8203;た&#8203;し、&#8203;ト&#8203;レ&#8203;ン&#8203;ド&#8203;フォ&#8203;ロー&#8203;戦&#8203;略&#8203;で&#8203;ベー&#8203;タ&#8203;値&#8203;を&#8203;低&#8203;く&#8203;抑&#8203;え&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;し&#8203;た。</p>
</div>
<div class="paragraph">
<p>　&#8203;基&#8203;本&#8203;的&#8203;に&#8203;リ&#8203;ター&#8203;ン・&#8203;リ&#8203;バー&#8203;サ&#8203;ル&#8203;戦&#8203;略&#8203;と&#8203;ト&#8203;レ&#8203;ン&#8203;ド&#8203;フォ&#8203;ロー&#8203;戦&#8203;略&#8203;は&#8203;安&#8203;定&#8203;し&#8203;て&#8203;勝&#8203;て&#8203;る&#8203;手&#8203;法&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;リ&#8203;バー&#8203;サ&#8203;ル・&#8203;モ&#8203;メ&#8203;ン&#8203;タ&#8203;ム&#8203;と&#8203;い&#8203;う&#8203;代&#8203;表&#8203;的&#8203;な&#8203;ファ&#8203;ク&#8203;ター&#8203;と&#8203;密&#8203;接&#8203;な&#8203;関&#8203;係&#8203;が&#8203;あ&#8203;り、&#8203;マー&#8203;ケッ&#8203;ト&#8203;の&#8203;局&#8203;面&#8203;ご&#8203;と&#8203;に&#8203;有&#8203;効&#8203;な&#8203;戦&#8203;略&#8203;が&#8203;変&#8203;わっ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;知&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;の&#8203;結&#8203;果&#8203;か&#8203;ら、&#8203;適&#8203;切&#8203;に&#8203;リ&#8203;ター&#8203;ン・&#8203;リ&#8203;バー&#8203;サ&#8203;ル&#8203;戦&#8203;略&#8203;と&#8203;ト&#8203;レ&#8203;ン&#8203;ド&#8203;フォ&#8203;ロー&#8203;戦&#8203;略&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;切&#8203;り&#8203;替&#8203;え&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;実&#8203;現&#8203;で&#8203;き&#8203;れ&#8203;ば、&#8203;高&#8203;い&#8203;収&#8203;益&#8203;が&#8203;実&#8203;現&#8203;で&#8203;き&#8203;る&#8203;ポ&#8203;テ&#8203;ン&#8203;シャ&#8203;ル&#8203;が&#8203;あ&#8203;り&#8203;そ&#8203;う&#8203;で&#8203;す。&#8203;そ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;機&#8203;械&#8203;学&#8203;習&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;構&#8203;築&#8203;を&#8203;検&#8203;討&#8203;す&#8203;る&#8203;価&#8203;値&#8203;は&#8203;あ&#8203;る&#8203;で&#8203;しょ&#8203;う。</p>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;様々&#8203;な&#8203;可&#8203;視&#8203;化&#8203;を&#8203;通&#8203;し&#8203;て、&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;を&#8203;評&#8203;価&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;を&#8203;発&#8203;展&#8203;さ&#8203;せ&#8203;て&#8203;い&#8203;く&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_投稿用パッケージの作成">3.8. 投稿用パッケージの作成</h3>
<div class="sect3">
<h4 id="_投稿用パッケージのディレクトリの作成">3.8.1. 投稿用パッケージのディレクトリの作成</h4>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;作&#8203;成&#8203;及&#8203;び&#8203;評&#8203;価&#8203;を&#8203;し&#8203;て&#8203;き&#8203;ま&#8203;し&#8203;た。&#8203;こ&#8203;こ&#8203;か&#8203;ら&#8203;は、&#8203;投&#8203;稿&#8203;用&#8203;の&#8203;パッ&#8203;ケー&#8203;ジ&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;用&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203;以&#8203;下&#8203;の&#8203;構&#8203;成&#8203;で&#8203;あ&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;ま&#8203;ず&#8203;は&#8203;必&#8203;要&#8203;な&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;作&#8203;成&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>.
├── model                  必須 学習済モデルを置くディレクトリ
│   └── ...
├── src                    必須 Python のプログラムを置くディレクトリ
│   ├── predictor.py       必須 最初にプログラムが呼び出すファイル
│   └── ...                その他のファイル (ディレクトリも作成可能)
└── requirements.txt       任意</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 作業用のディレクトリを設定</span>
<span class="keyword">if</span> <span class="string"><span class="delimiter">'</span><span class="content">google.colab</span><span class="delimiter">'</span></span> <span class="keyword">in</span> sys.modules:
    working_dir = <span class="string"><span class="delimiter">&quot;</span><span class="content">/content/drive/MyDrive/JPX_competition/Chapter03</span><span class="delimiter">&quot;</span></span>
<span class="keyword">else</span>:
    working_dir = <span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span>
<span class="comment"># パッケージのrootディレクトリ</span>
package_dir = f<span class="string"><span class="delimiter">&quot;</span><span class="content">{working_dir}/archive</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 必要なディレクトリを作成します</span>
os.makedirs(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{package_dir}/model</span><span class="delimiter">&quot;</span></span>, exist_ok=<span class="predefined-constant">True</span>)
os.makedirs(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{package_dir}/src</span><span class="delimiter">&quot;</span></span>, exist_ok=<span class="predefined-constant">True</span>)
<span class="comment"># 今回はmodelディレクトリに保存するファイルがないため空ファイルを作成します</span>
<span class="predefined">open</span>(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{package_dir}/model/dummy.txt</span><span class="delimiter">&quot;</span></span>, mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>).close()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ランタイム実行用クラスの作成">3.8.2. ランタイム実行用クラスの作成</h4>
<div class="paragraph">
<p>　notebook&#8203;の&#8203;各&#8203;セ&#8203;ル&#8203;で&#8203;実&#8203;行&#8203;す&#8203;る&#8203;内&#8203;容&#8203;を&#8203;ファ&#8203;イ&#8203;ル&#8203;に&#8203;書&#8203;き&#8203;出&#8203;す&#8203;た&#8203;め&#8203;に、&#8203;jupyter notebook&#8203;に&#8203;マ&#8203;ジッ&#8203;ク&#8203;コ&#8203;マ&#8203;ン&#8203;ド&#8203;を&#8203;追&#8203;加&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># jupyter notebookにマジックコマンドを追加します</span>
<span class="comment"># セル実行と同時にセル内の記載内容をファイルに書き込みます</span>
<span class="decorator">@register_cell_magic</span>
<span class="keyword">def</span> <span class="function">writerun</span>(line, cell):
    <span class="comment"># 書き込み先ファイルパスを取得</span>
    file_path = line.split()[-<span class="integer">1</span>]
    <span class="comment"># 親ディレクトリ名を取得</span>
    p_dir = os.path.dirname(file_path)
    <span class="comment"># 親ディレクトリが存在する場合は</span>
    <span class="keyword">if</span> p_dir != <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>:
        <span class="comment"># ディレクトリ作成</span>
        os.makedirs(p_dir, exist_ok=<span class="predefined-constant">True</span>)
    <span class="comment"># cellの内容をファイルに書き込み</span>
    <span class="keyword">with</span> <span class="predefined">open</span>(file_path, mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">w</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
        f.write(cell)
    <span class="comment"># cellを実行</span>
    get_ipython().run_cell(cell)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;以&#8203;下&#8203;の&#8203;コー&#8203;ド&#8203;は、&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;に&#8203;一&#8203;行&#8203;ず&#8203;つ&#8203;作&#8203;成&#8203;し&#8203;た&#8203;コー&#8203;ド&#8203;を&#8203;投&#8203;稿&#8203;用&#8203;の&#8203; <code>ScoringService</code> &#8203;と&#8203;し&#8203;て&#8203;ま&#8203;と&#8203;め&#8203;て&#8203;実&#8203;装&#8203;し&#8203;た&#8203;も&#8203;の&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;今&#8203;回&#8203;は&#8203;学&#8203;習&#8203;済&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;パ&#8203;ラ&#8203;メー&#8203;ター&#8203;な&#8203;ど&#8203;を&#8203;ファ&#8203;イ&#8203;ル&#8203;に&#8203;書&#8203;き&#8203;出&#8203;し&#8203;て&#8203;い&#8203;な&#8203;い&#8203;た&#8203;め、&#8203;`get_model` &#8203;メ&#8203;ソッ&#8203;ド&#8203;で&#8203;は&#8203;何&#8203;も&#8203;せ&#8203;ず&#8203;に&#8203;True&#8203;を&#8203;返&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;そ&#8203;し&#8203;て、&#8203;`predict` &#8203;メ&#8203;ソッ&#8203;ド&#8203;に&#8203;は&#8203;上&#8203;記&#8203;で&#8203;実&#8203;行&#8203;し&#8203;た&#8203;コー&#8203;ド&#8203;を&#8203;コ&#8203;ピー&#8203;し&#8203;て&#8203;貼&#8203;り&#8203;付&#8203;け&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;表&#8203;示&#8203;用&#8203;の&#8203;コー&#8203;ド&#8203;お&#8203;よ&#8203;び&#8203;作&#8203;業&#8203;用&#8203;デー&#8203;タ&#8203;の&#8203;コ&#8203;ピー&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;で&#8203;は&#8203;実&#8203;行&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;な&#8203;い&#8203;た&#8203;め&#8203;削&#8203;除&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　jupyter notebook&#8203;の&#8203;セ&#8203;ル&#8203;に&#8203; <code>ScoringService</code> &#8203;ク&#8203;ラ&#8203;ス&#8203;を&#8203;作&#8203;成&#8203;し&#8203;て&#8203;い&#8203;る&#8203;理&#8203;由&#8203;は、&#8203;`ScoringService` &#8203;ク&#8203;ラ&#8203;ス&#8203;の&#8203;出&#8203;力&#8203;す&#8203;る&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;が&#8203;こ&#8203;れ&#8203;ま&#8203;で&#8203;検&#8203;証&#8203;し&#8203;て&#8203;き&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;と&#8203;同&#8203;一&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;の&#8203;検&#8203;証&#8203;が&#8203;容&#8203;易&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め&#8203;で&#8203;す。&#8203;慣&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;方&#8203;は&#8203;直&#8203;接&#8203;`predictor.py` &#8203;ファ&#8203;イ&#8203;ル&#8203;上&#8203;で&#8203;作&#8203;業&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;好&#8203;ま&#8203;れ&#8203;る&#8203;か&#8203;も&#8203;し&#8203;れ&#8203;ま&#8203;せ&#8203;ん。</p>
</div>
<div class="paragraph">
<p>　&#8203;次&#8203;の&#8203;セ&#8203;ル&#8203;で&#8203;は、&#8203;セ&#8203;ル&#8203;の&#8203;先&#8203;頭&#8203;で&#8203; <code>writerun</code> &#8203;マ&#8203;ジッ&#8203;ク&#8203;コ&#8203;マ&#8203;ン&#8203;ド&#8203;を&#8203;指&#8203;定&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;実&#8203;行&#8203;時&#8203;に&#8203;セ&#8203;ル&#8203;の&#8203;内&#8203;容&#8203;が&#8203; <code>$package_dir/src/predictor.py</code> &#8203;ファ&#8203;イ&#8203;ル&#8203;に&#8203;書&#8203;き&#8203;込&#8203;ま&#8203;れ&#8203;ま&#8203;す。&#8203;す&#8203;で&#8203;に&#8203;ファ&#8203;イ&#8203;ル&#8203;が&#8203;存&#8203;在&#8203;し&#8203;て&#8203;い&#8203;る&#8203;場&#8203;合&#8203;は&#8203;上&#8203;書&#8203;き&#8203;さ&#8203;れ&#8203;る&#8203;た&#8203;め&#8203;ご&#8203;注&#8203;意&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">%%writerun <span class="error">$</span>package_dir/src/predictor.py
<span class="comment"># -*- coding: utf-8 -*-</span>
<span class="keyword">import</span> <span class="include">io</span>

<span class="keyword">import</span> <span class="include">pandas</span> <span class="keyword">as</span> pd


<span class="keyword">class</span> <span class="class">ScoringService</span>(<span class="predefined">object</span>):
    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_model</span>(cls, model_path=<span class="string"><span class="delimiter">&quot;</span><span class="content">../model</span><span class="delimiter">&quot;</span></span>):
        <span class="keyword">return</span> <span class="predefined-constant">True</span>

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">predict</span>(
        cls, inputs, start_dt=pd.Timestamp(<span class="string"><span class="delimiter">&quot;</span><span class="content">2021-02-01</span><span class="delimiter">&quot;</span></span>), strategy_id=<span class="string"><span class="delimiter">&quot;</span><span class="content">reversal</span><span class="delimiter">&quot;</span></span>
    ):
        <span class="comment">####</span>
        <span class="comment"># データセットを読み込みます</span>
        <span class="comment">####</span>
        <span class="comment"># 銘柄情報読み込み</span>
        df_stock_list = pd.read_csv(inputs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>])
        <span class="comment"># 問題2のユニバース (投資対象銘柄群) 取得</span>
        codes = df_stock_list.loc[
            df_stock_list.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">universe_comp2</span><span class="delimiter">&quot;</span></span>] == <span class="predefined-constant">True</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>
        ].unique()

        <span class="comment"># 価格情報読み込み、インデックス作成</span>
        df_price = pd.read_csv(inputs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]).set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>)
        <span class="comment"># 日付型に変換</span>
        df_price.index = pd.to_datetime(df_price.index, format=<span class="string"><span class="delimiter">&quot;</span><span class="content">%Y-%m-%d</span><span class="delimiter">&quot;</span></span>)

        <span class="keyword">if</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">purchase_date</span><span class="delimiter">&quot;</span></span> <span class="keyword">in</span> inputs.keys():
            <span class="comment"># ランタイム環境では指定された投資対象日付を使用します</span>
            <span class="comment"># purchase_dateを読み込み</span>
            df_purchase_date = pd.read_csv(inputs[<span class="string"><span class="delimiter">&quot;</span><span class="content">purchase_date</span><span class="delimiter">&quot;</span></span>])
            <span class="comment"># purchase_dateの最も古い日付を設定</span>
            start_dt = pd.Timestamp(
                df_purchase_date.sort_values(<span class="string"><span class="delimiter">&quot;</span><span class="content">Purchase Date</span><span class="delimiter">&quot;</span></span>).iloc[<span class="integer">0</span>, <span class="integer">0</span>]
            )

        <span class="comment"># 投資対象日の前週金曜日時点で予測を出力するため、予測出力用の日付を設定します。</span>
        pred_start_dt = pd.Timestamp(start_dt) - pd.Timedelta(<span class="string"><span class="delimiter">&quot;</span><span class="content">3D</span><span class="delimiter">&quot;</span></span>)
        <span class="comment"># 特徴量の生成に必要な日数をバッファとして設定</span>
        n = <span class="integer">30</span>
        <span class="comment"># データ絞り込み日付設定</span>
        data_start_dt = pred_start_dt - pd.offsets.BDay(n)
        <span class="comment"># 日付で絞り込み</span>
        filter_date = df_price.index &gt;= data_start_dt
        <span class="comment"># 銘柄をユニバースで絞り込み</span>
        filter_universe = df_price.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>].isin(codes)
        <span class="comment"># 絞り込み実施</span>
        df_price = df_price.loc[filter_date &amp; filter_universe]

        <span class="comment">####</span>
        <span class="comment"># シンプルな特徴量を作成します</span>
        <span class="comment">####</span>
        <span class="comment"># groupby を使用して処理するために並び替え</span>
        df_price.sort_values([<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>], inplace=<span class="predefined-constant">True</span>)
        <span class="comment"># 銘柄毎にグループにします。</span>
        grouped_price = df_price.groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>)[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>
        ]
        <span class="comment"># 銘柄毎に20営業日の変化率を作成してから、金曜日に必ずデータが存在するようにリサンプルしてフィルします</span>
        df_feature = grouped_price.apply(
            <span class="keyword">lambda</span> x: x.pct_change(<span class="integer">20</span>).resample(<span class="string"><span class="delimiter">&quot;</span><span class="content">B</span><span class="delimiter">&quot;</span></span>).ffill().dropna()
        ).to_frame()

        <span class="comment"># 上記が比較的時間のかかる処理なので、処理済みデータを残しておきます。</span>
        df_work = df_feature  <span class="comment"># copyはランタイム実行時には不要なので削除しています</span>

        <span class="comment"># インデックスが銘柄コードと日付になっているため、日付のみに変更します。</span>
        df_work = df_work.reset_index(level=[<span class="integer">0</span>])
        <span class="comment"># カラム名を変更します</span>
        df_work.rename(
            columns={<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">pct_change</span><span class="delimiter">&quot;</span></span>},
            inplace=<span class="predefined-constant">True</span>,
        )
        <span class="comment"># データをpred_start_dt以降の日付に絞り込みます</span>
        df_work = df_work.loc[df_work.index &gt;= pred_start_dt]

        <span class="comment">####</span>
        <span class="comment"># ポートフォリオを組成します</span>
        <span class="comment">####</span>
        <span class="comment"># 金曜日のデータのみに絞り込みます</span>
        df_work = df_work.loc[df_work.index.dayofweek == <span class="integer">4</span>]

        <span class="comment"># 日付毎に処理するためグループ化します</span>
        grouped_work = df_work.groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>, as_index=<span class="predefined-constant">False</span>)

        <span class="comment"># 選択する銘柄数を指定します</span>
        number_of_portfolio_stocks = <span class="integer">25</span>

        <span class="comment"># ポートフォリオの組成方法を戦略に応じて調整します</span>
        strategies = {
            <span class="comment"># リターン・リバーサル戦略</span>
            <span class="string"><span class="delimiter">&quot;</span><span class="content">reversal</span><span class="delimiter">&quot;</span></span>: {<span class="string"><span class="delimiter">&quot;</span><span class="content">asc</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">True</span>},
            <span class="comment"># トレンドフォロー戦略</span>
            <span class="string"><span class="delimiter">&quot;</span><span class="content">trend</span><span class="delimiter">&quot;</span></span>: {<span class="string"><span class="delimiter">&quot;</span><span class="content">asc</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">False</span>},
        }

        <span class="comment"># 戦略に応じたポートフォリオを保存します</span>
        df_portfolios = {}

        <span class="comment"># strategy_id が設定されていない場合は全ての戦略のポートフォリオを作成します</span>
        <span class="keyword">if</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">strategy_id</span><span class="delimiter">&quot;</span></span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="predefined">locals</span>():
            strategy_id = <span class="predefined-constant">None</span>

        <span class="keyword">for</span> i <span class="keyword">in</span> [strategy_id] <span class="keyword">if</span> strategy_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="predefined-constant">None</span> <span class="keyword">else</span> strategies.keys():
            <span class="comment">#  日付毎に戦略に応じた上位25銘柄を選択します。</span>
            df_portfolios[i] = grouped_work.apply(
                <span class="keyword">lambda</span> x: x.sort_values(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">pct_change</span><span class="delimiter">&quot;</span></span>, ascending=strategies[i][<span class="string"><span class="delimiter">&quot;</span><span class="content">asc</span><span class="delimiter">&quot;</span></span>]
                ).head(number_of_portfolio_stocks)
            )

        <span class="comment"># 銘柄ごとの購入金額を指定</span>
        budget = <span class="integer">50000</span>
        <span class="comment"># 戦略毎に処理</span>
        <span class="keyword">for</span> i <span class="keyword">in</span> df_portfolios.keys():
            <span class="comment"># 購入株式数を設定</span>
            df_portfolios[i].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">budget</span><span class="delimiter">&quot;</span></span>] = budget
            <span class="comment"># インデックスを日付のみにします</span>
            df_portfolios[i].reset_index(level=[<span class="integer">0</span>], inplace=<span class="predefined-constant">True</span>)
            <span class="comment"># 金曜日から月曜日日付に変更</span>
            df_portfolios[i].index = df_portfolios[i].index + pd.Timedelta(<span class="string"><span class="delimiter">&quot;</span><span class="content">3D</span><span class="delimiter">&quot;</span></span>)

        <span class="comment">####</span>
        <span class="comment"># 出力を調整します</span>
        <span class="comment">####</span>
        <span class="comment"># 戦略毎に処理</span>
        <span class="keyword">for</span> i <span class="keyword">in</span> df_portfolios.keys():
            <span class="comment"># インデックス名を設定</span>
            df_portfolios[i].index.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>
            <span class="comment"># 出力するカラムを絞り込みます</span>
            df_portfolios[i] = df_portfolios[i].loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">budget</span><span class="delimiter">&quot;</span></span>]]

        <span class="comment"># 出力保存用</span>
        outputs = {}
        <span class="comment"># 戦略毎に処理</span>
        <span class="keyword">for</span> i <span class="keyword">in</span> df_portfolios.keys():
            <span class="comment"># 出力します</span>
            out = io.StringIO()
            <span class="comment"># CSV形式で出力</span>
            df_portfolios[i].to_csv(out, header=<span class="predefined-constant">True</span>)
            <span class="comment"># 出力を保存</span>
            outputs[i] = out.getvalue()

        <span class="keyword">return</span> outputs[strategy_id]</code></pre>
</div>
</div>
<div class="paragraph">
<p>ファ&#8203;イ&#8203;ル&#8203;が&#8203;書&#8203;き&#8203;込&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>! ls -l $package_dir/src/</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>total 3
-rw-r--r-- 1 root root 4450 Feb 27 09:40 predictor.py</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;作&#8203;成&#8203;し&#8203;た&#8203;ク&#8203;ラ&#8203;ス&#8203;が&#8203;適&#8203;切&#8203;に&#8203;動&#8203;く&#8203;か&#8203;を&#8203;動&#8203;作&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203; &#8203;上&#8203;記&#8203;で&#8203;1&#8203;行&#8203;ず&#8203;つ&#8203;実&#8203;行&#8203;し&#8203;た&#8203;場&#8203;合&#8203;と&#8203;同&#8203;一&#8203;の&#8203;出&#8203;力&#8203;で&#8203;あ&#8203;れ&#8203;ば&#8203;良&#8203;い&#8203;こ&#8203;と&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 動作確認します</span>
str_ret = ScoringService.predict(inputs, start_dt=pd.Timestamp(<span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-01</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 出力を確認</span>
print(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>.join(str_ret.split(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>)[:<span class="integer">10</span>]))</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;さ&#8203;せ&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>date,Local Code,budget
2020-01-06,4592,50000
2020-01-06,3254,50000
2020-01-06,6875,50000
2020-01-06,4571,50000
2020-01-06,7956,50000
2020-01-06,6049,50000
2020-01-06,7744,50000
2020-01-06,2395,50000
2020-01-06,3660,50000</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 出力を保存</span>
<span class="keyword">with</span> <span class="predefined">open</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">chapter03-tutorial-01-class.csv</span><span class="delimiter">&quot;</span></span>, mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">w</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
    f.write(str_ret)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;が&#8203;一&#8203;致&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">assert</span> outputs[<span class="string"><span class="delimiter">&quot;</span><span class="content">reversal</span><span class="delimiter">&quot;</span></span>] == str_ret</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_提出用パッケージの作成と提出">3.8.3. 提出用パッケージの作成と提出</h4>
<div class="paragraph">
<p>　3.7.10&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203; <code>ScoringService</code> &#8203;を&#8203; <code>predictor.py</code> &#8203;に&#8203;書&#8203;き&#8203;込&#8203;み、&#8203;Zip&#8203;形&#8203;式&#8203;で&#8203;圧&#8203;縮&#8203;し&#8203;ま&#8203;す。&#8203;今&#8203;回&#8203;は&#8203;シ&#8203;ン&#8203;プ&#8203;ル&#8203;な&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;作&#8203;成&#8203;し&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;学&#8203;習&#8203;済&#8203;み&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;ファ&#8203;イ&#8203;ル&#8203;は&#8203;存&#8203;在&#8203;し&#8203;ま&#8203;せ&#8203;ん。&#8203;た&#8203;だ&#8203;し、&#8203;model&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;は&#8203;必&#8203;須&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;zip&#8203;ファ&#8203;イ&#8203;ル&#8203;に&#8203;は&#8203;該&#8203;当&#8203;の&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;含&#8203;め&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め&#8203;に&#8203;は、&#8203;model&#8203;ファ&#8203;イ&#8203;ル&#8203;に&#8203;は&#8203;何&#8203;ら&#8203;か&#8203;の&#8203;ダ&#8203;ミー&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;作&#8203;成&#8203;し&#8203;て&#8203;zip&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;と&#8203;良&#8203;い&#8203;で&#8203;しょ&#8203;う。</p>
</div>
<div class="paragraph">
<p>以&#8203;下、&#8203;Zip&#8203;ファ&#8203;イ&#8203;ル&#8203;作&#8203;成&#8203;例&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir model src
$ touch model/dummy.txt
$ ls
model src
$ zip -v submit.zip src/predictor.py model/dummy.txt</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 提出用パッケージ名</span>
package_file = <span class="string"><span class="delimiter">&quot;</span><span class="content">chapter03-model.zip</span><span class="delimiter">&quot;</span></span>
<span class="comment"># パッケージファイルパス</span>
package_path = f<span class="string"><span class="delimiter">&quot;</span><span class="content">{working_dir}/{package_file}</span><span class="delimiter">&quot;</span></span>

<span class="comment"># zipファイルを作成</span>
<span class="keyword">with</span> zipfile.ZipFile(package_path, <span class="string"><span class="delimiter">&quot;</span><span class="content">w</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
    <span class="comment"># model/dummy.txtを追加</span>
    print(f<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] add {package_dir}/model/dummy.txt to model/dummy.txt</span><span class="delimiter">&quot;</span></span>)
    f.write(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{package_dir}/model/dummy.txt</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">model/dummy.txt</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># src/predictor.py を追加</span>
    print(f<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] add {package_dir}/src/predictor.py to src/predictor.py</span><span class="delimiter">&quot;</span></span>)
    f.write(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{package_dir}/src/predictor.py</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">src/predictor.py</span><span class="delimiter">&quot;</span></span>)

print(f<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] please check {package_path}</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;以&#8203;上&#8203;で&#8203;投&#8203;稿&#8203;用&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;パッ&#8203;ケー&#8203;ジ&#8203;は&#8203;完&#8203;成&#8203;で&#8203;す。&#8203;`chapter03-model.zip` &#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;ペー&#8203;ジ&#8203;か&#8203;ら&#8203;投&#8203;稿&#8203;し&#8203;て&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;に&#8203;掲&#8203;載&#8203;さ&#8203;れ&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
<div class="paragraph">
<p>　&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;に&#8203;掲&#8203;載&#8203;さ&#8203;れ&#8203;た&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;し&#8203;た&#8203;ら、&#8203;例&#8203;え&#8203;ば、&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;変&#8203;更&#8203;し&#8203;て&#8203;み&#8203;た&#8203;り、&#8203;複&#8203;数&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;か&#8203;ら&#8203;10&#8203;銘&#8203;柄&#8203;ず&#8203;つ&#8203;選&#8203;択&#8203;す&#8203;る&#8203;ロ&#8203;ジッ&#8203;ク&#8203;を&#8203;実&#8203;装&#8203;し&#8203;て&#8203;み&#8203;る&#8203;の&#8203;は&#8203;ど&#8203;う&#8203;で&#8203;しょ&#8203;う&#8203;か。&#8203;い&#8203;く&#8203;つ&#8203;か&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;「<a href="#anchor-2.7">2.7. &#8203;特&#8203;徴&#8203;量&#8203;の&#8203;生&#8203;成&#8203;</a>」&#8203;で&#8203;説&#8203;明&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;の&#8203;で&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;特&#8203;に、&#8203;「2.7.2. &#8203;定&#8203;常&#8203;性&#8203;を&#8203;意&#8203;識&#8203;し&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;設&#8203;計」&#8203;は&#8203;重&#8203;要&#8203;な&#8203;概&#8203;念&#8203;で&#8203;す&#8203;の&#8203;で&#8203;ご&#8203;一&#8203;読&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>次&#8203;章&#8203;で&#8203;は、&#8203;2&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;機&#8203;械&#8203;学&#8203;習&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;組&#8203;成&#8203;す&#8203;る&#8203;方&#8203;法&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;記&#8203;載&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ファンダメンタルズ分析チャレンジで作成したモデルを使用してポートフォリオを構築しよう">4. 「ファンダメンタルズ分析チャレンジ」で作成したモデルを使用してポートフォリオを構築しよう</h2>
<div class="sectionbody">
<div class="paragraph">
<p>　4&#8203;章&#8203;で&#8203;は、&#8203;2&#8203;章&#8203;の&#8203;「ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;ズ&#8203;分&#8203;析&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ」&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;利&#8203;用&#8203;し&#8203;て&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;構&#8203;築&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　2&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;最&#8203;高&#8203;値・&#8203;最&#8203;安&#8203;値&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;が、&#8203;各&#8203;銘&#8203;柄&#8203;の&#8203;株&#8203;価&#8203;の&#8203;最&#8203;高&#8203;値・&#8203;最&#8203;安&#8203;値&#8203;だ&#8203;け&#8203;で&#8203;は&#8203;な&#8203;く&#8203;先&#8203;行&#8203;き&#8203;も&#8203;あ&#8203;る&#8203;程&#8203;度&#8203;予&#8203;測&#8203;で&#8203;き&#8203;て&#8203;い&#8203;た&#8203;と&#8203;し&#8203;た&#8203;ら、&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;組&#8203;成&#8203;の&#8203;た&#8203;め&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;と&#8203;し&#8203;て&#8203;利&#8203;用&#8203;し&#8203;て&#8203;も、&#8203;あ&#8203;る&#8203;程&#8203;度&#8203;の&#8203;効&#8203;果&#8203;が&#8203;期&#8203;待&#8203;で&#8203;き&#8203;る&#8203;か&#8203;も&#8203;し&#8203;れ&#8203;ま&#8203;せ&#8203;ん。&#8203;特&#8203;に&#8203;最&#8203;安&#8203;値&#8203;予&#8203;測&#8203;は&#8203;あ&#8203;る&#8203;種&#8203;の&#8203;最&#8203;大&#8203;リ&#8203;ス&#8203;ク&#8203;の&#8203;推&#8203;定&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;リ&#8203;ス&#8203;ク&#8203;が&#8203;最&#8203;も&#8203;低&#8203;い&#8203;銘&#8203;柄&#8203;に&#8203;投&#8203;資&#8203;す&#8203;る&#8203;と&#8203;い&#8203;う&#8203;戦&#8203;略&#8203;は&#8203;十&#8203;分&#8203;に&#8203;収&#8203;益&#8203;を&#8203;産&#8203;み&#8203;出&#8203;す&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　3&#8203;章&#8203;で&#8203;は&#8203;リ&#8203;ター&#8203;ン・&#8203;リ&#8203;バー&#8203;サ&#8203;ル&#8203; (&#8203;逆&#8203;張&#8203;り&#8203;) &#8203;戦&#8203;略&#8203;と&#8203;ト&#8203;レ&#8203;ン&#8203;ド&#8203;フォ&#8203;ロー&#8203; (&#8203;順&#8203;張&#8203;り&#8203;) &#8203;戦&#8203;略&#8203;を&#8203;採&#8203;用&#8203;し、&#8203;そ&#8203;の&#8203;実&#8203;装&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;し&#8203;た&#8203;が、&#8203;3&#8203;章&#8203;は&#8203;機&#8203;械&#8203;学&#8203;習&#8203;の&#8203;ア&#8203;プ&#8203;ロー&#8203;チ&#8203;と&#8203;い&#8203;う&#8203;よ&#8203;り&#8203;は&#8203;む&#8203;し&#8203;ろ、&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;成&#8203;せ&#8203;ず&#8203;に&#8203;戦&#8203;略&#8203;を&#8203;そ&#8203;の&#8203;ま&#8203;ま&#8203;実&#8203;装&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;4&#8203;章&#8203;の&#8203;狙&#8203;い&#8203;は&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;利&#8203;用&#8203;し&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;組&#8203;成&#8203;方&#8203;法&#8203;を&#8203;学&#8203;ぶ&#8203;こ&#8203;と&#8203;で&#8203;す。&#8203;本&#8203;章&#8203;は&#8203;主&#8203;に&#8203;以&#8203;下&#8203;の&#8203;ス&#8203;テッ&#8203;プ&#8203;で&#8203;進&#8203;め&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>1. 環境設定
2. ライブラリのロード
3. データセットの読み込み
4. 2章で作成したモデルの配置
5. 2章のpredictor.pyの変更
  5.1 get_inputsの変更 (stock_fin_priceを読み込む)
  5.2 get_datasetの変更 (必要なデータのみ読み込む)
  5.3 get_codesの変更 (ユニバースの変更)
  5.4 get_features_for_predict の変更 (stock_fin_priceを使用する)
  5.5 predictの変更 (銘柄選択、出力を変更)
6. バックテストの実行
7. バックテストの評価
8. 適時開示情報を使用して特別損失銘柄を除外
9. パッケージの作成</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_環境設定">4.1. 環境設定</h3>
<div class="paragraph">
<p>　&#8203;基&#8203;本&#8203;的&#8203;に&#8203;4&#8203;章&#8203;の&#8203;環&#8203;境&#8203;設&#8203;定&#8203;方&#8203;法&#8203;は、&#8203;3&#8203;章&#8203;に&#8203;準&#8203;拠&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;本&#8203;章&#8203;の&#8203;notebook&#8203;は&#8203;<a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial/tree/main/handson/Chapter04/20210224-chapter04-tutorial.ipynb">こちら</a>&#8203;か&#8203;ら&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;て&#8203;ご&#8203;利&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;な&#8203;お、&#8203;2&#8203;章&#8203;の&#8203;notebook&#8203;を&#8203;実&#8203;行&#8203;し&#8203;た&#8203;際&#8203;に&#8203;最&#8203;後&#8203;に&#8203;保&#8203;存&#8203;さ&#8203;れ&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;配&#8203;置&#8203;し&#8203;た&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203; <code>ScoringService.get_model</code> &#8203;の&#8203;パ&#8203;ラ&#8203;メー&#8203;ター&#8203;と&#8203;し&#8203;て&#8203;設&#8203;定&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;2&#8203;章&#8203;を&#8203;そ&#8203;の&#8203;ま&#8203;ま&#8203;実&#8203;行&#8203;し&#8203;た&#8203;際&#8203;の&#8203;学&#8203;習&#8203;済&#8203;み&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;は、&#8203;<a href="https://signate.jp/competitions/443/data">こちら</a>&#8203;か&#8203;ら&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;可&#8203;能&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>　Google Colaboratory&#8203;の&#8203;環&#8203;境&#8203;で&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;を&#8203;実&#8203;行&#8203;す&#8203;る&#8203;場&#8203;合、&#8203;最&#8203;初&#8203;に&#8203;以&#8203;下&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;実&#8203;行&#8203;し&#8203;て&#8203; Google Colaboratory &#8203;上&#8203;の&#8203; notebook &#8203;か&#8203;ら&#8203; Google Drive &#8203;に&#8203;ア&#8203;ク&#8203;セ&#8203;ス&#8203;で&#8203;き&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># Google Colab環境ではGoogle Driveをマウントしてアクセスできるようにします。</span>
<span class="keyword">import</span> <span class="include">sys</span>

<span class="keyword">if</span> <span class="string"><span class="delimiter">'</span><span class="content">google.colab</span><span class="delimiter">'</span></span> <span class="keyword">in</span> sys.modules:
    <span class="comment"># Google Drive をマウントします</span>
    <span class="keyword">from</span> <span class="include">google.colab</span> <span class="keyword">import</span> <span class="include">drive</span>
    mount_dir = <span class="string"><span class="delimiter">&quot;</span><span class="content">/content/drive</span><span class="delimiter">&quot;</span></span>
    drive.mount(mount_dir)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_必要なライブラリの読み込み_2">4.2. 必要なライブラリの読み込み</h3>
<div class="paragraph">
<p>　&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;と&#8203;Google Colaboratory&#8203;環&#8203;境&#8203;の&#8203;両&#8203;者&#8203;で&#8203;共&#8203;通&#8203;の&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;バー&#8203;ジョ&#8203;ン&#8203;を&#8203;調&#8203;整&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="error">!</span>pip install --no-cache-<span class="predefined">dir</span> joblib==<span class="float">1.0</span><span class="float">.1</span> numpy==<span class="float">1.19</span><span class="float">.5</span> pandas==<span class="float">1.1</span><span class="float">.5</span> scikit-learn==<span class="float">0.20</span><span class="float">.3</span> scipy==<span class="float">1.2</span><span class="float">.1</span> seaborn==<span class="float">0.9</span><span class="float">.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;次&#8203;に、&#8203;以&#8203;下&#8203;の&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">import</span> <span class="include">io</span>
<span class="keyword">import</span> <span class="include">os</span>
<span class="keyword">import</span> <span class="include">pickle</span>
<span class="keyword">import</span> <span class="include">sys</span>
<span class="keyword">import</span> <span class="include">zipfile</span>

<span class="keyword">import</span> <span class="include">matplotlib</span>
<span class="keyword">import</span> <span class="include">matplotlib.pyplot</span> <span class="keyword">as</span> plt
<span class="keyword">import</span> <span class="include">numpy</span> <span class="keyword">as</span> np
<span class="keyword">import</span> <span class="include">pandas</span> <span class="keyword">as</span> pd
<span class="keyword">import</span> <span class="include">seaborn</span> <span class="keyword">as</span> sns
<span class="keyword">from</span> <span class="include">scipy</span> <span class="keyword">import</span> <span class="include">stats</span>
<span class="keyword">from</span> <span class="include">sklearn.ensemble</span> <span class="keyword">import</span> <span class="include">RandomForestRegressor</span>
<span class="keyword">from</span> <span class="include">tqdm.auto</span> <span class="keyword">import</span> <span class="include">tqdm</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;次&#8203;に、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;評&#8203;価&#8203;検&#8203;証&#8203;用&#8203;の&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;モ&#8203;ジュー&#8203;ル&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;モ&#8203;ジュー&#8203;ル&#8203;の&#8203;使&#8203;用&#8203;方&#8203;法&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;「3.6. &#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;環&#8203;境&#8203;の&#8203;構&#8203;築」&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;イ&#8203;ン&#8203;ポー&#8203;ト&#8203;時&#8203;に&#8203;エ&#8203;ラー&#8203;が&#8203;出&#8203;た&#8203;場&#8203;合&#8203;は、&#8203;sys.path &#8203;に&#8203; backtest.py &#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;配&#8203;置&#8203;し&#8203;た&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;追&#8203;加&#8203;し&#8203;て&#8203;か&#8203;ら&#8203;再&#8203;度&#8203;イ&#8203;ン&#8203;ポー&#8203;ト&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># インポート時にエラーが出た場合は、以下のmodule_dirをbacktest.pyを配置したディレクトリに変更してください。</span>
<span class="keyword">import</span> <span class="include">sys</span>
<span class="keyword">if</span> <span class="string"><span class="delimiter">'</span><span class="content">google.colab</span><span class="delimiter">'</span></span> <span class="keyword">in</span> sys.modules:
  <span class="comment"># Backtestを配置したディレクトリへのフルパスを指定します</span>
  module_dir = f<span class="string"><span class="delimiter">&quot;</span><span class="content">{mount_dir}/MyDrive/JPX_competition/Chapter03/backtest</span><span class="delimiter">&quot;</span></span>
<span class="keyword">else</span>:
  <span class="comment"># Backtestを配置したディレクトリへのフルパスを指定します</span>
  module_dir = <span class="string"><span class="delimiter">&quot;</span><span class="content">/notebook/Chapter03/backtest</span><span class="delimiter">&quot;</span></span>
sys.path.append(module_dir)

<span class="keyword">from</span> <span class="include">backtest</span> <span class="keyword">import</span> <span class="include">Backtest</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　Pandas&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;表&#8203;示&#8203;す&#8203;る&#8203;際&#8203;に&#8203;省&#8203;略&#8203;さ&#8203;れ&#8203;な&#8203;い&#8203;よ&#8203;う&#8203;に&#8203;設&#8203;定&#8203;を&#8203;変&#8203;更&#8203;し&#8203;ま&#8203;す</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 表示用の設定を変更します</span>
%matplotlib inline
pd.options.display.max_rows = <span class="integer">100</span>
pd.options.display.max_columns = <span class="integer">100</span>
pd.options.display.width = <span class="integer">120</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_データセット及び2章のモデル準備">4.3. データセット及び2章のモデル準備</h3>
<div class="sect3">
<h4 id="_データセットの読み込み_3">4.3.1. データセットの読み込み</h4>
<div class="paragraph">
<p>　&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;配&#8203;置&#8203;し&#8203;た&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;の&#8203;パ&#8203;ス&#8203;を&#8203;設&#8203;定&#8203;し&#8203;ま&#8203;す。&#8203;Google Colab&#8203;を&#8203;ご&#8203;使&#8203;用&#8203;の&#8203;場&#8203;合&#8203;は&#8203; Google Drive &#8203;に&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;アッ&#8203;プ&#8203;ロー&#8203;ド&#8203;し、&#8203;そ&#8203;の&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;指&#8203;定&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;な&#8203;お、&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;取&#8203;得&#8203;方&#8203;法&#8203;お&#8203;よ&#8203;び&#8203;内&#8203;容&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;「3.4. &#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;説&#8203;明」&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># データセットを配置したディレクトリのパスを設定</span>
<span class="keyword">if</span> <span class="string"><span class="delimiter">'</span><span class="content">google.colab</span><span class="delimiter">'</span></span> <span class="keyword">in</span> sys.modules:
    dataset_dir = f<span class="string"><span class="delimiter">&quot;</span><span class="content">{mount_dir}/MyDrive/JPX_competition/data_dir_comp2</span><span class="delimiter">&quot;</span></span>
<span class="keyword">else</span>:
    dataset_dir = <span class="string"><span class="delimiter">&quot;</span><span class="content">/notebook/data_dir_comp2</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;に&#8203;お&#8203;け&#8203;る&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;へ&#8203;の&#8203;ア&#8203;ク&#8203;セ&#8203;ス&#8203;は、&#8203; <code>ScoringService.predict()</code> &#8203;メ&#8203;ソッ&#8203;ド&#8203;に&#8203;渡&#8203;さ&#8203;れ&#8203;る&#8203;inputs&#8203;パ&#8203;ラ&#8203;メー&#8203;ター&#8203;を&#8203;通&#8203;し&#8203;て&#8203;行&#8203;う&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;本&#8203;notebook&#8203;環&#8203;境&#8203;で&#8203;も&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;と&#8203;共&#8203;通&#8203;の&#8203;方&#8203;法&#8203;で&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;に&#8203;ア&#8203;ク&#8203;セ&#8203;ス&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;コー&#8203;ド&#8203;が&#8203;複&#8203;雑&#8203;に&#8203;なっ&#8203;た&#8203;り&#8203;投&#8203;稿&#8203;用&#8203;に&#8203;コー&#8203;ド&#8203;を&#8203;編&#8203;集&#8203;し&#8203;た&#8203;り&#8203;し&#8203;な&#8203;く&#8203;て&#8203;も&#8203;済&#8203;む&#8203;よ&#8203;う&#8203;に&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;な&#8203;お、&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;で&#8203;は&#8203; <code>purchase_date.csv</code> &#8203;に&#8203;評&#8203;価&#8203;対&#8203;象&#8203;週&#8203;の&#8203;初&#8203;日&#8203;の&#8203;日&#8203;付&#8203;が&#8203;指&#8203;定&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;以&#8203;下&#8203;で&#8203;は&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;で&#8203;も&#8203;適&#8203;切&#8203;に&#8203;動&#8203;作&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203; <code>purchase_date.csv</code> &#8203;の&#8203;日&#8203;付&#8203;を&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;組&#8203;成&#8203;対&#8203;象&#8203;と&#8203;す&#8203;る&#8203;コー&#8203;ド&#8203;を&#8203;記&#8203;載&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 入力パラメーターを設定します。ランタイム環境での実行時と同一フォーマットにします</span>
inputs = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_list.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_price.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_fin.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin_price</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_fin_price.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="comment"># ニュースデータ</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">tdnet</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/tdnet.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/disclosureItems.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">nikkei_article</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/nikkei_article.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">article</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/article.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">industry</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/industry.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">industry2</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/industry2.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">region</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/region.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">theme</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/theme.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="comment"># 目的変数データ</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_labels.csv.gz</span><span class="delimiter">&quot;</span></span>,
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_2章で作成したモデルの配置">4.3.2. 2章で作成したモデルの配置</h4>
<div class="paragraph">
<p>　2&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;あ&#8203;る&#8203; <code>my_label_high_20.pkl</code> &#8203;と&#8203; <code>my_label_low_20.pkl</code> &#8203;を&#8203;archive/model&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;に&#8203;配&#8203;置&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203;<a href="https://signate.jp/competitions/443/data">こちら</a>&#8203;か&#8203;ら&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;配&#8203;置&#8203;し&#8203;た&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;変&#8203;数&#8203;に&#8203;設&#8203;定&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># モデル配置ディレクトリのパスを設定</span>
<span class="keyword">if</span> <span class="string"><span class="delimiter">'</span><span class="content">google.colab</span><span class="delimiter">'</span></span> <span class="keyword">in</span> sys.modules:
    model_dir = f<span class="string"><span class="delimiter">&quot;</span><span class="content">{mount_dir}/MyDrive/JPX_competition/Chapter04/archive/model</span><span class="delimiter">&quot;</span></span>
<span class="keyword">else</span>:
    model_dir = <span class="string"><span class="delimiter">&quot;</span><span class="content">archive/model</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>モ&#8203;デ&#8203;ル&#8203;が&#8203;正&#8203;し&#8203;く&#8203;配&#8203;置&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;以&#8203;下&#8203;の&#8203;コー&#8203;ド&#8203;で&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">!ls -lh $model_dir/</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2章で作成した_predictor_py_の変更">4.4. 2章で作成した <code>predictor.py</code> の変更</h3>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;か&#8203;ら&#8203;は&#8203;2&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203; <code>predictor.py</code> &#8203;を&#8203;ベー&#8203;ス&#8203;に&#8203;変&#8203;更&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。&#8203;な&#8203;お、&#8203;2&#8203;章&#8203;の&#8203; <code>predictor.py</code> &#8203;は&#8203;<a href="https://raw.githubusercontent.com/JapanExchangeGroup/J-Quants-Tutorial/main/handson/Chapter02/archive/src/predictor.py">こちら</a>&#8203;か&#8203;ら&#8203;取&#8203;得&#8203;可&#8203;能&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;predictor.py&#8203;に&#8203;以&#8203;下&#8203;の&#8203;変&#8203;更&#8203;を&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。&#8203;あ&#8203;る&#8203;程&#8203;度&#8203;規&#8203;模&#8203;の&#8203;大&#8203;き&#8203;な&#8203;変&#8203;更&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;組&#8203;成&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;必&#8203;要&#8203;な&#8203;変&#8203;更&#8203;で&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>get_dataset&#8203;の&#8203;変&#8203;更&#8203; (&#8203;必&#8203;要&#8203;な&#8203;デー&#8203;タ&#8203;の&#8203;み&#8203;読&#8203;み&#8203;込&#8203;む&#8203;)</p>
</li>
<li>
<p>get_codes&#8203;の&#8203;変&#8203;更&#8203; (&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;の&#8203;変&#8203;更&#8203;)</p>
</li>
<li>
<p>get_features_for_predict &#8203;の&#8203;変&#8203;更&#8203; (stock_fin_price&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;)</p>
</li>
<li>
<p>get_exclude &#8203;の&#8203;追&#8203;加&#8203; (&#8203;適&#8203;時&#8203;開&#8203;示&#8203;情&#8203;報&#8203;を&#8203;使&#8203;用&#8203;し&#8203;た&#8203;銘&#8203;柄&#8203;選&#8203;択&#8203;)</p>
</li>
<li>
<p>strategy &#8203;の&#8203;追&#8203;加&#8203; (&#8203;銘&#8203;柄&#8203;選&#8203;択&#8203;)</p>
</li>
<li>
<p>predict &#8203;の&#8203;変&#8203;更&#8203; (&#8203;銘&#8203;柄&#8203;選&#8203;択、&#8203;出&#8203;力&#8203;を&#8203;変&#8203;更&#8203;)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_get_datasetの変更_必要なデータのみ読み込む">4.4.1. get_datasetの変更 (必要なデータのみ読み込む)</h4>
<div class="paragraph">
<p>　&#8203;ま&#8203;ず&#8203;は、&#8203;load_data&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203;を&#8203;追&#8203;加&#8203;し&#8203;て&#8203;必&#8203;要&#8203;な&#8203;ファ&#8203;イ&#8203;ル&#8203;の&#8203;み&#8203;を&#8203;ロー&#8203;ド&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;変&#8203;更&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_dataset</span>(cls, inputs, load_data):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            inputs (list[str]): path to dataset files</span><span class="content">
</span><span class="content">            load_data (list[str]): specify loading data</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            dict[pd.DataFrame]: loaded data</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="keyword">if</span> cls.dfs <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            cls.dfs = {}
        <span class="keyword">for</span> k, v <span class="keyword">in</span> inputs.items():
            <span class="comment"># 必要なデータのみ読み込みます</span>
            <span class="keyword">if</span> k <span class="keyword">not</span> <span class="keyword">in</span> load_data:
                <span class="keyword">continue</span>
            cls.dfs[k] = pd.read_csv(v)
            <span class="comment"># DataFrameのindexを設定します。</span>
            <span class="keyword">if</span> k == <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>:
                cls.dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = pd.to_datetime(
                    cls.dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>]
                )
                cls.dfs[k].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
            <span class="keyword">elif</span> k <span class="keyword">in</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin_price</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>]:
                cls.dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = pd.to_datetime(
                    cls.dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">base_date</span><span class="delimiter">&quot;</span></span>]
                )
                cls.dfs[k].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
        <span class="keyword">return</span> cls.dfs</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_codesの変更_ユニバースの変更">4.4.2. get_codesの変更 (ユニバースの変更)</h4>
<div class="paragraph">
<p>　&#8203;次&#8203;に、&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;universe_comp2&#8203;が&#8203;True&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;変&#8203;更&#8203; (prediction_target&#8203;か&#8203;ら&#8203;変&#8203;更&#8203;)&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_codes</span>(cls, dfs):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            dfs (dict[pd.DataFrame]): loaded data</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            array: list of stock codes</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        stock_list = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>].copy()
        <span class="comment"># 予測対象の銘柄コードを取得</span>
        cls.codes = stock_list[stock_list[<span class="string"><span class="delimiter">&quot;</span><span class="content">universe_comp2</span><span class="delimiter">&quot;</span></span>] == <span class="predefined-constant">True</span>][
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>
        ].values
        <span class="keyword">return</span> cls.codes</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_features_for_predict_の変更_stock_fin_priceを使用する">4.4.3. get_features_for_predict の変更 (stock_fin_priceを使用する)</h4>
<div class="paragraph">
<p>　stock_fin_price&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;変&#8203;更&#8203;し、&#8203;さ&#8203;ら&#8203;に&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;で&#8203;は&#8203;週&#8203;末&#8203;で&#8203;あ&#8203;る&#8203;金&#8203;曜&#8203;日&#8203;ま&#8203;で&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;利&#8203;用&#8203;し&#8203;て&#8203;出&#8203;力&#8203;を&#8203;だ&#8203;す&#8203;た&#8203;め、&#8203;3&#8203;章&#8203;で&#8203;も&#8203;行っ&#8203;た&#8203;リ&#8203;サ&#8203;ン&#8203;プ&#8203;ル・&#8203;前&#8203;方&#8203;補&#8203;完&#8203;の&#8203;処&#8203;理&#8203;を&#8203;行っ&#8203;た&#8203;上&#8203;で、&#8203;金&#8203;曜&#8203;日&#8203;の&#8203;レ&#8203;コー&#8203;ド&#8203;の&#8203;み&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;変&#8203;更&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_features_for_predict2</span>(cls, dfs, code, fin_columns, start_dt=TEST_START):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            dfs (dict)  : dict of pd.DataFrame include stock_fin, stock_price</span><span class="content">
</span><span class="content">            code (int)  : A local code for a listed company</span><span class="content">
</span><span class="content">            fin_columns(list[str]): list of columns</span><span class="content">
</span><span class="content">            start_dt (str): specify date range</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            feature DataFrame (pd.DataFrame)</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="comment"># stock_fin_priceデータを読み込み</span>
        stock_fin_price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin_price</span><span class="delimiter">&quot;</span></span>]

        <span class="comment"># 特定の銘柄コードのデータに絞る</span>
        feats = stock_fin_price[stock_fin_price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
        <span class="comment"># 2章で作成したモデルの特徴量では過去60営業日のデータを使用しているため、</span>
        <span class="comment"># 予測対象日からバッファ含めて土日を除く過去90日遡った時点から特徴量を生成します。</span>
        n = <span class="integer">90</span>
        <span class="comment"># 特徴量の生成対象期間を指定</span>
        feats = feats.loc[pd.Timestamp(start_dt) - pd.offsets.BDay(n) :]
        <span class="comment"># 指定されたカラムおよびExchangeOfficialCloseに絞り込み</span>
        feats = feats.loc[
            :, fin_columns + [<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]
        ].copy()
        <span class="comment"># 欠損値処理</span>
        feats = feats.fillna(<span class="integer">0</span>)

        <span class="comment"># 終値の20営業日リターン</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_1month</span><span class="delimiter">&quot;</span></span>] = feats[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>
        ].pct_change(<span class="integer">20</span>)
        <span class="comment"># 終値の40営業日リターン</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_2month</span><span class="delimiter">&quot;</span></span>] = feats[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>
        ].pct_change(<span class="integer">40</span>)
        <span class="comment"># 終値の60営業日リターン</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_3month</span><span class="delimiter">&quot;</span></span>] = feats[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>
        ].pct_change(<span class="integer">60</span>)
        <span class="comment"># 終値の20営業日ボラティリティ</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_1month</span><span class="delimiter">&quot;</span></span>] = (
            np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>])
            .diff()
            .rolling(<span class="integer">20</span>)
            .std()
        )
        <span class="comment"># 終値の40営業日ボラティリティ</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_2month</span><span class="delimiter">&quot;</span></span>] = (
            np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>])
            .diff()
            .rolling(<span class="integer">40</span>)
            .std()
        )
        <span class="comment"># 終値の60営業日ボラティリティ</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_3month</span><span class="delimiter">&quot;</span></span>] = (
            np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>])
            .diff()
            .rolling(<span class="integer">60</span>)
            .std()
        )
        <span class="comment"># 終値と20営業日の単純移動平均線の乖離</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_1month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
            feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">20</span>).mean()
        )
        <span class="comment"># 終値と40営業日の単純移動平均線の乖離</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_2month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
            feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">40</span>).mean()
        )
        <span class="comment"># 終値と60営業日の単純移動平均線の乖離</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_3month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
            feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">60</span>).mean()
        )
        <span class="comment"># 欠損値処理</span>
        feats = feats.fillna(<span class="integer">0</span>)
        <span class="comment"># 元データのカラムを削除</span>
        feats = feats.drop([<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>], axis=<span class="integer">1</span>)

        <span class="comment"># 1B resample + ffill で金曜日に必ずレコードが存在するようにする</span>
        feats = feats.resample(<span class="string"><span class="delimiter">&quot;</span><span class="content">B</span><span class="delimiter">&quot;</span></span>).ffill()
        <span class="comment"># 特徴量を金曜日日付のみに絞り込む</span>
        FRIDAY = <span class="integer">4</span>
        feats = feats.loc[feats.index.dayofweek == FRIDAY]

        <span class="comment"># 欠損値処理を行います。</span>
        feats = feats.replace([np.inf, -np.inf], <span class="integer">0</span>)

        <span class="comment"># 銘柄コードを設定</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] = code

        <span class="comment"># 生成対象日以降の特徴量に絞る</span>
        feats = feats.loc[pd.Timestamp(start_dt) :]

        <span class="keyword">return</span> feats</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_exclude_の追加_適時開示情報を使用した銘柄選択">4.4.4. get_exclude の追加 (適時開示情報を使用した銘柄選択)</h4>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は&#8203;適&#8203;時&#8203;開&#8203;示&#8203;情&#8203;報&#8203;が&#8203;デー&#8203;タ&#8203;と&#8203;し&#8203;て&#8203;提&#8203;供&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;適&#8203;時&#8203;開&#8203;示&#8203;情&#8203;報&#8203;に&#8203;は&#8203;様々&#8203;な&#8203;種&#8203;類&#8203;が&#8203;あ&#8203;り&#8203; disclosureItems.csv.gz &#8203;の&#8203;中&#8203;に&#8203;は&#8203;適&#8203;時&#8203;開&#8203;示&#8203;資&#8203;料&#8203;の&#8203;公&#8203;開&#8203;項&#8203;目&#8203;コー&#8203;ド&#8203;が&#8203;記&#8203;載&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;公&#8203;開&#8203;項&#8203;目&#8203;の&#8203;な&#8203;か&#8203;に&#8203;は&#8203;株&#8203;価&#8203;に&#8203;大&#8203;き&#8203;な&#8203;影&#8203;響&#8203;を&#8203;与&#8203;え&#8203;る&#8203;も&#8203;の&#8203;も&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;<br>
こ&#8203;こ&#8203;で&#8203;は&#8203;例&#8203;と&#8203;し&#8203;て&#8203;特&#8203;別&#8203;損&#8203;失&#8203;を&#8203;開&#8203;示&#8203;し&#8203;た&#8203;銘&#8203;柄&#8203;を&#8203;そ&#8203;の&#8203;週&#8203;お&#8203;よ&#8203;び&#8203;そ&#8203;の&#8203;翌&#8203;週&#8203;に&#8203;は&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;組&#8203;み&#8203;入&#8203;れ&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;を&#8203;試&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;す。&#8203;特&#8203;別&#8203;損&#8203;失&#8203;と&#8203;は&#8203;災&#8203;害&#8203;な&#8203;ど&#8203;企&#8203;業&#8203;の&#8203;通&#8203;常&#8203;の&#8203;業&#8203;務&#8203;外&#8203;で&#8203;発&#8203;生&#8203;し&#8203;た&#8203;一&#8203;過&#8203;性&#8203;の&#8203;損&#8203;失&#8203;の&#8203;こ&#8203;と&#8203;を&#8203;い&#8203;い&#8203;ま&#8203;す。&#8203;市&#8203;場&#8203;が&#8203;想&#8203;定&#8203;し&#8203;て&#8203;い&#8203;な&#8203;かっ&#8203;た&#8203;一&#8203;過&#8203;性&#8203;の&#8203;損&#8203;失&#8203;が&#8203;発&#8203;表&#8203;さ&#8203;れ&#8203;た&#8203;場&#8203;合、&#8203;そ&#8203;の&#8203;銘&#8203;柄&#8203;の&#8203;株&#8203;価&#8203;は&#8203;下&#8203;が&#8203;る&#8203;た&#8203;め&#8203;除&#8203;外&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;損&#8203;失&#8203;を&#8203;回&#8203;避&#8203;で&#8203;き&#8203;る&#8203;と&#8203;の&#8203;仮&#8203;説&#8203;を&#8203;設&#8203;定&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_exclude</span>(
        cls,
        df_tdnet,  <span class="comment"># tdnetのデータ</span>
        start_dt=<span class="predefined-constant">None</span>,  <span class="comment"># データ取得対象の開始日、Noneの場合は制限なし</span>
        end_dt=<span class="predefined-constant">None</span>,  <span class="comment"># データ取得対象の終了日、Noneの場合は制限なし</span>
        lookback=<span class="integer">7</span>,  <span class="comment"># 除外考慮期間 (days)</span>
        target_day_of_week=<span class="integer">4</span>,  <span class="comment"># 起点となる曜日</span>
    ):
        <span class="comment"># 特別損失のレコードを取得</span>
        special_loss = df_tdnet[df_tdnet[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>].str.contains(<span class="string"><span class="delimiter">'</span><span class="content">201&quot;</span><span class="delimiter">'</span></span>)].copy()
        <span class="comment"># 日付型を調整</span>
        special_loss[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>] = pd.to_datetime(special_loss[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosedDate</span><span class="delimiter">&quot;</span></span>])
        <span class="comment"># 処理対象開始日が設定されていない場合はデータの最初の日付を取得</span>
        <span class="keyword">if</span> start_dt <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            start_dt = special_loss[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>].iloc[<span class="integer">0</span>]
        <span class="comment"># 処理対象終了日が設定されていない場合はデータの最後の日付を取得</span>
        <span class="keyword">if</span> end_dt <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            end_dt = special_loss[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>].iloc[-<span class="integer">1</span>]
        <span class="comment">#  処理対象日で絞り込み</span>
        special_loss = special_loss[
            (start_dt &lt;= special_loss[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>]) &amp; (special_loss[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>] &lt;= end_dt)
        ]
        <span class="comment"># 出力用にカラムを調整</span>
        res = special_loss[[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">disclosedDate</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>]].copy()
        <span class="comment"># 銘柄コードを4桁にする</span>
        res[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] = res[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>].astype(<span class="predefined">str</span>).str[:-<span class="integer">1</span>]
        <span class="comment"># 予測の基準となる金曜日の日付にするために調整</span>
        res[<span class="string"><span class="delimiter">&quot;</span><span class="content">remain</span><span class="delimiter">&quot;</span></span>] = (target_day_of_week - res[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>].dt.dayofweek) % <span class="integer">7</span>
        res[<span class="string"><span class="delimiter">&quot;</span><span class="content">start_dt</span><span class="delimiter">&quot;</span></span>] = res[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>] + pd.to_timedelta(res[<span class="string"><span class="delimiter">&quot;</span><span class="content">remain</span><span class="delimiter">&quot;</span></span>], unit=<span class="string"><span class="delimiter">&quot;</span><span class="content">d</span><span class="delimiter">&quot;</span></span>)
        res[<span class="string"><span class="delimiter">&quot;</span><span class="content">end_dt</span><span class="delimiter">&quot;</span></span>] = res[<span class="string"><span class="delimiter">&quot;</span><span class="content">start_dt</span><span class="delimiter">&quot;</span></span>] + pd.Timedelta(days=lookback)
        columns = [<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">start_dt</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">end_dt</span><span class="delimiter">&quot;</span></span>]
        <span class="keyword">return</span> res[columns].reset_index(drop=<span class="predefined-constant">True</span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_strategy_の追加_銘柄選択">4.4.5. strategy の追加 (銘柄選択)</h4>
<div class="paragraph">
<p>　&#8203;銘&#8203;柄&#8203;の&#8203;選&#8203;択&#8203;に&#8203;は&#8203;2&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;最&#8203;高&#8203;値・&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;予&#8203;測&#8203;し&#8203;た&#8203;pred&#8203;列&#8203;（最&#8203;高&#8203;値・&#8203;最&#8203;安&#8203;値&#8203;へ&#8203;の&#8203;変&#8203;化&#8203;率）&#8203;の&#8203;値&#8203;が&#8203;大&#8203;き&#8203;い&#8203;（最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;場&#8203;合&#8203;は&#8203;小&#8203;さ&#8203;い）&#8203;上&#8203;位&#8203;25&#8203;銘&#8203;柄&#8203;を&#8203;採&#8203;用&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;strategy&#8203;メ&#8203;ソッ&#8203;ド&#8203;で&#8203;pred&#8203;列&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;方&#8203;法&#8203;に&#8203;よ&#8203;り&#8203;選&#8203;択&#8203;さ&#8203;れ&#8203;る&#8203;銘&#8203;柄&#8203;を&#8203;調&#8203;整&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;以&#8203;下&#8203;の&#8203;6&#8203;種&#8203;類&#8203;の&#8203;銘&#8203;柄&#8203;選&#8203;択&#8203;方&#8203;法&#8203;を&#8203;実&#8203;装&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;出&#8203;力&#8203;に&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;出&#8203;力&#8203;を&#8203;足&#8203;し&#8203;て&#8203;使&#8203;用</p>
</li>
<li>
<p>最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;を&#8203;使&#8203;用</p>
</li>
<li>
<p>最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;を&#8203;使&#8203;用</p>
</li>
<li>
<p>最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;出&#8203;力&#8203;に&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;出&#8203;力&#8203;を&#8203;足&#8203;し&#8203;て&#8203;使&#8203;用&#8203;し、&#8203;特&#8203;別&#8203;損&#8203;失&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;た&#8203;銘&#8203;柄&#8203;を&#8203;除&#8203;外</p>
</li>
<li>
<p>最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;を&#8203;使&#8203;用&#8203;し、&#8203;特&#8203;別&#8203;損&#8203;失&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;た&#8203;銘&#8203;柄&#8203;銘&#8203;柄&#8203;を&#8203;除&#8203;外</p>
</li>
<li>
<p>最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;を&#8203;使&#8203;用&#8203;し、&#8203;特&#8203;別&#8203;損&#8203;失&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;た&#8203;銘&#8203;柄&#8203;を&#8203;除&#8203;外</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>　&#8203;最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203;潜&#8203;在&#8203;的&#8203;な&#8203;収&#8203;益&#8203;性&#8203;を、&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203;潜&#8203;在&#8203;的&#8203;な&#8203;リ&#8203;ス&#8203;ク&#8203;を&#8203;推&#8203;定&#8203;し&#8203;て&#8203;い&#8203;る&#8203;と&#8203;想&#8203;定&#8203;し&#8203;た&#8203;場&#8203;合、&#8203;1&#8203;は&#8203;シ&#8203;ン&#8203;プ&#8203;ル&#8203;に&#8203;そ&#8203;れ&#8203;を&#8203;足&#8203;し&#8203;合&#8203;わ&#8203;せ&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;潜&#8203;在&#8203;的&#8203;な&#8203;リ&#8203;ス&#8203;ク&#8203;を&#8203;抑&#8203;え&#8203;つ&#8203;つ、&#8203;高&#8203;い&#8203;収&#8203;益&#8203;性&#8203;を&#8203;持&#8203;つ&#8203;銘&#8203;柄&#8203;を&#8203;探&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;も&#8203;し&#8203;最&#8203;高&#8203;値・&#8203;最&#8203;安&#8203;値&#8203;の&#8203;予&#8203;測&#8203;が&#8203;上&#8203;手&#8203;く&#8203;働&#8203;い&#8203;て&#8203;い&#8203;た&#8203;ら、&#8203;こ&#8203;の&#8203;方&#8203;法&#8203;が&#8203;大&#8203;き&#8203;な&#8203;収&#8203;益&#8203;を&#8203;達&#8203;成&#8203;で&#8203;き&#8203;る&#8203;は&#8203;ず&#8203;で&#8203;す。&#8203;2&#8203;は&#8203;最&#8203;大&#8203;の&#8203;収&#8203;益&#8203;性&#8203;を&#8203;持&#8203;つ&#8203;銘&#8203;柄、&#8203;3&#8203;は&#8203;最&#8203;も&#8203;リ&#8203;ス&#8203;ク&#8203;が&#8203;低&#8203;い&#8203;銘&#8203;柄&#8203;が&#8203;採&#8203;用&#8203;さ&#8203;れ&#8203;る&#8203;と&#8203;想&#8203;定&#8203;さ&#8203;れ、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;収&#8203;益&#8203;性&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　4,5,6&#8203;は&#8203;1,2,3&#8203;の&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;戦&#8203;略&#8203;か&#8203;ら&#8203;特&#8203;別&#8203;損&#8203;失&#8203;を&#8203;開&#8203;示&#8203;し&#8203;た&#8203;銘&#8203;柄&#8203;を&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;組&#8203;成&#8203;対&#8203;象&#8203;か&#8203;ら&#8203;除&#8203;外&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;特&#8203;別&#8203;損&#8203;失&#8203;開&#8203;示&#8203;に&#8203;よ&#8203;る&#8203;株&#8203;価&#8203;の&#8203;下&#8203;落&#8203;を&#8203;回&#8203;避&#8203;し&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;利&#8203;益&#8203;を&#8203;向&#8203;上&#8203;で&#8203;き&#8203;る&#8203;と&#8203;の&#8203;仮&#8203;説&#8203;を&#8203;検&#8203;証&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;後&#8203;ほ&#8203;ど、&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;仮&#8203;説&#8203;の&#8203;検&#8203;証&#8203;を&#8203;簡&#8203;単&#8203;な&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;通&#8203;し&#8203;て&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">strategy</span>(cls, strategy_id, df, df_tdnet):
        df = df.copy()
        <span class="comment"># 銘柄選択方法選択</span>
        <span class="keyword">if</span> strategy_id <span class="keyword">in</span> [<span class="integer">1</span>, <span class="integer">4</span>]:
            <span class="comment"># 最高値モデル +　最安値モデル</span>
            df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">pred</span><span class="delimiter">&quot;</span></span>] = df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>] + df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">label_low_20</span><span class="delimiter">&quot;</span></span>]
        <span class="keyword">elif</span> strategy_id <span class="keyword">in</span> [<span class="integer">2</span>, <span class="integer">5</span>]:
            <span class="comment"># 最高値モデル</span>
            df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">pred</span><span class="delimiter">&quot;</span></span>] = df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>]
        <span class="keyword">elif</span> strategy_id <span class="keyword">in</span> [<span class="integer">3</span>, <span class="integer">6</span>]:
            <span class="comment"># 最高値モデル</span>
            df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">pred</span><span class="delimiter">&quot;</span></span>] = df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">label_low_20</span><span class="delimiter">&quot;</span></span>]
        <span class="keyword">else</span>:
            <span class="keyword">raise</span> <span class="exception">ValueError</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">no strategy_id selected</span><span class="delimiter">&quot;</span></span>)

        <span class="comment"># 特別損失を除外する場合</span>
        <span class="keyword">if</span> strategy_id <span class="keyword">in</span> [<span class="integer">4</span>, <span class="integer">5</span>, <span class="integer">6</span>]:
            <span class="comment"># 特別損失が発生した銘柄一覧を取得</span>
            df_exclude = cls.get_exclude(df_tdnet)
            <span class="comment"># 除外用にユニークな列を作成します。</span>
            df_exclude.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">date-code_lastweek</span><span class="delimiter">&quot;</span></span>] = df_exclude.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">start_dt</span><span class="delimiter">&quot;</span></span>].dt.strftime(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Y-%m-%d-</span><span class="delimiter">&quot;</span></span>) + df_exclude.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>]
            df_exclude.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">date-code_thisweek</span><span class="delimiter">&quot;</span></span>] = df_exclude.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">end_dt</span><span class="delimiter">&quot;</span></span>].dt.strftime(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Y-%m-%d-</span><span class="delimiter">&quot;</span></span>) + df_exclude.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>]
            df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">date-code_lastweek</span><span class="delimiter">&quot;</span></span>] = (df.index - pd.Timedelta(<span class="string"><span class="delimiter">&quot;</span><span class="content">7D</span><span class="delimiter">&quot;</span></span>)).strftime(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Y-%m-%d-</span><span class="delimiter">&quot;</span></span>) + df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>].astype(<span class="predefined">str</span>)
            df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">date-code_thisweek</span><span class="delimiter">&quot;</span></span>] = df.index.strftime(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Y-%m-%d-</span><span class="delimiter">&quot;</span></span>) + df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>].astype(<span class="predefined">str</span>)
            <span class="comment"># 特別損失銘柄を除外</span>
            df = df.loc[~df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">date-code_lastweek</span><span class="delimiter">&quot;</span></span>].isin(df_exclude.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">date-code_lastweek</span><span class="delimiter">&quot;</span></span>])]
            df = df.loc[~df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">date-code_thisweek</span><span class="delimiter">&quot;</span></span>].isin(df_exclude.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">date-code_thisweek</span><span class="delimiter">&quot;</span></span>])]

        <span class="comment"># 予測出力を降順に並び替え</span>
        df = df.sort_values(<span class="string"><span class="delimiter">&quot;</span><span class="content">pred</span><span class="delimiter">&quot;</span></span>, ascending=<span class="predefined-constant">False</span>)
        <span class="comment"># 予測出力の大きいものを取得</span>
        df = df.groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>).head(<span class="integer">30</span>)

        <span class="keyword">return</span> df</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_predictの変更_銘柄選択出力を変更">4.4.6. predictの変更 (銘柄選択、出力を変更)</h4>
<div class="paragraph">
<p>以&#8203;下&#8203;で&#8203;は、&#8203; <code>predictor.py</code> &#8203;の&#8203; <code>predict</code> &#8203;メ&#8203;ソッ&#8203;ド&#8203;出&#8203;力&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;出&#8203;力&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;変&#8203;更&#8203;し、&#8203;予&#8203;測&#8203;出&#8203;力&#8203;か&#8203;ら&#8203;銘&#8203;柄&#8203;を&#8203;選&#8203;択&#8203;す&#8203;る&#8203;ロ&#8203;ジッ&#8203;ク&#8203;を&#8203;追&#8203;加&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;で&#8203;は&#8203; <code>purchase_date</code> &#8203;で&#8203;指&#8203;定&#8203;さ&#8203;れ&#8203;た&#8203;日&#8203;付&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;変&#8203;更&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">predict</span>(
        cls,
        inputs,
        labels=<span class="predefined-constant">None</span>,
        codes=<span class="predefined-constant">None</span>,
        start_dt=TEST_START,
        load_data=[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin_price</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tdnet</span><span class="delimiter">&quot;</span></span>],
        fin_columns=<span class="predefined-constant">None</span>,
        strategy_id=<span class="integer">1</span>,
    ):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">Predict method</span><span class="content">
</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            inputs (dict[str]): paths to the dataset files</span><span class="content">
</span><span class="content">            labels (list[str]): target label names</span><span class="content">
</span><span class="content">            codes (list[int]): traget codes</span><span class="content">
</span><span class="content">            start_dt (str): specify date range</span><span class="content">
</span><span class="content">            load_data (list[str]): specify loading data</span><span class="content">
</span><span class="content">            fin_columns (list[str]): specify feature columns</span><span class="content">
</span><span class="content">            strategy_id (int): specify strategy</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            str: Inference for the given input.</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="keyword">if</span> fin_columns <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            fin_columns = [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement FiscalYear</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetSales</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OperatingIncome</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OrdinaryIncome</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetIncome</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement TotalAssets</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetAssets</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromOperatingActivities</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromFinancingActivities</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromInvestingActivities</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Forecast_FinancialStatement FiscalYear</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Forecast_FinancialStatement NetSales</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Forecast_FinancialStatement OperatingIncome</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Forecast_FinancialStatement OrdinaryIncome</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Forecast_FinancialStatement NetIncome</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_Dividend FiscalYear</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_Dividend QuarterlyDividendPerShare</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_Dividend AnnualDividendPerShare</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Forecast_Dividend FiscalYear</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Forecast_Dividend QuarterlyDividendPerShare</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Forecast_Dividend AnnualDividendPerShare</span><span class="delimiter">&quot;</span></span>,
            ]

        <span class="comment"># データ読み込み</span>
        <span class="keyword">if</span> cls.dfs <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] load data</span><span class="delimiter">&quot;</span></span>)
            cls.get_dataset(inputs, load_data)
            cls.get_codes(cls.dfs)

        <span class="comment"># 予測対象の銘柄コードと目的変数を設定</span>
        <span class="keyword">if</span> codes <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            codes = cls.codes
        <span class="keyword">if</span> labels <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            labels = cls.TARGET_LABELS

        <span class="keyword">if</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">purchase_date</span><span class="delimiter">&quot;</span></span> <span class="keyword">in</span> inputs.keys():
            <span class="comment"># ランタイム環境では指定された投資対象日付を使用します</span>
            <span class="comment"># purchase_dateを読み込み</span>
            df_purchase_date = pd.read_csv(inputs[<span class="string"><span class="delimiter">&quot;</span><span class="content">purchase_date</span><span class="delimiter">&quot;</span></span>])
            <span class="comment"># purchase_dateの最も古い日付を設定</span>
            start_dt = pd.Timestamp(
                df_purchase_date.sort_values(<span class="string"><span class="delimiter">&quot;</span><span class="content">Purchase Date</span><span class="delimiter">&quot;</span></span>).iloc[<span class="integer">0</span>, <span class="integer">0</span>]
            )

        <span class="comment"># 予測対象日を調整</span>
        <span class="comment"># start_dtにはポートフォリオの購入日を指定しているため、</span>
        <span class="comment"># 予測に使用する前週の金曜日を指定します。</span>
        start_dt = pd.Timestamp(start_dt) - pd.Timedelta(<span class="string"><span class="delimiter">&quot;</span><span class="content">3D</span><span class="delimiter">&quot;</span></span>)

        <span class="comment"># 特徴量を作成</span>
        print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] generate feature</span><span class="delimiter">&quot;</span></span>)
        buff = []
        <span class="keyword">for</span> code <span class="keyword">in</span> tqdm(codes):
            buff.append(
                cls.get_features_for_predict2(cls.dfs, code, fin_columns, start_dt)
            )
        feats = pd.concat(buff)

        <span class="comment"># 結果を以下のcsv形式で出力する</span>
        <span class="comment"># 1列目:date</span>
        <span class="comment"># 2列目:Local Code</span>
        <span class="comment"># 3列目:budget</span>
        <span class="comment"># headerあり、2列目3列目はint64</span>

        <span class="comment"># 日付と銘柄コードに絞り込み</span>
        df = feats.loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>]].copy()
        <span class="comment"># 購入金額を設定 (ここでは一律50000とする)</span>
        df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">budget</span><span class="delimiter">&quot;</span></span>] = <span class="integer">50000</span>

        <span class="comment"># 特徴量カラムを指定</span>
        feature_columns = ScoringService.get_feature_columns(cls.dfs, feats)

        <span class="comment"># 目的変数毎に予測</span>
        print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] predict</span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">for</span> label <span class="keyword">in</span> tqdm(labels):
            <span class="comment"># 予測実施</span>
            df[label] = ScoringService.models[label].predict(feats[feature_columns])
            <span class="comment"># 出力対象列に追加</span>

        <span class="comment"># 銘柄選択方法選択</span>
        df = cls.strategy(strategy_id, df, cls.dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">tdnet</span><span class="delimiter">&quot;</span></span>])

        <span class="comment"># 日付順に並び替え</span>
        df.sort_index(kind=<span class="string"><span class="delimiter">&quot;</span><span class="content">mergesort</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
        <span class="comment"># 月曜日日付に変更</span>
        df.index = df.index + pd.Timedelta(<span class="string"><span class="delimiter">&quot;</span><span class="content">3D</span><span class="delimiter">&quot;</span></span>)
        <span class="comment"># 出力用に調整</span>
        df.index.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>
        df.rename(columns={<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>}, inplace=<span class="predefined-constant">True</span>)
        df.reset_index(inplace=<span class="predefined-constant">True</span>)

        <span class="comment"># 出力対象列を定義</span>
        output_columns = [<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">budget</span><span class="delimiter">&quot;</span></span>]

        out = io.StringIO()
        df.to_csv(out, header=<span class="predefined-constant">True</span>, index=<span class="predefined-constant">False</span>, columns=output_columns)

        <span class="keyword">return</span> out.getvalue()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_予測の実行">4.4.7. 予測の実行</h4>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;で&#8203;ソー&#8203;ス&#8203;コー&#8203;ド&#8203;の&#8203;変&#8203;更&#8203;が&#8203;完&#8203;了&#8203;し&#8203;た&#8203;ら、&#8203;い&#8203;よ&#8203;い&#8203;よ&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;実&#8203;行&#8203;し&#8203;ま&#8203;す。&#8203;ま&#8203;ず、&#8203;対&#8203;象&#8203;期&#8203;間&#8203;を&#8203;設&#8203;定&#8203;し&#8203;ま&#8203;す。&#8203;2020-01-01&#8203;を&#8203;指&#8203;定&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;予&#8203;測&#8203;の&#8203;出&#8203;力&#8203;さ&#8203;れ&#8203;る&#8203;日&#8203;は&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;の&#8203;実&#8203;装&#8203;に&#8203;よ&#8203;り&#8203;月&#8203;曜&#8203;日&#8203;の&#8203;日&#8203;付&#8203;の&#8203;み&#8203;に&#8203;な&#8203;る&#8203;は&#8203;ず&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 対象期間を設定</span>
start_dt = pd.Timestamp(<span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-01</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># 学習済みモデルを読み込みます</span>
ScoringService.get_model(<span class="string"><span class="delimiter">&quot;</span><span class="content">archive/model</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># 予測を実行します</span>
str_ret = ScoringService.predict(inputs, start_dt=start_dt, strategy_id=<span class="integer">1</span>)

<span class="comment"># 出力を確認</span>
print(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>.join(str_ret.split(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>)[:<span class="integer">10</span>]))</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;と、&#8203;月&#8203;曜&#8203;日&#8203;の&#8203;日&#8203;付&#8203;で&#8203;あ&#8203;る&#8203;2020-01-06&#8203;で&#8203;出&#8203;力&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;ま&#8203;た&#8203;budget&#8203;が&#8203;一&#8203;律&#8203;50000&#8203;円&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;確&#8203;認&#8203;で&#8203;き&#8203;ま&#8203;ま&#8203;す。&#8203;想&#8203;定&#8203;通&#8203;り&#8203;の&#8203;結&#8203;果&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>date,Local Code,budget
2020-01-06,4482,50000
2020-01-06,7679,50000
2020-01-06,2980,50000
2020-01-06,3966,50000
2020-01-06,4479,50000
2020-01-06,6049,50000
2020-01-06,4369,50000
2020-01-06,4488,50000
2020-01-06,3793,50000</code></pre>
</div>
</div>
<div class="paragraph">
<p>次&#8203;で&#8203;実&#8203;施&#8203;す&#8203;る&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;た&#8203;め&#8203;に&#8203;結&#8203;果&#8203;を&#8203;CSV&#8203;ファ&#8203;イ&#8203;ル&#8203;に&#8203;保&#8203;存&#8203;し&#8203;て&#8203;お&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 出力を保存</span>
<span class="keyword">with</span> <span class="predefined">open</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">chapter03-tutorial-02-backtest-1.csv</span><span class="delimiter">&quot;</span></span>, mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">w</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
    f.write(str_ret)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_バックテスト">4.5. バックテスト</h3>
<div class="sect3">
<h4 id="_バックテストの実行_2">4.5.1. バックテストの実行</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203; Public LB &#8203;お&#8203;よ&#8203;び&#8203; Private LB &#8203;と&#8203;同&#8203;等&#8203;の&#8203;評&#8203;価&#8203;ロ&#8203;ジッ&#8203;ク&#8203;を&#8203;実&#8203;装&#8203;し&#8203;た&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;用&#8203;の&#8203; <code>backtest.py</code> &#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て、&#8203;作&#8203;成&#8203;し&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;評&#8203;価&#8203;し&#8203;ま&#8203;す。&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;使&#8203;用&#8203;法&#8203;な&#8203;ど&#8203;の&#8203;詳&#8203;細&#8203;は&#8203;「3.6. &#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト」&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>　&#8203;初&#8203;め&#8203;に&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;際&#8203;に&#8203;必&#8203;要&#8203;な&#8203;デー&#8203;タ&#8203;を&#8203;準&#8203;備&#8203;し&#8203;ま&#8203;す。&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;実&#8203;行&#8203;に&#8203;は&#8203;以&#8203;下&#8203;の&#8203;3&#8203;つ&#8203;の&#8203;デー&#8203;タ&#8203;が&#8203;必&#8203;要&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ユ&#8203;ニ&#8203;バー&#8203;ス&#8203; (stock_list.csv.gz)</p>
</li>
<li>
<p>株&#8203;価&#8203; (stock_price.csv.gz)</p>
</li>
<li>
<p>テ&#8203;ス&#8203;ト&#8203;対&#8203;象&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>　Backtest.prepare_data &#8203;に&#8203;1&#8203;お&#8203;よ&#8203;び&#8203;2&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;保&#8203;存&#8203;し&#8203;て&#8203;い&#8203;る&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;へ&#8203;の&#8203;パ&#8203;ス&#8203;を&#8203;指&#8203;定&#8203;し&#8203;て、&#8203;必&#8203;要&#8203;な&#8203;デー&#8203;タ&#8203;を&#8203;ロー&#8203;ド&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># データを保存しているディレクトリを指定します。</span>
backtest_dataset_dir = dataset_dir
<span class="comment"># バックテストに必要なデータを読み込みます。</span>
backtest_codes, backtest_price = Backtest.prepare_data(backtest_dataset_dir)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　Backtest.load_submit &#8203;に&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;対&#8203;象&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;保&#8203;存&#8203;し&#8203;た&#8203;ファ&#8203;イ&#8203;ル&#8203;へ&#8203;の&#8203;パ&#8203;ス&#8203;を&#8203;指&#8203;定&#8203;し&#8203;て&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。&#8203;`load_submit` &#8203;で&#8203;は&#8203;デー&#8203;タ&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;時&#8203;に&#8203;フォー&#8203;マッ&#8203;ト&#8203;の&#8203;チェッ&#8203;ク&#8203;を&#8203;し&#8203;た&#8203;り、&#8203;レ&#8203;コー&#8203;ド&#8203;順&#8203;を&#8203;付&#8203;与&#8203;す&#8203;る&#8203;等、&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;実&#8203;行&#8203;の&#8203;た&#8203;め&#8203;の&#8203;前&#8203;処&#8203;理&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 先ほど出力したポートフィリオデータを読み込みます</span>
df_submit = Backtest.load_submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">chapter03-tutorial-02-backtest-1.csv</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　3&#8203;つ&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;指&#8203;定&#8203;し&#8203;て&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;行&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># バックテスト結果保存用</span>
results = {}
stocks = {}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">results[<span class="integer">1</span>], stocks[<span class="integer">1</span>] = Backtest.run(df_submit.loc[start_dt:], backtest_codes, backtest_price)</code></pre>
</div>
</div>
<div class="paragraph">
<p>結&#8203;果&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203;う&#8203;ま&#8203;く&#8203;結&#8203;果&#8203;が&#8203;取&#8203;得&#8203;で&#8203;き&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;確&#8203;認&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># バックテスト結果のサマリー</span>
results[<span class="integer">1</span>].head(<span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter04/images/rf/rf.png" alt="処理結果" width="100%">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 銘柄毎の情報</span>
stocks[<span class="integer">1</span>].head(<span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter04/images/rf/rf1.png" alt="処理結果" width="80%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;次&#8203;に、&#8203;銘&#8203;柄&#8203;選&#8203;択&#8203;の&#8203;方&#8203;法&#8203;を&#8203;変&#8203;え&#8203;て&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;組&#8203;成&#8203;し&#8203;ま&#8203;す。&#8203;1&#8203;は&#8203;す&#8203;で&#8203;に&#8203;取&#8203;得&#8203;で&#8203;き&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;の&#8203;で&#8203;2、&#8203;3&#8203;も&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;出&#8203;力&#8203;に&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;出&#8203;力&#8203;を&#8203;足&#8203;し&#8203;て&#8203;使&#8203;用</p>
</li>
<li>
<p>最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;を&#8203;使&#8203;用</p>
</li>
<li>
<p>最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;を&#8203;使&#8203;用</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> strategy_id <span class="keyword">in</span> tqdm([<span class="integer">2</span>, <span class="integer">3</span>]):
    <span class="comment"># ポートフォリオ組成</span>
    str_ret = ScoringService.predict(inputs, start_dt=start_dt, strategy_id=strategy_id)
    <span class="comment"># ポートフォリオを保存</span>
    <span class="keyword">with</span> <span class="predefined">open</span>(f<span class="string"><span class="delimiter">&quot;</span><span class="content">chapter03-tutorial-02-backtest-{strategy_id}.csv</span><span class="delimiter">&quot;</span></span>, mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">w</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
        f.write(str_ret)

<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> strategy_id <span class="keyword">in</span> tqdm([<span class="integer">2</span>, <span class="integer">3</span>]):
    <span class="comment"># ポートフォリオを読み込み</span>
    df_submit = Backtest.load_submit(f<span class="string"><span class="delimiter">&quot;</span><span class="content">chapter03-tutorial-02-backtest-{strategy_id}.csv</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># バックテスト実行</span>
    results[strategy_id], stocks[strategy_id] = Backtest.run(df_submit.loc[start_dt:], backtest_codes, backtest_price)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_バックテストの評価_2">4.5.2. バックテストの評価</h4>
<div class="paragraph">
<p>　&#8203;上&#8203;記&#8203;の&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;行&#8203;し&#8203;て&#8203;取&#8203;得&#8203;し&#8203;た、&#8203;週&#8203;毎&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;情&#8203;報&#8203;と&#8203;各&#8203;銘&#8203;柄&#8203;毎&#8203;の&#8203;購&#8203;入&#8203;結&#8203;果&#8203;数&#8203;の&#8203;情&#8203;報&#8203;を&#8203;評&#8203;価&#8203;し&#8203;ま&#8203;す。&#8203;各&#8203;項&#8203;目&#8203;の&#8203;定&#8203;義&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;「3.6.4. &#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;評&#8203;価&#8203;軸&#8203;と&#8203;取&#8203;引&#8203;戦&#8203;略」&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>以&#8203;下&#8203;で&#8203;は、&#8203;結&#8203;果&#8203;の&#8203;評&#8203;価&#8203;と&#8203;し&#8203;て&#8203;以&#8203;下&#8203;を&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect4">
<h5 id="_週毎のリターンデータ">週毎のリターンデータ</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>週&#8203;毎&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;の&#8203;分&#8203;布&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203; (&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;評&#8203;価&#8203;項&#8203;目&#8203;)</p>
</li>
<li>
<p>週&#8203;毎&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;の&#8203;統&#8203;計&#8203;量</p>
</li>
<li>
<p>週&#8203;毎&#8203;の&#8203;勝&#8203;率・&#8203;ペ&#8203;イ&#8203;オ&#8203;フ&#8203;レ&#8203;シ&#8203;オ・&#8203;シャー&#8203;プ&#8203;レ&#8203;シ&#8203;オ</p>
</li>
<li>
<p>週&#8203;毎&#8203;に&#8203;曜&#8203;日&#8203;別&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;プ&#8203;ロッ&#8203;ト</p>
</li>
<li>
<p>週&#8203;毎&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;累&#8203;積&#8203;プ&#8203;ロッ&#8203;ト</p>
</li>
<li>
<p>ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;と&#8203;の&#8203;散&#8203;布&#8203;図</p>
</li>
<li>
<p>ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;に&#8203;対&#8203;す&#8203;る&#8203;ベー&#8203;タ&#8203;を&#8203;計&#8203;算</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_各銘柄毎のデータ">各銘柄毎のデータ</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>銘&#8203;柄&#8203;毎&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;の&#8203;分&#8203;布&#8203;を&#8203;プ&#8203;ロッ&#8203;ト</p>
</li>
<li>
<p>銘&#8203;柄&#8203;毎&#8203;の&#8203;return&#8203;の&#8203;分&#8203;布&#8203;を&#8203;プ&#8203;ロッ&#8203;ト</p>
</li>
<li>
<p>週&#8203;毎&#8203;の&#8203;勝&#8203;ち&#8203;銘&#8203;柄&#8203;率&#8203;を&#8203;プ&#8203;ロッ&#8203;ト</p>
</li>
<li>
<p>週&#8203;毎&#8203;の&#8203;勝&#8203;ち&#8203;銘&#8203;柄&#8203;率&#8203;の&#8203;統&#8203;計&#8203;量</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_週毎の運用実績の分布をプロット">週毎の運用実績の分布をプロット</h5>
<div class="paragraph">
<p>　&#8203;ま&#8203;ず、&#8203;週&#8203;毎&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;の&#8203;分&#8203;布&#8203;を&#8203;ヒ&#8203;ス&#8203;ト&#8203;グ&#8203;ラ&#8203;ム&#8203;で&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;か&#8203;ら&#8203;先&#8203;の&#8203;解&#8203;析&#8203;は、&#8203;「1.&#8203;最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;出&#8203;力&#8203;に&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;出&#8203;力&#8203;を&#8203;足&#8203;し&#8203;て&#8203;使&#8203;用」、&#8203;「2.&#8203;最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;を&#8203;使&#8203;用」、&#8203;「3.&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;を&#8203;使&#8203;用」&#8203;の&#8203;3&#8203;種&#8203;類&#8203;を&#8203;解&#8203;析&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;特&#8203;別&#8203;損&#8203;失&#8203;銘&#8203;柄&#8203;を&#8203;除&#8203;外&#8203;し&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;（4〜&#8203;6）&#8203;の&#8203;解&#8203;析&#8203;は&#8203;最&#8203;後&#8203;に&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 描画領域を定義</span>
fig, axes = plt.subplots(<span class="integer">1</span>, <span class="predefined">len</span>(results), figsize=(<span class="integer">8</span> * <span class="predefined">len</span>(results), <span class="integer">8</span>), sharex=<span class="predefined-constant">True</span>, sharey=<span class="predefined-constant">True</span>)

<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="predefined">enumerate</span>(results.keys()):
    <span class="comment"># 描画位置を指定</span>
    ax = axes[i]
    <span class="comment"># 分布をプロット</span>
    results[k].week_pl.hist(bins=<span class="integer">25</span>, ax=ax)
    <span class="comment"># タイトルを設定</span>
    ax.set_title(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: week pl distribution</span><span class="delimiter">&quot;</span></span>)
<span class="comment">#　描画</span>
plt.show()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter04/images/rf/rf2.png" alt="処理結果" width="100%">
</div>
</div>
<div class="paragraph">
<p>　1&#8203;及&#8203;び&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;似&#8203;た&#8203;よ&#8203;う&#8203;な&#8203;分&#8203;布&#8203;を&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;確&#8203;認&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;利&#8203;用&#8203;し&#8203;て&#8203;い&#8203;る&#8203;3&#8203;は、&#8203;1&#8203;や&#8203;2&#8203;と&#8203;は&#8203;大&#8203;き&#8203;く&#8203;分&#8203;布&#8203;が&#8203;異&#8203;なっ&#8203;て&#8203;お&#8203;り、&#8203;分&#8203;布&#8203;が&#8203;狭&#8203;く&#8203;運&#8203;用&#8203;実&#8203;績&#8203;が&#8203;0&#8203;近&#8203;辺&#8203;に&#8203;集&#8203;中&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;す&#8203;な&#8203;わ&#8203;ち、&#8203;3&#8203;の&#8203;戦&#8203;略&#8203;で&#8203;は、&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;が&#8203;低&#8203;い&#8203;銘&#8203;柄&#8203;を&#8203;中&#8203;心&#8203;に&#8203;採&#8203;用&#8203;し&#8203;て&#8203;い&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_週毎の運用実績の統計量を算出">週毎の運用実績の統計量を算出</h5>
<div class="paragraph">
<p>　&#8203;次&#8203;に、&#8203;週&#8203;毎&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;の&#8203;統&#8203;計&#8203;量&#8203;を&#8203;算&#8203;出&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># week_plの分布の統計量</span>

<span class="comment"># 結合用データ保存</span>
buff = []
<span class="comment"># ストラテジー毎に処理</span>
<span class="keyword">for</span> k <span class="keyword">in</span> results.keys():
    <span class="comment"># week_plの統計量を取得します。</span>
    df = results[k].loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">week_pl</span><span class="delimiter">&quot;</span></span>]].describe().T
    <span class="comment"># インデックスを編集してストラテジーのIDにする</span>
    df.index = [k]
    <span class="comment"># インデックス名変更</span>
    df.index.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">strategy_id</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 結合用に保存</span>
    buff.append(df)
<span class="comment"># 結合して表示</span>
pd.concat(buff)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter04/images/rf/rf3.png" alt="処理結果" width="80%"">
</div>
</div>
<div class="paragraph">
<p>　&#8203;分&#8203;布&#8203;情&#8203;報&#8203;を&#8203;数&#8203;値&#8203;で&#8203;確&#8203;認&#8203;す&#8203;る&#8203;と、&#8203;先&#8203;程&#8203;と&#8203;同&#8203;様&#8203;に&#8203;1&#8203;及&#8203;び&#8203;2&#8203;の&#8203;分&#8203;布&#8203;情&#8203;報&#8203;が&#8203;似&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;確&#8203;認&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;異&#8203;な&#8203;る&#8203;点&#8203;と&#8203;し&#8203;て&#8203;25%&#8203;分&#8203;位&#8203;点&#8203;を&#8203;比&#8203;較&#8203;す&#8203;る&#8203;と、&#8203;1&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;よ&#8203;り&#8203;も&#8203;負&#8203;け&#8203;を&#8203;若&#8203;干&#8203;抑&#8203;え&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;て&#8203;い&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;示&#8203;唆&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;で&#8203;は、&#8203;1&#8203;の&#8203;戦&#8203;略&#8203;よ&#8203;り&#8203;も&#8203;平&#8203;均&#8203;が&#8203;大&#8203;き&#8203;く&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;結&#8203;果&#8203;と&#8203;し&#8203;て、&#8203;1&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;よ&#8203;り&#8203;も&#8203;収&#8203;益&#8203;性&#8203;は&#8203;劣&#8203;る&#8203;も&#8203;の&#8203;の、&#8203;リ&#8203;ス&#8203;ク&#8203;コ&#8203;ン&#8203;ト&#8203;ロー&#8203;ル&#8203;が&#8203;で&#8203;き&#8203;て&#8203;い&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;示&#8203;唆&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;3&#8203;の&#8203;戦&#8203;略&#8203;の&#8203;結&#8203;果&#8203;は&#8203;平&#8203;均&#8203;が&#8203;1&#8203;及&#8203;び&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;よ&#8203;り&#8203;低&#8203;く、&#8203;25%&#8203;及&#8203;び&#8203;75%&#8203;分&#8203;位&#8203;点&#8203;も&#8203;1&#8203;及&#8203;び&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;よ&#8203;り&#8203;も&#8203;狭&#8203;い&#8203;分&#8203;布&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_週毎の勝率ペイオフレシオシャープレシオを算出">週毎の勝率、ペイオフレシオ、シャープレシオを算出</h5>
<div class="paragraph">
<p>　&#8203;他&#8203;の&#8203;メ&#8203;ト&#8203;リ&#8203;ク&#8203;ス&#8203;も&#8203;確&#8203;認&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;しょ&#8203;う。&#8203;週&#8203;毎&#8203;の&#8203;勝&#8203;率、&#8203;ペ&#8203;イ&#8203;オ&#8203;フ&#8203;レ&#8203;シ&#8203;オ、&#8203;シャー&#8203;プ&#8203;レ&#8203;シ&#8203;オ&#8203;を&#8203;算&#8203;出&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 結合用データ保存</span>
buff = []
<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> k <span class="keyword">in</span> results.keys():
    df_return = results[k]
    <span class="comment"># 計算結果保存用</span>
    d = {}
    <span class="comment"># 件数</span>
    d[<span class="string"><span class="delimiter">&quot;</span><span class="content">count</span><span class="delimiter">&quot;</span></span>] = df_return.shape[<span class="integer">0</span>]
    <span class="comment"># 勝率</span>
    d[<span class="string"><span class="delimiter">&quot;</span><span class="content">win_ratio</span><span class="delimiter">&quot;</span></span>] = (
        df_return.loc[df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>] &gt; <span class="integer">0</span>].shape[<span class="integer">0</span>] / d[<span class="string"><span class="delimiter">&quot;</span><span class="content">count</span><span class="delimiter">&quot;</span></span>]
    )
    <span class="comment"># ペイオフレシオ</span>
    d[<span class="string"><span class="delimiter">&quot;</span><span class="content">payoff_ratio</span><span class="delimiter">&quot;</span></span>] = df_return.loc[
        df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>] &gt; <span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>
    ].mean() / (
        -<span class="integer">1</span> * df_return.loc[df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>] &lt;= <span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>].mean()
    )
    <span class="comment"># シャープレシオ</span>
    d[<span class="string"><span class="delimiter">&quot;</span><span class="content">sharp</span><span class="delimiter">&quot;</span></span>] = (
        df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>].mean() / df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>].std()
    )
    <span class="comment"># 平均PL</span>
    d[<span class="string"><span class="delimiter">&quot;</span><span class="content">avgPL</span><span class="delimiter">&quot;</span></span>] = df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_pl</span><span class="delimiter">&quot;</span></span>].mean()
    <span class="comment"># week_plの合計</span>
    d[<span class="string"><span class="delimiter">&quot;</span><span class="content">PL</span><span class="delimiter">&quot;</span></span>] = df_return.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_pl</span><span class="delimiter">&quot;</span></span>].sum()
    <span class="comment"># strategy_idを設定</span>
    df = pd.DataFrame([d], index=[k])
    <span class="comment"># インデックス名を指定</span>
    df.index.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">strategy_id</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 結合用に保存</span>
    buff.append(df)
<span class="comment"># 結合して表示</span>
pd.concat(buff)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter04/images/rf/rf4.png" alt="処理結果" width="80%">
</div>
</div>
<div class="paragraph">
<p>　1&#8203;及&#8203;び&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;の&#8203;結&#8203;果&#8203;は&#8203;こ&#8203;ち&#8203;ら&#8203;で&#8203;も&#8203;似&#8203;通っ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;3&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;勝&#8203;率&#8203;も&#8203;低&#8203;く、&#8203;運&#8203;用&#8203;実&#8203;績&#8203;も&#8203;低&#8203;い&#8203;た&#8203;め、&#8203;今&#8203;の&#8203;と&#8203;こ&#8203;ろ&#8203;最&#8203;安&#8203;値&#8203;を&#8203;単&#8203;体&#8203;で&#8203;利&#8203;用&#8203;す&#8203;る&#8203;手&#8203;法&#8203;が&#8203;機&#8203;能&#8203;し&#8203;て&#8203;い&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;は&#8203;見&#8203;え&#8203;ま&#8203;せ&#8203;ん。</p>
</div>
</div>
<div class="sect4">
<h5 id="_週毎に曜日別のリターンをプロット">週毎に曜日別のリターンをプロット</h5>
<div class="paragraph">
<p>　&#8203;週&#8203;毎&#8203;の&#8203;1&#8203;日&#8203;目&#8203;か&#8203;ら&#8203;5&#8203;日&#8203;目&#8203;ま&#8203;で&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;推&#8203;移&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し、&#8203;曜&#8203;日&#8203;毎&#8203;に&#8203;勝&#8203;ち&#8203;負&#8203;け&#8203;の&#8203;分&#8203;布&#8203;に&#8203;差&#8203;異&#8203;が&#8203;無&#8203;い&#8203;か&#8203;を&#8203;確&#8203;認&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;3&#8203;章&#8203;と&#8203;同&#8203;じ&#8203;よ&#8203;う&#8203;に&#8203;seaborn&#8203;の&#8203;バ&#8203;イ&#8203;オ&#8203;リ&#8203;ン&#8203;プ&#8203;ロッ&#8203;ト&#8203;(<a href="https://seaborn.pydata.org/generated/seaborn.violinplot.html">リンク</a>)&#8203;を&#8203;利&#8203;用&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 描画領域を定義</span>
fig, axes = plt.subplots(<span class="predefined">len</span>(results), <span class="integer">1</span>, figsize=(<span class="integer">15</span>, <span class="integer">4</span> * <span class="predefined">len</span>(results)), sharex=<span class="predefined-constant">True</span>, sharey=<span class="predefined-constant">True</span>)

<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="predefined">enumerate</span>(results.keys()):
    <span class="comment"># 描画位置を指定</span>
    ax = axes[i]
    <span class="comment"># 箱が見やすいように横方向を指定してプロット</span>
    sns.violinplot(x=<span class="string"><span class="delimiter">&quot;</span><span class="content">return</span><span class="delimiter">&quot;</span></span>, y=<span class="string"><span class="delimiter">&quot;</span><span class="content">level_1</span><span class="delimiter">&quot;</span></span>, data=dfs_plot[k], ax=ax, orient=<span class="string"><span class="delimiter">&quot;</span><span class="content">h</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># タイトルを設定</span>
    ax.set_title(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: daily return</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># グリッドを表示</span>
    ax.grid(<span class="predefined-constant">True</span>)
<span class="comment"># 文字が重なって読みにくいので間隔調整</span>
fig.tight_layout(pad=<span class="float">2.0</span>)
<span class="comment"># 描画</span>
plt.show()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter04/images/rf/rf6.png" alt="処理結果" width="80%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;の&#8203;結&#8203;果&#8203;か&#8203;ら&#8203;1&#8203;及&#8203;び&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;は、&#8203;木&#8203;曜&#8203;日・&#8203;金&#8203;曜&#8203;日&#8203;の&#8203;負&#8203;け&#8203;が&#8203;大&#8203;き&#8203;そ&#8203;う&#8203;な&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;場&#8203;合、&#8203;週&#8203;の&#8203;後&#8203;半&#8203;に&#8203;負&#8203;け&#8203;て&#8203;い&#8203;る&#8203;の&#8203;は&#8203;そ&#8203;の&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;効&#8203;果&#8203;が&#8203;後&#8203;半&#8203;で&#8203;薄&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;可&#8203;能&#8203;性&#8203;を&#8203;示&#8203;唆&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;あ&#8203;る&#8203;の&#8203;で&#8203;注&#8203;意&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。&#8203;こ&#8203;の&#8203;グ&#8203;ラ&#8203;フ&#8203;に&#8203;も&#8203;若&#8203;干&#8203;そ&#8203;の&#8203;傾&#8203;向&#8203;が&#8203;観&#8203;測&#8203;さ&#8203;れ&#8203;る&#8203;た&#8203;め、&#8203;何&#8203;ら&#8203;か&#8203;の&#8203;改&#8203;善&#8203;を&#8203;実&#8203;施&#8203;し&#8203;た&#8203;場&#8203;合&#8203;に、&#8203;こ&#8203;の&#8203;結&#8203;果&#8203;が&#8203;ど&#8203;う&#8203;なっ&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;価&#8203;値&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;3&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;1&#8203;及&#8203;び&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;と&#8203;比&#8203;較&#8203;す&#8203;る&#8203;と&#8203;分&#8203;布&#8203;が&#8203;狭&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;確&#8203;認&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_収益率の時系列を累積プロット">収益率の時系列を累積プロット</h5>
<div class="paragraph">
<p>　&#8203;次&#8203;に、&#8203;取&#8203;得&#8203;し&#8203;た&#8203;収&#8203;益&#8203;率&#8203;の&#8203;時&#8203;系&#8203;列&#8203;を&#8203;累&#8203;積&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。&#8203;ま&#8203;ず、&#8203;比&#8203;較&#8203;対&#8203;象&#8203;で&#8203;あ&#8203;る&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;と&#8203;し&#8203;て&#8203;取&#8203;引&#8203;対&#8203;象&#8203;の&#8203;全&#8203;銘&#8203;柄&#8203;の&#8203;平&#8203;均&#8203;週&#8203;次&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;計&#8203;算&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 変数名を調整します。</span>
<span class="comment"># backtest_priceはユニバースで絞り込み済みです</span>
df_price = backtest_price</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 週毎に始値と終値を取得</span>
df_wp = (
    <span class="comment"># start_dt以降の日付のみ計算</span>
    df_price.loc[df_price.index &gt;= start_dt].sort_values([<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>])
    <span class="comment"># 銘柄コード毎に処理</span>
    .groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># 月曜日スタートで週にリサンプル</span>
    .resample(<span class="string"><span class="delimiter">&quot;</span><span class="content">W-MON</span><span class="delimiter">&quot;</span></span>, label=<span class="string"><span class="delimiter">&quot;</span><span class="content">left</span><span class="delimiter">&quot;</span></span>, closed=<span class="string"><span class="delimiter">&quot;</span><span class="content">left</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># 始値は最初のレコード、終値は最後のレコードを取得</span>
    .agg({<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Open</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">first</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">last</span><span class="delimiter">&quot;</span></span>})
    <span class="comment"># マルチインデックスを解除</span>
    .reset_index(level=[<span class="integer">0</span>])
)
<span class="comment"># Open が 0.0 の銘柄は値段が付かなかった銘柄で、バックテストでは購入対象外であるため除外する</span>
df_wp = df_wp.loc[df_wp.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Open</span><span class="delimiter">&quot;</span></span>] != <span class="float">0.0</span>]
<span class="comment"># 銘柄毎の週次リターンを計算</span>
df_wp.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">universe</span><span class="delimiter">&quot;</span></span>] = (
    (
        (
            df_wp.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]
            / df_wp.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Open</span><span class="delimiter">&quot;</span></span>]
        )
        - <span class="integer">1</span>
    )
    * <span class="integer">100</span>
)
<span class="comment"># ユニバースの週毎のリターンを計算します。</span>
df_universe_return = df_wp.groupby(df_wp.index)[<span class="string"><span class="delimiter">&quot;</span><span class="content">universe</span><span class="delimiter">&quot;</span></span>].mean().to_frame()</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;と&#8203;し&#8203;て&#8203;取&#8203;引&#8203;対&#8203;象&#8203;の&#8203;全&#8203;銘&#8203;柄&#8203;の&#8203;平&#8203;均&#8203;週&#8203;次&#8203;リ&#8203;ター&#8203;ン&#8203;が&#8203;準&#8203;備&#8203;で&#8203;き&#8203;た&#8203;ら、&#8203;今&#8203;回&#8203;の&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;の&#8203;結&#8203;果&#8203;と&#8203;一&#8203;緒&#8203;に&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 描画領域を定義</span>
fig, axes = plt.subplots(<span class="integer">1</span>, <span class="integer">1</span>, figsize=(<span class="integer">20</span>, <span class="integer">8</span>), sharex=<span class="predefined-constant">True</span>, sharey=<span class="predefined-constant">True</span>)

<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> k <span class="keyword">in</span> results.keys():
    <span class="comment"># 描画位置を指定</span>
    ax = axes
    <span class="comment"># 戦略別の累積リターンを描画</span>
    results[k].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>).loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>]].rename(
        columns={<span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: week_return</span><span class="delimiter">&quot;</span></span>}
    ).cumsum().plot(ax=ax)

<span class="comment"># ユニバースの週次リターンの累積をプロット</span>
df_universe_return.cumsum().plot(ax=ax, color=<span class="string"><span class="delimiter">&quot;</span><span class="content">black</span><span class="delimiter">&quot;</span></span>, label=<span class="string"><span class="delimiter">&quot;</span><span class="content">universe</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># 表示を調整</span>
ax.set_title(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cumulative week_return</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># グリッドを表示</span>
ax.grid(<span class="predefined-constant">True</span>)
<span class="comment"># 描画</span>
plt.show()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter04/images/rf/rf7.png" alt="処理結果" width="100%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;の&#8203;プ&#8203;ロッ&#8203;ト&#8203;か&#8203;ら&#8203;は&#8203;複&#8203;数&#8203;の&#8203;事&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;ま&#8203;ず&#8203;1&#8203;及&#8203;び&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;想&#8203;定&#8203;通&#8203;り、&#8203;極&#8203;め&#8203;て&#8203;似&#8203;通っ&#8203;た&#8203;結&#8203;果&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;1&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;結&#8203;果&#8203;も&#8203;足&#8203;し&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;2&#8203;の&#8203;最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;み&#8203;を&#8203;用&#8203;い&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;よ&#8203;り&#8203;も&#8203;ド&#8203;ロー&#8203;ダ&#8203;ウ&#8203;ン&#8203;が&#8203;小&#8203;さ&#8203;い&#8203;こ&#8203;と&#8203;を&#8203;期&#8203;待&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;し&#8203;た&#8203;が、&#8203;3&#8203;月&#8203;の&#8203;暴&#8203;落&#8203;時&#8203;の&#8203;結&#8203;果&#8203;を&#8203;見&#8203;る&#8203;限&#8203;り、&#8203;そ&#8203;の&#8203;効&#8203;果&#8203;は&#8203;観&#8203;測&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;せ&#8203;ん。&#8203;こ&#8203;れ&#8203;は、&#8203;3&#8203;の&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;も&#8203;暴&#8203;落&#8203;時&#8203;に&#8203;下&#8203;落&#8203;低&#8203;減&#8203;効&#8203;果&#8203;が&#8203;観&#8203;測&#8203;で&#8203;き&#8203;な&#8203;い&#8203;た&#8203;め、&#8203;3&#8203;の&#8203;戦&#8203;略&#8203;で&#8203;は&#8203;残&#8203;念&#8203;な&#8203;が&#8203;ら&#8203;3&#8203;月&#8203;の&#8203;暴&#8203;落&#8203;の&#8203;対&#8203;処&#8203;に&#8203;は&#8203;な&#8203;ら&#8203;な&#8203;かっ&#8203;た&#8203;よ&#8203;う&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>　1&#8203;及&#8203;び&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;3&#8203;月&#8203;以&#8203;降&#8203;の&#8203;反&#8203;発&#8203;で&#8203;大&#8203;き&#8203;く&#8203;収&#8203;益&#8203;を&#8203;上&#8203;げ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;特&#8203;に&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;が&#8203;ほ&#8203;ぼ&#8203;フ&#8203;ラッ&#8203;ト&#8203;に&#8203;なっ&#8203;た&#8203;6&#8203;月&#8203;以&#8203;降&#8203;も&#8203;1&#8203;及&#8203;び&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;高&#8203;い&#8203;収&#8203;益&#8203;を&#8203;あ&#8203;げ&#8203;て&#8203;お&#8203;り、&#8203;マー&#8203;ケッ&#8203;ト&#8203;が&#8203;フ&#8203;ラッ&#8203;ト&#8203;な&#8203;状&#8203;況&#8203;で&#8203;も&#8203;銘&#8203;柄&#8203;選&#8203;択&#8203;に&#8203;よ&#8203;り&#8203;収&#8203;益&#8203;を&#8203;上&#8203;げ&#8203;る&#8203;力&#8203;が&#8203;あ&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;示&#8203;唆&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;ま&#8203;た、&#8203;3&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;一&#8203;見&#8203;す&#8203;る&#8203;と&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;と&#8203;ほ&#8203;ぼ&#8203;同&#8203;じ&#8203;収&#8203;益&#8203;に&#8203;見&#8203;え&#8203;ま&#8203;す&#8203;が、&#8203;3&#8203;月&#8203;以&#8203;降&#8203;ほ&#8203;ぼ&#8203;ド&#8203;ロー&#8203;ダ&#8203;ウ&#8203;ン&#8203;が&#8203;発&#8203;生&#8203;し&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;は&#8203;注&#8203;目&#8203;に&#8203;値&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;は&#8203;低&#8203;い&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;の&#8203;銘&#8203;柄&#8203;を&#8203;優&#8203;先&#8203;的&#8203;に&#8203;採&#8203;用&#8203;し&#8203;た&#8203;と&#8203;き&#8203;な&#8203;ど&#8203;に&#8203;見&#8203;ら&#8203;れ&#8203;る&#8203;現&#8203;象&#8203;で、&#8203;実&#8203;際&#8203;に&#8203;収&#8203;益&#8203;曲&#8203;線&#8203;が&#8203;安&#8203;定&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;か&#8203;ら&#8203;も、&#8203;3&#8203;の&#8203;戦&#8203;略&#8203;自&#8203;体&#8203;も&#8203;ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル&#8203;な&#8203;ど&#8203;の&#8203;デー&#8203;タ&#8203;と&#8203;し&#8203;て&#8203;は&#8203;有&#8203;望&#8203;な&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_ユニバースとリターンの散布図をプロット">ユニバースとリターンの散布図をプロット</h5>
<div class="paragraph">
<p>　&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;と&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;散&#8203;布&#8203;図&#8203;を&#8203;チェッ&#8203;ク&#8203;し&#8203;ま&#8203;す。&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;と&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;散&#8203;布&#8203;図&#8203;は、&#8203;マー&#8203;ケッ&#8203;ト&#8203;の&#8203;動&#8203;き&#8203;に&#8203;対&#8203;し&#8203;て&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;運&#8203;用&#8203;実&#8203;績&#8203;が&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;分&#8203;布&#8203;す&#8203;る&#8203;か&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;利&#8203;用&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> k <span class="keyword">in</span> results.keys():
    <span class="comment"># 散布図をプロット</span>
    p = sns.jointplot(
        x=df_universe_return.iloc[:, <span class="integer">0</span>],
        y=results[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>],
        kind=<span class="string"><span class="delimiter">&quot;</span><span class="content">reg</span><span class="delimiter">&quot;</span></span>,
        height=<span class="integer">5</span>,
        stat_func=stats.pearsonr,
    )
    <span class="comment"># タイトルを設定</span>
    p.fig.suptitle(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: week_return vs universe</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># タイトル表示用に位置を調整</span>
    p.fig.subplots_adjust(top=<span class="float">0.95</span>)
    <span class="comment"># 描画</span>
    plt.show()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter04/images/rf/rf8.png" alt="処理結果" width="100%">
</div>
</div>
<div class="paragraph">
<p>　1&#8203;の&#8203;戦&#8203;略&#8203;か&#8203;ら&#8203;は&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;が&#8203;0&#8203;の&#8203;と&#8203;き&#8203;も&#8203;収&#8203;益&#8203;を&#8203;上&#8203;げ&#8203;る&#8203;力&#8203;が&#8203;あ&#8203;る&#8203;傾&#8203;向&#8203;が&#8203;観&#8203;測&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;の&#8203;分&#8203;布&#8203;は&#8203;1&#8203;よ&#8203;り&#8203;も&#8203;広&#8203;く、&#8203;こ&#8203;れ&#8203;は&#8203;高&#8203;い&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;の&#8203;銘&#8203;柄&#8203;を&#8203;利&#8203;用&#8203;し&#8203;て&#8203;い&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;示&#8203;唆&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;3&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;の&#8203;下&#8203;落&#8203;の&#8203;と&#8203;き&#8203;は&#8203;一&#8203;緒&#8203;に&#8203;負&#8203;け&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;観&#8203;測&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;も&#8203;し&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;が&#8203;下&#8203;落&#8203;し&#8203;て&#8203;も、&#8203;下&#8203;落&#8203;を&#8203;抑&#8203;え&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;て&#8203;い&#8203;れ&#8203;ば、&#8203;3&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;リ&#8203;ス&#8203;ク&#8203;回&#8203;避&#8203;用&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;と&#8203;し&#8203;て&#8203;理&#8203;想&#8203;的&#8203;な&#8203;結&#8203;果&#8203;で&#8203;し&#8203;た&#8203;が、&#8203;そ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;効&#8203;果&#8203;ま&#8203;で&#8203;は&#8203;観&#8203;測&#8203;で&#8203;き&#8203;ま&#8203;せ&#8203;ん&#8203;で&#8203;し&#8203;た。</p>
</div>
</div>
<div class="sect4">
<h5 id="_ベータ値の算出">ベータ値の算出</h5>
<div class="paragraph">
<p>　&#8203;最&#8203;後&#8203;に&#8203;ベー&#8203;タ&#8203;を&#8203;計&#8203;算&#8203;し&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 結合用に保存</span>
buff = []
<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> k <span class="keyword">in</span> results.keys():
    <span class="comment"># ベータを計算</span>
    res = stats.linregress(df_universe_return.iloc[:,<span class="integer">0</span>], results[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>])
    <span class="comment"># 一覧表示用にデータフレームを作成</span>
    df_beta = pd.DataFrame([res.slope], index=[k], columns=[<span class="string"><span class="delimiter">&quot;</span><span class="content">beta</span><span class="delimiter">&quot;</span></span>])
    <span class="comment"># インデックス名を設定</span>
    df_beta.index.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">storategy_id</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 保存</span>
    buff.append(df_beta)
<span class="comment"># 結合して表示</span>
pd.concat(buff)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter04/images/rf/rf11.png" alt="処理結果" width="20%">
</div>
</div>
<div class="paragraph">
<p>　1&#8203;及&#8203;び&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;は、&#8203;1.2&#8203;近&#8203;辺&#8203;の&#8203;高&#8203;ベー&#8203;タ&#8203;な&#8203;ス&#8203;ト&#8203;ラ&#8203;テ&#8203;ジー&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;3&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;低&#8203;い&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;の&#8203;銘&#8203;柄&#8203;を&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;採&#8203;用&#8203;す&#8203;る&#8203;ス&#8203;ト&#8203;ラ&#8203;テ&#8203;ジー&#8203;特&#8203;有&#8203;の&#8203;傾&#8203;向&#8203;で&#8203;あ&#8203;る&#8203;低&#8203;い&#8203;ベー&#8203;タ&#8203;値&#8203;が&#8203;観&#8203;測&#8203;で&#8203;き&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_銘柄毎に分析するための準備_2">銘柄毎に分析するための準備</h5>
<div class="paragraph">
<p>　&#8203;次&#8203;に、&#8203;銘&#8203;柄&#8203;毎&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;分&#8203;析&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;銘&#8203;柄&#8203;毎&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;分&#8203;析&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;必&#8203;要&#8203;な&#8203;計&#8203;算&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 分析用データ保存用</span>
dfs_analyze = {}
<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i <span class="keyword">in</span> stocks.keys():
    <span class="comment"># 分析用にデータをコピー</span>
    df_analyze = stocks[i].copy()
    <span class="comment"># day5に必ず値が存在するように調整します</span>
    df_analyze.loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">day_1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_3</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_4</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_5</span><span class="delimiter">&quot;</span></span>]] = (
        df_analyze.loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">day_1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_3</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_4</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_5</span><span class="delimiter">&quot;</span></span>]]
        .replace(<span class="float">0.0</span>, np.nan)
        .ffill(axis=<span class="integer">1</span>)
    )
    <span class="comment"># 終値とエントリーの差分を計算</span>
    df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">diff</span><span class="delimiter">&quot;</span></span>] = df_analyze.loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_5</span><span class="delimiter">&quot;</span></span>]].diff(axis=<span class="integer">1</span>)[
        <span class="string"><span class="delimiter">&quot;</span><span class="content">day_5</span><span class="delimiter">&quot;</span></span>
    ]
    <span class="comment"># 損益を計算します</span>
    df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">pl</span><span class="delimiter">&quot;</span></span>] = df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">diff</span><span class="delimiter">&quot;</span></span>] * df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>]
    <span class="comment"># リターンを計算します</span>
    df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">return</span><span class="delimiter">&quot;</span></span>] = (
        (df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">day_5</span><span class="delimiter">&quot;</span></span>] / df_analyze.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>]) - <span class="integer">1</span>
    ) * <span class="integer">100</span>
    <span class="comment"># infを0.0に変換</span>
    df_analyze = df_analyze.replace(np.inf, <span class="float">0.0</span>)
    <span class="comment"># 処理結果を保存</span>
    dfs_analyze[i] = df_analyze</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;分&#8203;析&#8203;用&#8203;デー&#8203;タ&#8203;を&#8203;表&#8203;示&#8203;し&#8203;て、&#8203;う&#8203;ま&#8203;く&#8203;計&#8203;算&#8203;が&#8203;で&#8203;き&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">dfs_analyze[<span class="integer">1</span>].head(<span class="integer">2</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter04/images/rf/rf12.png" alt="処理結果" width="80%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;問&#8203;題&#8203;な&#8203;く&#8203;計&#8203;算&#8203;が&#8203;で&#8203;き&#8203;て&#8203;い&#8203;る&#8203;よ&#8203;う&#8203;で&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_銘柄毎のリターンの分布をヒストグラムでプロット">銘柄毎のリターンの分布をヒストグラムでプロット</h5>
<div class="paragraph">
<p>　&#8203;銘&#8203;柄&#8203;ご&#8203;と&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;分&#8203;布&#8203;を&#8203;ヒ&#8203;ス&#8203;ト&#8203;グ&#8203;ラ&#8203;ム&#8203;で&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 描画領域を定義</span>
fig, axes = plt.subplots(<span class="integer">1</span>, <span class="predefined">len</span>(dfs_analyze), figsize=(<span class="integer">8</span> * <span class="predefined">len</span>(dfs_analyze), <span class="integer">8</span>), sharex=<span class="predefined-constant">True</span>, sharey=<span class="predefined-constant">True</span>)

<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="predefined">enumerate</span>(dfs_analyze.keys()):
    <span class="comment"># 描画位置を指定</span>
    ax = axes[i]
    <span class="comment"># ヒストグラムをプロット</span>
    dfs_analyze[k].groupby([<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>])[<span class="string"><span class="delimiter">&quot;</span><span class="content">return</span><span class="delimiter">&quot;</span></span>].sum().hist(bins=<span class="integer">50</span>, log=<span class="predefined-constant">True</span>, ax=ax)
    <span class="comment"># タイトルを設定</span>
    ax.set_title(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: Weekly PL distribution</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># 描画</span>
plt.show()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter04/images/rf/rf13.png" alt="処理結果" width="100%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;か&#8203;ら&#8203;は&#8203;あ&#8203;ま&#8203;り&#8203;はっ&#8203;き&#8203;り&#8203;と&#8203;し&#8203;た&#8203;傾&#8203;向&#8203;は&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;1&#8203;の&#8203;戦&#8203;略&#8203;の&#8203;分&#8203;布&#8203;が&#8203;若&#8203;干&#8203;右&#8203;側&#8203;に&#8203;広&#8203;く&#8203;大&#8203;勝&#8203;ち&#8203;し&#8203;た&#8203;銘&#8203;柄&#8203;を&#8203;選&#8203;択&#8203;で&#8203;き&#8203;て&#8203;い&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;示&#8203;唆&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;3&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;や&#8203;は&#8203;り&#8203;銘&#8203;柄&#8203;個&#8203;別&#8203;で&#8203;見&#8203;て&#8203;も&#8203;分&#8203;布&#8203;が&#8203;狭&#8203;く、&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;が&#8203;低&#8203;い&#8203;銘&#8203;柄&#8203;を&#8203;採&#8203;用&#8203;し&#8203;て&#8203;い&#8203;る&#8203;よ&#8203;う&#8203;で&#8203;す。</p>
</div>
</div>
<div class="sect4">
<h5 id="_週毎に勝ち銘柄率を算出">週毎に勝ち銘柄率を算出</h5>
<div class="paragraph">
<p>　&#8203;最&#8203;後&#8203;に&#8203;週&#8203;毎&#8203;の&#8203;銘&#8203;柄&#8203;の&#8203;勝&#8203;率&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 描画領域を定義</span>
fig, ax = plt.subplots(<span class="integer">1</span>, <span class="integer">1</span>, figsize=(<span class="integer">20</span>, <span class="integer">8</span>), sharex=<span class="predefined-constant">True</span>, sharey=<span class="predefined-constant">True</span>)

<span class="comment"># 統計量表示用</span>
buff = []
<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> k <span class="keyword">in</span> dfs_analyze.keys():
    <span class="comment"># 週毎の勝ち銘柄率を計算</span>
    win_ratio = (
        dfs_analyze[k]
        .set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>)
        .groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>)
        .apply(<span class="keyword">lambda</span> x: (x.pl &gt; <span class="integer">0</span>).sum() / x.shape[<span class="integer">0</span>])
        .to_frame()
        .rename(columns={<span class="integer">0</span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: win_ratio</span><span class="delimiter">&quot;</span></span>})
    )
    <span class="comment"># プロット</span>
    win_ratio.plot(ax=ax)
    <span class="comment"># 統計量を保存</span>
    buff.append(win_ratio.describe().T)
<span class="comment"># ユニバースの勝ち銘柄率をプロット</span>
df_wp.groupby(df_wp.index).apply(<span class="keyword">lambda</span> x: (x.universe &gt; <span class="integer">0</span>).sum() / x.shape[<span class="integer">0</span>]).rename(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">universe</span><span class="delimiter">&quot;</span></span>
).to_frame().plot(ax=ax, color=<span class="string"><span class="delimiter">&quot;</span><span class="content">black</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># タイトルを設定</span>
ax.set_title(<span class="string"><span class="delimiter">&quot;</span><span class="content">win ratio of selected stocks</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># グリッド表示</span>
ax.grid(<span class="predefined-constant">True</span>)
<span class="comment"># 0.5に基準線を描画</span>
ax.axhline(y=<span class="float">0.5</span>, color=<span class="string"><span class="delimiter">&quot;</span><span class="content">red</span><span class="delimiter">&quot;</span></span>)
<span class="comment">#  描画</span>
plt.show()
<span class="comment"># 週毎の勝ち銘柄率の統計量</span>
display(pd.concat(buff))</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter04/images/rf/rf14.png" alt="処理結果" width="100%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;の&#8203;プ&#8203;ロッ&#8203;ト&#8203;か&#8203;ら&#8203;い&#8203;く&#8203;つ&#8203;か&#8203;お&#8203;も&#8203;し&#8203;ろ&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;ま&#8203;ず、&#8203;1/2&#8203;の&#8203;ス&#8203;ト&#8203;ラ&#8203;テ&#8203;ジー&#8203;は&#8203;6&#8203;月&#8203;か&#8203;ら&#8203;10&#8203;月&#8203;に&#8203;か&#8203;け&#8203;て&#8203;収&#8203;益&#8203;を&#8203;上&#8203;げ&#8203;て&#8203;い&#8203;ま&#8203;し&#8203;た&#8203;が、&#8203;こ&#8203;の&#8203;時&#8203;期&#8203;に&#8203;勝&#8203;率&#8203;が&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;よ&#8203;り&#8203;も&#8203;高&#8203;かっ&#8203;た&#8203;わ&#8203;け&#8203;で&#8203;は&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;む&#8203;し&#8203;ろ&#8203;銘&#8203;柄&#8203;単&#8203;位&#8203;で&#8203;見&#8203;る&#8203;と&#8203;勝&#8203;率&#8203;は&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;の&#8203;平&#8203;均&#8203;よ&#8203;り&#8203;も&#8203;若&#8203;干&#8203;低&#8203;い&#8203;事&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;つ&#8203;ま&#8203;り、&#8203;こ&#8203;の&#8203;期&#8203;間&#8203;に&#8203;1/2&#8203;の&#8203;ス&#8203;ト&#8203;ラ&#8203;テ&#8203;ジー&#8203;は&#8203;勝&#8203;率&#8203;で&#8203;稼&#8203;い&#8203;だ&#8203;わ&#8203;け&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;銘&#8203;柄&#8203;ご&#8203;と&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;が&#8203;大&#8203;き&#8203;かっ&#8203;た&#8203;こ&#8203;と&#8203;が&#8203;推&#8203;測&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;<br>
こ&#8203;れ&#8203;は&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;銘&#8203;柄&#8203;を&#8203;選&#8203;択&#8203;し&#8203;て&#8203;い&#8203;た&#8203;か&#8203;を&#8203;調&#8203;査&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;よっ&#8203;て、&#8203;ど&#8203;の&#8203;あ&#8203;た&#8203;り&#8203;に&#8203;収&#8203;益&#8203;性&#8203;の&#8203;厳&#8203;選&#8203;が&#8203;あ&#8203;る&#8203;か&#8203;を&#8203;考&#8203;え&#8203;る&#8203;ヒ&#8203;ン&#8203;ト&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;傾&#8203;向&#8203;が&#8203;観&#8203;測&#8203;さ&#8203;れ&#8203;た&#8203;ら&#8203;ファ&#8203;ク&#8203;ター&#8203;分&#8203;析&#8203;な&#8203;ど&#8203;を&#8203;利&#8203;用&#8203;し&#8203;て&#8203;収&#8203;益&#8203;の&#8203;厳&#8203;選&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;作&#8203;業&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;な&#8203;ど&#8203;の&#8203;発&#8203;展&#8203;が&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_適時開示情報を使用して特別損失銘柄を除外">4.6. 適時開示情報を使用して特別損失銘柄を除外</h3>
<div class="paragraph">
<p>　strategy_id&#8203;の&#8203;4/5/6&#8203;に&#8203;tdnet.csv.gz&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;特&#8203;別&#8203;損&#8203;失&#8203;を&#8203;発&#8203;表&#8203;し&#8203;た&#8203;銘&#8203;柄&#8203;を&#8203;除&#8203;外&#8203;す&#8203;る&#8203;戦&#8203;略&#8203;を&#8203;実&#8203;装&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;strategy_id&#8203;に&#8203;4/5/6&#8203;を&#8203;指&#8203;定&#8203;し&#8203;て&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;施&#8203;し、&#8203;設&#8203;定&#8203;し&#8203;た&#8203;仮&#8203;説&#8203;（特&#8203;別&#8203;損&#8203;失&#8203;開&#8203;示&#8203;に&#8203;よ&#8203;る&#8203;株&#8203;価&#8203;の&#8203;下&#8203;落&#8203;を&#8203;回&#8203;避&#8203;し、&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;利&#8203;益&#8203;を&#8203;向&#8203;上&#8203;で&#8203;き&#8203;る&#8203;と&#8203;の&#8203;仮&#8203;説）&#8203;が&#8203;有&#8203;効&#8203;な&#8203;の&#8203;か&#8203;ど&#8203;う&#8203;か&#8203;を&#8203;検&#8203;証&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;特&#8203;別&#8203;損&#8203;失&#8203;を&#8203;発&#8203;表&#8203;し&#8203;た&#8203;銘&#8203;柄&#8203;を&#8203;除&#8203;外&#8203;し&#8203;て&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;組&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> strategy_id <span class="keyword">in</span> tqdm([<span class="integer">4</span>, <span class="integer">5</span>, <span class="integer">6</span>]):
    <span class="comment"># ポートフォリオ組成</span>
    str_ret = ScoringService.predict(inputs, start_dt=start_dt, strategy_id=strategy_id)
    <span class="comment"># ポートフォリオを保存</span>
    <span class="keyword">with</span> <span class="predefined">open</span>(f<span class="string"><span class="delimiter">&quot;</span><span class="content">chapter03-tutorial-02-backtest-{strategy_id}.csv</span><span class="delimiter">&quot;</span></span>, mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">w</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
        f.write(str_ret)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;実&#8203;行&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> strategy_id <span class="keyword">in</span> tqdm([<span class="integer">4</span>, <span class="integer">5</span>, <span class="integer">6</span>]):
    <span class="comment"># ポートフォリオを読み込み</span>
    df_submit = Backtest.load_submit(f<span class="string"><span class="delimiter">&quot;</span><span class="content">chapter03-tutorial-02-backtest-{strategy_id}.csv</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># バックテスト実行</span>
    results[strategy_id], stocks[strategy_id] = Backtest.run(df_submit.loc[start_dt:], backtest_codes, backtest_price)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_改善を試みたバックテスト結果の考察">4.6.1. 改善を試みたバックテスト結果の考察</h4>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;ま&#8203;ず&#8203;week_return&#8203;の&#8203;累&#8203;積&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;し&#8203;て&#8203;効&#8203;果&#8203;が&#8203;出&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 描画領域を定義</span>
fig, axes = plt.subplots(<span class="integer">1</span>, <span class="integer">1</span>, figsize=(<span class="integer">20</span>, <span class="integer">8</span>), sharex=<span class="predefined-constant">True</span>, sharey=<span class="predefined-constant">True</span>)

<span class="comment"># 戦略毎に処理</span>
<span class="keyword">for</span> k <span class="keyword">in</span> results.keys():
    <span class="comment"># 描画位置を指定</span>
    ax = axes
    <span class="comment"># 戦略別の累積リターンを描画</span>
    results[k].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>).loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>]].rename(
        columns={<span class="string"><span class="delimiter">&quot;</span><span class="content">week_return</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{k}: week_return</span><span class="delimiter">&quot;</span></span>}
    ).cumsum().plot(ax=ax)

<span class="comment"># ユニバースの週次リターンの累積をプロット</span>
df_universe_return.cumsum().plot(ax=ax, color=<span class="string"><span class="delimiter">&quot;</span><span class="content">black</span><span class="delimiter">&quot;</span></span>, label=<span class="string"><span class="delimiter">&quot;</span><span class="content">universe</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># 表示を調整</span>
ax.set_title(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cumulative week_return</span><span class="delimiter">&quot;</span></span>)
<span class="comment"># グリッドを表示</span>
ax.grid(<span class="predefined-constant">True</span>)
<span class="comment"># 描画</span>
plt.show()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter04/images/rf/rf18.png" alt="処理結果" width="100%">
</div>
</div>
<div class="paragraph">
<p>　2&#8203;及&#8203;び&#8203;5&#8203;の&#8203;戦&#8203;略&#8203;に&#8203;注&#8203;目&#8203;す&#8203;る&#8203;と、&#8203;特&#8203;別&#8203;損&#8203;失&#8203;を&#8203;発&#8203;表&#8203;し&#8203;た&#8203;銘&#8203;柄&#8203;を&#8203;除&#8203;外&#8203;す&#8203;る&#8203;と&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;の&#8203;利&#8203;益&#8203;が&#8203;上&#8203;昇&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;勝&#8203;率&#8203;や&#8203;シャー&#8203;プ&#8203;レ&#8203;シ&#8203;オ&#8203;等&#8203;こ&#8203;れ&#8203;ま&#8203;で&#8203;実&#8203;施&#8203;し&#8203;て&#8203;き&#8203;た&#8203;詳&#8203;細&#8203;な&#8203;分&#8203;析&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;実&#8203;施&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;実&#8203;際&#8203;の&#8203;戦&#8203;略&#8203;の&#8203;決&#8203;定&#8203;に&#8203;は&#8203;一&#8203;つ&#8203;の&#8203;評&#8203;価&#8203;指&#8203;標&#8203;の&#8203;み&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;の&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;複&#8203;数&#8203;の&#8203;評&#8203;価&#8203;指&#8203;標&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;総&#8203;合&#8203;的&#8203;に&#8203;判&#8203;断&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;重&#8203;要&#8203;で&#8203;す。&#8203;前&#8203;述&#8203;の&#8203;評&#8203;価&#8203;方&#8203;法&#8203;な&#8203;ど&#8203;を&#8203;参&#8203;考&#8203;に&#8203;各&#8203;自&#8203;で&#8203;実&#8203;施&#8203;し&#8203;て&#8203;み&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>　&#8203;ま&#8203;た、&#8203;今&#8203;回&#8203;は&#8203;適&#8203;時&#8203;開&#8203;示&#8203;情&#8203;報&#8203;の&#8203;特&#8203;別&#8203;損&#8203;失&#8203;の&#8203;み&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;そ&#8203;れ&#8203;以&#8203;外&#8203;に&#8203;も&#8203;株&#8203;価&#8203;に&#8203;影&#8203;響&#8203;を&#8203;与&#8203;え&#8203;る&#8203;開&#8203;示&#8203;項&#8203;目&#8203;が&#8203;あ&#8203;る&#8203;か&#8203;も&#8203;し&#8203;れ&#8203;ま&#8203;せ&#8203;ん、&#8203;上&#8203;記&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;仮&#8203;説&#8203;を&#8203;立&#8203;て&#8203;て&#8203;一&#8203;つ&#8203;ず&#8203;つ&#8203;効&#8203;果&#8203;を&#8203;比&#8203;較&#8203;し&#8203;な&#8203;が&#8203;ら&#8203;検&#8203;証&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;重&#8203;要&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_バックテストの総括">4.6.2. バックテストの総括</h4>
<div class="paragraph">
<p>　&#8203;ま&#8203;ず、&#8203;1&#8203;及&#8203;び&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;と&#8203;比&#8203;較&#8203;し&#8203;て&#8203;高&#8203;い&#8203;収&#8203;益&#8203;性&#8203;を&#8203;実&#8203;現&#8203;で&#8203;き&#8203;て&#8203;い&#8203;ま&#8203;し&#8203;た。&#8203;最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;と&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;足&#8203;し&#8203;合&#8203;わ&#8203;せ&#8203;た&#8203;1&#8203;の&#8203;戦&#8203;略&#8203;が、&#8203;よ&#8203;り&#8203;安&#8203;定&#8203;的&#8203;な&#8203;収&#8203;益&#8203;を&#8203;上&#8203;げ&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;期&#8203;待&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;し&#8203;た&#8203;が、&#8203;シャー&#8203;プ&#8203;レ&#8203;シ&#8203;オ&#8203;な&#8203;ど&#8203;を&#8203;比&#8203;較&#8203;し&#8203;て&#8203;も&#8203;2&#8203;の&#8203;戦&#8203;略&#8203;の&#8203;方&#8203;が&#8203;優&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;と&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;足&#8203;す&#8203;よ&#8203;り&#8203;も、&#8203;現&#8203;時&#8203;点&#8203;で&#8203;は&#8203;最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;単&#8203;体&#8203;で&#8203;利&#8203;用&#8203;す&#8203;る&#8203;ほ&#8203;う&#8203;が&#8203;良&#8203;い&#8203;結&#8203;果&#8203;が&#8203;期&#8203;待&#8203;で&#8203;き&#8203;そ&#8203;う&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;た&#8203;だ&#8203;し、&#8203;最&#8203;高&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;と&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;組&#8203;み&#8203;合&#8203;わ&#8203;せ&#8203;方&#8203;が&#8203;悪&#8203;かっ&#8203;た&#8203;可&#8203;能&#8203;性&#8203;も&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;と&#8203;い&#8203;う&#8203;の&#8203;も、&#8203;2&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203;あ&#8203;く&#8203;ま&#8203;で&#8203;ス&#8203;ピ&#8203;ア&#8203;マ&#8203;ン&#8203;の&#8203;順&#8203;位&#8203;相&#8203;関&#8203;を&#8203;意&#8203;識&#8203;し&#8203;て&#8203;作&#8203;ら&#8203;れ&#8203;た&#8203;た&#8203;め、&#8203;予&#8203;測&#8203;値&#8203;の&#8203;幅&#8203;よ&#8203;り&#8203;も&#8203;順&#8203;位&#8203;を&#8203;当&#8203;て&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;意&#8203;識&#8203;し&#8203;て&#8203;設&#8203;計&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;場&#8203;合、&#8203;予&#8203;測&#8203;の&#8203;幅&#8203;が&#8203;必&#8203;ず&#8203;し&#8203;も&#8203;実&#8203;際&#8203;の&#8203;幅&#8203;と&#8203;一&#8203;致&#8203;す&#8203;る&#8203;必&#8203;要&#8203;は&#8203;あ&#8203;り&#8203;ま&#8203;せ&#8203;ん&#8203;の&#8203;で、&#8203;単&#8203;純&#8203;に&#8203;足&#8203;す&#8203;よ&#8203;り&#8203;も&#8203;scikit-learn&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;の&#8203;StandardScaler( <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html" class="bare">https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html</a> )&#8203;に&#8203;よ&#8203;る&#8203;標&#8203;準&#8203;化&#8203;な&#8203;ど&#8203;を&#8203;通&#8203;し&#8203;て、&#8203;一&#8203;旦&#8203;正&#8203;規&#8203;化&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;か&#8203;ら&#8203;足&#8203;す&#8203;の&#8203;が&#8203;よ&#8203;い&#8203;の&#8203;で&#8203;は&#8203;な&#8203;い&#8203;か&#8203;と&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>こ&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;構&#8203;築&#8203;と&#8203;利&#8203;用&#8203;方&#8203;法&#8203;の&#8203;組&#8203;み&#8203;合&#8203;わ&#8203;せ&#8203;に&#8203;よっ&#8203;て&#8203;銘&#8203;柄&#8203;選&#8203;択&#8203;の&#8203;戦&#8203;略&#8203;は&#8203;決&#8203;ま&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;是&#8203;非&#8203;様々&#8203;な&#8203;試&#8203;行&#8203;錯&#8203;誤&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_投稿用パッケージの作成_2">4.7. 投稿用パッケージの作成</h3>
<div class="sect3">
<h4 id="_投稿用パッケージのディレクトリの作成_2">4.7.1. 投稿用パッケージのディレクトリの作成</h4>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;作&#8203;成&#8203;及&#8203;び&#8203;評&#8203;価&#8203;を&#8203;し&#8203;て&#8203;き&#8203;ま&#8203;し&#8203;た。&#8203;こ&#8203;こ&#8203;か&#8203;ら&#8203;は、&#8203;投&#8203;稿&#8203;用&#8203;の&#8203;パッ&#8203;ケー&#8203;ジ&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;用&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203;以&#8203;下&#8203;の&#8203;構&#8203;成&#8203;で&#8203;あ&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;ま&#8203;ず&#8203;は&#8203;必&#8203;要&#8203;な&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;作&#8203;成&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;適&#8203;宜&#8203;「3.8. &#8203;投&#8203;稿&#8203;用&#8203;パッ&#8203;ケー&#8203;ジ&#8203;の&#8203;作&#8203;成」&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;も&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>.
├── model                  必須 学習済モデルを置くディレクトリ
│   └── ...
├── src                    必須 Python のプログラムを置くディレクトリ
│   ├── predictor.py       必須 最初のプログラムが呼び出すファイル
│   └── ...                その他のファイル (ディレクトリ作成可能)
└── requirements.txt       任意</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ライブラリバージョン調整">4.7.2. ライブラリバージョン調整</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;章&#8203;で&#8203;利&#8203;用&#8203;し&#8203;た&#8203;モ&#8203;ジュー&#8203;ル&#8203;の&#8203;バー&#8203;ジョ&#8203;ン&#8203;を&#8203;調&#8203;整&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に、&#8203;requirements.txt&#8203;に&#8203;以&#8203;下&#8203;を&#8203;記&#8203;載&#8203;し&#8203;て&#8203;保&#8203;存&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>joblib==1.0.1
numpy==1.19.5
pandas==1.1.5
scikit-learn==0.20.3
scipy==1.2.1
seaborn==0.9.0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ランタイム実行用クラス及び提出ファイルの作成">4.7.3. ランタイム実行用クラス及び提出ファイルの作成</h4>
<div class="paragraph">
<p>　&#8203;最&#8203;後&#8203;に&#8203;作&#8203;成&#8203;し&#8203;た&#8203;ScoringService&#8203;ク&#8203;ラ&#8203;ス&#8203;を&#8203;predictor.py&#8203;に&#8203;書&#8203;き&#8203;込&#8203;み、&#8203;Zip&#8203;形&#8203;式&#8203;で&#8203;圧&#8203;縮&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;提&#8203;出&#8203;可&#8203;能&#8203;な&#8203;zip&#8203;ファ&#8203;イ&#8203;ル&#8203;が&#8203;作&#8203;成&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>Zip&#8203;ファ&#8203;イ&#8203;ル&#8203;作&#8203;成&#8203;例</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ls
model  requirements.txt  src
$ zip -v submit.zip requirements.txt src/*.py model/*.pkl
updating: requirements.txt        (in=0) (out=0) (stored 0%)
updating: src/predictor.py        (in=11408) (out=2417) (deflated 79%)
updating: model/my_model_label_high_20.pkl .        (in=18919345) (out=5071005) (deflated 73%)
updating: model/my_model_label_low_20.pkl .        (in=18704305) (out=5006613) (deflated 73%)
total bytes=37635058, compressed=10080035 -&gt; 73% savings</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ニュースデータから特徴量を抽出しよう">5. ニュースデータから特徴量を抽出しよう</h2>
<div class="sectionbody">
<div class="paragraph">
<p>　&#8203;本&#8203;章&#8203;で&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;の&#8203;大&#8203;き&#8203;な&#8203;特&#8203;徴&#8203;で&#8203;あ&#8203;る&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;に&#8203;注&#8203;目&#8203;し、&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;か&#8203;ら&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;を&#8203;行&#8203;う&#8203;手&#8203;法&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;を&#8203;行&#8203;う&#8203;こ&#8203;と&#8203;で&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;情&#8203;報&#8203;が&#8203;ス&#8203;コ&#8203;ア&#8203;化&#8203;さ&#8203;れ&#8203;る&#8203;た&#8203;め、&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;や&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;活&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;可&#8203;能&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;章&#8203;で&#8203;は&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;か&#8203;ら&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;を&#8203;行&#8203;う&#8203;手&#8203;法&#8203;と&#8203;し&#8203;て、&#8203;BERT(Bidirectional Encoder Representations from Transformers)&#8203;を&#8203;採&#8203;用&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;BERT&#8203;は&#8203;Google&#8203;に&#8203;よっ&#8203;て&#8203;開&#8203;発&#8203;さ&#8203;れ&#8203;た、&#8203;自&#8203;然&#8203;言&#8203;語&#8203;処&#8203;理&#8203;（NLP）&#8203;の&#8203;事&#8203;前&#8203;学&#8203;習&#8203;の&#8203;た&#8203;め&#8203;の&#8203;Transformer&#8203;ベー&#8203;ス&#8203;の&#8203;機&#8203;械&#8203;学&#8203;習&#8203;手&#8203;法&#8203;で&#8203;あ&#8203;り&#8203;(&#8203;引&#8203;用&#8203;:<a href="https://ja.wikipedia.org/wiki/BERT_(%E8%A8%80%E8%AA%9E%E3%83%A2%E3%83%87%E3%83%AB)">Wikipedia: BERT (&#8203;言&#8203;語&#8203;モ&#8203;デ&#8203;ル&#8203;)</a>)、&#8203;近&#8203;年&#8203;様々&#8203;な&#8203;分&#8203;野&#8203;で&#8203;高&#8203;い&#8203;性&#8203;能&#8203;を&#8203;発&#8203;揮&#8203;し&#8203;て&#8203;い&#8203;る&#8203;ニュー&#8203;ラ&#8203;ル&#8203;ネッ&#8203;ト&#8203;を&#8203;基&#8203;盤&#8203;と&#8203;す&#8203;る&#8203;言&#8203;語&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;一&#8203;種&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は、&#8203;東&#8203;北&#8203;大&#8203;学&#8203;の&#8203;乾・&#8203;鈴&#8203;木&#8203;研&#8203;究&#8203;室&#8203;が&#8203;公&#8203;開&#8203;し&#8203;た&#8203;訓&#8203;練&#8203;済&#8203;み&#8203;日&#8203;本&#8203;語&#8203;BERT&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;利&#8203;用&#8203;し&#8203;ま&#8203;す&#8203;(<a href="https://github.com/cl-tohoku/bert-japanese">こちら</a>)。&#8203;な&#8203;お、&#8203;BERT&#8203;モ&#8203;デ&#8203;ル&#8203;へ&#8203;の&#8203;入&#8203;力&#8203;で&#8203;あ&#8203;る&#8203;コー&#8203;パ&#8203;ス&#8203;(&#8203;言&#8203;語&#8203;の&#8203;標&#8203;本&#8203;を&#8203;抽&#8203;出&#8203;し&#8203;た&#8203;集&#8203;合。&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;の&#8203;集&#8203;合&#8203;を&#8203;示&#8203;し&#8203;ま&#8203;す&#8203;)&#8203;は、&#8203;そ&#8203;の&#8203;BERT&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;学&#8203;習&#8203;さ&#8203;れ&#8203;た&#8203;時&#8203;と&#8203;同&#8203;様&#8203;の&#8203;前&#8203;処&#8203;理&#8203;を&#8203;行&#8203;う&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;注&#8203;意&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>今&#8203;回&#8203;使&#8203;用&#8203;す&#8203;る&#8203;"cl-tohoku/bert-base-japanese-whole-word-masking"&#8203;モ&#8203;デ&#8203;ル&#8203;は、&#8203;mecab-ipadic-NEologd&#8203;に&#8203;よ&#8203;り&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;さ&#8203;れ、&#8203;そ&#8203;の&#8203;後&#8203;Wordpiece subword encoder&#8203;よ&#8203;り&#8203;subword&#8203;化&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;も&#8203;そ&#8203;の&#8203;流&#8203;れ&#8203;に&#8203;沿っ&#8203;た&#8203;処&#8203;理&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;と&#8203;は、&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;を&#8203;決&#8203;め&#8203;た&#8203;基&#8203;準&#8203;の&#8203;トー&#8203;ク&#8203;ン&#8203;に&#8203;区&#8203;切&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;す&#8203;(5.2&#8203;に&#8203;詳&#8203;細&#8203;記&#8203;載&#8203;)。&#8203;他&#8203;の&#8203;BERT&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;可&#8203;能&#8203;で&#8203;す&#8203;が、&#8203;そ&#8203;の&#8203;場&#8203;合&#8203;は、&#8203;そ&#8203;の&#8203;BERT&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;入&#8203;力&#8203;と&#8203;す&#8203;る&#8203;コー&#8203;パ&#8203;ス&#8203;が&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;前&#8203;処&#8203;理&#8203;が&#8203;行&#8203;わ&#8203;れ&#8203;た&#8203;か&#8203;を&#8203;確&#8203;認&#8203;し&#8203;適&#8203;切&#8203;な&#8203;前&#8203;処&#8203;理&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;<br>
ま&#8203;た、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;外&#8203;部&#8203;デー&#8203;タ&#8203;の&#8203;利&#8203;用&#8203;を&#8203;制&#8203;限&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;ち&#8203;ら&#8203;も&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;ご&#8203;確&#8203;認&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>・提供するデータ以外の外部データ（為替や金利データ等）や、提供するデータの期間外のヒストリカルデータを用いてモデルを学習することは禁止。（例として、2015年以前の株価等）

・ただし、言語資源の外部データについては、第三者の権利を侵害しない、無償で誰でも利用可能なオープンなものに限り利用可能。（例として、形態素解析辞書や、BERTモデル）</pre>
</div>
</div>
<div class="sect2">
<h3 id="_テキストからの特徴量抽出方法の紹介">5.1. テキストからの特徴量抽出方法の紹介</h3>
<div class="paragraph">
<p>　&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;に&#8203;内&#8203;在&#8203;す&#8203;る&#8203;情&#8203;報&#8203;を&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;抽&#8203;出&#8203;す&#8203;る&#8203;方&#8203;法&#8203;と&#8203;し&#8203;て&#8203;は、&#8203;単&#8203;語&#8203;の&#8203;頻&#8203;度&#8203;ベー&#8203;ス、&#8203;単&#8203;語&#8203;の&#8203;分&#8203;散&#8203;表&#8203;現&#8203;ベー&#8203;ス、&#8203;言&#8203;語&#8203;モ&#8203;デ&#8203;ル&#8203;ベー&#8203;ス&#8203;等&#8203;の&#8203;方&#8203;法&#8203;が&#8203;存&#8203;在&#8203;し&#8203;ま&#8203;す。&#8203;下&#8203;記&#8203;で&#8203;は、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;い&#8203;く&#8203;つ&#8203;か&#8203;の&#8203;方&#8203;法&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;単&#8203;語&#8203;の&#8203;頻&#8203;度&#8203;ベー&#8203;ス&#8203;</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>テ&#8203;キ&#8203;ス&#8203;ト&#8203;に&#8203;登&#8203;場&#8203;す&#8203;る&#8203;各&#8203;単&#8203;語&#8203;の&#8203;頻&#8203;度&#8203;を&#8203;行&#8203;列&#8203;化&#8203;し&#8203;た&#8203;単&#8203;語&#8203;文&#8203;書&#8203;行&#8203;列&#8203;を&#8203;用&#8203;い&#8203;る&#8203;方&#8203;法&#8203; &#8203;（例）&#8203;TF-IDF(Term Frequency–&#8203;Inverse Document Frequency)</p>
</li>
<li>
<p>テ&#8203;キ&#8203;ス&#8203;ト&#8203;の&#8203;潜&#8203;在&#8203;意&#8203;味&#8203;を&#8203;抽&#8203;出&#8203;す&#8203;る&#8203;ト&#8203;ピッ&#8203;ク&#8203;モ&#8203;デ&#8203;リ&#8203;ン&#8203;グ&#8203;の&#8203;方&#8203;法&#8203; &#8203;（例）&#8203;LSA(Latent Semantic Analysis), LDA(Latent Dirichlet Allocation)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;方&#8203;法&#8203;は、&#8203;単&#8203;語&#8203;の&#8203;頻&#8203;度&#8203;行&#8203;列&#8203;の&#8203;使&#8203;用&#8203;を&#8203;基&#8203;盤&#8203;と&#8203;し&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;コー&#8203;パ&#8203;ス&#8203;内&#8203;に&#8203;単&#8203;語&#8203;が&#8203;増&#8203;え&#8203;れ&#8203;ば&#8203;増&#8203;え&#8203;る&#8203;ほ&#8203;ど&#8203;高&#8203;い&#8203;計&#8203;算&#8203;リ&#8203;ソー&#8203;ス&#8203;が&#8203;要&#8203;求&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">モ&#8203;デ&#8203;リ&#8203;ン&#8203;グ&#8203;名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">説&#8203;明</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">引&#8203;用</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LSA(Latent Semantic Analysis)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LSA&#8203;は&#8203;ベ&#8203;ク&#8203;ト&#8203;ル&#8203;空&#8203;間&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;利&#8203;用&#8203;し&#8203;た&#8203;自&#8203;然&#8203;言&#8203;語&#8203;処&#8203;理&#8203;の&#8203;技&#8203;法&#8203;の&#8203;1&#8203;つ&#8203;で、&#8203;文&#8203;書&#8203;群&#8203;と&#8203;そ&#8203;こ&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;る&#8203;用&#8203;語&#8203;群&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;そ&#8203;れ&#8203;ら&#8203;に&#8203;関&#8203;連&#8203;し&#8203;た&#8203;概&#8203;念&#8203;の&#8203;集&#8203;合&#8203;を&#8203;生&#8203;成&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;そ&#8203;の&#8203;関&#8203;係&#8203;を&#8203;分&#8203;析&#8203;す&#8203;る&#8203;技&#8203;術&#8203;で&#8203;あ&#8203;る。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://ja.wikipedia.org/wiki/%E6%BD%9C%E5%9C%A8%E6%84%8F%E5%91%B3%E8%A7%A3%E6%9E%90#:~:text=%E6%BD%9C%E5%9C%A8%E6%84%8F%E5%91%B3%E8%A7%A3%E6%9E%90%EF%BC%88%E8%8B%B1%3A%20Latent,%E6%BD%9C%E5%9C%A8%E7%9A%84%E6%84%8F%E5%91%B3%E8%A7%A3%E6%9E%90%E3%81%A8%E3%82%82%E3%80%82">Wikipedia:潜在意味解析</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDA(Latent Dirichlet Allocation)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDA&#8203;は&#8203;文&#8203;章&#8203;中&#8203;の&#8203;潜&#8203;在&#8203;的&#8203;な&#8203;ト&#8203;ピッ&#8203;ク&#8203;を&#8203;推&#8203;定&#8203;し、&#8203;文&#8203;章&#8203;分&#8203;類&#8203;や、&#8203;文&#8203;章&#8203;ベ&#8203;ク&#8203;ト&#8203;ル&#8203;の&#8203;次&#8203;元&#8203;削&#8203;減&#8203;等&#8203;に&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;る&#8203;技&#8203;術&#8203;で&#8203;す。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://spjai.com/topic-model/">【入門】トピックモデルとは？トピック分析の３つの手法を解説</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>&#8203;単&#8203;語&#8203;の&#8203;分&#8203;散&#8203;表&#8203;現&#8203;ベー&#8203;ス&#8203;</strong></p>
</div>
<div class="paragraph">
<p>　&#8203;単&#8203;語&#8203;の&#8203;分&#8203;散&#8203;表&#8203;現&#8203;（あ&#8203;る&#8203;い&#8203;は&#8203;単&#8203;語&#8203;埋&#8203;め&#8203;込&#8203;み）&#8203;と&#8203;は、&#8203;単&#8203;語&#8203;を&#8203;高&#8203;次&#8203;元&#8203;の&#8203;実&#8203;数&#8203;ベ&#8203;ク&#8203;ト&#8203;ル&#8203;で&#8203;表&#8203;現&#8203;す&#8203;る&#8203;技&#8203;術&#8203;で&#8203;す&#8203;(&#8203;引&#8203;用&#8203;:<a href="https://sites.google.com/site/iwanamidatascience/vol2/word-embedding">岩波データサイエンス: &#8203;分&#8203;散&#8203;表&#8203;現&#8203;(&#8203;単&#8203;語&#8203;埋&#8203;め&#8203;込&#8203;み&#8203;)</a>)。&#8203;次&#8203;に&#8203;挙&#8203;げ&#8203;る&#8203;方&#8203;法&#8203;は、&#8203;単&#8203;語&#8203;を&#8203;分&#8203;散&#8203;表&#8203;現&#8203;化&#8203;す&#8203;る&#8203;方&#8203;法&#8203;の&#8203;一&#8203;部&#8203;で&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">手&#8203;法</th>
<th class="tableblock halign-left valign-top">説&#8203;明</th>
<th class="tableblock halign-left valign-top">論&#8203;文&#8203;例</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Word2Vec(CBOW)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">中&#8203;心&#8203;単&#8203;語&#8203;か&#8203;ら&#8203;周&#8203;辺&#8203;単&#8203;語&#8203;を&#8203;予&#8203;測&#8203;し、&#8203;前&#8203;後&#8203;単&#8203;語&#8203;と&#8203;の&#8203;関&#8203;係&#8203;性&#8203;を&#8203;用&#8203;い&#8203;て&#8203;分&#8203;散&#8203;表&#8203;現&#8203;を&#8203;構&#8203;築</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://arxiv.org/abs/1301.3781">Tomas Mikolov, Kai Chen, Greg Corrado, Jeffrey Dean, 2013, Efficient Estimation of Word Representations in Vector Space</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Glove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">単&#8203;語&#8203;の&#8203;頻&#8203;度&#8203;ベー&#8203;ス&#8203;の&#8203;LSA&#8203;と&#8203;単&#8203;語&#8203;の&#8203;分&#8203;散&#8203;表&#8203;現&#8203;ベー&#8203;ス&#8203;の&#8203;Word2Vec&#8203;を&#8203;用&#8203;い&#8203;て&#8203;分&#8203;散&#8203;表&#8203;現&#8203;を&#8203;構&#8203;築</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://arxiv.org/abs/1411.5595">Tianze Shi, Zhiyuan Liu, 2014, Linking GloVe with word2vec</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FastText</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">単&#8203;語&#8203;を&#8203;Subword&#8203;化&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;Out-Of-Vocabulary&#8203;に&#8203;頑&#8203;健&#8203;な&#8203;分&#8203;散&#8203;表&#8203;現&#8203;を&#8203;構&#8203;築</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://arxiv.org/abs/1607.04606">Piotr Bojanowski, Edouard Grave, Armand Joulin, Tomas Mikolov, 2017, Enriching Word Vectors with Subword Information</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elmo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RNN&#8203;ベー&#8203;ス&#8203;の&#8203;言&#8203;語&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;あ&#8203;る&#8203;biLM&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;文&#8203;脈&#8203;を&#8203;反&#8203;映&#8203;す&#8203;る&#8203;分&#8203;散&#8203;表&#8203;現&#8203;を&#8203;構&#8203;築</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://arxiv.org/abs/1802.05365">Matthew E. Peters, Mark Neumann, Mohit Iyyer, Matt Gardner, Christopher Clark, Kenton Lee, Luke Zettlemoyer, 2018, Deep contextualized word representations</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>&#8203;言&#8203;語&#8203;モ&#8203;デ&#8203;ル&#8203;ベー&#8203;ス&#8203;(&#8203;ニュー&#8203;ラ&#8203;ル&#8203;ネッ&#8203;ト&#8203;基&#8203;盤&#8203;の&#8203;言&#8203;語&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;み&#8203;を&#8203;説&#8203;明&#8203;)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>RNN&#8203;基&#8203;盤&#8203;(LSTM, GRU, LM&#8203;を&#8203;含&#8203;む&#8203;)&#8203;の&#8203;内&#8203;部&#8203;状&#8203;態&#8203;を&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;抽&#8203;出</p>
</li>
<li>
<p>Transformer(BERT&#8203;等&#8203;Attention&#8203;機&#8203;構&#8203;を&#8203;用&#8203;い&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;含&#8203;む&#8203;)&#8203;基&#8203;盤&#8203;の&#8203;内&#8203;部&#8203;状&#8203;態&#8203;を&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;抽&#8203;出</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;方&#8203;法&#8203;は、&#8203;膨&#8203;大&#8203;な&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203;を&#8203;持&#8203;つ&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;膨&#8203;大&#8203;な&#8203;デー&#8203;タ&#8203;を&#8203;用&#8203;い&#8203;て&#8203;学&#8203;習&#8203;さ&#8203;せ&#8203;る&#8203;た&#8203;め、&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;よ&#8203;り&#8203;高&#8203;次&#8203;元&#8203;の&#8203;潜&#8203;在&#8203;表&#8203;現&#8203;を&#8203;学&#8203;習&#8203;で&#8203;き&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;知&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;モ&#8203;デ&#8203;ル&#8203;か&#8203;ら&#8203;抽&#8203;出&#8203;し&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;は&#8203;多&#8203;様&#8203;な&#8203;タ&#8203;ス&#8203;ク&#8203;に&#8203;お&#8203;い&#8203;て&#8203;適&#8203;用&#8203;で&#8203;き、&#8203;高&#8203;い&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;を&#8203;表&#8203;す&#8203;こ&#8203;と&#8203;が&#8203;知&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は、&#8203;上&#8203;記&#8203;観&#8203;点&#8203;か&#8203;ら&#8203;も&#8203;最&#8203;も&#8203;汎&#8203;用&#8203;性&#8203;が&#8203;高&#8203;い&#8203;と&#8203;思&#8203;わ&#8203;れ&#8203;る&#8203;BERT&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;利&#8203;用&#8203;し&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;に&#8203;取&#8203;り&#8203;組&#8203;み&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect2">
<h3 id="anchor-5.2">5.2. 実行環境</h3>
<div class="paragraph">
<p>　&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は、&#8203;CPU&#8203;と&#8203;GPU&#8203;ど&#8203;ち&#8203;ら&#8203;の&#8203;環&#8203;境&#8203;で&#8203;も&#8203;実&#8203;行&#8203;可&#8203;能&#8203;な&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;し&#8203;か&#8203;し、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;紹&#8203;介&#8203;す&#8203;る&#8203;BERT&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;の&#8203;処&#8203;理&#8203;は、&#8203;CPU&#8203;環&#8203;境&#8203;で&#8203;は&#8203;か&#8203;な&#8203;り&#8203;の&#8203;時&#8203;間&#8203;が&#8203;か&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;GPU&#8203;環&#8203;境&#8203;を&#8203;お&#8203;持&#8203;ち&#8203;で&#8203;な&#8203;い&#8203;方&#8203;は、&#8203;多&#8203;少&#8203;の&#8203;制&#8203;限&#8203;は&#8203;あ&#8203;る&#8203;も&#8203;の&#8203;の&#8203;実&#8203;行&#8203;環&#8203;境&#8203;と&#8203;し&#8203;て&#8203;無&#8203;料&#8203;で&#8203;GPU&#8203;環&#8203;境&#8203;が&#8203;使&#8203;え&#8203;る&#8203;Google Colaboratory&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;強&#8203;く&#8203;お&#8203;勧&#8203;め&#8203;し&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;本&#8203;章&#8203;を&#8203;実&#8203;行&#8203;し&#8203;な&#8203;く&#8203;て&#8203;も&#8203;問&#8203;題&#8203;な&#8203;く&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;ご&#8203;利&#8203;用&#8203;い&#8203;た&#8203;だ&#8203;け&#8203;る&#8203;よ&#8203;う&#8203;に、&#8203;本&#8203;章&#8203;で&#8203;抽&#8203;出&#8203;し&#8203;た&#8203;BERT&#8203;特&#8203;徴&#8203;量&#8203;は&#8203;pkl&#8203;ファ&#8203;イ&#8203;ル&#8203;と&#8203;し&#8203;て&#8203; <a href="http://signate.jp/competitions/443/data">こちら</a> &#8203;で&#8203;も&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_google_colaboratoryの環境設定">5.2.1. Google Colaboratoryの環境設定</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;の&#8203;5&#8203;章、&#8203;6&#8203;章&#8203;の&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;を&#8203;Google Colaboratory&#8203;上&#8203;で&#8203;動&#8203;か&#8203;す&#8203;た&#8203;め&#8203;に&#8203;は、&#8203;ま&#8203;ず&#8203;以&#8203;下&#8203;の&#8203;手&#8203;順&#8203;で&#8203;Google Drive&#8203;上&#8203;に&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;設&#8203;置&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Google Drive&#8203;の&#8203;My Drive&#8203;に&#8203;<code>JPX_competition</code>&#8203;と&#8203;い&#8203;う&#8203;フォ&#8203;ル&#8203;ダー&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</li>
<li>
<p>1&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;<code>JPX_competition</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;に&#8203;デー&#8203;タ&#8203;を&#8203;保&#8203;存&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;<code>data_dir_comp2</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</li>
<li>
<p>SIGNATE&#8203;の&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;サ&#8203;イ&#8203;ト&#8203;よ&#8203;り&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;た&#8203;各&#8203;種&#8203;デー&#8203;タ&#8203;を&#8203;2&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;<code>data_dir_comp2</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;に&#8203;アッ&#8203;プ&#8203;ロー&#8203;ド&#8203;し&#8203;ま&#8203;す。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>　&#8203;次&#8203;に&#8203;Google Colaboratory&#8203;上&#8203;で&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;notebook&#8203;を&#8203;展&#8203;開&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;notebook&#8203;は&#8203;Google Colaboratory&#8203;上&#8203;で&#8203;も&#8203;実&#8203;行&#8203;可&#8203;能&#8203;と&#8203;なっ&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。&#8203;各&#8203;章&#8203;の&#8203;notebook&#8203;は&#8203;以&#8203;下&#8203;の&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;リ&#8203;ン&#8203;ク&#8203;先&#8203;を&#8203;開&#8203;き、&#8203;開&#8203;い&#8203;た&#8203;ペー&#8203;ジ&#8203;で&#8203;Raw&#8203;を&#8203;右&#8203;ク&#8203;リッ&#8203;ク&#8203;し、&#8203;「リ&#8203;ン&#8203;ク&#8203;先&#8203;を&#8203;名&#8203;前&#8203;を&#8203;つ&#8203;け&#8203;て&#8203;保&#8203;存」&#8203;を&#8203;選&#8203;択&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;可&#8203;能&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial/blob/main/handson/Chapter05/20210226_chapter05_tutorial.ipynb">5章のnotebook</a><br>
<a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial/blob/main/handson/Chapter06/20210226_chapter06_tutorial.ipynb">6章のnotebook</a><br>
<a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial/blob/main/handson/Chapter06/20210224_chapter06_tutorial_test_predictor.ipynb">6章の投稿ファイル実装例用notebook</a><br></p>
</div>
<div class="paragraph">
<p>　&#8203;以&#8203;下、&#8203;5&#8203;章&#8203;を&#8203;例&#8203;に&#8203;Google Colaboratory&#8203;で&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;noteboook&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;方&#8203;法&#8203;を&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Google Drive &#8203;の&#8203; My Drive &#8203;内&#8203;に&#8203;作&#8203;成&#8203;し&#8203;た&#8203;<code>JPX_competition</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;に&#8203;3&#8203;章&#8203;用&#8203;の&#8203;notebook&#8203;を&#8203;保&#8203;存&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;<code>Chapter05</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</li>
<li>
<p>上&#8203;記&#8203;の&#8203;リ&#8203;ン&#8203;ク&#8203;先&#8203;か&#8203;ら&#8203;5&#8203;章&#8203;の&#8203;notebook&#8203;を&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;て、&#8203;先&#8203;程&#8203;作&#8203;成&#8203;し&#8203;た&#8203;<code>Chapter05</code>&#8203;フォ&#8203;ル&#8203;ダー&#8203;に&#8203;<code>20210226_chapter05_tutorial.ipyn</code>&#8203;と&#8203;い&#8203;う&#8203;ファ&#8203;イ&#8203;ル&#8203;名&#8203;で&#8203;保&#8203;存&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</li>
<li>
<p>Google Drive&#8203;に&#8203;アッ&#8203;プ&#8203;ロー&#8203;ド&#8203;し&#8203;た&#8203; <code>20210226_chapter05_tutorial.ipynb</code> &#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;ダ&#8203;ブ&#8203;ル&#8203;ク&#8203;リッ&#8203;ク&#8203;し&#8203;て&#8203; Google Colaboratory &#8203;で&#8203;開&#8203;き&#8203;ま&#8203;す。</p>
</li>
<li>
<p>Google Colaboratory&#8203;の&#8203;環&#8203;境&#8203;で&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;を&#8203;実&#8203;行&#8203;す&#8203;る&#8203;場&#8203;合、&#8203;最&#8203;初&#8203;に&#8203;以&#8203;下&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;実&#8203;行&#8203;し&#8203;て&#8203; Google Colaboratory &#8203;上&#8203;の&#8203; notebook &#8203;か&#8203;ら&#8203; Google Drive &#8203;に&#8203;ア&#8203;ク&#8203;セ&#8203;ス&#8203;で&#8203;き&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># Google Colab環境ではGoogle Driveをマウントしてアクセスできるようにします。</span>
<span class="keyword">import</span> <span class="include">sys</span>

<span class="keyword">if</span> <span class="string"><span class="delimiter">'</span><span class="content">google.colab</span><span class="delimiter">'</span></span> <span class="keyword">in</span> sys.modules:
    <span class="comment"># Google Drive をマウントします</span>
    <span class="keyword">from</span> <span class="include">google.colab</span> <span class="keyword">import</span> <span class="include">drive</span>
    mount_dir = <span class="string"><span class="delimiter">&quot;</span><span class="content">/content/drive</span><span class="delimiter">&quot;</span></span>
    drive.mount(mount_dir)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_必要なライブラリのインストール_2">5.2.2. 必要なライブラリのインストール</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;内&#8203;で&#8203;は、&#8203;上&#8203;記&#8203;の&#8203;実&#8203;行&#8203;環&#8203;境&#8203;に&#8203;は&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;以&#8203;下&#8203;の&#8203;コ&#8203;マ&#8203;ン&#8203;ド&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;個&#8203;別&#8203;に&#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル&#8203;し&#8203;ま&#8203;す。&#8203;Notebook&#8203;に&#8203;記&#8203;載&#8203;が&#8203;あ&#8203;る&#8203;通&#8203;り、&#8203;Google Colaboratory&#8203;上&#8203;に&#8203;お&#8203;い&#8203;て&#8203;も&#8203;実&#8203;行&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># テキスト解析用にmecabをインストールします。
# 日本語表記を含む可視化のため、フォントもインストールしています。
apt-get update
apt-get install -y build-essential sudo mecab libmecab-dev mecab-ipadic-utf8 fonts-ipafont-gothic file

# 必要なライブラリをインストールします。
pip install --no-cache-dir pandas==1.1.5 numpy==1.19.5 scattertext==0.1.0.0 wordcloud==1.8.1 torch==1.7.1 torchvision==0.8.2 transformers==4.2.2 mecab-python3==0.996.6rc1 ipadic==1.0.0 neologdn==0.4 fugashi==1.0.5 japanize-matplotlib==1.1.3 gensim==3.8.3 pyLDAvis==2.1.2
# mecab用のipadic-neologd辞書をインストールします。
# ipadic-neologd辞書は非常に頻繁に更新されるため、同様の解析結果が得られるようにバージョンを指定します。そのため、git clone時にバージョン(--branch v0.0.7 --single-branch)を指定します。
# git cloneよりインストールファイルが入っているレポジトリをローカル環境に落とします。
git clone https://github.com/neologd/mecab-ipadic-neologd.git --branch v0.0.7 --single-branch

# インストールの途中、yesのコマンドを叩かないとインストールが実行されません。yesコマンドを使うことで、渡された引数を常に叩くようになります。
yes yes | mecab-ipadic-neologd/bin/install-mecab-ipadic-neologd</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ライブラリの読み込み_2">5.2.3. ライブラリの読み込み</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;利&#8203;用&#8203;す&#8203;る&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 基本ライブラリ</span>
<span class="keyword">import</span> <span class="include">re</span>
<span class="keyword">import</span> <span class="include">os</span>
<span class="keyword">import</span> <span class="include">sys</span>
<span class="keyword">import</span> <span class="include">math</span>
<span class="keyword">import</span> <span class="include">random</span>
<span class="keyword">import</span> <span class="include">json</span>
<span class="keyword">import</span> <span class="include">joblib</span>
<span class="keyword">import</span> <span class="include">numpy</span> <span class="keyword">as</span> np
<span class="keyword">import</span> <span class="include">pandas</span> <span class="keyword">as</span> pd
<span class="keyword">from</span> <span class="include">scipy</span> <span class="keyword">import</span> <span class="include">stats</span>
<span class="keyword">import</span> <span class="include">string</span>
<span class="keyword">from</span> <span class="include">copy</span> <span class="keyword">import</span> <span class="include">copy</span>
<span class="keyword">from</span> <span class="include">glob</span> <span class="keyword">import</span> <span class="include">glob</span>
<span class="keyword">from</span> <span class="include">itertools</span> <span class="keyword">import</span> <span class="include">chain</span>
<span class="keyword">import</span> <span class="include">gc</span>

<span class="comment"># テキスト解析関連</span>
<span class="keyword">import</span> <span class="include">MeCab</span>
<span class="keyword">import</span> <span class="include">unicodedata</span>
<span class="keyword">import</span> <span class="include">neologdn</span>

<span class="comment"># 可視化関連</span>
<span class="keyword">from</span> <span class="include">tqdm.auto</span> <span class="keyword">import</span> <span class="include">tqdm</span>
<span class="keyword">from</span> <span class="include">IPython.display</span> <span class="keyword">import</span> <span class="include">display</span>, <span class="include">display_markdown</span>, <span class="include">IFrame</span>
<span class="keyword">import</span> <span class="include">scattertext</span> <span class="keyword">as</span> st
<span class="keyword">from</span> <span class="include">wordcloud</span> <span class="keyword">import</span> <span class="include">WordCloud</span>
<span class="keyword">import</span> <span class="include">matplotlib.pyplot</span> <span class="keyword">as</span> plt
<span class="keyword">import</span> <span class="include">japanize_matplotlib</span>
<span class="keyword">import</span> <span class="include">seaborn</span> <span class="keyword">as</span> sns
<span class="keyword">import</span> <span class="include">gensim</span>
<span class="keyword">import</span> <span class="include">pyLDAvis</span>
<span class="keyword">import</span> <span class="include">pyLDAvis.gensim</span>

<span class="comment">#PCA関連</span>
<span class="keyword">from</span> <span class="include">sklearn.decomposition</span> <span class="keyword">import</span> <span class="include">PCA</span>, <span class="include">KernelPCA</span>

<span class="comment"># ニューラルネット関連</span>
<span class="keyword">import</span> <span class="include">torch</span>
<span class="keyword">from</span> <span class="include">torch</span> <span class="keyword">import</span> <span class="include">nn</span>
<span class="keyword">import</span> <span class="include">torch.nn.functional</span> <span class="keyword">as</span> F
<span class="keyword">import</span> <span class="include">transformers</span>
<span class="keyword">from</span> <span class="include">transformers</span> <span class="keyword">import</span> <span class="include">BertJapaneseTokenizer</span>
<span class="keyword">from</span> <span class="include">torch.utils.data</span> <span class="keyword">import</span> <span class="include">DataLoader</span>, <span class="include">Dataset</span> <span class="keyword">as</span> _Dataset

<span class="comment"># notebook上でpyLDAvisより可視化を行う場合の設定</span>
pyLDAvis.enable_notebook()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ライブラリ解説_2">5.2.4. ライブラリ解説</h4>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;目&#8203;的&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;公&#8203;式&#8203;ド&#8203;キュ&#8203;メ&#8203;ン&#8203;ト&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;入&#8203;門&#8203;解&#8203;説&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">re</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デー&#8203;タ&#8203;の&#8203;処&#8203;理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.python.org/3/library/re.html">Regular expression operations</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://note.nkmk.me/python-re-match-search-findall-etc/">Pythonの正規表現モジュールreの使い方</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">numpy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デー&#8203;タ&#8203;の&#8203;処&#8203;理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://numpy.org/doc/stable/user/tutorials_index.html">NumPy Tutorials</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/jyori112/items/a15658d1dd17c421e1e2">Qiita:numpyの使い方</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pandas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デー&#8203;タ&#8203;の&#8203;処&#8203;理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://pandas.pydata.org/docs/">pandas documentation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/ysdyt/items/9ccca82fc5b504e7913a">Qiita:データ分析で頻出のPandas基本操作</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scipy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">統&#8203;計&#8203;用&#8203;の&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.scipy.org/doc/scipy/reference/tutorial/index.html">SciPy Tutorial</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://amorphous.tf.chiba-u.jp/lecture.files/chem_computer/11_scipy%E3%81%AE%E5%9F%BA%E6%9C%AC%E3%81%A8%E5%BF%9C%E7%94%A8/11.html">千葉大: &#8203;コ&#8203;ン&#8203;ピュー&#8203;タ&#8203;処&#8203;理&#8203; &#8203;ド&#8203;キュ&#8203;メ&#8203;ン&#8203;ト&#8203; 11. scipy&#8203;の&#8203;基&#8203;本&#8203;と&#8203;応&#8203;用&#8203;</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">glob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファ&#8203;イ&#8203;ル&#8203;の&#8203;検&#8203;知</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.python.org/3/library/glob.html">glob &#8203;—&#8203; Unix style pathname pattern expansion</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/HirosuguTakeshita/items/0e0850362c7eb3b10ea1">Qiita:【備忘録】globの使い方</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MeCab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">テ&#8203;キ&#8203;ス&#8203;ト&#8203;解&#8203;析</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://taku910.github.io/mecab/">MeCab: Yet Another Part-of-Speech and Morphological Analyzer</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/KROYO/items/931805e5f499753b546f">Qiita:初めての自然言語処理 &#8203;入&#8203;門&#8203; 1 ~MeCab&#8203;を&#8203;動&#8203;か&#8203;し&#8203;て&#8203;み&#8203;よ&#8203;う&#8203; ~</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unicodedata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unicode&#8203;正&#8203;規&#8203;化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.python.org/3/library/unicodedata.html">Unicode Database</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/fury00812/items/b98a7f9428d1395fc230">Qiita:Unicode正規化</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">neologdn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">テ&#8203;キ&#8203;ス&#8203;ト&#8203;正&#8203;規&#8203;化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/neologd/mecab-ipadic-neologd/wiki/Regexp.ja">neologdn</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://diatonic.codes/blog/neologdn/">【ライブラリ紹介】テキスト正規化ライブラリ neologdn</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tqdm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">計&#8203;算&#8203;の&#8203;進&#8203;捗&#8203;確&#8203;認</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://tqdm.github.io/">tqdm</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/pontyo4/items/76145cb10e030ad8186a">Qiita:tqdmでプログレスバーを表示させる</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IPython.display</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デー&#8203;タ&#8203;可&#8203;視&#8203;化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.display.html">Module: display &#8203;—&#8203; IPython 7.20.0 documentation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/alchemist/items/54b5768c964fd1eb6b54">Qiita:Jupyter Notebook&#8203;で&#8203;セ&#8203;ル&#8203;の&#8203;途&#8203;中&#8203;で&#8203;も&#8203;値&#8203;を&#8203;出&#8203;力&#8203;す&#8203;る&#8203;に&#8203;は&#8203;</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scattertext</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コー&#8203;パ&#8203;ス&#8203;可&#8203;視&#8203;化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/JasonKessler/scattertext">scattertext</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://ichi.pro/scattertext-no-kaishaku-tekisuto-o-purottosuru-tame-no-miwakuteki-na-tsu-ru-51217040558168">Scattertextの解釈：テキストをプロットするための魅惑的なツール</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wordcloud</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コー&#8203;パ&#8203;ス&#8203;可&#8203;視&#8203;化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://amueller.github.io/word_cloud/">WordCloud for Python documentation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/str32/items/4539e417a9cb333abd52">Qiita:wordcloudで遊んでみた！</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matplotlib</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デー&#8203;タ&#8203;の&#8203;可&#8203;視&#8203;化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://matplotlib.org/tutorials/index.html">matplotlib tutorials</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/skotaro/items/08dc0b8c5704c94eafb9">Qiita:早く知っておきたかったmatplotlibの基礎知識、あるいは見た目の調整が捗るArtistの話</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">japanize_matplotlib</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デー&#8203;タ&#8203;の&#8203;可&#8203;視&#8203;化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/uehara1414/japanize-matplotlib">japanize-matplotlib</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/uehara1414/items/6286590d2e1ffbf68f6c">pip install &#8203;し&#8203;て&#8203; import &#8203;す&#8203;る&#8203;だ&#8203;け&#8203;で&#8203; matplotlib &#8203;を&#8203;日&#8203;本&#8203;語&#8203;表&#8203;示&#8203;対&#8203;応&#8203;さ&#8203;せ&#8203;る&#8203;</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">seaborn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デー&#8203;タ&#8203;の&#8203;可&#8203;視&#8203;化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://seaborn.pydata.org/tutorial.html">User guide and tutorial</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/hik0107/items/3dc541158fceb3156ee0">Qiita:pythonで美しいグラフ描画 -seaborn&#8203;を&#8203;使&#8203;え&#8203;ば&#8203;デー&#8203;タ&#8203;分&#8203;析&#8203;と&#8203;可&#8203;視&#8203;化&#8203;が&#8203;捗&#8203;る&#8203; &#8203;そ&#8203;の&#8203;1</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gensim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コー&#8203;パ&#8203;ス&#8203;解&#8203;析</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://radimrehurek.com/gensim/auto_examples/index.html">Gensim topic modelling for humans</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openbook4.me/projects/193/sections/1154">openbook:データ解析: LDA&#8203;の&#8203;実&#8203;装&#8203;(gensim)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pyLDAvis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コー&#8203;パ&#8203;ス&#8203;可&#8203;視&#8203;化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://pyldavis.readthedocs.io/en/latest/">Welcome to pyLDAvis’&#8203;s documentation!</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.ie110704.net/2018/12/29/wordcloudとpyldavisによるldaの可視化について">WordCloudとpyLDAvisによるLDAの可視化について</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">torch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ニュー&#8203;ラ&#8203;ル&#8203;ネッ&#8203;ト&#8203;モ&#8203;デ&#8203;リ&#8203;ン&#8203;グ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://pytorch.org/docs/stable/index.html">PYTORCH DOCUMENTATION</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/north_redwing/items/30f9619f0ee727875250">Qiita:PyTorch入門 [&#8203;公&#8203;式&#8203;Tutorial:DEEP LEARNING WITH PYTORCH: A 60 MINUTE BLITZ&#8203;を&#8203;読&#8203;む&#8203;</a>]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transformers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">事&#8203;前&#8203;学&#8203;習&#8203;言&#8203;語&#8203;処&#8203;理&#8203;モ&#8203;デ&#8203;ル&#8203;利&#8203;用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://huggingface.co/transformers/">Transformers</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://note.com/npaka/n/n5bb043191cc9">note:Huggingface Transformers &#8203;入&#8203;門&#8203; (1) - &#8203;事&#8203;始&#8203;め&#8203;</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_notebook環境の構築">5.2.5. notebook環境の構築</h4>
<div class="paragraph">
<p><strong>&#8203;ファ&#8203;イ&#8203;ル&#8203;パ&#8203;ス&#8203;の&#8203;設&#8203;定&#8203;</strong></p>
</div>
<div class="paragraph">
<p>　notebook&#8203;実&#8203;行&#8203;時&#8203;に&#8203;使&#8203;用&#8203;す&#8203;る&#8203;ファ&#8203;イ&#8203;ル&#8203;パ&#8203;ス&#8203;を&#8203;設&#8203;定&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># colab環境で実行する場合</span>
<span class="keyword">if</span> <span class="string"><span class="delimiter">'</span><span class="content">google.colab</span><span class="delimiter">'</span></span> <span class="keyword">in</span> sys.modules:
    CONFIG = {
        <span class="string"><span class="delimiter">'</span><span class="content">base_path</span><span class="delimiter">'</span></span>: f<span class="string"><span class="delimiter">'</span><span class="content">{mount_dir}/MyDrive/JPX_competition/workspace</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">article_path</span><span class="delimiter">'</span></span>: f<span class="string"><span class="delimiter">'</span><span class="content">{mount_dir}/MyDrive/JPX_competition/data_dir_comp2/nikkei_article.csv.gz</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">stock_price_path</span><span class="delimiter">'</span></span>: f<span class="string"><span class="delimiter">'</span><span class="content">{mount_dir}/MyDrive/JPX_competition/data_dir_comp2/stock_price.csv.gz</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">stock_list_path</span><span class="delimiter">'</span></span>: f<span class="string"><span class="delimiter">'</span><span class="content">{mount_dir}/MyDrive/JPX_competition/data_dir_comp2/stock_list.csv.gz</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">dict_path</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">/usr/lib/x86_64-linux-gnu/mecab/dic/mecab-ipadic-neologd</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">font_path</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">/usr/share/fonts/truetype/fonts-japanese-gothic.ttf</span><span class="delimiter">'</span></span>,
    }
<span class="keyword">else</span>:
    CONFIG = {
        <span class="string"><span class="delimiter">'</span><span class="content">base_path</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">/notebook/workspace</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">article_path</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">/notebook/data_dir_comp2/nikkei_article.csv.gz</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">stock_price_path</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">/notebook/data_dir_comp2/stock_price.csv.gz</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">stock_list_path</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">/notebook/data_dir_comp2/stock_list.csv.gz</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">dict_path</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">/usr/lib/x86_64-linux-gnu/mecab/dic/mecab-ipadic-neologd</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">font_path</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">/usr/share/fonts/truetype/fonts-japanese-gothic.ttf</span><span class="delimiter">'</span></span>,
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;作&#8203;成&#8203;</strong></p>
</div>
<div class="paragraph">
<p>　&#8203;ア&#8203;ウ&#8203;ト&#8203;プッ&#8203;ト&#8203;さ&#8203;れ&#8203;た&#8203;実&#8203;行&#8203;結&#8203;果&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;保&#8203;存&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;作&#8203;成&#8203;し&#8203;て&#8203;お&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">for</span> store_dir <span class="keyword">in</span> [<span class="string"><span class="delimiter">'</span><span class="content">headline_features</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">keywords_features</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">visualizations</span><span class="delimiter">'</span></span>]:
    os.makedirs(os.path.join(CONFIG[<span class="string"><span class="delimiter">&quot;</span><span class="content">base_path</span><span class="delimiter">&quot;</span></span>], store_dir), exist_ok=<span class="predefined-constant">True</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="anchor-5.2.6">5.3. テキスト解析について</h3>
<div class="sect3">
<h4 id="_形態素解析トークナイズ">5.3.1. 形態素解析・トークナイズ</h4>
<div class="paragraph">
<p>　&#8203;自&#8203;然&#8203;言&#8203;語&#8203;処&#8203;理&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;コー&#8203;パ&#8203;ス&#8203;が&#8203;前&#8203;処&#8203;理&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;状&#8203;態&#8203;で&#8203;あ&#8203;る&#8203;場&#8203;合、&#8203;該&#8203;当&#8203;す&#8203;る&#8203;デー&#8203;タ&#8203;を&#8203;使&#8203;用&#8203;す&#8203;る&#8203;に&#8203;当&#8203;たっ&#8203;て&#8203;用&#8203;途&#8203;に&#8203;合&#8203;わ&#8203;せ&#8203;た&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。&#8203;トー&#8203;ク&#8203;ン&#8203;と&#8203;は&#8203;意&#8203;味&#8203;を&#8203;持&#8203;つ&#8203;文&#8203;字&#8203;列&#8203;で&#8203;あ&#8203;り、&#8203;主&#8203;に、&#8203;単&#8203;語&#8203;や&#8203;単&#8203;語&#8203;よ&#8203;り&#8203;小&#8203;さ&#8203;い&#8203;単&#8203;位&#8203;を&#8203;持&#8203;つ&#8203;形&#8203;態&#8203;素&#8203;と&#8203;い&#8203;う&#8203;も&#8203;の&#8203;が&#8203;該&#8203;当&#8203;し&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;を&#8203;予&#8203;め&#8203;決&#8203;め&#8203;た&#8203;基&#8203;準&#8203;の&#8203;トー&#8203;ク&#8203;ン&#8203;に&#8203;区&#8203;切&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;と&#8203;言&#8203;い&#8203;ま&#8203;す。&#8203;英&#8203;語&#8203;に&#8203;お&#8203;い&#8203;て&#8203;は、&#8203;ス&#8203;ペー&#8203;ス&#8203;を&#8203;単&#8203;語&#8203;と&#8203;単&#8203;語&#8203;の&#8203;区&#8203;切&#8203;り&#8203;と&#8203;み&#8203;な&#8203;す&#8203;こ&#8203;と&#8203;で&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;は&#8203;簡&#8203;単&#8203;に&#8203;行&#8203;え&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;句&#8203;読&#8203;点&#8203;を&#8203;用&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;文&#8203;章&#8203;と&#8203;文&#8203;章&#8203;を&#8203;区&#8203;切&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;し&#8203;か&#8203;し、&#8203;英&#8203;語&#8203;と&#8203;異&#8203;な&#8203;り&#8203;日&#8203;本&#8203;語&#8203;は&#8203;ス&#8203;ペー&#8203;ス&#8203;や&#8203;句&#8203;読&#8203;点&#8203;だ&#8203;け&#8203;で&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;を&#8203;行&#8203;う&#8203;こ&#8203;と&#8203;は&#8203;困&#8203;難&#8203;で&#8203;す&#8203;が、&#8203;python&#8203;で&#8203;は&#8203;MeCab&#8203;と&#8203;い&#8203;う&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;を&#8203;用&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;日&#8203;本&#8203;語&#8203;に&#8203;お&#8203;け&#8203;る&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;処&#8203;理&#8203;を&#8203;簡&#8203;単&#8203;に&#8203;行&#8203;う&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;MeCab&#8203;の&#8203;動&#8203;作&#8203;原&#8203;理&#8203;に&#8203;関&#8203;し&#8203;て&#8203;興&#8203;味&#8203;が&#8203;あ&#8203;る&#8203;方&#8203;は&#8203; <a href="https://techlife.cookpad.com/entry/2016/05/11/170000">こちら</a> &#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
</div>
<div class="sect3">
<h4 id="_テキスト解析に用いるtaggerの構築">5.3.2. テキスト解析に用いるtaggerの構築</h4>
<div class="paragraph">
<p>　MeCab&#8203;で&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;を&#8203;行&#8203;う&#8203;ク&#8203;ラ&#8203;ス&#8203;（トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ザ）&#8203;を&#8203;tagger&#8203;と&#8203;呼&#8203;び&#8203;ま&#8203;す。&#8203;MeCab&#8203;の&#8203;tagger&#8203;を&#8203;構&#8203;築&#8203;す&#8203;る&#8203;時&#8203;は、&#8203;そ&#8203;の&#8203;出&#8203;力&#8203;形&#8203;式&#8203;を&#8203;オ&#8203;プ&#8203;ショ&#8203;ン&#8203;と&#8203;し&#8203;て&#8203;渡&#8203;す&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;オ&#8203;プ&#8203;ショ&#8203;ン&#8203;に&#8203;は、&#8203;以&#8203;下&#8203;の&#8203;４&#8203;つ&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>-Ochasen：&#8203;ChaSen&#8203;互&#8203;換&#8203;形&#8203;式</p>
</li>
<li>
<p>-Owakati：&#8203;分&#8203;か&#8203;ち&#8203;書&#8203;き&#8203;の&#8203;み&#8203;を&#8203;出&#8203;力</p>
</li>
<li>
<p>-Oyomi：&#8203;読&#8203;み&#8203;の&#8203;み&#8203;（振&#8203;り&#8203;仮&#8203;名）&#8203;を&#8203;出&#8203;力</p>
</li>
<li>
<p>-Odump：&#8203;単&#8203;語&#8203;の&#8203;全&#8203;情&#8203;報&#8203;を&#8203;出&#8203;力</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>そ&#8203;の&#8203;中&#8203;で&#8203;も、&#8203;Owakati&#8203;と&#8203;Ochasen&#8203;の&#8203;2&#8203;つ&#8203;が&#8203;よ&#8203;く&#8203;使&#8203;用&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;Owakati&#8203;は&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;を&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;し、&#8203;空&#8203;白&#8203;で&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;を&#8203;トー&#8203;ク&#8203;ン&#8203;単&#8203;位&#8203;に&#8203;区&#8203;切&#8203;り&#8203;ま&#8203;す。&#8203;Ochasen&#8203;は&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;を&#8203;行&#8203;う&#8203;と&#8203;共&#8203;に、&#8203;トー&#8203;ク&#8203;ン&#8203;の&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;や&#8203;原&#8203;型、&#8203;活&#8203;用&#8203;型&#8203;な&#8203;ど&#8203;を&#8203;共&#8203;に&#8203;返&#8203;し&#8203;ま&#8203;す。&#8203;以&#8203;降&#8203;の&#8203;解&#8203;析&#8203;で&#8203;は、&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;tagger&#8203;を&#8203;使&#8203;用&#8203;し&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;各々&#8203;の&#8203;tagger&#8203;に&#8203;出&#8203;力&#8203;形&#8203;式&#8203;オ&#8203;プ&#8203;ショ&#8203;ン&#8203;を&#8203;引&#8203;数&#8203;と&#8203;し&#8203;て&#8203;設&#8203;定&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">owakati = MeCab.Tagger(f<span class="string"><span class="delimiter">&quot;</span><span class="content">-Owakati -d {CONFIG['dict_path']}</span><span class="delimiter">&quot;</span></span>)
ochasen = MeCab.Tagger(f<span class="string"><span class="delimiter">&quot;</span><span class="content">-Ochasen -d {CONFIG['dict_path']}</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># taggerのparseを使うことで、各々の機能を確認することができます。</span>
text = <span class="string"><span class="delimiter">'</span><span class="content">taggerの役割を確認してみます。</span><span class="delimiter">'</span></span>
print(<span class="string"><span class="delimiter">'</span><span class="content">owakati:</span><span class="char">\n</span><span class="delimiter">'</span></span> + owakati.parse(text))
print(<span class="string"><span class="delimiter">'</span><span class="content">ochasen:</span><span class="char">\n</span><span class="delimiter">'</span></span> + ochasen.parse(text))</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;の&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ、&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;の&#8203;取&#8203;得&#8203;に&#8203;成&#8203;功&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;確&#8203;認&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">owakati:
tagger の 役割 を 確認 し て み ます <span class="error">。</span>

ochasen:
tagger        タガー        tagger        名詞-固有名詞-一般
の        ノ        の        助詞-連体化
役割        ヤクワリ        役割        名詞-一般
を        ヲ        を        助詞-格助詞-一般
確認        カクニン        確認        名詞-サ変接続
し        シ        する        動詞-自立        サ変<span class="error">・</span>スル        連用形
て        テ        て        助詞-接続助詞
み        ミ        みる        動詞-非自立        一段        連用形
ます        マス        ます        助動詞        特殊<span class="error">・</span>マス        基本形
<span class="error">。</span>        <span class="error">。</span>        <span class="error">。</span>        記号-句点
EOS</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_本番提出用のクラス作成方法について">5.3.3. 本番提出用のクラス作成方法について</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;章&#8203;で&#8203;構&#8203;築&#8203;す&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203;記&#8203;述&#8203;が&#8203;と&#8203;て&#8203;も&#8203;長&#8203;い&#8203;た&#8203;め、&#8203;3&#8203;章&#8203;及&#8203;び&#8203;4&#8203;章&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;最&#8203;後&#8203;に&#8203;一&#8203;気&#8203;に&#8203;モ&#8203;デ&#8203;ル&#8203;提&#8203;出&#8203;用&#8203;の&#8203;ク&#8203;ラ&#8203;ス&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;の&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;段&#8203;階&#8203;的&#8203;に&#8203;モ&#8203;デ&#8203;ル&#8203;提&#8203;出&#8203;用&#8203;の&#8203;ク&#8203;ラ&#8203;ス&#8203;を&#8203;作&#8203;成&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。&#8203;ま&#8203;ず&#8203;は、&#8203;ベー&#8203;ス&#8203;と&#8203;な&#8203;る&#8203;基&#8203;底&#8203;ク&#8203;ラ&#8203;ス&#8203; <code>SentimentGenerator</code> &#8203;を&#8203;定&#8203;義&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">SentimentGenerator</span>(<span class="predefined">object</span>):
    <span class="comment"># 各々の変数に関しては、後述のチュートリアル内で説明します。</span>
    article_columns = <span class="predefined-constant">None</span>
    punctuation_replace_dict = <span class="predefined-constant">None</span>
    punctuation_remove_list = <span class="predefined-constant">None</span>
    device = <span class="predefined-constant">None</span>
    feature_extractor = <span class="predefined-constant">None</span>
    headline_feature_combiner_handler = <span class="predefined-constant">None</span>
    keywords_feature_combiner_handler = <span class="predefined-constant">None</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ニュースデータ処理の流れ">5.4. ニュースデータ処理の流れ</h3>
<div class="paragraph">
<p>本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は、&#8203;5&#8203;章&#8203;及&#8203;び&#8203;6&#8203;章&#8203;で&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;を&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;処&#8203;理&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter05/images/chapter03_flow_chart.shapex.png" alt="chapter03_flow_chart.shapex" width="60%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_利用するテキストデータについて">5.5. 利用するテキストデータについて</h3>
<div class="paragraph">
<p>　&#8203;本&#8203;節&#8203;で&#8203;は、&#8203;使&#8203;用&#8203;す&#8203;る&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;の&#8203;デー&#8203;タ&#8203;の&#8203;読&#8203;み&#8203;込&#8203;み&#8203;や&#8203;内&#8203;容&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;概&#8203;観&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_テキストデータの読み込み">5.5.1. テキストデータの読み込み</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;用&#8203;い&#8203;る&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み、&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">articles = pd.read_csv(CONFIG[<span class="string"><span class="delimiter">'</span><span class="content">article_path</span><span class="delimiter">'</span></span>])
display(articles.head(<span class="integer">3</span>))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_テキストデータの内容を概観">5.5.2. テキストデータの内容を概観</h4>
<div class="paragraph">
<p>　&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;の&#8203;構&#8203;成&#8203;を&#8203;把&#8203;握&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;各&#8203;column&#8203;の&#8203;ユ&#8203;ニー&#8203;ク&#8203;な&#8203;デー&#8203;タ&#8203;の&#8203;件&#8203;数&#8203;や&#8203;デー&#8203;タ&#8203;の&#8203;形&#8203;等&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203;読&#8203;み&#8203;込&#8203;ん&#8203;だ&#8203;デー&#8203;タ&#8203;に&#8203;関&#8203;し&#8203;て&#8203;細&#8203;か&#8203;く&#8203;そ&#8203;の&#8203;デー&#8203;タ&#8203;数&#8203;や&#8203;形&#8203;式&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;作&#8203;業&#8203;は&#8203;デー&#8203;タ&#8203;の&#8203;理&#8203;解&#8203;を&#8203;助&#8203;け&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># key: column, value: 重複を排除したデータ件数のdict型宣言</span>
n_unique = {}
<span class="keyword">for</span> column <span class="keyword">in</span> articles.columns:
    <span class="comment"># column毎の重複を排除したデータ件数をn_uniqueに追加する。</span>
    n_unique[column] = <span class="predefined">len</span>(articles[column].unique())

display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">Number of unique data</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)

<span class="comment"># n_uniqueをpd.Series形式に変換する。articles.dtypesよりcolumnごとのdtypeを取得</span>
<span class="comment"># これらをpd.concatによってテーブル形式に変換し、表示</span>
display(pd.concat([pd.Series(n_unique).rename(<span class="string"><span class="delimiter">'</span><span class="content">n_unique</span><span class="delimiter">'</span></span>), articles.dtypes.rename(<span class="string"><span class="delimiter">'</span><span class="content">dtype</span><span class="delimiter">'</span></span>)], axis=<span class="integer">1</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter05/images/1_4_unique_data.png" alt="1_4_unique_data" width="40%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;を&#8203;解&#8203;析&#8203;す&#8203;る&#8203;際、&#8203;そ&#8203;の&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;が&#8203;持&#8203;つ&#8203;意&#8203;味&#8203;を&#8203;考&#8203;慮&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;は、&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;を&#8203;単&#8203;な&#8203;る&#8203;文&#8203;字&#8203;列&#8203;の&#8203;集&#8203;合&#8203;と&#8203;見&#8203;な&#8203;す&#8203;の&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;よ&#8203;り&#8203;踏&#8203;み&#8203;込&#8203;ん&#8203;だ&#8203;前&#8203;処&#8203;理&#8203;が&#8203;必&#8203;要&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;を&#8203;単&#8203;な&#8203;る&#8203;文&#8203;字&#8203;コー&#8203;ド&#8203;（int&#8203;の&#8203;離&#8203;散&#8203;値）&#8203;の&#8203;集&#8203;合&#8203;と&#8203;見&#8203;做&#8203;し、&#8203;こ&#8203;れ&#8203;を&#8203;数&#8203;値&#8203;的&#8203;な&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;用&#8203;い&#8203;た&#8203;と&#8203;し&#8203;て&#8203;も、&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;の&#8203;意&#8203;味&#8203;的&#8203;な&#8203;解&#8203;析&#8203;は&#8203;不&#8203;可&#8203;能&#8203;で&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;場&#8203;合、&#8203;文&#8203;字&#8203;列&#8203;長&#8203;の&#8203;分&#8203;布&#8203;や&#8203;各&#8203;漢&#8203;字&#8203;の&#8203;出&#8203;現&#8203;頻&#8203;度&#8203;と&#8203;いっ&#8203;た&#8203;表&#8203;層&#8203;的&#8203;な&#8203;解&#8203;析&#8203;し&#8203;か&#8203;で&#8203;き&#8203;な&#8203;く&#8203;な&#8203;る&#8203;と&#8203;推&#8203;察&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は、&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;解&#8203;析&#8203;に&#8203;は&#8203;別&#8203;途&#8203;の&#8203;前&#8203;処&#8203;理&#8203;を&#8203;実&#8203;行&#8203;し、&#8203;モ&#8203;デ&#8203;リ&#8203;ン&#8203;グ&#8203;に&#8203;適&#8203;し&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;抽&#8203;出&#8203;し&#8203;ま&#8203;す。&#8203;（詳&#8203;細&#8203;は&#8203;5.7.6&#8203;節&#8203;に&#8203;て&#8203;説&#8203;明）</p>
</div>
<div class="paragraph">
<p>　&#8203;各&#8203;column&#8203;を&#8203;見&#8203;る&#8203;と、&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;の&#8203;単&#8203;純&#8203;な&#8203;id&#8203;番&#8203;号&#8203;を&#8203;含&#8203;む&#8203;`article_id` &#8203;と&#8203;時&#8203;刻&#8203;情&#8203;報&#8203;を&#8203;含&#8203;む&#8203;`publish_datetime` &#8203;を&#8203;除&#8203;け&#8203;ば、&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;内&#8203;で&#8203;利&#8203;用&#8203;で&#8203;き&#8203;そ&#8203;う&#8203;な&#8203;デー&#8203;タ&#8203;は&#8203; <code>headline</code>, <code>keywords</code>, <code>classifications</code>, <code>company_g.stock_code</code> &#8203;に&#8203;な&#8203;り&#8203;そ&#8203;う&#8203;で&#8203;す。&#8203;以&#8203;下&#8203;に&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;デー&#8203;タ&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;を&#8203;表&#8203;示&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 表示するcolumnを定義する。</span>
columns = [<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">classifications</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">company_g.stock_code</span><span class="delimiter">'</span></span>]
<span class="keyword">for</span> column <span class="keyword">in</span> columns:
    display_markdown(f<span class="string"><span class="delimiter">'</span><span class="content">#### {column}</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)

    <span class="comment"># 欠損値が含まれることがあるため、どちらかに欠損値が存在するデータを除去する。</span>
    <span class="comment"># 同様のindexを持つ5個のサンプルデータを表示。</span>
    display(articles[columns].dropna()[column].head(<span class="integer">5</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;と&#8203;お&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">headline
<span class="integer">10</span>                             ゴーン元会長<span class="error">、</span>周到な不意打ち出国<span class="error">　</span>司法批判の声明
<span class="integer">19</span>                                地銀が変わる<span class="error">、</span>始まったマニュアルなき大競争
<span class="integer">20</span>                                ＪＸＴＧ<span class="error">・</span>国際帝石<span class="error">、</span>ＵＡＥ新取引所に出資へ
<span class="integer">22</span>    元日付のこういうコラムは<span class="error">、</span>ふつうなら来し方行く末に思いをはせ<span class="error">、</span>まずは新年をことほぐものである...
<span class="integer">26</span>             Googleの最新AI<span class="error">、</span>読解力も人間超え<span class="error">　</span>驚異の学習法<span class="error">\</span>n超人間<span class="error">・</span>万能AI<span class="error">（</span>上<span class="error">）</span>
Name: headline, dtype: <span class="predefined">object</span>

keywords
<span class="integer">10</span>    カルロス<span class="error">・</span>ゴーン<span class="error">\</span>n日産自動車<span class="error">\</span>nグレッグ<span class="error">・</span>ケリー<span class="error">\</span>n弘中惇一郎<span class="error">\</span>nＭｕｓｉｃＴｅｌｅｖｉｓ...
<span class="integer">19</span>    金融検査マニュアル<span class="error">\</span>nマニュアル<span class="error">\</span>n笹原晶博<span class="error">\</span>n安田光春<span class="error">\</span>n金融機関<span class="error">\</span>n銀行<span class="error">\</span>n地方銀行<span class="error">\</span>n...
<span class="integer">20</span>    国際石油開発帝石<span class="error">\</span>nＩＣＥフューチャーズ<span class="error">・</span>アブダビ<span class="error">\</span>nＪＸＴＧホールディングス<span class="error">\</span>nアラブ首長...
<span class="integer">22</span>                春秋<span class="error">\</span>nカルロス<span class="error">・</span>ゴーン<span class="error">\</span>nコラム<span class="error">\</span>n来し方行く末<span class="error">\</span>n思い<span class="error">\</span>n日付<span class="error">\</span>n新年
<span class="integer">26</span>    中田敦<span class="error">\</span>nストックマーク<span class="error">\</span>nグーグル<span class="error">\</span>nＢＥＲＴ<span class="error">\</span>nＡＩ<span class="error">\</span>nＮＩＩ<span class="error">\</span>nロボット<span class="error">\</span>n言語モデル...
Name: keywords, dtype: <span class="predefined">object</span>

classifications
<span class="integer">10</span>    <span class="error">＄</span>絵写表記事<span class="error">\</span>nＴ<span class="error">７</span><span class="error">２</span><span class="error">０</span><span class="error">１</span><span class="error">\</span>nＰＤ<span class="error">２</span><span class="error">７</span><span class="error">１</span><span class="error">\</span>nＮ<span class="error">０</span><span class="error">０</span><span class="error">０</span><span class="error">１</span><span class="error">３</span><span class="error">５</span><span class="error">１</span><span class="error">\</span>nＮ<span class="error">０</span><span class="error">０</span><span class="error">４</span><span class="error">４</span><span class="error">３</span><span class="error">７</span><span class="error">１</span><span class="error">\</span>n<span class="error">＃</span>Ｗ<span class="error">５</span><span class="error">０</span>...
<span class="integer">19</span>    <span class="error">＄</span>絵写表記事<span class="error">\</span>nＴ<span class="error">８</span><span class="error">５</span><span class="error">２</span><span class="error">４</span><span class="error">\</span>nＰＤ<span class="error">４</span><span class="error">７</span><span class="error">３</span><span class="error">\</span>nＮ<span class="error">０</span><span class="error">０</span><span class="error">７</span><span class="error">０</span><span class="error">０</span><span class="error">１</span><span class="error">７</span><span class="error">\</span>nＮ<span class="error">０</span><span class="error">０</span><span class="error">７</span><span class="error">０</span><span class="error">０</span><span class="error">８</span><span class="error">７</span><span class="error">\</span>n<span class="error">＃</span>Ｗ<span class="error">２</span><span class="error">０</span>...
<span class="integer">20</span>    <span class="error">＄</span>絵写表記事<span class="error">\</span>nＴ<span class="error">１</span><span class="error">６</span><span class="error">０</span><span class="error">５</span><span class="error">\</span>nＴ<span class="error">５</span><span class="error">０</span><span class="error">２</span><span class="error">０</span><span class="error">\</span>nＰＤ<span class="error">３</span><span class="error">７</span><span class="error">２</span><span class="error">\</span>nＰＤ<span class="error">１</span><span class="error">１</span><span class="error">１</span><span class="error">\</span>nＮ<span class="error">０</span><span class="error">０</span><span class="error">３</span><span class="error">１</span><span class="error">２</span><span class="error">１</span><span class="error">７</span><span class="error">\</span>n...
<span class="integer">22</span>    <span class="error">「</span>春秋<span class="error">」</span><span class="error">\</span>n<span class="error">＊</span>春秋<span class="error">\</span>nＴ<span class="error">７</span><span class="error">２</span><span class="error">０</span><span class="error">１</span><span class="error">\</span>nＰＤ<span class="error">２</span><span class="error">７</span><span class="error">１</span><span class="error">\</span>nＮ<span class="error">０</span><span class="error">０</span><span class="error">０</span><span class="error">１</span><span class="error">３</span><span class="error">５</span><span class="error">１</span><span class="error">\</span>n<span class="error">＃</span>Ｗ<span class="error">５</span><span class="error">０</span><span class="error">３</span><span class="error">０</span><span class="error">５</span><span class="error">\</span>n<span class="error">＃</span>Ｗ...
<span class="integer">26</span>                       <span class="error">＄</span>絵写表記事<span class="error">\</span>nＴ<span class="error">９</span><span class="error">４</span><span class="error">３</span><span class="error">２</span><span class="error">\</span>nＰＤ<span class="error">６</span><span class="error">５</span><span class="error">１</span><span class="error">\</span>nＮ<span class="error">０</span><span class="error">０</span><span class="error">１</span><span class="error">５</span><span class="error">０</span><span class="error">０</span><span class="error">６</span>
Name: classifications, dtype: <span class="predefined">object</span>

company_g.stock_code
<span class="integer">10</span>          <span class="integer">7201</span>
<span class="integer">19</span>          <span class="integer">8524</span>
<span class="integer">20</span>    <span class="integer">1605</span><span class="error">\</span>n5020
<span class="integer">22</span>          <span class="integer">7201</span>
<span class="integer">26</span>          <span class="integer">9432</span>
Name: company_g.stock_code, dtype: <span class="predefined">object</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は、&#8203;ニュー&#8203;ス&#8203;の&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;そ&#8203;の&#8203;ニュー&#8203;ス&#8203;が&#8203;マー&#8203;ケッ&#8203;ト&#8203;に&#8203;対&#8203;し&#8203;て&#8203;持っ&#8203;て&#8203;い&#8203;る&#8203;潜&#8203;在&#8203;表&#8203;現&#8203;を&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;取&#8203;得&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;目&#8203;的&#8203;と&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;上&#8203;記&#8203;で&#8203;表&#8203;示&#8203;し&#8203;た&#8203;column&#8203;ご&#8203;と&#8203;の&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;を&#8203;見&#8203;る&#8203;と、&#8203;`headline` &#8203;の&#8203;デー&#8203;タ&#8203;は&#8203;ニュー&#8203;ス&#8203;の&#8203;要&#8203;約&#8203;内&#8203;容&#8203;で&#8203;あ&#8203;り、&#8203;こ&#8203;の&#8203;中&#8203;か&#8203;ら&#8203;潜&#8203;在&#8203;表&#8203;現&#8203;を&#8203;抽&#8203;出&#8203;で&#8203;き&#8203;そ&#8203;う&#8203;で&#8203;す。&#8203;ま&#8203;た、&#8203;`keywords` &#8203;も&#8203;ニュー&#8203;ス&#8203;が&#8203;持&#8203;つ&#8203;特&#8203;性&#8203;が&#8203;キー&#8203;ワー&#8203;ド&#8203;化&#8203;さ&#8203;れ&#8203;た&#8203;も&#8203;の&#8203;で&#8203;あ&#8203;り、&#8203;こ&#8203;の&#8203;中&#8203;か&#8203;ら&#8203;も&#8203;潜&#8203;在&#8203;表&#8203;現&#8203;を&#8203;抽&#8203;出&#8203;で&#8203;き&#8203;そ&#8203;う&#8203;で&#8203;す。&#8203;一&#8203;方&#8203;で、&#8203;`classifications` &#8203;は&#8203;`keywords` &#8203;と&#8203;同&#8203;様&#8203;に、&#8203;ニュー&#8203;ス&#8203;が&#8203;も&#8203;つ&#8203;特&#8203;性&#8203;を&#8203;表&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;こ&#8203;の&#8203;ま&#8203;ま&#8203;の&#8203;状&#8203;態&#8203;で&#8203;は&#8203;扱&#8203;い&#8203;に&#8203;く&#8203;く、&#8203;`keywords` &#8203;と&#8203;重&#8203;複&#8203;す&#8203;る&#8203;情&#8203;報&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;解&#8203;析&#8203;か&#8203;ら&#8203;は&#8203;省&#8203;き&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;ニュー&#8203;ス&#8203;と&#8203;株&#8203;式&#8203;銘&#8203;柄&#8203;を&#8203;紐&#8203;付&#8203;け&#8203;る&#8203;`company_g.stock_code` &#8203;は&#8203;有&#8203;力&#8203;そ&#8203;う&#8203;な&#8203;情&#8203;報&#8203;で&#8203;は&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;あ&#8203;く&#8203;ま&#8203;で&#8203;数&#8203;値&#8203;で&#8203;あ&#8203;り&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;解&#8203;析&#8203;の&#8203;観&#8203;点&#8203;で&#8203;は&#8203;適&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;せ&#8203;ん。&#8203;よっ&#8203;て、&#8203;`headline` &#8203;と&#8203;`keywords` &#8203;及&#8203;び&#8203;ニュー&#8203;ス&#8203;が&#8203;公&#8203;開&#8203;さ&#8203;れ&#8203;た&#8203;時&#8203;刻&#8203;を&#8203;表&#8203;す&#8203;`publish_datetime` &#8203;を&#8203;保&#8203;持&#8203;し、&#8203;他&#8203;の&#8203;デー&#8203;タ&#8203;は&#8203;以&#8203;下&#8203;の&#8203;手&#8203;順&#8203;で&#8203;取&#8203;り&#8203;除&#8203;い&#8203;て&#8203;お&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">articles = articles[[<span class="string"><span class="delimiter">'</span><span class="content">publish_datetime</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>]]

<span class="comment"># ニュース時刻をindexとしてセット</span>
articles = articles.set_index(<span class="string"><span class="delimiter">'</span><span class="content">publish_datetime</span><span class="delimiter">'</span></span>)

<span class="comment"># str形式のdatetimeをpd.Timestamp形式に変換</span>
articles.index = pd.to_datetime(articles.index)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_本番提出用のクラスへ組み込み">5.5.3. 本番提出用のクラスへ組み込み</h4>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;の&#8203;処&#8203;理&#8203;を&#8203;<code>load_articles</code>&#8203;関&#8203;数&#8203;と&#8203;し&#8203;て&#8203; <code>SentimentGenerator</code> &#8203;ク&#8203;ラ&#8203;ス&#8203;に&#8203;追&#8203;加&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 生データから使用するコラムを設定する</span>
SentimentGenerator.article_columns = [<span class="string"><span class="delimiter">'</span><span class="content">publish_datetime</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>]

<span class="comment"># 上記のコードを用いて、本番提出用のクラスにclassmethodを追加</span>
<span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">load_articles</span>(cls, path, start_dt=<span class="predefined-constant">None</span>, end_dt=<span class="predefined-constant">None</span>):
    <span class="comment"># csvをロードする</span>
    <span class="comment"># headline、keywordsをcolumnとして使用。publish_datetimeをindexとして使用。</span>
    articles =  pd.read_csv(path)[cls.article_columns].set_index(<span class="string"><span class="delimiter">'</span><span class="content">publish_datetime</span><span class="delimiter">'</span></span>)

    <span class="comment"># str形式のdatetimeをpd.Timestamp形式に変換</span>
    articles.index = pd.to_datetime(articles.index)

    <span class="comment"># 必要な場合、使用するデータの範囲を指定する</span>
    <span class="keyword">return</span> articles[start_dt:end_dt]


<span class="comment"># SentimentGeneratorに定義したclassmethodを追加する</span>
SentimentGenerator.load_articles = load_articles

<span class="comment"># SentimentGenerator使用する全体流れを記述</span>
articles = SentimentGenerator.load_articles(path=CONFIG[<span class="string"><span class="delimiter">&quot;</span><span class="content">article_path</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_データセットの前処理_2">5.6. データセットの前処理</h3>
<div class="paragraph">
<p>　&#8203;多&#8203;用&#8203;な&#8203;文&#8203;字、&#8203;記&#8203;号&#8203;が&#8203;存&#8203;在&#8203;す&#8203;る&#8203;日&#8203;本&#8203;語&#8203;の&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;解&#8203;析&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;前&#8203;処&#8203;理&#8203;は&#8203;非&#8203;常&#8203;に&#8203;重&#8203;要&#8203;な&#8203;処&#8203;理&#8203;で&#8203;す。&#8203;例&#8203;え&#8203;ば、&#8203;日&#8203;本&#8203;語&#8203;の&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;は、&#8203;半&#8203;角&#8203;文&#8203;字&#8203;と&#8203;全&#8203;角&#8203;文&#8203;字&#8203;が&#8203;混&#8203;在&#8203;し&#8203;て&#8203;使&#8203;わ&#8203;れ&#8203;る&#8203;場&#8203;合&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;同&#8203;じ&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;内&#8203;で&#8203;あっ&#8203;て&#8203;も、&#8203;同&#8203;じ&#8203;単&#8203;語&#8203;が&#8203;半&#8203;角&#8203;文&#8203;字&#8203;と&#8203;全&#8203;角&#8203;文&#8203;字&#8203;で&#8203;混&#8203;在&#8203;し&#8203;て&#8203;使&#8203;わ&#8203;れ&#8203;る&#8203;場&#8203;合、&#8203;人&#8203;は&#8203;そ&#8203;れ&#8203;ら&#8203;が&#8203;単&#8203;語&#8203;が&#8203;同&#8203;じ&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;認&#8203;識&#8203;で&#8203;き&#8203;ま&#8203;す&#8203;が、&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;お&#8203;い&#8203;て&#8203;は、&#8203;異&#8203;な&#8203;る&#8203;別&#8203;の&#8203;単&#8203;語&#8203;と&#8203;し&#8203;て&#8203;認&#8203;識&#8203;さ&#8203;れ&#8203;て&#8203;し&#8203;ま&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;さ&#8203;ら&#8203;に、&#8203;半&#8203;角&#8203;文&#8203;字&#8203;と&#8203;全&#8203;角&#8203;文&#8203;字&#8203;が&#8203;混&#8203;在&#8203;す&#8203;る&#8203;単&#8203;語&#8203;が、&#8203;学&#8203;習&#8203;時&#8203;に&#8203;観&#8203;察&#8203;し&#8203;て&#8203;い&#8203;な&#8203;い&#8203;単&#8203;語&#8203;(&#8203;未&#8203;知&#8203;語&#8203;, Out-of-Vocabulary&#8203;等&#8203;)&#8203;で&#8203;あ&#8203;る&#8203;場&#8203;合&#8203;に&#8203;は、&#8203;そ&#8203;の&#8203;意&#8203;味&#8203;は&#8203;失&#8203;わ&#8203;れ&#8203;て&#8203;し&#8203;ま&#8203;い、&#8203;結&#8203;果&#8203;と&#8203;し&#8203;て&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;全&#8203;体&#8203;の&#8203;意&#8203;味&#8203;が&#8203;崩&#8203;れ&#8203;る&#8203;可&#8203;能&#8203;性&#8203;も&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;問&#8203;題&#8203;を&#8203;防&#8203;止&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;前&#8203;処&#8203;理&#8203;と&#8203;し&#8203;て&#8203; <strong>&#8203;「テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;の&#8203;正&#8203;規&#8203;化」&#8203;</strong> &#8203;が&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;節&#8203;で&#8203;は、&#8203;使&#8203;用&#8203;す&#8203;る&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;が&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;文&#8203;字&#8203;や&#8203;記&#8203;号&#8203;で&#8203;構&#8203;成&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;て、&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;期&#8203;待&#8203;し&#8203;て&#8203;い&#8203;な&#8203;い&#8203;文&#8203;字&#8203;や&#8203;記&#8203;号&#8203;な&#8203;ど&#8203;を&#8203;含&#8203;ん&#8203;で&#8203;い&#8203;る&#8203;か&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203;更&#8203;に、&#8203;そ&#8203;れ&#8203;ら&#8203;の&#8203;期&#8203;待&#8203;し&#8203;て&#8203;い&#8203;な&#8203;い&#8203;情&#8203;報&#8203;に&#8203;対&#8203;し&#8203;て、&#8203;置&#8203;換&#8203;処&#8203;理&#8203;や&#8203;除&#8203;去&#8203;処&#8203;理&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;正&#8203;規&#8203;化&#8203;方&#8203;法&#8203;を&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;ま&#8203;た、&#8203;前&#8203;処&#8203;理&#8203;の&#8203;一&#8203;つ&#8203;と&#8203;し&#8203;て&#8203;欠&#8203;損&#8203;値&#8203;に&#8203;対&#8203;す&#8203;る&#8203;処&#8203;理&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;欠&#8203;損&#8203;値&#8203;の&#8203;確&#8203;認&#8203;は、&#8203;そ&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;理&#8203;解&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;基&#8203;本&#8203;的&#8203;な&#8203;作&#8203;業&#8203;で&#8203;す。&#8203;連&#8203;続&#8203;す&#8203;る&#8203;数&#8203;値&#8203;デー&#8203;タ&#8203;に&#8203;お&#8203;い&#8203;て&#8203;欠&#8203;損&#8203;値&#8203;が&#8203;存&#8203;在&#8203;す&#8203;る&#8203;場&#8203;合&#8203;は&#8203;補&#8203;正&#8203;や&#8203;補&#8203;完&#8203;を&#8203;行&#8203;う&#8203;こ&#8203;と&#8203;も&#8203;可&#8203;能&#8203;で&#8203;す&#8203;が、&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;は&#8203;各々&#8203;の&#8203;記&#8203;事&#8203;が&#8203;連&#8203;続&#8203;せ&#8203;ず、&#8203;独&#8203;立&#8203;し&#8203;た&#8203;内&#8203;容&#8203;を&#8203;含&#8203;ん&#8203;で&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;方&#8203;法&#8203;は&#8203;適&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;せ&#8203;ん。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は&#8203;headline&#8203;及&#8203;び&#8203;keywords&#8203;両&#8203;方&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;同&#8203;時&#8203;に&#8203;用&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;ど&#8203;ち&#8203;ら&#8203;か&#8203;片&#8203;方&#8203;に&#8203;欠&#8203;損&#8203;値&#8203;が&#8203;存&#8203;在&#8203;す&#8203;る&#8203;場&#8203;合&#8203;は&#8203;利&#8203;用&#8203;し&#8203;な&#8203;い&#8203;デー&#8203;タ&#8203;と&#8203;み&#8203;な&#8203;し&#8203;除&#8203;去&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_欠損値除去">5.6.1. 欠損値除去</h4>
<div class="paragraph">
<p>ま&#8203;ず&#8203;は、&#8203;欠&#8203;損&#8203;値&#8203;が&#8203;あ&#8203;る&#8203;か&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203;確&#8203;認&#8203;す&#8203;る&#8203;手&#8203;順&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">articles.isnull().any()</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">headline    <span class="predefined-constant">False</span>
keywords     <span class="predefined-constant">True</span>
dtype: <span class="predefined">bool</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;ど&#8203;ち&#8203;ら&#8203;か&#8203;に&#8203;欠&#8203;損&#8203;値&#8203;が&#8203;あ&#8203;る&#8203;場&#8203;合、&#8203;そ&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;除&#8203;去&#8203;す&#8203;る&#8203;処&#8203;理&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 欠損値を取り除く</span>
articles = articles.dropna()
articles.isnull().any()</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;欠&#8203;損&#8203;値&#8203;が&#8203;除&#8203;去&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">headline    <span class="predefined-constant">False</span>
keywords    <span class="predefined-constant">False</span>
dtype: <span class="predefined">bool</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_テキストデータの正規化">5.6.2. テキストデータの正規化</h4>
<div class="paragraph">
<p>　&#8203;次&#8203;に、&#8203;本&#8203;節&#8203;で&#8203;行&#8203;う&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;の&#8203;正&#8203;規&#8203;化&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;の&#8203;概&#8203;略&#8203;を&#8203;記&#8203;載&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;以&#8203;下&#8203;の&#8203;と&#8203;お&#8203;り&#8203; neologdn&#8203;正&#8203;規&#8203;化、&#8203;unicode&#8203;正&#8203;規&#8203;化、&#8203;マ&#8203;ニュ&#8203;ア&#8203;ル&#8203;処&#8203;理&#8203;の&#8203;3&#8203;つ&#8203;に&#8203;分&#8203;け&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="sect4">
<h5 id="_neologdn正規化">neologdn正規化</h5>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&#8203;正&#8203;規&#8203;化&#8203;前&#8203;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&#8203;正&#8203;規&#8203;化&#8203;後&#8203;</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">全&#8203;角&#8203;英&#8203;字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">半&#8203;角&#8203;英&#8203;字</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">全&#8203;角&#8203;数&#8203;字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">半&#8203;角&#8203;数&#8203;字</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">全&#8203;角&#8203;ス&#8203;ペー&#8203;ス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">半&#8203;角&#8203;ス&#8203;ペー&#8203;ス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">複&#8203;数&#8203;回&#8203;ス&#8203;ペー&#8203;ス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">単&#8203;一&#8203;ス&#8203;ペー&#8203;ス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">正&#8203;し&#8203;く&#8203;な&#8203;い&#8203;ス&#8203;ペー&#8203;ス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">除&#8203;去</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">半&#8203;角&#8203;カ&#8203;ナ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全&#8203;角&#8203;カ&#8203;ナ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">複&#8203;数&#8203;回&#8203;長&#8203;音&#8203;記&#8203;号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">単&#8203;一&#8203;長&#8203;音&#8203;記&#8203;号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">一&#8203;部&#8203;全&#8203;角&#8203;記&#8203;号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">半&#8203;角&#8203;記&#8203;号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">一&#8203;部&#8203;半&#8203;角&#8203;記&#8203;号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全&#8203;角&#8203;記&#8203;号</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_unicode正規化">unicode正規化</h5>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&#8203;正&#8203;規&#8203;化&#8203;前&#8203;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&#8203;正&#8203;規&#8203;化&#8203;後&#8203;</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">丸&#8203;囲&#8203;み&#8203;の&#8203;数&#8203;字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数&#8203;字</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ロー&#8203;マ&#8203;数&#8203;字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ア&#8203;ル&#8203;ファ&#8203;ベッ&#8203;ト&#8203;形&#8203;式</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">単&#8203;位</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ア&#8203;ル&#8203;ファ&#8203;ベッ&#8203;ト&#8203;や&#8203;日&#8203;本&#8203;語&#8203;形&#8203;式</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">省&#8203;略&#8203;文&#8203;字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記&#8203;号&#8203;及&#8203;び&#8203;日&#8203;本&#8203;語&#8203;形&#8203;式</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_マニュアル処理">マニュアル処理</h5>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&#8203;正&#8203;規&#8203;化&#8203;前&#8203;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&#8203;正&#8203;規&#8203;化&#8203;後&#8203;</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">一&#8203;部&#8203;第&#8203;一&#8203;水&#8203;準、&#8203;第&#8203;二&#8203;水&#8203;準&#8203;漢&#8203;字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JISx0208&#8203;に&#8203;存&#8203;在&#8203;す&#8203;る&#8203;漢&#8203;字&#8203;(<a href="https://ja.wikipedia.org/wiki/JIS_X_0208">Wikipedia: JIS X 0208</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">一&#8203;部&#8203;不&#8203;必&#8203;要&#8203;な&#8203;記&#8203;号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">除&#8203;去</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">一&#8203;部&#8203;乱&#8203;用&#8203;記&#8203;号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">置&#8203;換</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>neologdn&#8203;正&#8203;規&#8203;化&#8203;及&#8203;び、&#8203;unicode&#8203;正&#8203;規&#8203;化&#8203;に&#8203;関&#8203;し&#8203;て&#8203;は、&#8203;実&#8203;際&#8203;の&#8203;コー&#8203;ド&#8203;で&#8203;は&#8203;上&#8203;記&#8203;で&#8203;記&#8203;入&#8203;し&#8203;て&#8203;い&#8203;な&#8203;い&#8203;パ&#8203;ター&#8203;ン&#8203;に&#8203;関&#8203;し&#8203;て&#8203;も&#8203;正&#8203;規&#8203;化&#8203;を&#8203;行っ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;詳&#8203;細&#8203;や&#8203;関&#8203;連&#8203;リ&#8203;ン&#8203;ク&#8203;は&#8203;後&#8203;述&#8203;し&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_全角文字の確認">5.6.3. 全角文字の確認</h4>
<div class="paragraph">
<p>　&#8203;ま&#8203;ず&#8203;は&#8203;全&#8203;角&#8203;ス&#8203;ペー&#8203;ス、&#8203;全&#8203;角&#8203;ア&#8203;ル&#8203;ファ&#8203;ベッ&#8203;ト、&#8203;全&#8203;角&#8203;数&#8203;字&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203;な&#8203;お、&#8203;"\u3000"&#8203;は&#8203;全&#8203;角&#8203;ス&#8203;ペー&#8203;ス、&#8203;r"[Ａ-Ｚａ-ｚ]"&#8203;は&#8203;全&#8203;角&#8203;ア&#8203;ル&#8203;ファ&#8203;ベッ&#8203;ト&#8203;の&#8203;正&#8203;規&#8203;表&#8203;現、&#8203;r"[０-９]&#8203;は&#8203;全&#8203;角&#8203;数&#8203;字&#8203;の&#8203;正&#8203;規&#8203;表&#8203;現&#8203;を&#8203;表&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">for</span> column <span class="keyword">in</span> articles.columns:
    <span class="keyword">for</span> check_target <span class="keyword">in</span> [<span class="string"><span class="delimiter">&quot;</span><span class="char">\u3000</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="modifier">r</span><span class="delimiter">&quot;</span><span class="content">[Ａ-Ｚａ-ｚ]</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="modifier">r</span><span class="delimiter">&quot;</span><span class="content">[０-９]</span><span class="delimiter">&quot;</span></span>]:
        display(f<span class="string"><span class="delimiter">'</span><span class="content">Coulmn: {column}, Contains {check_target}: {articles[column].str.contains(check_target).any()}</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="string"><span class="delimiter">'</span><span class="content">Coulmn: headline, Contains </span><span class="char">\u3000</span><span class="content">: True</span><span class="delimiter">'</span></span>
<span class="string"><span class="delimiter">'</span><span class="content">Coulmn: headline, Contains [Ａ-Ｚａ-ｚ]: True</span><span class="delimiter">'</span></span>
<span class="string"><span class="delimiter">'</span><span class="content">Coulmn: headline, Contains [０-９]: True</span><span class="delimiter">'</span></span>
<span class="string"><span class="delimiter">'</span><span class="content">Coulmn: keywords, Contains </span><span class="char">\u3000</span><span class="content">: True</span><span class="delimiter">'</span></span>
<span class="string"><span class="delimiter">'</span><span class="content">Coulmn: keywords, Contains [Ａ-Ｚａ-ｚ]: True</span><span class="delimiter">'</span></span>
<span class="string"><span class="delimiter">'</span><span class="content">Coulmn: keywords, Contains [０-９]: True</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;全&#8203;角&#8203;ス&#8203;ペー&#8203;ス、&#8203;全&#8203;角&#8203;ア&#8203;ル&#8203;ファ&#8203;ベッ&#8203;ト、&#8203;全&#8203;角&#8203;数&#8203;字&#8203;全&#8203;て&#8203;が&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;の&#8203;コー&#8203;パ&#8203;ス&#8203;内&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;文&#8203;字・&#8203;記&#8203;号&#8203;を&#8203;含&#8203;む&#8203;例&#8203;を&#8203;出&#8203;力&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="sect4">
<h5 id="_全角スペースを持つケース">全角スペースを持つケース</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">display(articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>][articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>].str.contains(<span class="string"><span class="delimiter">'</span><span class="char">\u3000</span><span class="delimiter">'</span></span>)][<span class="integer">0</span>])
display(articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>][articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>].str.contains(<span class="string"><span class="delimiter">'</span><span class="char">\u3000</span><span class="delimiter">'</span></span>)][<span class="integer">0</span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="string"><span class="delimiter">'</span><span class="content">日米貿易協定が発効</span><span class="char">\u3000</span><span class="content">TPP土台に自由貿易圏拡大</span><span class="char">\n</span><span class="content">日本、RCEPに波及期待</span><span class="delimiter">'</span></span>
<span class="string"><span class="delimiter">'</span><span class="content">米ツアー</span><span class="char">\u3000</span><span class="content">ズームアップ</span><span class="char">\n</span><span class="content">アダム・スコット</span><span class="char">\n</span><span class="content">グレッグ・ノーマン</span><span class="char">\n</span><span class="content">コリン・モリカワ</span><span class="char">\n</span><span class="content">コリン・モンゴメリー</span><span class="char">\n</span><span class="content">ゴルファー</span><span class="char">\n</span><span class="content">ゴルフジャーナリスト</span><span class="char">\n</span><span class="content">ジム・マッケイブ</span><span class="char">\n</span><span class="content">ジャスティン・ローズ</span><span class="char">\n</span><span class="content">スティーブ・エルキントン</span><span class="char">\n</span><span class="content">スティーブ・ジョーンズ</span><span class="char">\n</span><span class="content">スティーブ・ストリッカー</span><span class="char">\n</span><span class="content">セルヒオ・ガルシア</span><span class="char">\n</span><span class="content">タイガー・ウッズ</span><span class="char">\n</span><span class="content">ダスティン・ジョンソン</span><span class="char">\n</span><span class="content">デービス・ラブ３世</span><span class="char">\n</span><span class="content">トム・リーマン</span><span class="char">\n</span><span class="content">トム・ワトソン</span><span class="char">\n</span><span class="content">ニック・ファルド</span><span class="char">\n</span><span class="content">バッバ・ワトソン</span><span class="char">\n</span><span class="content">ビクトル・ホブラン</span><span class="char">\n</span><span class="content">ビジェイ・シン</span><span class="char">\n</span><span class="content">フィル・ミケルソン</span><span class="char">\n</span><span class="content">フレッド・カプルス</span><span class="char">\n</span><span class="content">ブラッド・ファクソン</span><span class="char">\n</span><span class="content">ベルンハルト・ランガー</span><span class="char">\n</span><span class="content">ポール・ケーシー</span><span class="char">\n</span><span class="content">マシュー・ウォルフ</span><span class="char">\n</span><span class="content">マスターズ・トーナメント</span><span class="char">\n</span><span class="content">マット・クーチャー</span><span class="char">\n</span><span class="content">マーク・オメーラ</span><span class="char">\n</span><span class="content">マーク・マクナルティ</span><span class="char">\n</span><span class="content">世界トップ</span><span class="char">\n</span><span class="content">主流</span><span class="char">\n</span><span class="content">尾崎将司</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_全角アルファベットを持つケース">全角アルファベットを持つケース</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">display(articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>][articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>].str.contains(<span class="string"><span class="modifier">r</span><span class="delimiter">&quot;</span><span class="content">[Ａ-Ｚａ-ｚ]</span><span class="delimiter">&quot;</span></span>)][<span class="integer">0</span>])
display(articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>][articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>].str.contains(<span class="string"><span class="modifier">r</span><span class="delimiter">&quot;</span><span class="content">[Ａ-Ｚａ-ｚ]</span><span class="delimiter">&quot;</span></span>)][<span class="integer">0</span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="string"><span class="delimiter">'</span><span class="content">ＪＸＴＧ・国際帝石、ＵＡＥ新取引所に出資へ</span><span class="delimiter">'</span></span>
<span class="string"><span class="delimiter">'</span><span class="content">政府</span><span class="char">\n</span><span class="content">米国政府</span><span class="char">\n</span><span class="content">東アジア地域包括的経済連携</span><span class="char">\n</span><span class="content">ＴＰＰ</span><span class="char">\n</span><span class="content">安倍晋三</span><span class="char">\n</span><span class="content">貿易協定</span><span class="char">\n</span><span class="content">自由貿易</span><span class="char">\n</span><span class="content">貿易</span><span class="char">\n</span><span class="content">関税</span><span class="char">\n</span><span class="content">発効</span><span class="char">\n</span><span class="content">日米</span><span class="char">\n</span><span class="content">撤廃</span><span class="char">\n</span><span class="content">波及</span><span class="char">\n</span><span class="content">双方</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_全角数字を持つケース">全角数字を持つケース</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">display(articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>][articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>].str.contains(<span class="string"><span class="modifier">r</span><span class="delimiter">&quot;</span><span class="content">[０-９]</span><span class="delimiter">&quot;</span></span>)][<span class="integer">0</span>])
display(articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>][articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>].str.contains(<span class="string"><span class="modifier">r</span><span class="delimiter">&quot;</span><span class="content">[０-９]</span><span class="delimiter">&quot;</span></span>)][<span class="integer">0</span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="string"><span class="delimiter">'</span><span class="content">「雇用制度全般の見直しを」中西経団連会長</span><span class="char">\n</span><span class="content">経済３団体トップの年頭所感</span><span class="delimiter">'</span></span>
<span class="string"><span class="delimiter">'</span><span class="content">政府統計</span><span class="char">\n</span><span class="content">ダウ</span><span class="char">\n</span><span class="content">小幅高</span><span class="char">\n</span><span class="content">ダウ工業株３０種平均</span><span class="char">\n</span><span class="content">貿易協議</span><span class="char">\n</span><span class="content">株式市場</span><span class="char">\n</span><span class="content">米中</span><span class="char">\n</span><span class="content">米国株</span><span class="char">\n</span><span class="content">進展</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_neologdnを用いたテキストの正規化の挙動確認">5.6.4. neologdnを用いたテキストの正規化の挙動確認</h4>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;neologdn&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;先&#8203;程&#8203;確&#8203;認&#8203;し&#8203;た&#8203;全&#8203;角&#8203;ア&#8203;ル&#8203;ファ&#8203;ベッ&#8203;ト&#8203;や&#8203;全&#8203;角&#8203;数&#8203;字、&#8203;ま&#8203;た、&#8203;そ&#8203;の&#8203;他&#8203;の&#8203;半&#8203;角&#8203;カ&#8203;タ&#8203;カ&#8203;ナ&#8203;や&#8203;一&#8203;部&#8203;の&#8203;全&#8203;角&#8203;記&#8203;号&#8203;等&#8203;に&#8203;対&#8203;し&#8203;て&#8203;正&#8203;規&#8203;化&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。&#8203;neologdn&#8203;の&#8203;正&#8203;規&#8203;化&#8203;規&#8203;則&#8203;に&#8203;関&#8203;し&#8203;て&#8203;詳&#8203;し&#8203;い&#8203;情&#8203;報&#8203;が&#8203;必&#8203;要&#8203;な&#8203;場&#8203;合&#8203;は&#8203; <a href="https://github.com/neologd/mecab-ipadic-neologd/wiki/Regexp.ja">こちら</a> &#8203;を&#8203;参&#8203;照&#8203;し&#8203;て&#8203;下&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>　neologdn&#8203;を&#8203;用&#8203;い&#8203;た&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;正&#8203;規&#8203;化&#8203;の&#8203;挙&#8203;動&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;以&#8203;下&#8203;の&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;を&#8203;用&#8203;意&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">text = <span class="string"><span class="delimiter">'</span><span class="content">全角アルファベット:Ａ, 全角数字:０, 全角スペース:　, 半角カナ:ｱ</span><span class="delimiter">'</span></span>

<span class="comment"># 正規化前のテキストを確認</span>
display(text)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;正&#8203;規&#8203;化&#8203;前&#8203;の&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="string"><span class="delimiter">'</span><span class="content">全角アルファベット:Ａ, 全角数字:０, 全角スペース:</span><span class="char">\u3000</span><span class="content">, 半角カナ:ｱ</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　neologdn.normalize&#8203;関&#8203;数&#8203;を&#8203;用&#8203;い&#8203;て&#8203;よ&#8203;り&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;の&#8203;正&#8203;規&#8203;化&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 正規化後を確認</span>
display(neologdn.normalize(text))</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;全&#8203;角&#8203;ア&#8203;ル&#8203;ファ&#8203;ベッ&#8203;ト&#8203;が&#8203;半&#8203;角&#8203;ア&#8203;ル&#8203;ファ&#8203;ベッ&#8203;ト&#8203;に、&#8203;全&#8203;角&#8203;数&#8203;字&#8203;が&#8203;半&#8203;角&#8203;数&#8203;字&#8203;に、&#8203;全&#8203;角&#8203;ス&#8203;ペー&#8203;ス&#8203;が&#8203;半&#8203;角&#8203;ス&#8203;ペー&#8203;ス&#8203;に、&#8203;半&#8203;角&#8203;カ&#8203;タ&#8203;カ&#8203;ナ&#8203;が&#8203;全&#8203;角&#8203;カ&#8203;タ&#8203;カ&#8203;ナ&#8203;に&#8203;なっ&#8203;た&#8203;こ&#8203;と&#8203;が&#8203;確&#8203;認&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="string"><span class="delimiter">'</span><span class="content">全角アルファベット:A,全角数字:0,全角スペース: ,半角カナ:ア</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_neologdnを用いたテキストの正規化">5.6.5. neologdnを用いたテキストの正規化</h4>
<div class="paragraph">
<p>　neologdn&#8203;の&#8203;挙&#8203;動&#8203;が&#8203;確&#8203;認&#8203;で&#8203;き&#8203;ま&#8203;し&#8203;た&#8203;の&#8203;で、&#8203;neologdn&#8203;を&#8203;用&#8203;い&#8203;て&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;用&#8203;い&#8203;る&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;全&#8203;体&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;正&#8203;規&#8203;化&#8203;し&#8203;ま&#8203;す。&#8203;な&#8203;お、&#8203;正&#8203;規&#8203;化&#8203;に&#8203;あ&#8203;たっ&#8203;て&#8203;一&#8203;つ&#8203;注&#8203;意&#8203;す&#8203;べ&#8203;き&#8203;と&#8203;こ&#8203;ろ&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;今&#8203;回&#8203;使&#8203;用&#8203;し&#8203;て&#8203;い&#8203;る&#8203;`keywords` &#8203;の&#8203;デー&#8203;タ&#8203;は、&#8203;名&#8203;詞&#8203;で&#8203;構&#8203;成&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;単&#8203;語&#8203;が&#8203;半&#8203;角&#8203;ス&#8203;ペー&#8203;ス&#8203;で&#8203;区&#8203;切&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;場&#8203;合、&#8203;neologdn&#8203;の&#8203;仕&#8203;様&#8203;に&#8203;よ&#8203;り&#8203;正&#8203;規&#8203;化&#8203;を&#8203;行&#8203;う&#8203;こ&#8203;と&#8203;で、&#8203;半&#8203;角&#8203;ス&#8203;ペー&#8203;ス&#8203;が&#8203;全&#8203;て&#8203;除&#8203;去&#8203;さ&#8203;れ&#8203;て&#8203;し&#8203;ま&#8203;い、&#8203;各&#8203;keywords&#8203;が&#8203;一&#8203;つ&#8203;の&#8203;大&#8203;き&#8203;な&#8203;keywords&#8203;と&#8203;なっ&#8203;て&#8203;し&#8203;ま&#8203;い、&#8203;MeCab&#8203;に&#8203;よ&#8203;る&#8203;正&#8203;し&#8203;い&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;が&#8203;不&#8203;可&#8203;能&#8203;と&#8203;なっ&#8203;て&#8203;し&#8203;ま&#8203;い&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;半&#8203;角&#8203;ス&#8203;ペー&#8203;ス&#8203;の&#8203;情&#8203;報&#8203;が&#8203;失&#8203;わ&#8203;れ&#8203;な&#8203;い&#8203;よ&#8203;う&#8203;に、&#8203;一&#8203;度&#8203;半&#8203;角&#8203;ス&#8203;ペー&#8203;ス&#8203;を&#8203;全&#8203;て&#8203;改&#8203;行&#8203;コー&#8203;ド&#8203;に&#8203;書&#8203;き&#8203;換&#8203;え、&#8203;正&#8203;規&#8203;化&#8203;し&#8203;た&#8203;後&#8203;に&#8203;当&#8203;該&#8203;改&#8203;行&#8203;コー&#8203;ド&#8203;を&#8203;半&#8203;角&#8203;ス&#8203;ペー&#8203;ス&#8203;に&#8203;再&#8203;変&#8203;換&#8203;す&#8203;る&#8203;処&#8203;理&#8203;を&#8203;行&#8203;う&#8203;こ&#8203;と&#8203;で、&#8203;半&#8203;角&#8203;ス&#8203;ペー&#8203;ス&#8203;の&#8203;情&#8203;報&#8203;を&#8203;維&#8203;持&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;正&#8203;規&#8203;化&#8203;を&#8203;行っ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;MeCab&#8203;に&#8203;よ&#8203;る&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;の&#8203;際&#8203;に&#8203;は、&#8203;半&#8203;角&#8203;ス&#8203;ペー&#8203;ス&#8203;が&#8203;残っ&#8203;て&#8203;い&#8203;る&#8203;状&#8203;態&#8203;で&#8203;あっ&#8203;て&#8203;も、&#8203;半&#8203;角&#8203;ス&#8203;ペー&#8203;ス&#8203;の&#8203;情&#8203;報&#8203;は&#8203;除&#8203;去&#8203;さ&#8203;れ&#8203;る&#8203;た&#8203;め&#8203;問&#8203;題&#8203;あ&#8203;り&#8203;ま&#8203;せ&#8203;ん。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">for</span> column <span class="keyword">in</span> articles.columns:
    articles[column] = articles[column].apply(<span class="keyword">lambda</span> x: <span class="string"><span class="delimiter">'</span><span class="char">\n</span><span class="delimiter">'</span></span>.join(x.split()))

    <span class="comment"># neologdnを使って正規化を行う。</span>
    articles[column] = articles[column].apply(<span class="keyword">lambda</span> x: neologdn.normalize(x))

    <span class="comment"># 改行をスペースに置換する。</span>
    articles[column] = articles[column].str.replace(<span class="string"><span class="delimiter">'</span><span class="char">\n</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content"> </span><span class="delimiter">'</span></span>)

<span class="comment"># 変換後を確認する。</span>
display(articles.head(<span class="integer">5</span>))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_本番提出用のクラスへ組み込み_2">5.6.6. 本番提出用のクラスへ組み込み</h4>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;の&#8203;処&#8203;理&#8203;を&#8203;<code>normalize_articles</code>&#8203;関&#8203;数&#8203;と&#8203;し&#8203;て&#8203; <code>SentimentGenerator</code> &#8203;ク&#8203;ラ&#8203;ス&#8203;に&#8203;追&#8203;加&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 上記のコードを用いて、本番提出用のクラスにclassmethodを追加</span>
<span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">normalize_articles</span>(cls, articles):
    articles = articles.copy()

    <span class="comment"># 欠損値を取り除く</span>
    articles = articles.dropna()

    <span class="keyword">for</span> column <span class="keyword">in</span> articles.columns:
        <span class="comment"># スペース(全角スペースを含む)はneologdn正規化時に全て除去される。</span>
        <span class="comment"># ここでは、スペースの情報が失われないように、スペースを全て改行に書き換え、正規化後スペースに再変換する。</span>
        articles[column] = articles[column].apply(<span class="keyword">lambda</span> x: <span class="string"><span class="delimiter">'</span><span class="char">\n</span><span class="delimiter">'</span></span>.join(x.split()))

        <span class="comment"># neologdnを使って正規化を行う。</span>
        articles[column] = articles[column].apply(<span class="keyword">lambda</span> x: neologdn.normalize(x))

        <span class="comment"># 改行をスペースに置換する。</span>
        articles[column] = articles[column].str.replace(<span class="string"><span class="delimiter">'</span><span class="char">\n</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content"> </span><span class="delimiter">'</span></span>)

    <span class="keyword">return</span> articles

<span class="comment"># SentimentGeneratorに定義したclassmethodを追加する</span>
SentimentGenerator.normalize_articles = normalize_articles

<span class="comment"># SentimentGenerator使用する全体流れを記述</span>
articles = SentimentGenerator.load_articles(path=CONFIG[<span class="string"><span class="delimiter">&quot;</span><span class="content">article_path</span><span class="delimiter">&quot;</span></span>])
articles = SentimentGenerator.normalize_articles(articles)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_テキスト内の記号情報について">5.6.7. テキスト内の記号情報について</h4>
<div class="paragraph">
<p>　&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;内&#8203;で&#8203;記&#8203;号&#8203;が&#8203;使&#8203;わ&#8203;れ&#8203;る&#8203;場&#8203;合&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;希&#8203;少&#8203;な&#8203;記&#8203;号&#8203;や&#8203;正&#8203;し&#8203;く&#8203;な&#8203;い&#8203;記&#8203;号&#8203;の&#8203;使&#8203;い&#8203;方&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;を&#8203;理&#8203;解&#8203;す&#8203;る&#8203;上&#8203;で&#8203;ノ&#8203;イ&#8203;ズ&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;本&#8203;節&#8203;で&#8203;は、&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;る&#8203;記&#8203;号&#8203;を&#8203;取&#8203;得&#8203;し、&#8203;そ&#8203;れ&#8203;ら&#8203;の&#8203;記&#8203;号&#8203;が&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;使&#8203;わ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;意&#8203;味&#8203;が&#8203;薄&#8203;い&#8203;と&#8203;思&#8203;わ&#8203;れ&#8203;る&#8203;希&#8203;少&#8203;な&#8203;記&#8203;号&#8203;は&#8203;取&#8203;り&#8203;除&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;ま&#8203;ず、&#8203;記&#8203;号&#8203;の&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;ochasen&#8203;を&#8203;用&#8203;い&#8203;て&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;か&#8203;ら&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;す。&#8203;返&#8203;り&#8203;値&#8203;は&#8203;各々&#8203;以&#8203;下&#8203;を&#8203;表&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>表&#8203;層&#8203;形&#8203;: &#8203;単&#8203;語&#8203;そ&#8203;の&#8203;も&#8203;の</p>
</li>
<li>
<p>発&#8203;音&#8203;: &#8203;単&#8203;語&#8203;の&#8203;発&#8203;音</p>
</li>
<li>
<p>原&#8203;型&#8203;: &#8203;同&#8203;士&#8203;で&#8203;あ&#8203;れ&#8203;ば&#8203;変&#8203;化&#8203;す&#8203;る&#8203;前&#8203;の&#8203;原&#8203;形&#8203;, &#8203;他&#8203;の&#8203;品&#8203;詞&#8203;の&#8203;場&#8203;合&#8203;は&#8203;表&#8203;層&#8203;形&#8203;と&#8203;同&#8203;様</p>
</li>
<li>
<p>形&#8203;態&#8203;素&#8203;の&#8203;品&#8203;詞&#8203;型&#8203;: &#8203;形&#8203;態&#8203;素&#8203;は&#8203;言&#8203;語&#8203;学&#8203;の&#8203;用&#8203;語&#8203;で&#8203;意&#8203;味&#8203;を&#8203;も&#8203;つ&#8203;表&#8203;現&#8203;要&#8203;素&#8203;の&#8203;最&#8203;小&#8203;単&#8203;位&#8203;で&#8203;あ&#8203;り、&#8203;そ&#8203;の&#8203;形&#8203;態&#8203;素&#8203;を&#8203;文&#8203;法&#8203;的&#8203;な&#8203;働&#8203;き&#8203;ご&#8203;と&#8203;に&#8203;分&#8203;け&#8203;た&#8203;も&#8203;の</p>
</li>
<li>
<p>活&#8203;用&#8203;形&#8203;: &#8203;単&#8203;語&#8203;が&#8203;活&#8203;用&#8203;す&#8203;る&#8203;と&#8203;き&#8203;の&#8203;形</p>
</li>
<li>
<p>活&#8203;用&#8203;型&#8203;: &#8203;助&#8203;動&#8203;詞&#8203;の&#8203;活&#8203;用&#8203;を&#8203;い&#8203;く&#8203;つ&#8203;か&#8203;の&#8203;型&#8203;に&#8203;分&#8203;類&#8203;し&#8203;た&#8203;も&#8203;の</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">parse_by_ochasen</span>(tagger, text):
    <span class="comment"># Ochasenでmecab-ipadic-neologdの辞書を使ったときの、返り値のデータ順は以下となる。</span>
    columns = [<span class="string"><span class="delimiter">'</span><span class="content">表層形</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">発音</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">原型</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">形態素の品詞型</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">活用形</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">活用型</span><span class="delimiter">'</span></span>]

    <span class="comment"># Ochasenよりコーパスタグ付けを行う。</span>
    parsed = [item.split(<span class="string"><span class="delimiter">'</span><span class="char">\t</span><span class="delimiter">'</span></span>) <span class="keyword">for</span> item <span class="keyword">in</span> tagger.parse(text).split(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>) <span class="keyword">if</span> item <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string"><span class="delimiter">'</span><span class="content">EOS</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>)]
    <span class="keyword">return</span> pd.DataFrame(parsed, columns=columns)

text = <span class="string"><span class="delimiter">'</span><span class="content">テストテキストです。「記号を探してみます!」</span><span class="delimiter">'</span></span>
parsed = parse_by_ochasen(tagger=ochasen, text=text)
display(parsed)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;形&#8203;態&#8203;素&#8203;の&#8203;品&#8203;詞&#8203;型&#8203;に&#8203;お&#8203;け&#8203;る&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;と、&#8203;記&#8203;号&#8203;が&#8203;記&#8203;号&#8203;と&#8203;し&#8203;て&#8203;正&#8203;し&#8203;く&#8203;認&#8203;識&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter05/images/1_5_wordclasses.png" alt="1_5_wordclasses" width="50%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;次&#8203;に、&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;が&#8203;記&#8203;号&#8203;で&#8203;あ&#8203;る&#8203;全&#8203;て&#8203;の&#8203;記&#8203;号&#8203;を&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。&#8203;注&#8203;意&#8203;す&#8203;べ&#8203;き&#8203;点&#8203;と&#8203;し&#8203;て&#8203;は、&#8203;MeCab&#8203;で&#8203;は&#8203;記&#8203;号&#8203;の&#8203;一&#8203;部&#8203;を&#8203;「サ&#8203;変&#8203;接&#8203;続」&#8203;と&#8203;認&#8203;識&#8203;し&#8203;て&#8203;し&#8203;ま&#8203;う&#8203;こ&#8203;と&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;事&#8203;例&#8203;: <a href="https://blanktar.jp/blog/2013/06/mecab-misunderstand-symbol">MeCabさんが記号を「サ変接続」と認識してしまう</a></p>
</div>
<div class="paragraph">
<p>　&#8203;今&#8203;回&#8203;の&#8203;環&#8203;境&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;実&#8203;際&#8203;に&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;挙&#8203;動&#8203;は&#8203;確&#8203;認&#8203;で&#8203;き&#8203;て&#8203;い&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;念&#8203;の&#8203;為&#8203;「サ&#8203;変&#8203;接&#8203;続」&#8203;の&#8203;中&#8203;で、&#8203;「漢&#8203;字、&#8203;ひ&#8203;ら&#8203;が&#8203;な、&#8203;カ&#8203;タ&#8203;カ&#8203;ナ、&#8203;ア&#8203;ル&#8203;ファ&#8203;ベッ&#8203;ト」&#8203;を&#8203;含&#8203;ま&#8203;な&#8203;い&#8203;も&#8203;の&#8203;を&#8203;記&#8203;号&#8203;と&#8203;し&#8203;て&#8203;扱&#8203;う&#8203;こ&#8203;と&#8203;と&#8203;し&#8203;ま&#8203;す。&#8203;以&#8203;下&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;実&#8203;行&#8203;し&#8203;取&#8203;得&#8203;し&#8203;た&#8203;記&#8203;号&#8203;を&#8203;変&#8203;数&#8203;`punctuation` &#8203;と&#8203;し&#8203;て&#8203;扱&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 記号として扱う品詞型を定義し、以下のflagに該当する品詞型を持つものだけを取得する。</span>
flags = [<span class="string"><span class="delimiter">&quot;</span><span class="content">記号</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">サ変接続</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># ひらがな、カタカナ、漢字、アルファベットを含まない、記号を全て取得。</span>
punctuation_candidate = parsed[<span class="string"><span class="delimiter">'</span><span class="content">表層形</span><span class="delimiter">'</span></span>][parsed[<span class="string"><span class="delimiter">'</span><span class="content">形態素の品詞型</span><span class="delimiter">'</span></span>].apply(<span class="keyword">lambda</span> x: <span class="predefined">any</span>([flag <span class="keyword">in</span> x <span class="keyword">for</span> flag <span class="keyword">in</span> flags]))]

<span class="comment"># r&quot;[一-龯ぁ-んァ-ンA-Za-z々ゝゞヽヾヴヵヶ]は正規表現であり、「漢字、ひらがな、カタカナ、大文字アルファベット、小文字アルファベット、々ゝゞヽヾヴヵヶのいずれか」を表す。</span>
<span class="comment"># これらを含まないものを記号として扱う。</span>
punctuations = punctuation_candidate[~punctuation_candidate.str.contains(<span class="string"><span class="modifier">r</span><span class="delimiter">&quot;</span><span class="content">[一-龯ぁ-んァ-ンA-Za-z々ゝゞヽヾヴヵヶ]</span><span class="delimiter">&quot;</span></span>)]
punctuations = <span class="predefined">set</span>(punctuations)

display(punctuations)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">{<span class="string"><span class="delimiter">'</span><span class="content">!」</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">。</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">「</span><span class="delimiter">'</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;複&#8203;合&#8203;記&#8203;号&#8203;か&#8203;ら&#8203;単&#8203;一&#8203;記&#8203;号&#8203;を&#8203;抽&#8203;出&#8203;し、&#8203;集&#8203;合&#8203;に&#8203;追&#8203;加&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">for</span> punctuation <span class="keyword">in</span> punctuations:
    punctuations = punctuations | <span class="predefined">set</span>(punctuation)

display(<span class="predefined">set</span>(punctuations))</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">{<span class="string"><span class="delimiter">'</span><span class="content">!</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">!」</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">。</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">「</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">」</span><span class="delimiter">'</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;最&#8203;終&#8203;的&#8203;に&#8203;上&#8203;記&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;ま&#8203;と&#8203;め、&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;か&#8203;ら&#8203;記&#8203;号&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;関&#8203;数&#8203;を&#8203;作&#8203;成&#8203;し、&#8203;記&#8203;号&#8203;を&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">build_punctuations</span>(tagger, texts, flags = [<span class="string"><span class="delimiter">&quot;</span><span class="content">記号</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">サ変接続</span><span class="delimiter">&quot;</span></span>]):
    gc.collect()
    <span class="comment"># textsがpd.Seriesでない時に、pd.Seriesに変換</span>
    <span class="keyword">if</span> <span class="predefined">isinstance</span>(texts, pd.Series) <span class="keyword">is</span> <span class="predefined-constant">False</span>:
        texts = pd.Series(texts)

    punctuations = <span class="predefined">set</span>()

    <span class="keyword">for</span> text <span class="keyword">in</span> tqdm(texts):
        <span class="comment"># Ochasenより単語の品詞情報を取得</span>
        parsed = parse_by_ochasen(tagger=tagger, text=text)

        <span class="comment"># ひらがな、カタカナ、漢字、アルファベットを含まない、記号を全て取得</span>
        punctuation_candidate = parsed[<span class="string"><span class="delimiter">'</span><span class="content">表層形</span><span class="delimiter">'</span></span>][parsed[<span class="string"><span class="delimiter">'</span><span class="content">形態素の品詞型</span><span class="delimiter">'</span></span>].apply(<span class="keyword">lambda</span> x: <span class="predefined">any</span>([flag <span class="keyword">in</span> x.split(<span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>) <span class="keyword">for</span> flag <span class="keyword">in</span> flags]))]
        punctuation_candidate = punctuation_candidate[~punctuation_candidate.str.contains(<span class="string"><span class="modifier">r</span><span class="delimiter">&quot;</span><span class="content">[一-龯ぁ-んァ-ンA-Za-z々ゝゞヽヾヴヵヶ]</span><span class="delimiter">&quot;</span></span>)]
        punctuations = punctuations | <span class="predefined">set</span>(punctuation_candidate.tolist())

    <span class="comment"># 複合記号から単一記号を抽出</span>
    <span class="keyword">for</span> punctuation <span class="keyword">in</span> punctuations:
        punctuations = punctuations | <span class="predefined">set</span>(punctuation)

    <span class="keyword">return</span> punctuations

headline_punctuations = build_punctuations(tagger=ochasen, texts=articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>])
keywords_punctuations = build_punctuations(tagger=ochasen, texts=articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;記&#8203;号&#8203;を&#8203;含&#8203;む&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;の&#8203;例&#8203;を&#8203;表&#8203;示&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># headlineから、これら記号を含むテキストを表示</span>
<span class="keyword">for</span> punctuation <span class="keyword">in</span> <span class="predefined">sorted</span>(headline_punctuations, key=<span class="keyword">lambda</span> x: <span class="predefined">len</span>(x)):
    print(f<span class="string"><span class="delimiter">&quot;</span><span class="content">punctuation: {punctuation}</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>, articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>][articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>].apply(<span class="keyword">lambda</span> x: punctuation <span class="keyword">in</span> x)][<span class="integer">0</span>], <span class="string"><span class="delimiter">'</span><span class="char">\n</span><span class="delimiter">'</span></span>)

<span class="comment"># keywordsから、これら記号を含むテキストを表示</span>
<span class="keyword">for</span> punctuation <span class="keyword">in</span> <span class="predefined">sorted</span>(keywords_punctuations, key=<span class="keyword">lambda</span> x: <span class="predefined">len</span>(x)):
    print(f<span class="string"><span class="delimiter">&quot;</span><span class="content">punctuation: {punctuation}</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>, articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>][articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>].apply(<span class="keyword">lambda</span> x: punctuation <span class="keyword">in</span> x)][<span class="integer">0</span>], <span class="string"><span class="delimiter">'</span><span class="char">\n</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;記&#8203;号&#8203;や&#8203;漢&#8203;字&#8203;の&#8203;中&#8203;に&#8203;は、&#8203;パ&#8203;ソ&#8203;コ&#8203;ン&#8203;の&#8203;種&#8203;類&#8203;や&#8203;環&#8203;境&#8203;に&#8203;依&#8203;存&#8203;し、&#8203;異&#8203;な&#8203;る&#8203;環&#8203;境&#8203;で&#8203;表&#8203;示&#8203;さ&#8203;せ&#8203;た&#8203;場&#8203;合&#8203;に、&#8203;文&#8203;字&#8203;化&#8203;け&#8203;や&#8203;表&#8203;示&#8203;で&#8203;き&#8203;な&#8203;く&#8203;な&#8203;る&#8203;可&#8203;能&#8203;性&#8203;の&#8203;あ&#8203;る&#8203;文&#8203;字&#8203;「機&#8203;種&#8203;依&#8203;存&#8203;文&#8203;字」&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;機&#8203;種&#8203;依&#8203;存&#8203;文&#8203;字&#8203;の&#8203;中&#8203;で&#8203;記&#8203;号&#8203;の&#8203;多&#8203;く&#8203;は、&#8203;unicode&#8203;正&#8203;規&#8203;化&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;を&#8203;用&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;正&#8203;規&#8203;化&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;星&#8203;や&#8203;音&#8203;符&#8203;な&#8203;ど&#8203;の&#8203;あ&#8203;ま&#8203;り&#8203;意&#8203;味&#8203;を&#8203;持&#8203;た&#8203;な&#8203;い&#8203;記&#8203;号&#8203;は&#8203;取&#8203;り&#8203;除&#8203;き&#8203;ま&#8203;す。&#8203;一&#8203;部&#8203;の&#8203;括&#8203;弧&#8203;は、&#8203;見&#8203;栄&#8203;え&#8203;の&#8203;た&#8203;め&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;だ&#8203;け&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め&#8203;置&#8203;換&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;以&#8203;下&#8203;で&#8203;は、&#8203;置&#8203;換&#8203;す&#8203;る&#8203;ター&#8203;ゲッ&#8203;ト&#8203;と&#8203;除&#8203;去&#8203;す&#8203;る&#8203;ター&#8203;ゲッ&#8203;ト&#8203;を&#8203;定&#8203;義&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;機&#8203;種&#8203;依&#8203;存&#8203;文&#8203;字&#8203;の&#8203;第&#8203;一&#8203;水&#8203;準、&#8203;第&#8203;二&#8203;水&#8203;準&#8203;漢&#8203;字&#8203;に&#8203;関&#8203;し&#8203;て&#8203;は、&#8203;そ&#8203;の&#8203;数&#8203;が&#8203;膨&#8203;大&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;名&#8203;前&#8203;な&#8203;ど&#8203;に&#8203;多&#8203;く&#8203;使&#8203;わ&#8203;れ&#8203;る&#8203;一&#8203;部&#8203;の&#8203;漢&#8203;字&#8203;を&#8203;以&#8203;下&#8203;で&#8203;定&#8203;義&#8203;し、&#8203;置&#8203;換&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す&#8203;(&#8203;第&#8203;一&#8203;水&#8203;準&#8203;漢&#8203;字・&#8203;第&#8203;二&#8203;水&#8203;準&#8203;漢&#8203;字&#8203;は、&#8203;日&#8203;本&#8203;語&#8203;の&#8203;情&#8203;報&#8203;処&#8203;理&#8203;を&#8203;標&#8203;準&#8203;化&#8203;す&#8203;る&#8203;目&#8203;的&#8203;に&#8203;JIS&#8203;が&#8203;定&#8203;め&#8203;た&#8203;定&#8203;義&#8203;で&#8203;あ&#8203;り、&#8203;平&#8203;仮&#8203;名、&#8203;片&#8203;仮&#8203;名、&#8203;漢&#8203;字&#8203;な&#8203;ど&#8203;の&#8203;日&#8203;本&#8203;語&#8203;の&#8203;文&#8203;字&#8203;コー&#8203;ド&#8203;を&#8203;定&#8203;義&#8203;し&#8203;た&#8203;も&#8203;の&#8203;で&#8203;す&#8203;)。&#8203;置&#8203;換&#8203;す&#8203;る&#8203;漢&#8203;字&#8203;の&#8203;リ&#8203;ス&#8203;ト&#8203;は、&#8203; <a href="https://qiita.com/mindwood/items/3cc4fbf76caa38aa743c">コチラ</a> &#8203;か&#8203;ら&#8203;取&#8203;得&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 機種依存文字の第一水準、第二水準漢字に関しては一部の漢字を以下で定義し、置換を行う。</span>
JISx0208_replace_dict = {
    <span class="string"><span class="delimiter">'</span><span class="content">髙</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">高</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">﨑</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">崎</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">濵</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">浜</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">賴</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">頼</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">瀨</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">瀬</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">德</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">徳</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">蓜</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">配</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">昻</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">昂</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">桒</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">桑</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">栁</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">柳</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">犾</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">犹</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">琪</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">棋</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">裵</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">裴</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">魲</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">鱸</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">羽</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">羽</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">焏</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">丞</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">祥</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">祥</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">曻</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">昇</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">敎</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">教</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">澈</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">徹</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">曺</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">曹</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">黑</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">黒</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">塚</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">塚</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">閒</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">間</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">彅</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">薙</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">匤</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">匡</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">冝</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">宜</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">埇</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">甬</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">鮏</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">鮭</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">伹</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">但</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">杦</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">杉</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">罇</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">樽</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">柀</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">披</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">﨤</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">返</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">寬</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">寛</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">神</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">神</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">福</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">福</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">礼</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">礼</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">贒</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">賢</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">逸</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">逸</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">隆</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">隆</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">靑</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">青</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">飯</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">飯</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">飼</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">飼</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">緖</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">緒</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">埈</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">峻</span><span class="delimiter">&quot;</span></span>,
}

<span class="comment"># 取得したpunctuationの観察から、置換すべき記号のdictionaryを作成する。</span>
punctuation_replace_dict = {
    **JISx0208_replace_dict,
    <span class="string"><span class="delimiter">'</span><span class="content">《</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">〈</span><span class="delimiter">'</span></span>,
     <span class="string"><span class="delimiter">'</span><span class="content">》</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">〉</span><span class="delimiter">'</span></span>,
     <span class="string"><span class="delimiter">'</span><span class="content">『</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">「</span><span class="delimiter">'</span></span>,
     <span class="string"><span class="delimiter">'</span><span class="content">』</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">」</span><span class="delimiter">'</span></span>,
     <span class="string"><span class="delimiter">'</span><span class="content">“</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">&quot;</span><span class="delimiter">'</span></span>,
     <span class="string"><span class="delimiter">'</span><span class="content">!!</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">!</span><span class="delimiter">'</span></span>,
     <span class="string"><span class="delimiter">'</span><span class="content">〔</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">[</span><span class="delimiter">'</span></span>,
     <span class="string"><span class="delimiter">'</span><span class="content">〕</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">]</span><span class="delimiter">'</span></span>,
     <span class="string"><span class="delimiter">'</span><span class="content">χ</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>
}

<span class="comment"># 取得したpunctuationの観察から、あまり意味を持たない記号のリストを作成し、これらを下記のコードで取り除く。</span>
punctuation_remove_list = [<span class="string"><span class="delimiter">'</span><span class="content">|</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">■</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">◆</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">●</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">★</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">☆</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">♪</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">〃</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">△</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">○</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">□</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;置&#8203;換&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;定&#8203;義&#8203;し&#8203;た&#8203;機&#8203;種&#8203;依&#8203;存&#8203;文&#8203;字&#8203;の&#8203;第&#8203;一&#8203;水&#8203;準、&#8203;第&#8203;二&#8203;水&#8203;準&#8203;漢&#8203;字&#8203;が&#8203;デー&#8203;タ&#8203;の&#8203;中&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 観測された漢字をstoreするためのsetを定義</span>
catched_replace_targets = <span class="predefined">set</span>()
<span class="keyword">for</span> column <span class="keyword">in</span> articles.columns:
    display_markdown(f<span class="string"><span class="delimiter">'</span><span class="content">column: {column}</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)

    <span class="comment"># 定義した置換すべき漢字がデータに含まれているかをチェック</span>
    <span class="keyword">for</span> key <span class="keyword">in</span> JISx0208_replace_dict.keys():

        <span class="comment"># articles[column]にその漢字が含まれている場合、catched_replace_targetsに追加する。</span>
        <span class="keyword">if</span> articles[column].str.contains(key).any():
            catched_replace_targets.update(key)

    <span class="comment"># 観測された漢字のsetを表示する</span>
    display(catched_replace_targets)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;は&#8203;以&#8203;下&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;機&#8203;種&#8203;依&#8203;存&#8203;文&#8203;字&#8203;の&#8203;第&#8203;一&#8203;水&#8203;準、&#8203;第&#8203;二&#8203;水&#8203;準&#8203;漢&#8203;字&#8203;が&#8203;デー&#8203;タ&#8203;の&#8203;中&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">column: headline
{<span class="string"><span class="delimiter">'</span><span class="content">塚</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">彅</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">曺</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">礼</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">神</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">祥</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">福</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">羽</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">逸</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">隆</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">飯</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">飼</span><span class="delimiter">'</span></span>}

column: keywords
{<span class="string"><span class="delimiter">'</span><span class="content">塚</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">彅</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">德</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">曺</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">礼</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">神</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">祥</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">福</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">羽</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">逸</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">隆</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">飯</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">飼</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">髙</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">﨑</span><span class="delimiter">'</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;機&#8203;種&#8203;依&#8203;存&#8203;文&#8203;字&#8203;の&#8203;丸&#8203;囲&#8203;み&#8203;の&#8203;数&#8203;字、&#8203;ロー&#8203;マ&#8203;数&#8203;字、&#8203;単&#8203;位、&#8203;省&#8203;略&#8203;文&#8203;字&#8203;な&#8203;ど&#8203;は、&#8203;unicodedata&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;を&#8203;用&#8203;い&#8203;た&#8203;unicode&#8203;正&#8203;規&#8203;化&#8203;よ&#8203;り&#8203;置&#8203;換&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。&#8203;正&#8203;規&#8203;化&#8203;形&#8203;式&#8203;に&#8203;関&#8203;し&#8203;て&#8203;は&#8203;NFKC(Normalization Form Compatibility Composition)&#8203;を&#8203;用&#8203;い&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># unicodedata.normalize関数より、unicode正規化を行う。</span>
text = <span class="string"><span class="delimiter">'</span><span class="content">丸囲みの数字:①, ローマ数字:Ⅷ, 単位:㎜㍉, 省略文字:㈱</span><span class="delimiter">'</span></span>
unicodedata.normalize(<span class="string"><span class="delimiter">'</span><span class="content">NFKC</span><span class="delimiter">'</span></span>, text)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;と&#8203;な&#8203;り、&#8203;正&#8203;規&#8203;化&#8203;が&#8203;行&#8203;わ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="string"><span class="delimiter">'</span><span class="content">丸囲みの数字:1, ローマ数字:VIII, 単位:mmミリ, 省略文字:(株)</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;の&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;か&#8203;ら&#8203;記&#8203;号&#8203;の&#8203;置&#8203;換&#8203;及&#8203;び&#8203;除&#8203;去&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">for</span> column <span class="keyword">in</span> articles.columns:
    <span class="comment"># punctuation_remove_listに含まれる記号を除去する</span>
    articles[column] = articles[column].str.replace(fr<span class="string"><span class="delimiter">&quot;</span><span class="content">[{''.join(punctuation_remove_list)}]</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>)

    <span class="comment"># punctuation_replace_dictに含まれる記号を置換する</span>
    <span class="keyword">for</span> replace_base, replace_target <span class="keyword">in</span> punctuation_replace_dict.items():
        articles[column] = articles[column].str.replace(replace_base, replace_target)

    <span class="comment"># unicode正規化を行う</span>
    articles[column] = articles[column].apply(<span class="keyword">lambda</span> x: unicodedata.normalize(<span class="string"><span class="delimiter">'</span><span class="content">NFKC</span><span class="delimiter">'</span></span>, x))

<span class="comment"># 精製後確認</span>
articles.head(<span class="integer">10</span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_本番提出用のクラスへ組み込み_3">5.6.8. 本番提出用のクラスへ組み込み</h4>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;の&#8203;処&#8203;理&#8203;を&#8203;<code>handle_punctuations_in_articles</code>&#8203;関&#8203;数&#8203;と&#8203;し&#8203;て&#8203; <code>SentimentGenerator</code> &#8203;ク&#8203;ラ&#8203;ス&#8203;に&#8203;追&#8203;加&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 作成した記号置換用のdictと記号削除用のリストをhandle_punctuations_in_articles関数内で使用するため、SentimentGeneratorに追加</span>
SentimentGenerator.punctuation_remove_list = punctuation_remove_list
SentimentGenerator.punctuation_replace_dict = punctuation_replace_dict

<span class="comment"># 上記のコードを用いて、本番提出用のクラスにclassmethodを追加</span>
<span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">handle_punctuations_in_articles</span>(cls, articles):
    articles = articles.copy()

    <span class="keyword">for</span> column <span class="keyword">in</span> articles.columns:
        <span class="comment"># punctuation_remove_listに含まれる記号を除去する</span>
        articles[column] = articles[column].str.replace(fr<span class="string"><span class="delimiter">&quot;</span><span class="content">[{''.join(cls.punctuation_remove_list)}]</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>)

        <span class="comment"># punctuation_replace_dictに含まれる記号を置換する</span>
        <span class="keyword">for</span> replace_base, replace_target <span class="keyword">in</span> cls.punctuation_replace_dict.items():
            articles[column] = articles[column].str.replace(replace_base, replace_target)

        <span class="comment"># unicode正規化を行う</span>
        articles[column] = articles[column].apply(<span class="keyword">lambda</span> x: unicodedata.normalize(<span class="string"><span class="delimiter">'</span><span class="content">NFKC</span><span class="delimiter">'</span></span>, x))

    <span class="keyword">return</span> articles

<span class="comment"># SentimentGeneratorに定義したclassmethodを追加する</span>
SentimentGenerator.handle_punctuations_in_articles = handle_punctuations_in_articles

<span class="comment"># SentimentGenerator使用する全体流れを記述</span>
articles = SentimentGenerator.load_articles(path=CONFIG[<span class="string"><span class="delimiter">&quot;</span><span class="content">article_path</span><span class="delimiter">&quot;</span></span>])
articles = SentimentGenerator.normalize_articles(articles)
articles = SentimentGenerator.handle_punctuations_in_articles(articles)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_テキストデータの可視化">5.7. テキストデータの可視化</h3>
<div class="paragraph">
<p>　&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;の&#8203;解&#8203;析&#8203;及&#8203;び&#8203;可&#8203;視&#8203;化&#8203;は、&#8203;デー&#8203;タ&#8203;自&#8203;体&#8203;の&#8203;特&#8203;性&#8203;を&#8203;理&#8203;解&#8203;す&#8203;る&#8203;上&#8203;で&#8203;役&#8203;に&#8203;立&#8203;つ&#8203;だ&#8203;け&#8203;で&#8203;な&#8203;く、&#8203;期&#8203;待&#8203;し&#8203;て&#8203;い&#8203;な&#8203;い&#8203;情&#8203;報&#8203;も&#8203;含&#8203;ん&#8203;で&#8203;い&#8203;る&#8203;か&#8203;ど&#8203;う&#8203;か&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;上&#8203;で&#8203;も&#8203;役&#8203;立&#8203;ち&#8203;ま&#8203;す。&#8203;本&#8203;節&#8203;で&#8203;は、&#8203;扱&#8203;う&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;が&#8203;が&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;特&#8203;性&#8203;を&#8203;持っ&#8203;て&#8203;い&#8203;る&#8203;の&#8203;か&#8203;を、&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;や&#8203;単&#8203;語&#8203;の&#8203;頻&#8203;度&#8203;に&#8203;よ&#8203;り&#8203;解&#8203;析&#8203;及&#8203;び&#8203;可&#8203;視&#8203;化&#8203;し&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;そ&#8203;の&#8203;結&#8203;果&#8203;に&#8203;応&#8203;じ&#8203;た&#8203;前&#8203;処&#8203;理&#8203;を&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;に&#8203;実&#8203;施&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_品詞情報取得">5.7.1. 品詞情報取得</h4>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;か&#8203;ら&#8203;の&#8203;解&#8203;析&#8203;や&#8203;可&#8203;視&#8203;化&#8203;処&#8203;理&#8203;は&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;を&#8203;必&#8203;要&#8203;と&#8203;し&#8203;ま&#8203;す。&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;の&#8203;取&#8203;得&#8203;処&#8203;理&#8203;に&#8203;は&#8203;時&#8203;間&#8203;が&#8203;か&#8203;か&#8203;る&#8203;た&#8203;め、&#8203;あ&#8203;ら&#8203;か&#8203;じ&#8203;め&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;に&#8203;お&#8203;い&#8203;て&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># コーパス全体をochasenによってparseする。</span>
<span class="comment"># メモリー節約のため、解析で使用する['表層形', '形態素の品詞型']の情報のみを残す。</span>
parsed_headline_by_ochasen = articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>].apply(<span class="keyword">lambda</span> x: parse_by_ochasen(tagger=ochasen, text=x)[[<span class="string"><span class="delimiter">'</span><span class="content">表層形</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">形態素の品詞型</span><span class="delimiter">'</span></span>]])
parsed_keywords_by_ochasen = articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>].apply(<span class="keyword">lambda</span> x: parse_by_ochasen(tagger=ochasen, text=x)[[<span class="string"><span class="delimiter">'</span><span class="content">表層形</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">形態素の品詞型</span><span class="delimiter">'</span></span>]])

<span class="comment"># parseされたテキストデータを確認します。</span>
display(parsed_headline_by_ochasen.head())
display(parsed_keywords_by_ochasen.head())</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">publish_datetime
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">01</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>         表層形       形態素の品詞型
<span class="integer">0</span>      日  名詞-固有名詞-地域-国
...
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">01</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>      表層形     形態素の品詞型
<span class="integer">0</span>  人事       名詞-一般
<span class="integer">1</span>   <span class="error">、</span>     ...
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">01</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>       表層形     形態素の品詞型
<span class="integer">0</span>   人事       名詞-一般
<span class="integer">1</span>    <span class="error">、</span>  ...
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">01</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>         表層形     形態素の品詞型
<span class="integer">0</span>     人事       名詞-一般
<span class="integer">1</span>   ...
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">01</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>          表層形       形態素の品詞型
<span class="integer">0</span>       <span class="error">「</span>        記号-括弧...
Name: headline, dtype: <span class="predefined">object</span>

publish_datetime
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">01</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>                  表層形       形態素の品詞型
<span class="integer">0</span>             ...
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">01</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>                   表層形     形態素の品詞型
<span class="integer">0</span>  衆議院  名詞-固有名詞-組織
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">01</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>                   表層形     形態素の品詞型
<span class="integer">0</span>  外務省  名詞-固有名詞-組織
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">01</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>                 表層形     形態素の品詞型
<span class="integer">0</span>  厚生労働省  名詞-固有名詞-組織
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">01</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>              表層形        形態素の品詞型
<span class="integer">0</span>        中西宏明  名詞...
Name: keywords, dtype: <span class="predefined">object</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_品詞情報解析">5.7.2. 品詞情報解析</h4>
<div class="paragraph">
<p>　&#8203;ま&#8203;ず&#8203;は、&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;に&#8203;お&#8203;け&#8203;る&#8203;品&#8203;詞&#8203;の&#8203;分&#8203;布&#8203;を&#8203;解&#8203;析&#8203;し&#8203;ま&#8203;す。&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;の&#8203;品&#8203;詞&#8203;分&#8203;布&#8203;を&#8203;調&#8203;べ&#8203;る&#8203;前&#8203;に、&#8203;単&#8203;一&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;か&#8203;ら&#8203;品&#8203;詞&#8203;分&#8203;布&#8203;を&#8203;取&#8203;得&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">text = <span class="string"><span class="delimiter">'</span><span class="content">テストテキスト。コーパスの品詞情報を取得します。</span><span class="delimiter">'</span></span>

<span class="comment"># 品詞情報を取得するため、ochasenを用いる</span>
parsed = parse_by_ochasen(tagger=ochasen, text=text)
parsed[<span class="string"><span class="delimiter">'</span><span class="content">形態素の品詞型</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="integer">0</span>       名詞-サ変接続
<span class="integer">1</span>         名詞-一般
<span class="integer">2</span>         記号-句点
<span class="integer">3</span>         名詞-一般
<span class="integer">4</span>        助詞-連体化
<span class="integer">5</span>         名詞-一般
<span class="integer">6</span>         名詞-一般
<span class="integer">7</span>     助詞-格助詞-一般
<span class="integer">8</span>       名詞-サ変接続
<span class="integer">9</span>         動詞-自立
<span class="integer">10</span>          助動詞
<span class="integer">11</span>        記号-句点
Name: 形態素の品詞型, dtype: <span class="predefined">object</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;形&#8203;態&#8203;素&#8203;の&#8203;品&#8203;詞&#8203;型&#8203;は、&#8203;「名&#8203;詞&#8203; &#8203;サ&#8203;変&#8203;接&#8203;続」&#8203;な&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;多&#8203;重&#8203;の&#8203;ク&#8203;ラ&#8203;ス&#8203;と&#8203;し&#8203;て&#8203;成&#8203;り&#8203;立っ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;全&#8203;体&#8203;を&#8203;掴&#8203;む&#8203;た&#8203;め、&#8203;最&#8203;上&#8203;位&#8203;の&#8203;品&#8203;詞&#8203;型&#8203;の&#8203;み&#8203;（こ&#8203;の&#8203;場&#8203;合&#8203;名&#8203;詞&#8203;の&#8203;み）&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">word_classes = parsed[<span class="string"><span class="delimiter">'</span><span class="content">形態素の品詞型</span><span class="delimiter">'</span></span>].apply(<span class="keyword">lambda</span> x: x.split(<span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>)[<span class="integer">0</span>])
word_classes</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="integer">0</span>      名詞
<span class="integer">1</span>      名詞
<span class="integer">2</span>      記号
<span class="integer">3</span>      名詞
<span class="integer">4</span>      助詞
<span class="integer">5</span>      名詞
<span class="integer">6</span>      名詞
<span class="integer">7</span>      助詞
<span class="integer">8</span>      名詞
<span class="integer">9</span>      動詞
<span class="integer">10</span>    助動詞
<span class="integer">11</span>     記号
Name: 形態素の品詞型, dtype: <span class="predefined">object</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;上&#8203;で&#8203;観&#8203;察&#8203;さ&#8203;れ&#8203;た&#8203;品&#8203;詞&#8203;リ&#8203;ス&#8203;ト&#8203;か&#8203;ら、&#8203;品&#8203;詞&#8203;ご&#8203;と&#8203;の&#8203;数&#8203;を&#8203;カ&#8203;ウ&#8203;ン&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">word_classes.groupby(word_classes).count().to_dict()</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">{<span class="string"><span class="delimiter">'</span><span class="content">助動詞</span><span class="delimiter">'</span></span>: <span class="integer">1</span>, <span class="string"><span class="delimiter">'</span><span class="content">助詞</span><span class="delimiter">'</span></span>: <span class="integer">2</span>, <span class="string"><span class="delimiter">'</span><span class="content">動詞</span><span class="delimiter">'</span></span>: <span class="integer">1</span>, <span class="string"><span class="delimiter">'</span><span class="content">名詞</span><span class="delimiter">'</span></span>: <span class="integer">6</span>, <span class="string"><span class="delimiter">'</span><span class="content">記号</span><span class="delimiter">'</span></span>: <span class="integer">2</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;ご&#8203;と&#8203;に&#8203;品&#8203;詞&#8203;の&#8203;出&#8203;現&#8203;数&#8203;を&#8203;累&#8203;積&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;出&#8203;現&#8203;数&#8203;を&#8203;品&#8203;詞&#8203;ご&#8203;と&#8203;に&#8203;dict&#8203;型&#8203;で&#8203;管&#8203;理&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">count_of_word_classes = {}
<span class="comment"># key: 品詞型, value: カウント数</span>
<span class="keyword">for</span> key, value <span class="keyword">in</span> word_classes.groupby(word_classes).count().to_dict().items():
    <span class="comment"># 品詞が存在しない場合、新しく追加する。</span>
    <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> count_of_word_classes:
        count_of_word_classes[key] = value

    <span class="comment"># 品詞が存在する場合、既存のカウントに観察されたカウントを足す。</span>
    <span class="keyword">else</span>:
        count_of_word_classes[key] += value

<span class="comment"># 確認する</span>
count_of_word_classes</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">{<span class="string"><span class="delimiter">'</span><span class="content">助動詞</span><span class="delimiter">'</span></span>: <span class="integer">1</span>, <span class="string"><span class="delimiter">'</span><span class="content">助詞</span><span class="delimiter">'</span></span>: <span class="integer">2</span>, <span class="string"><span class="delimiter">'</span><span class="content">動詞</span><span class="delimiter">'</span></span>: <span class="integer">1</span>, <span class="string"><span class="delimiter">'</span><span class="content">名詞</span><span class="delimiter">'</span></span>: <span class="integer">6</span>, <span class="string"><span class="delimiter">'</span><span class="content">記号</span><span class="delimiter">'</span></span>: <span class="integer">2</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;上&#8203;記&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;コー&#8203;ド&#8203;を&#8203;ま&#8203;と&#8203;め&#8203;て、&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;か&#8203;ら&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;を&#8203;累&#8203;積&#8203;し&#8203;取&#8203;得&#8203;す&#8203;る&#8203;関&#8203;数&#8203;を&#8203;作&#8203;成&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;関&#8203;数&#8203;は&#8203;実&#8203;行&#8203;時&#8203;間&#8203;短&#8203;縮&#8203;の&#8203;た&#8203;め、&#8203;す&#8203;で&#8203;に&#8203;ochasen&#8203;よ&#8203;り&#8203;parse&#8203;さ&#8203;れ&#8203;た&#8203;情&#8203;報&#8203;を&#8203;入&#8203;力&#8203;と&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">get_count_of_word_classes</span>(parsed_by_ochasen):
    gc.collect()

    count_of_word_classes = {}

    <span class="keyword">for</span> parsed <span class="keyword">in</span> tqdm(parsed_by_ochasen):
        <span class="comment"># 一番大きいくくりの品詞型だけを取得する。</span>
        word_classes = parsed[<span class="string"><span class="delimiter">'</span><span class="content">形態素の品詞型</span><span class="delimiter">'</span></span>].apply(<span class="keyword">lambda</span> x: x.split(<span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>)[<span class="integer">0</span>])

        <span class="comment"># 単一テキストの品詞カウントをdictionaryにアップデート</span>
        <span class="comment"># key: 品詞型, value: カウント数</span>
        <span class="keyword">for</span> key, value <span class="keyword">in</span> word_classes.groupby(word_classes).count().to_dict().items():
            <span class="comment"># dictionaryに品詞が存在しない場合、新しく追加する。</span>
            <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> count_of_word_classes:
                count_of_word_classes[key] = value

            <span class="comment"># dictionaryに品詞が存在する場合、既存のカウントに観察されたカウントを足す。</span>
            <span class="keyword">else</span>:
                count_of_word_classes[key] += value

    <span class="keyword">return</span> pd.Series(count_of_word_classes).sort_values()

<span class="comment"># headline, keywords各々のコーパスから品詞情報を取得する。</span>
headline_count_of_word_classes = get_count_of_word_classes(parsed_by_ochasen=parsed_headline_by_ochasen)
keywords_count_of_word_classes = get_count_of_word_classes(parsed_by_ochasen=parsed_keywords_by_ochasen)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;そ&#8203;れ&#8203;で&#8203;は、&#8203;2&#8203;つ&#8203;の&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;集&#8203;合&#8203;（<code>headline</code> &#8203;及&#8203;び&#8203; <code>keywords</code> ）&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;品&#8203;詞&#8203;型&#8203;の&#8203;分&#8203;布&#8203;を&#8203;比&#8203;較&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;しょ&#8203;う。&#8203;2&#8203;つ&#8203;の&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;の&#8203;品&#8203;詞&#8203;ご&#8203;と&#8203;の&#8203;累&#8203;計&#8203;を&#8203;pd.concat&#8203;を&#8203;用&#8203;い&#8203;て&#8203;重&#8203;ね、&#8203;一&#8203;つ&#8203;の&#8203;テー&#8203;ブ&#8203;ル&#8203;に&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">count_of_word_classes_df = pd.concat([headline_count_of_word_classes.rename(<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>), keywords_count_of_word_classes.rename(<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>)], axis=<span class="integer">1</span>, sort=<span class="predefined-constant">True</span>)

<span class="comment"># 確認する</span>
count_of_word_classes_df</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter05/images/1_6_wordclass_counts.png" alt="1_6_wordclass_counts" width="30%">
</div>
</div>
<div class="paragraph">
<p>　&#8203;二&#8203;つ&#8203;の&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;の&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;の&#8203;分&#8203;布&#8203;を&#8203;比&#8203;較&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;全&#8203;体&#8203;の&#8203;単&#8203;語&#8203;数&#8203;で&#8203;各々&#8203;を&#8203;割&#8203;り、&#8203;品&#8203;詞&#8203;の&#8203;割&#8203;合&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">normalized_count_of_word_classes_df = count_of_word_classes_df / count_of_word_classes_df.sum()

<span class="comment"># 小数点6桁までで表示します。</span>
display(normalized_count_of_word_classes_df.applymap(<span class="string"><span class="delimiter">'</span><span class="content">{:,.6f}</span><span class="delimiter">'</span></span>.format))</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter05/images/1_6_wordclass_distributions.png" alt="1_6_wordclass_distributions" width="30%">
</div>
</div>
<div class="paragraph">
<p>　<code>headline</code> &#8203;と&#8203; <code>keywords</code> &#8203;の&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;の&#8203;分&#8203;布&#8203;か&#8203;ら、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;特&#8203;性&#8203;を&#8203;理&#8203;解&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;ま&#8203;ず、&#8203;keywords&#8203;は、&#8203;名&#8203;詞&#8203;の&#8203;割&#8203;合&#8203;が&#8203;高&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;keywords&#8203;の&#8203;名&#8203;前&#8203;の&#8203;通&#8203;り、&#8203;各&#8203;ニュー&#8203;ス&#8203;に&#8203;関&#8203;連&#8203;す&#8203;る&#8203;ト&#8203;ピッ&#8203;ク&#8203;の&#8203;名&#8203;詞&#8203;情&#8203;報&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;と&#8203;想&#8203;定&#8203;さ&#8203;れ&#8203;ま&#8203;す&#8203;が、&#8203;そ&#8203;の&#8203;他&#8203;の&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;も&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;少&#8203;か&#8203;ら&#8203;ず&#8203;文&#8203;章&#8203;構&#8203;造&#8203;に&#8203;近&#8203;い&#8203;キー&#8203;ワー&#8203;ド&#8203;も&#8203;入っ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;想&#8203;定&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;ま&#8203;た、&#8203;`headline` &#8203;は、&#8203;名&#8203;詞&#8203;以&#8203;外&#8203;に&#8203;も&#8203;助&#8203;詞、&#8203;動&#8203;詞&#8203;の&#8203;割&#8203;合&#8203;も&#8203;高&#8203;く、&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;が&#8203;文&#8203;章&#8203;構&#8203;造&#8203;を&#8203;持っ&#8203;て&#8203;い&#8203;る&#8203;と&#8203;想&#8203;定&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;正&#8203;規&#8203;化&#8203;し&#8203;た&#8203;上&#8203;で&#8203;も&#8203;記&#8203;号&#8203;が&#8203;か&#8203;な&#8203;り&#8203;多&#8203;く&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;必&#8203;要&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;さ&#8203;ら&#8203;に&#8203;記&#8203;号&#8203;に&#8203;対&#8203;す&#8203;る&#8203;正&#8203;規&#8203;化&#8203;や&#8203;除&#8203;去&#8203;を&#8203;行&#8203;う&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;際&#8203;は、&#8203;有&#8203;意&#8203;味&#8203;な&#8203;情&#8203;報&#8203;を&#8203;持&#8203;つ&#8203;記&#8203;号&#8203;を&#8203;除&#8203;去&#8203;し&#8203;な&#8203;い&#8203;よ&#8203;う&#8203;に&#8203;注&#8203;意&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;次&#8203;に、&#8203;上&#8203;で&#8203;表&#8203;示&#8203;し&#8203;た&#8203;テー&#8203;ブ&#8203;ル&#8203;か&#8203;ら&#8203;さ&#8203;ら&#8203;に&#8203;細&#8203;か&#8203;く&#8203;品&#8203;詞&#8203;分&#8203;布&#8203;の&#8203;違&#8203;い&#8203;を&#8203;理&#8203;解&#8203;す&#8203;る&#8203;た&#8203;め&#8203;可&#8203;視&#8203;化&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;す。&#8203;品&#8203;詞&#8203;毎&#8203;の&#8203;出&#8203;現&#8203;数&#8203;が&#8203;か&#8203;な&#8203;り&#8203;不&#8203;均&#8203;等&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;そ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;場&#8203;合&#8203;に&#8203;有&#8203;用&#8203;な&#8203;truncated barplot&#8203;を&#8203;用&#8203;い&#8203;て&#8203;可&#8203;視&#8203;化&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 上下切断表示のため、縦二つのaxesを用意する。</span>
fig, ax = plt.subplots(<span class="integer">2</span>, <span class="integer">1</span>, sharex=<span class="predefined-constant">True</span>, figsize=(<span class="integer">12</span>, <span class="integer">5</span>))

<span class="comment"># 上下両方のaxesに同様のプロットを行う。</span>
normalized_count_of_word_classes_df.sort_values(<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>).plot(kind=<span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>, ax=ax[<span class="integer">0</span>])
normalized_count_of_word_classes_df.sort_values(<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>).plot(kind=<span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>, ax=ax[<span class="integer">1</span>])

<span class="comment"># 上下両方のy軸範囲を設定する。</span>
ax[<span class="integer">0</span>].set_ylim((normalized_count_of_word_classes_df).max().max() - <span class="float">0.9</span>, <span class="integer">1</span>)
ax[<span class="integer">1</span>].set_ylim(<span class="integer">0</span>, <span class="float">0.03</span>)

<span class="comment"># 上のaxesでは、bottom部分表示(ticker, labelなど)、下のaxesでは、top部分表示を除去する。</span>
ax[<span class="integer">0</span>].spines[<span class="string"><span class="delimiter">'</span><span class="content">bottom</span><span class="delimiter">'</span></span>].set_visible(<span class="predefined-constant">False</span>)
ax[<span class="integer">1</span>].spines[<span class="string"><span class="delimiter">'</span><span class="content">top</span><span class="delimiter">'</span></span>].set_visible(<span class="predefined-constant">False</span>)

ax[<span class="integer">0</span>].xaxis.tick_top()
ax[<span class="integer">0</span>].tick_params(labeltop=<span class="predefined-constant">False</span>)
ax[<span class="integer">1</span>].xaxis.tick_bottom()

<span class="comment"># プロット切断部に点線表示を行う。</span>
d = <span class="float">0.01</span>
kwargs = <span class="predefined">dict</span>(transform=ax[<span class="integer">0</span>].transAxes, color=<span class="string"><span class="delimiter">'</span><span class="content">k</span><span class="delimiter">'</span></span>,linestyle=<span class="string"><span class="delimiter">'</span><span class="content">:</span><span class="delimiter">'</span></span>, lw=<span class="integer">1</span>, clip_on=<span class="predefined-constant">False</span>)
ax[<span class="integer">0</span>].plot((-d, <span class="integer">1</span>+d), (<span class="integer">0</span>, <span class="integer">0</span>), **kwargs)

kwargs.update(transform=ax[<span class="integer">1</span>].transAxes)
ax[<span class="integer">1</span>].plot((-d, <span class="integer">1</span>+d), (<span class="integer">1</span>, <span class="integer">1</span>), **kwargs)

<span class="comment"># 上のaxesだけにlegendを表示するため、下のaxesではlegendを除去する。</span>
ax[<span class="integer">1</span>].legend().remove()

plt.tight_layout()
plt.xticks(rotation=<span class="integer">0</span>)
plt.show()</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;`keywords` &#8203;は、&#8203;名&#8203;詞&#8203;の&#8203;割&#8203;合&#8203;が&#8203;高&#8203;い&#8203;こ&#8203;と&#8203;や、&#8203;`headline` &#8203;に&#8203;は&#8203;助&#8203;詞&#8203;と&#8203;同&#8203;じ&#8203;割&#8203;合&#8203;で&#8203;記&#8203;号&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter05/images/1_6_wordclass_visualization.png" alt="1_6_wordclass_visualization">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wordcloudによる可視化">5.7.3. wordcloudによる可視化</h4>
<div class="paragraph">
<p>　&#8203;単&#8203;一&#8203;テ&#8203;キ&#8203;ス&#8203;ト、&#8203;も&#8203;し&#8203;く&#8203;は&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;を&#8203;可&#8203;視&#8203;化&#8203;す&#8203;る&#8203;主&#8203;な&#8203;手&#8203;法&#8203;と&#8203;し&#8203;て、&#8203;そ&#8203;の&#8203;コー&#8203;パ&#8203;ス&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;る&#8203;単&#8203;語&#8203;や&#8203;形&#8203;態&#8203;素&#8203;の&#8203;頻&#8203;度&#8203;を&#8203;可&#8203;視&#8203;化&#8203;す&#8203;る&#8203;方&#8203;法&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203; &#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;そ&#8203;の&#8203;代&#8203;表&#8203;的&#8203;な&#8203;手&#8203;法&#8203;で&#8203;あ&#8203;る&#8203;wordcloud&#8203;を&#8203;用&#8203;い&#8203;た&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;に&#8203;お&#8203;け&#8203;る&#8203;単&#8203;語&#8203;の&#8203;頻&#8203;度&#8203;情&#8203;報&#8203;の&#8203;可&#8203;視&#8203;化&#8203;を&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;単&#8203;語&#8203;の&#8203;可&#8203;視&#8203;化&#8203;を&#8203;行&#8203;う&#8203;前&#8203;に、&#8203;分&#8203;析&#8203;の&#8203;ノ&#8203;イ&#8203;ズ&#8203;と&#8203;な&#8203;る&#8203;*stopwords*(&#8203;ど&#8203;の&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;に&#8203;お&#8203;い&#8203;て&#8203;も&#8203;多&#8203;く&#8203;登&#8203;場&#8203;し、&#8203;特&#8203;に&#8203;重&#8203;要&#8203;な&#8203;意&#8203;味&#8203;を&#8203;持&#8203;た&#8203;な&#8203;い&#8203;も&#8203;の&#8203;)&#8203;を&#8203;取&#8203;得&#8203;し、&#8203;そ&#8203;れ&#8203;ら&#8203;を&#8203;排&#8203;除&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;解&#8203;析&#8203;で&#8203;は、&#8203;名&#8203;詞、&#8203;動&#8203;詞、&#8203;形&#8203;容&#8203;詞、&#8203;副&#8203;詞&#8203;以&#8203;外&#8203;を&#8203;stopwords&#8203;と&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;な&#8203;お、&#8203;名&#8203;詞&#8203;で&#8203;も&#8203;数&#8203;値&#8203;の&#8203;情&#8203;報&#8203;を&#8203;含&#8203;む&#8203;場&#8203;合&#8203;は&#8203;stopwords&#8203;と&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;前&#8203;節&#8203;で&#8203;記&#8203;号&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;た&#8203;め&#8203;用&#8203;い&#8203;た、&#8203;build_punctuations&#8203;関&#8203;数&#8203;を&#8203;少&#8203;し&#8203;変&#8203;更&#8203;し、&#8203;stopwords&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;コー&#8203;ド&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。&#8203;お&#8203;お&#8203;よ&#8203;そ&#8203;の&#8203;コー&#8203;ド&#8203;は&#8203;同&#8203;様&#8203;で&#8203;す&#8203;が、&#8203;大&#8203;き&#8203;な&#8203;違&#8203;い&#8203;は、&#8203;skip_flags&#8203;で&#8203;取&#8203;得&#8203;す&#8203;る&#8203;品&#8203;詞&#8203;型&#8203;を&#8203;定&#8203;義&#8203;す&#8203;る&#8203;だ&#8203;け&#8203;で&#8203;な&#8203;く、&#8203;non_skip_flags&#8203;に&#8203;よ&#8203;り&#8203;取&#8203;得&#8203;し&#8203;な&#8203;い&#8203;品&#8203;詞&#8203;型&#8203;（数&#8203;値）&#8203;を&#8203;定&#8203;義&#8203;す&#8203;る&#8203;処&#8203;理&#8203;を&#8203;追&#8203;加&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;は、&#8203;名&#8203;詞&#8203;の&#8203;品&#8203;詞&#8203;型&#8203;を&#8203;持&#8203;つ&#8203;も&#8203;の&#8203;の&#8203;中&#8203;で、&#8203;数&#8203;値&#8203;の&#8203;品&#8203;詞&#8203;型&#8203;を&#8203;持&#8203;つ&#8203;も&#8203;の&#8203;を&#8203;取&#8203;り&#8203;除&#8203;く&#8203;た&#8203;め&#8203;に&#8203;追&#8203;加&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;な&#8203;お、&#8203;こ&#8203;ち&#8203;ら&#8203;の&#8203;コー&#8203;ド&#8203;に&#8203;関&#8203;し&#8203;て&#8203;も、&#8203;実&#8203;行&#8203;時&#8203;間&#8203;短&#8203;縮&#8203;の&#8203;た&#8203;め&#8203;に&#8203;す&#8203;で&#8203;に&#8203;ochasen&#8203;よ&#8203;り&#8203;parse&#8203;さ&#8203;れ&#8203;た&#8203;情&#8203;報&#8203;を&#8203;用&#8203;い&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">build_stopwords</span>(parsed_by_ochasen, non_skip_flags=[<span class="string"><span class="delimiter">&quot;</span><span class="content">数</span><span class="delimiter">&quot;</span></span>], skip_flags = [<span class="string"><span class="delimiter">&quot;</span><span class="content">名詞</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">動詞</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">形容詞</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">副詞</span><span class="delimiter">&quot;</span></span>]):
    gc.collect()
    stopwords = <span class="predefined">set</span>()

    <span class="keyword">for</span> parsed <span class="keyword">in</span> tqdm(parsed_by_ochasen):
        <span class="comment"># non_skip_flagsが入っているものは全てstopwordsとして扱う</span>
        <span class="comment"># それ以外において、skip_flagsをひとつでも含んでいないものをstopwordsとして扱う</span>
        mask_include_non_skip_flags = parsed[<span class="string"><span class="delimiter">'</span><span class="content">形態素の品詞型</span><span class="delimiter">'</span></span>].apply(<span class="keyword">lambda</span> x: <span class="predefined">any</span>([non_skip_flag <span class="keyword">in</span> x.split(<span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>) <span class="keyword">for</span> non_skip_flag <span class="keyword">in</span> non_skip_flags]))
        mask_exclude_skip_flags = parsed[<span class="string"><span class="delimiter">'</span><span class="content">形態素の品詞型</span><span class="delimiter">'</span></span>].apply(<span class="keyword">lambda</span> x: <span class="keyword">not</span> <span class="predefined">any</span>([skip_flag <span class="keyword">in</span> x.split(<span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>) <span class="keyword">for</span> skip_flag <span class="keyword">in</span> skip_flags]))

        <span class="comment">#日、月、年度のようなユニット情報を含むものは全てstopwordsとして扱う</span>
        mask_include_unit_info = parsed[<span class="string"><span class="delimiter">'</span><span class="content">表層形</span><span class="delimiter">'</span></span>].apply(<span class="keyword">lambda</span> x: <span class="predefined-constant">False</span> <span class="keyword">if</span> re.fullmatch(<span class="string"><span class="modifier">r</span><span class="delimiter">'</span><span class="content">\d</span><span class="content">+(秒|分|時|日|月|カ月|年|人|ドル|円)</span><span class="delimiter">'</span></span>, x) <span class="keyword">is</span> <span class="predefined-constant">None</span> <span class="keyword">else</span> <span class="predefined-constant">True</span>)

        stopword_candidate = parsed[<span class="string"><span class="delimiter">'</span><span class="content">表層形</span><span class="delimiter">'</span></span>][mask_include_non_skip_flags | mask_exclude_skip_flags | mask_include_unit_info]

        <span class="comment"># stopwordsセットにアップデートする。</span>
        stopwords = stopwords | <span class="predefined">set</span>(stopword_candidate.tolist())

    <span class="comment"># 追加的に単一アルファベットをstopwordsとして追加する</span>
    stopwords = stopwords | <span class="predefined">set</span>(string.ascii_lowercase) | <span class="predefined">set</span>(string.ascii_uppercase)

    <span class="comment"># 追加的に単一数字をstopwordsとして追加する</span>
    stopwords = stopwords | <span class="predefined">set</span>([<span class="predefined">str</span>(idx) <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="predefined">range</span>(<span class="integer">10</span>)])

    <span class="keyword">return</span> stopwords

<span class="comment"># headline, keywords各々のコーパスからsubwordsを取得する。</span>
headline_stopwords = build_stopwords(parsed_by_ochasen=parsed_headline_by_ochasen)
keywords_stopwords = build_stopwords(parsed_by_ochasen=parsed_keywords_by_ochasen)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　<code>headline</code> , <code>keywords</code> &#8203;の&#8203;各々&#8203;か&#8203;ら&#8203;取&#8203;得&#8203;し&#8203;た&#8203;stopwords&#8203;の&#8203;集&#8203;合&#8203;を&#8203;組&#8203;み&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">stopwords = headline_stopwords | keywords_stopwords

<span class="comment"># 表示するためにリストに変換する。</span>
stopwords_list = <span class="predefined">sorted</span>(stopwords)

<span class="comment"># 異なる特性を持つ色んなstopwordsを表示するためランダムにシャッフルする。</span>
random.Random(<span class="integer">0</span>).shuffle(stopwords_list)
print(stopwords_list[:<span class="integer">50</span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">[<span class="string"><span class="delimiter">'</span><span class="content">9302</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">243</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">456ドル</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">あれ</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">2678</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">259人</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">182ドル</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">3395円</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">554</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">9985</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1775</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">100200</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">510円</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">2430円</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">4918</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1114</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1日</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">7038</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">向</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">963</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">9771円</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">450ドル</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">39日</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">7068</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">5カ月</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">5168</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1001</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">11分</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">18年</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1931</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">123</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1834</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">4925円</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">8分</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">454ドル</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">4788</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">181人</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">3097</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">280</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">3580円</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">259円</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">6156</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">138ドル</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">4347</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">402</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">8240</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">417</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">6600</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;単&#8203;語&#8203;の&#8203;頻&#8203;度&#8203;可&#8203;視&#8203;化&#8203;方&#8203;法&#8203;の&#8203;1&#8203;つ&#8203;と&#8203;し&#8203;て&#8203;wordcloud&#8203;と&#8203;い&#8203;う&#8203;も&#8203;の&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;方&#8203;法&#8203;は、&#8203;頻&#8203;度&#8203;順&#8203;に&#8203;字&#8203;の&#8203;大&#8203;き&#8203;さ&#8203;が&#8203;異&#8203;な&#8203;る&#8203;等、&#8203;全&#8203;体&#8203;の&#8203;傾&#8203;向&#8203;を&#8203;直&#8203;感&#8203;的&#8203;に&#8203;把&#8203;握&#8203;し&#8203;や&#8203;す&#8203;い&#8203;長&#8203;所&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;逆&#8203;に&#8203;そ&#8203;れ&#8203;以&#8203;上&#8203;の&#8203;知&#8203;見&#8203;を&#8203;な&#8203;か&#8203;な&#8203;か&#8203;得&#8203;ら&#8203;れ&#8203;な&#8203;い&#8203;と&#8203;い&#8203;う&#8203;短&#8203;所&#8203;も&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　wordcould&#8203;へ&#8203;の&#8203;入&#8203;力&#8203;は、&#8203;単&#8203;語&#8203;が&#8203;ス&#8203;ペー&#8203;ス&#8203;で&#8203;区&#8203;切&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;で&#8203;す。&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;全&#8203;体&#8203;を&#8203;入&#8203;力&#8203;と&#8203;す&#8203;る&#8203;に&#8203;は、&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;全&#8203;体&#8203;が&#8203;各々&#8203;単&#8203;語&#8203;に&#8203;ス&#8203;ペー&#8203;ス&#8203;で&#8203;区&#8203;切&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め&#8203;文&#8203;と&#8203;文&#8203;を&#8203;区&#8203;切&#8203;る&#8203;改&#8203;行&#8203;等&#8203;を&#8203;削&#8203;除&#8203;し&#8203;ス&#8203;ペー&#8203;ス&#8203;で&#8203;区&#8203;切&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;具&#8203;体&#8203;的&#8203;に&#8203;は、&#8203;owakati&#8203;を&#8203;用&#8203;い&#8203;て&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;を&#8203;parse&#8203;し、&#8203;単&#8203;語&#8203;を&#8203;ス&#8203;ペー&#8203;ス&#8203;で&#8203;区&#8203;切&#8203;り、&#8203;そ&#8203;の&#8203;後&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;毎&#8203;に&#8203;ス&#8203;ペー&#8203;ス&#8203;で&#8203;繋&#8203;げ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">tagger = owakati

words_with_space = articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>].apply(<span class="keyword">lambda</span> x: tagger.parse(x).strip(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>).rstrip())
words_with_space = <span class="string"><span class="delimiter">'</span><span class="content"> </span><span class="delimiter">'</span></span>.join(words_with_space)

<span class="comment"># 確認する</span>
print(words_with_space[:<span class="integer">200</span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;期&#8203;待&#8203;通&#8203;り&#8203;の&#8203;結&#8203;果&#8203;に&#8203;なっ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">日 米 貿易協定 が 発効 TPP 土台 に 自由貿易 圏 拡大 日本 <span class="error">、</span> RCEP に 波及 期待 人事 <span class="error">、</span> 衆院 人事 <span class="error">、</span> 外務省 人事 <span class="error">、</span> 厚生労働省 <span class="error">「</span> 雇用 制度 全般 の 見直し を <span class="error">」</span> 中西 経団連会長 経済3団体 トップ の 年頭 所感 首相 <span class="error">「</span> 全世代 安心 の 社会保障 へ 改革 <span class="error">」</span> 年頭 所感 天皇陛下 の 年頭 所感 全文 <span class="error">「</span> 災害 が ない <span class="integer">1</span>年 に <span class="error">」</span> 陛下 <span class="error">、</span> 新年</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;上&#8203;記&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;ま&#8203;と&#8203;め、&#8203;wordcloud&#8203;を&#8203;可&#8203;視&#8203;化&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;関&#8203;数&#8203;を&#8203;定&#8203;義&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;stopwords&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;る&#8203;単&#8203;語&#8203;は&#8203;表&#8203;示&#8203;対&#8203;象&#8203;か&#8203;ら&#8203;除&#8203;外&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">display_wordcloud</span>(tagger, texts, stopwords, collocations):
    <span class="comment"># textsがpd.Seriesでない時に、pd.Seriesに変換</span>
    <span class="keyword">if</span> <span class="predefined">isinstance</span>(texts, pd.Series) <span class="keyword">is</span> <span class="predefined-constant">False</span>:
        texts = pd.Series(texts)

    <span class="comment"># テキストは単語別にスペースで区切りされ、テキストごとはスペースでつながっていることが期待値</span>
    words_with_space = texts.apply(<span class="keyword">lambda</span> x: tagger.parse(x).strip(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>).rstrip())
    words_with_space = <span class="string"><span class="delimiter">'</span><span class="content"> </span><span class="delimiter">'</span></span>.join(words_with_space)

    <span class="comment"># wordcloudを表示するため、パラメータを渡しインスタンス化する。</span>
    <span class="comment"># collocations=Falseの場合、連語による重複単語が表示されない。</span>
    wordcloud = WordCloud(
        background_color=<span class="string"><span class="delimiter">&quot;</span><span class="content">white</span><span class="delimiter">&quot;</span></span>,
        font_path=CONFIG[<span class="string"><span class="delimiter">'</span><span class="content">font_path</span><span class="delimiter">'</span></span>],
        stopwords=stopwords,
        width=<span class="integer">2000</span>,
        height=<span class="integer">1000</span>,
        collocations=collocations,
        random_state=<span class="integer">0</span>,
    ).generate(words_with_space)

    <span class="comment"># 表示サイズを設定し、表示する。</span>
    fig, ax = plt.subplots(<span class="integer">1</span>, <span class="integer">1</span>, figsize=(<span class="integer">16</span>, <span class="integer">8</span>))
    ax.imshow(wordcloud, interpolation=<span class="string"><span class="delimiter">&quot;</span><span class="content">bilinear</span><span class="delimiter">&quot;</span></span>)
    plt.axis(<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span>)
    plt.show()</code></pre>
</div>
</div>
<div class="paragraph">
<p>上&#8203;記&#8203;関&#8203;数&#8203;を&#8203;用&#8203;い&#8203;て&#8203; <code>headline</code> &#8203;及&#8203;び&#8203; <code>keywords</code> &#8203;の&#8203;各々&#8203;の&#8203;コー&#8203;パ&#8203;ス&#8203;の&#8203;頻&#8203;度&#8203;を&#8203;可&#8203;視&#8203;化&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># headlineのwordcloud表示</span>
display_wordcloud(tagger=owakati, texts=articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>], stopwords=stopwords, collocations=<span class="predefined-constant">False</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　headline&#8203;の&#8203;wordcloud&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter05/images/1_6_headline_wordcloud.png" alt="1_6_headline_wordcloud">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># keywordsのwordcloud表示</span>
display_wordcloud(tagger=owakati, texts=articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>], stopwords=stopwords, collocations=<span class="predefined-constant">False</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　keywords&#8203;の&#8203;wordcloud&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter05/images/1_6_keywords_wordcloud.png" alt="1_6_keywords_wordcloud">
</div>
</div>
<div class="paragraph">
<p>　&#8203;以&#8203;上&#8203;の&#8203;結&#8203;果&#8203;か&#8203;ら、&#8203;以&#8203;下&#8203;の&#8203;こ&#8203;と&#8203;が&#8203;観&#8203;察&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>headline&#8203;に&#8203;「人&#8203;事」&#8203;や&#8203;「発&#8203;売」、&#8203;「コ&#8203;ロ&#8203;ナ」、&#8203;「米」&#8203;と&#8203;い&#8203;う&#8203;単&#8203;語&#8203;が&#8203;多&#8203;く&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</li>
<li>
<p>keywords&#8203;に&#8203;は&#8203;「新&#8203;型」&#8203;や&#8203;「日」、&#8203;「発&#8203;表」&#8203;と&#8203;い&#8203;う&#8203;単&#8203;語&#8203;が&#8203;多&#8203;く&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</li>
<li>
<p>「東&#8203;証」&#8203;や&#8203;「株&#8203;式&#8203;市&#8203;場」&#8203;な&#8203;ど&#8203;マー&#8203;ケッ&#8203;ト&#8203;関&#8203;連&#8203;の&#8203;単&#8203;語&#8203;が&#8203;双&#8203;方&#8203;に&#8203;多&#8203;く&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</li>
<li>
<p>「コ&#8203;ロ&#8203;ナ」&#8203;や&#8203;「コ&#8203;ロ&#8203;ナ&#8203;ウィ&#8203;ル&#8203;ス」&#8203;な&#8203;ど&#8203;の&#8203;新&#8203;型&#8203;コ&#8203;ロ&#8203;ナ&#8203;ウィ&#8203;ル&#8203;ス&#8203;に&#8203;関&#8203;連&#8203;す&#8203;る&#8203;単&#8203;語&#8203;が&#8203;双&#8203;方&#8203;に&#8203;多&#8203;く&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;観&#8203;察&#8203;結&#8203;果&#8203;に&#8203;注&#8203;意&#8203;し&#8203;て、&#8203;次&#8203;の&#8203;scatter text&#8203;の&#8203;解&#8203;析&#8203;を&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_scatter_textによる可視化">5.7.4. scatter textによる可視化</h4>
<div class="paragraph">
<p>　&#8203;頻&#8203;度&#8203;の&#8203;可&#8203;視&#8203;化&#8203;方&#8203;法&#8203;の&#8203;一&#8203;つ&#8203;に、&#8203;頻&#8203;度&#8203;の&#8203;情&#8203;報&#8203;だ&#8203;け&#8203;で&#8203;な&#8203;く、&#8203;そ&#8203;の&#8203;単&#8203;語&#8203;の&#8203;一&#8203;般&#8203;性&#8203;を&#8203;表&#8203;す&#8203;使&#8203;用&#8203;分&#8203;布&#8203;も&#8203;共&#8203;に&#8203;可&#8203;視&#8203;化&#8203;で&#8203;き&#8203;る&#8203;scatter text&#8203;と&#8203;い&#8203;う&#8203;も&#8203;の&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　scatter text&#8203;を&#8203;プ&#8203;ロッ&#8203;ト&#8203;す&#8203;る&#8203;に&#8203;あ&#8203;た&#8203;り、&#8203;wordcloud&#8203;と&#8203;同&#8203;様&#8203;に&#8203;各々&#8203;の&#8203;単&#8203;語&#8203;が&#8203;ス&#8203;ペー&#8203;ス&#8203;で&#8203;区&#8203;切&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;し&#8203;か&#8203;し、&#8203;こ&#8203;ち&#8203;ら&#8203;は&#8203;wordcloud&#8203;と&#8203;は&#8203;違&#8203;い、&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;を&#8203;一&#8203;つ&#8203;と&#8203;し&#8203;て&#8203;繋&#8203;げ&#8203;る&#8203;必&#8203;要&#8203;は&#8203;あ&#8203;り&#8203;ま&#8203;せ&#8203;ん。&#8203;ま&#8203;ず、&#8203;wordcloud&#8203;の&#8203;時&#8203;と&#8203;同&#8203;様&#8203;に&#8203;owakati&#8203;よ&#8203;り、&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;を&#8203;parse&#8203;し、&#8203;単&#8203;語&#8203;を&#8203;ス&#8203;ペー&#8203;ス&#8203;よ&#8203;り&#8203;区&#8203;切&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">tokenized = articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>].apply(<span class="keyword">lambda</span> x: tagger.parse(x).strip(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>).rstrip())

<span class="comment"># 確認する</span>
tokenized.head(<span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>続&#8203;き、&#8203;whitespace_nlp_with_sentences&#8203;関&#8203;数&#8203;を&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;毎&#8203;に&#8203;適&#8203;用&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">parsed = tokenized.apply(st.whitespace_nlp_with_sentences)

<span class="comment"># 確認する</span>
parsed.head(<span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;可&#8203;視&#8203;化&#8203;の&#8203;た&#8203;め、&#8203;corpus&#8203;イ&#8203;ン&#8203;ス&#8203;タ&#8203;ン&#8203;ス&#8203;を&#8203;作&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;get_unigram_corpus&#8203;関&#8203;数&#8203;を&#8203;用&#8203;い&#8203;て&#8203;bigrams&#8203;を&#8203;corpus&#8203;か&#8203;ら&#8203;取&#8203;り&#8203;除&#8203;き、&#8203;remove_terms&#8203;関&#8203;数&#8203;よ&#8203;り&#8203;stopwords&#8203;を&#8203;取&#8203;り&#8203;除&#8203;い&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;remove_infrequent_words&#8203;関&#8203;数&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;出&#8203;現&#8203;頻&#8203;度&#8203;が&#8203;100&#8203;回&#8203;以&#8203;下&#8203;の&#8203;単&#8203;語&#8203;は&#8203;除&#8203;去&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">corpus = st.CorpusWithoutCategoriesFromParsedDocuments(
    parsed.rename(<span class="string"><span class="delimiter">'</span><span class="content">parse</span><span class="delimiter">'</span></span>).to_frame(), parsed_col=<span class="string"><span class="delimiter">'</span><span class="content">parse</span><span class="delimiter">'</span></span>
).build().get_unigram_corpus().remove_terms(stopwords, ignore_absences=<span class="predefined-constant">True</span>).remove_infrequent_words(minimum_term_count=<span class="integer">100</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　Dispersion&#8203;関&#8203;数&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;単&#8203;語&#8203;ご&#8203;と&#8203;の&#8203;頻&#8203;度&#8203;情&#8203;報&#8203;及&#8203;び&#8203;使&#8203;用&#8203;分&#8203;布&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">dispersion = st.Dispersion(corpus)
dispersion_df = dispersion.get_df()

<span class="comment"># ビルドされた頻度情報及び使用分布情報から、どの基準を用いてプロットするかをX, Xpos, Y, Yposのcolumnsにセットする。</span>
dispersion_df = dispersion_df.assign(
    X=<span class="keyword">lambda</span> df: df.Frequency,
    Xpos=<span class="keyword">lambda</span> df: st.Scalers.log_scale(df.X),
    Y=<span class="keyword">lambda</span> df: df[<span class="string"><span class="delimiter">&quot;</span><span class="content">Rosengren's S</span><span class="delimiter">&quot;</span></span>],
    Ypos=<span class="keyword">lambda</span> df: st.Scalers.scale(df.Y),
)

<span class="comment"># 確認する</span>
dispersion_df.head(<span class="integer">5</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter05/images/1_6_scattertext_prepare.png" alt="1_6_scattertext_prepare">
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;れ&#8203;ま&#8203;で&#8203;と&#8203;同&#8203;様&#8203;に&#8203;上&#8203;記&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;コー&#8203;ド&#8203;を&#8203;ま&#8203;と&#8203;め&#8203;て、&#8203;scatter text&#8203;可&#8203;視&#8203;化&#8203;を&#8203;行&#8203;う&#8203;関&#8203;数&#8203;を&#8203;作&#8203;成&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">display_scatter_text</span>(tagger, texts, stopwords, filename=<span class="string"><span class="delimiter">'</span><span class="content">out</span><span class="delimiter">'</span></span>):
    gc.collect()
    <span class="comment"># textsがpd.Seriesでない時に、pd.Seriesに変換。</span>
    <span class="keyword">if</span> <span class="predefined">isinstance</span>(texts, pd.Series) <span class="keyword">is</span> <span class="predefined-constant">False</span>:
        texts = pd.Series(texts)

    <span class="comment"># owakatiより、テキストをparseし、単語をスペースで区切り、whitespace_nlp_with_sentencesを適用。</span>
    tokenized = texts.apply(<span class="keyword">lambda</span> x: tagger.parse(x).strip(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>).rstrip())
    parsed = tokenized.apply(st.whitespace_nlp_with_sentences)

    <span class="comment"># bigrams及びstopwordsをcorpusから取り除き、出現頻度が100回以下の単語を除去する。</span>
    corpus = st.CorpusWithoutCategoriesFromParsedDocuments(
        parsed.rename(<span class="string"><span class="delimiter">'</span><span class="content">parse</span><span class="delimiter">'</span></span>).to_frame(), parsed_col=<span class="string"><span class="delimiter">'</span><span class="content">parse</span><span class="delimiter">'</span></span>
    ).build().get_unigram_corpus().remove_terms(stopwords, ignore_absences=<span class="predefined-constant">True</span>).remove_infrequent_words(minimum_term_count=<span class="integer">100</span>)

    <span class="comment"># Dispersion関数をより、単語ごとの頻度情報及び使用分布情報を取得。</span>
    dispersion = st.Dispersion(corpus)
    dispersion_df = dispersion.get_df()
    dispersion_df = dispersion_df.assign(
        X=<span class="keyword">lambda</span> df: df.Frequency,
        Xpos=<span class="keyword">lambda</span> df: st.Scalers.log_scale(df.X),
        Y=<span class="keyword">lambda</span> df: df[<span class="string"><span class="delimiter">&quot;</span><span class="content">Rosengren's S</span><span class="delimiter">&quot;</span></span>],
        Ypos=<span class="keyword">lambda</span> df: st.Scalers.scale(df.Y),
    )

    <span class="comment"># dataframe_scattertext関数より、可視化したhtmlをビルドできる。</span>
    html = st.dataframe_scattertext(
        corpus,
        plot_df=dispersion_df,
        ignore_categories=<span class="predefined-constant">True</span>,
        x_label=<span class="string"><span class="delimiter">'</span><span class="content">Log Frequency</span><span class="delimiter">'</span></span>,
        y_label=<span class="string"><span class="delimiter">&quot;</span><span class="content">Rosengren's S</span><span class="delimiter">&quot;</span></span>,
        y_axis_labels=[<span class="string"><span class="delimiter">'</span><span class="content">More Dispersion</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Medium</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Less Dispersion</span><span class="delimiter">'</span></span>],
    )

    <span class="comment"># htmlを書き出します。Google Driveの該当箇所に出力されるため、出力されたhtmlファイルをダウンロードし、ブラウザで開いて御覧ください。</span>
    <span class="predefined">open</span>(f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/visualizations/vis_{filename}_scatter.html</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">w</span><span class="delimiter">'</span></span>).write(html)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;準&#8203;備&#8203;が&#8203;で&#8203;き&#8203;た&#8203;ら、&#8203;ま&#8203;ず&#8203;は&#8203; <code>headline</code> &#8203;の&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;を&#8203;用&#8203;い&#8203;て&#8203;scatter text&#8203;可&#8203;視&#8203;化&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 以下のコードを実行するとvisualizations配下にhtmlファイルが作成されます。作成されたファイルをブラウザで開いて確認ください。</span>
display_scatter_text(tagger=owakati, texts=articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>], stopwords=stopwords, filename=<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="Chapter05/images/1_6_scattertext_headline.png" alt="1_6_scattertext_headline"></span></p>
</div>
<div class="paragraph">
<p>　&#8203;縦&#8203;軸&#8203;（y&#8203;軸）&#8203;は&#8203;使&#8203;用&#8203;分&#8203;布&#8203;(Dispersion)&#8203;を&#8203;表&#8203;し&#8203;ま&#8203;す。&#8203;y&#8203;軸&#8203;の&#8203;Dispersion&#8203;は&#8203;特&#8203;定&#8203;の&#8203;単&#8203;語&#8203;が&#8203;コー&#8203;パ&#8203;ス&#8203;内&#8203;で&#8203;ど&#8203;れ&#8203;だ&#8203;け&#8203;均&#8203;等&#8203;に&#8203;分&#8203;布&#8203;し&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;表&#8203;す&#8203;数&#8203;値&#8203;で、&#8203;1 (Less Dispersion)&#8203;に&#8203;近&#8203;い&#8203;ほ&#8203;ど&#8203;ど&#8203;の&#8203;コー&#8203;パ&#8203;ス&#8203;に&#8203;も&#8203;均&#8203;等&#8203;に&#8203;現&#8203;れ&#8203;る&#8203;単&#8203;語&#8203;で&#8203;あ&#8203;り、&#8203;0 (More Dispersion) &#8203;に&#8203;近&#8203;い&#8203;ほ&#8203;ど&#8203;特&#8203;定&#8203;の&#8203;分&#8203;野&#8203;で&#8203;の&#8203;み&#8203;現&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;示&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;横&#8203;軸&#8203;（x&#8203;軸）&#8203;は&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;に&#8203;お&#8203;け&#8203;る&#8203;単&#8203;語&#8203;の&#8203;使&#8203;用&#8203;頻&#8203;度&#8203;の&#8203;対&#8203;数&#8203;ス&#8203;ケー&#8203;ル&#8203;で&#8203;表&#8203;示&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;カー&#8203;ソ&#8203;ル&#8203;を&#8203;単&#8203;語&#8203;に&#8203;重&#8203;ね&#8203;る&#8203;と&#8203;各&#8203;単&#8203;語&#8203;の&#8203;数&#8203;値&#8203;が&#8203;表&#8203;示&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;の&#8203;図&#8203;か&#8203;ら&#8203;も&#8203;「米」、&#8203;「コ&#8203;ロ&#8203;ナ」、&#8203;「株&#8203;式&#8203;市&#8203;場」、&#8203;「人&#8203;事」&#8203;な&#8203;ど&#8203;の&#8203;単&#8203;語&#8203;が&#8203;多&#8203;く&#8203;使&#8203;用&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;分&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;は&#8203;wordcloud&#8203;で&#8203;観&#8203;察&#8203;し&#8203;た&#8203;結&#8203;果&#8203;と&#8203;似&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;さ&#8203;ら&#8203;に&#8203;注&#8203;目&#8203;す&#8203;べ&#8203;き&#8203;点&#8203;は、&#8203;「人&#8203;事」&#8203;は&#8203;使&#8203;用&#8203;頻&#8203;度&#8203;が&#8203;高&#8203;い&#8203;に&#8203;も&#8203;か&#8203;か&#8203;わ&#8203;ら&#8203;ず、&#8203;使&#8203;用&#8203;分&#8203;布&#8203;が&#8203;狭&#8203;く、&#8203;特&#8203;定&#8203;の&#8203;分&#8203;野&#8203;で&#8203;の&#8203;み&#8203;使&#8203;用&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;分&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;結&#8203;果&#8203;か&#8203;ら、&#8203;こ&#8203;の&#8203;単&#8203;語&#8203;を&#8203;含&#8203;む&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;は&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;と&#8203;性&#8203;質&#8203;が&#8203;異&#8203;な&#8203;る&#8203;と&#8203;想&#8203;定&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;単&#8203;語&#8203;が&#8203;有&#8203;意&#8203;味&#8203;な&#8203;情&#8203;報&#8203;を&#8203;含&#8203;む&#8203;か&#8203;を&#8203;判&#8203;断&#8203;し、&#8203;追&#8203;加&#8203;的&#8203;な&#8203;前&#8203;処&#8203;理&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;る&#8203;か&#8203;を&#8203;後&#8203;ほ&#8203;ど&#8203;検&#8203;討&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;引&#8203;き&#8203;続&#8203;き、&#8203; <code>keywords</code> &#8203;の&#8203;コー&#8203;パ&#8203;ス&#8203;を&#8203;用&#8203;い&#8203;て&#8203;scatter text&#8203;可&#8203;視&#8203;化&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">display_scatter_text(tagger=owakati, texts=articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>], stopwords=stopwords, filename=<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="Chapter05/images/1_6_scattertext_keywords.png" alt="1_6_scattertext_keywords"></span></p>
</div>
<div class="paragraph">
<p>　<code>keywords</code> &#8203;に&#8203;関&#8203;し&#8203;て&#8203;も、&#8203;「コ&#8203;ロ&#8203;ナ&#8203;ウ&#8203;イ&#8203;ル&#8203;ス」&#8203;や、&#8203;「株&#8203;式&#8203;市&#8203;場」&#8203;な&#8203;ど&#8203;が&#8203;高&#8203;頻&#8203;度&#8203;単&#8203;語&#8203;と&#8203;し&#8203;て&#8203;観&#8203;察&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;headline&#8203;に&#8203;お&#8203;け&#8203;る&#8203;「人&#8203;事」&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;使&#8203;用&#8203;頻&#8203;度&#8203;と&#8203;使&#8203;用&#8203;分&#8203;布&#8203;に&#8203;著&#8203;し&#8203;い&#8203;違&#8203;い&#8203;が&#8203;あ&#8203;る&#8203;単&#8203;語&#8203;は&#8203;観&#8203;測&#8203;で&#8203;き&#8203;ま&#8203;せ&#8203;ん。&#8203;さ&#8203;ら&#8203;に&#8203;追&#8203;加&#8203;的&#8203;に&#8203;解&#8203;析&#8203;を&#8203;行&#8203;い&#8203;た&#8203;い&#8203;場&#8203;合、&#8203;品&#8203;詞&#8203;ご&#8203;と&#8203;に&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;頻&#8203;度&#8203;や&#8203;使&#8203;用&#8203;分&#8203;布&#8203;を&#8203;可&#8203;視&#8203;化&#8203;し&#8203;て&#8203;解&#8203;析&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;品&#8203;詞&#8203;毎&#8203;に、&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;単&#8203;語&#8203;が&#8203;多&#8203;く&#8203;使&#8203;わ&#8203;れ、&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;分&#8203;布&#8203;し&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;観&#8203;察&#8203;し、&#8203;コー&#8203;パ&#8203;ス&#8203;の&#8203;特&#8203;性&#8203;を&#8203;さ&#8203;ら&#8203;に&#8203;深&#8203;く&#8203;理&#8203;解&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
</div>
<div class="sect3">
<h4 id="_トピック解析">5.7.5. トピック解析</h4>
<div class="paragraph">
<p>　&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;の&#8203;特&#8203;性&#8203;を&#8203;理&#8203;解&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に、&#8203;そ&#8203;の&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;が&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;ト&#8203;ピッ&#8203;ク&#8203;で&#8203;構&#8203;成&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;解&#8203;析&#8203;す&#8203;る&#8203;ト&#8203;ピッ&#8203;ク&#8203;モ&#8203;デ&#8203;リ&#8203;ン&#8203;グ&#8203;の&#8203;手&#8203;法&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;潜&#8203;在&#8203;ディ&#8203;リ&#8203;ク&#8203;レ&#8203;配&#8203;分&#8203;法&#8203;(Latent Dirichlet Allocation, LDA)&#8203;は、&#8203;そ&#8203;の&#8203;中&#8203;で&#8203;も&#8203;ト&#8203;ピッ&#8203;ク&#8203;モ&#8203;デ&#8203;リ&#8203;ン&#8203;グ&#8203;の&#8203;代&#8203;表&#8203;的&#8203;ア&#8203;ル&#8203;ゴ&#8203;リ&#8203;ズ&#8203;ム&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>　LDA&#8203;は&#8203;コー&#8203;パ&#8203;ス&#8203;が&#8203;ト&#8203;ピッ&#8203;ク&#8203;の&#8203;混&#8203;合&#8203;で&#8203;成&#8203;り&#8203;立っ&#8203;て&#8203;い&#8203;て、&#8203;そ&#8203;の&#8203;ト&#8203;ピッ&#8203;ク&#8203;が&#8203;確&#8203;率&#8203;分&#8203;布&#8203;に&#8203;従っ&#8203;て&#8203;単&#8203;語&#8203;を&#8203;生&#8203;成&#8203;し&#8203;て&#8203;い&#8203;る&#8203;と&#8203;仮&#8203;定&#8203;し、&#8203;そ&#8203;の&#8203;生&#8203;成&#8203;過&#8203;程&#8203;を&#8203;逆&#8203;に&#8203;辿&#8203;る&#8203;こ&#8203;と&#8203;よ&#8203;り、&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;を&#8203;構&#8203;成&#8203;す&#8203;る&#8203;ト&#8203;ピッ&#8203;ク&#8203;情&#8203;報&#8203;を&#8203;推&#8203;定&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;LDA&#8203;の&#8203;学&#8203;習&#8203;時&#8203;に&#8203;は、&#8203;単&#8203;語&#8203;の&#8203;頻&#8203;度&#8203;情&#8203;報&#8203;を&#8203;持&#8203;つ&#8203;メ&#8203;ト&#8203;リ&#8203;ク&#8203;ス&#8203;が&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;ま&#8203;す。&#8203;単&#8203;語&#8203;数&#8203;が&#8203;多&#8203;く&#8203;な&#8203;り、&#8203;メ&#8203;ト&#8203;リ&#8203;ク&#8203;ス&#8203;が&#8203;大&#8203;き&#8203;く&#8203;な&#8203;る&#8203;ほ&#8203;ど&#8203;計&#8203;算&#8203;リ&#8203;ソー&#8203;ス&#8203;が&#8203;要&#8203;求&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;現&#8203;実&#8203;的&#8203;な&#8203;処&#8203;理&#8203;時&#8203;間&#8203;で&#8203;完&#8203;了&#8203;さ&#8203;せ&#8203;る&#8203;た&#8203;め、&#8203;名&#8203;詞&#8203;以&#8203;外&#8203;の&#8203;単&#8203;語&#8203;は&#8203;全&#8203;て&#8203;取&#8203;り&#8203;除&#8203;き&#8203;解&#8203;析&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　build_stopwords&#8203;関&#8203;数&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;品&#8203;詞&#8203;情&#8203;報&#8203;が&#8203;名&#8203;詞&#8203;以&#8203;外&#8203;の&#8203;も&#8203;の&#8203;を&#8203;全&#8203;て&#8203;invalid_tokens&#8203;と&#8203;し&#8203;て&#8203;扱っ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;名&#8203;詞&#8203;の&#8203;中&#8203;で&#8203;も&#8203;数&#8203;を&#8203;品&#8203;詞&#8203;型&#8203;と&#8203;し&#8203;て&#8203;含&#8203;む&#8203;場&#8203;合&#8203;も&#8203;同&#8203;様&#8203;に&#8203;invalid_tokens&#8203;と&#8203;し&#8203;て&#8203;扱っ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">build_invalid_tokens</span>(parsed_by_ochasen, non_skip_flags=[<span class="string"><span class="delimiter">'</span><span class="content">数</span><span class="delimiter">'</span></span>], skip_flags = [<span class="string"><span class="delimiter">&quot;</span><span class="content">名詞</span><span class="delimiter">&quot;</span></span>]):
    <span class="keyword">return</span> build_stopwords(parsed_by_ochasen=parsed_by_ochasen, non_skip_flags=non_skip_flags, skip_flags=skip_flags)</code></pre>
</div>
</div>
<div class="paragraph">
<p>LDA&#8203;の&#8203;学&#8203;習&#8203;の&#8203;た&#8203;め&#8203;に、&#8203;owakati&#8203;を&#8203;用&#8203;い&#8203;て&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;し、&#8203;上&#8203;記&#8203;で&#8203;定&#8203;義&#8203;し&#8203;た&#8203;invalid_tokens&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;な&#8203;い&#8203;名&#8203;詞&#8203;の&#8203;み&#8203;の&#8203;単&#8203;語&#8203;に&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">tokenize_for_lda</span>(tagger, texts, invalid_tokens):
    <span class="comment"># textsがpd.Seriesでない時に、pd.Seriesに変換</span>
    <span class="keyword">if</span> <span class="predefined">isinstance</span>(texts, pd.Series) <span class="keyword">is</span> <span class="predefined-constant">False</span>:
        texts = pd.Series(texts)

    <span class="comment"># owakatiを用いてトークナイズする</span>
    tokenized = texts.apply(<span class="keyword">lambda</span> x: tagger.parse(x).split())

    <span class="comment"># 上記で定義したinvalid_tokensに含まれないトークンに精製する。</span>
    tokenized = tokenized.apply(<span class="keyword">lambda</span> x: [token <span class="keyword">for</span> token <span class="keyword">in</span> x <span class="keyword">if</span> token <span class="keyword">not</span> <span class="keyword">in</span> invalid_tokens])

    <span class="keyword">return</span> tokenized</code></pre>
</div>
</div>
<div class="paragraph">
<p>上&#8203;記&#8203;の&#8203;tokenize_for_lda&#8203;関&#8203;数&#8203;を&#8203;用&#8203;い&#8203;て&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;し、&#8203;そ&#8203;の&#8203;後&#8203;単&#8203;語&#8203;の&#8203;id、&#8203;頻&#8203;度&#8203;を&#8203;も&#8203;つ&#8203;dictionary&#8203;を&#8203;作&#8203;り、&#8203;gensim.models.ldamodel.LdaModel&#8203;を&#8203;用&#8203;い&#8203;て&#8203;LDA&#8203;を&#8203;学&#8203;習&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">build_ldamodel</span>(tagger, texts, invalid_tokens, num_topics=<span class="integer">10</span>):
    tokenized = tokenize_for_lda(tagger=tagger, texts=texts, invalid_tokens=invalid_tokens)

    <span class="comment"># 頻度情報をもつ単語辞書を作る</span>
    dictionary = gensim.corpora.Dictionary(tokenized)

    <span class="comment"># 生成されたcorpusは(word_id, word_frequency)の情報を持つ</span>
    corpus = [dictionary.doc2bow(text) <span class="keyword">for</span> text <span class="keyword">in</span> tokenized]

    ldamodel = gensim.models.ldamodel.LdaModel(corpus, num_topics=num_topics, id2word=dictionary, chunksize=<span class="integer">5000</span>, passes=<span class="integer">10</span>, random_state=<span class="integer">0</span>)

    <span class="keyword">return</span> ldamodel, corpus</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;上&#8203;記&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;コー&#8203;ド&#8203;を&#8203;用&#8203;い&#8203;て&#8203;可&#8203;視&#8203;化&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。&#8203;以&#8203;下&#8203;の&#8203;ト&#8203;ピッ&#8203;ク&#8203;解&#8203;析&#8203;コー&#8203;ド&#8203;は&#8203;高&#8203;い&#8203;計&#8203;算&#8203;リ&#8203;ソー&#8203;ス&#8203;が&#8203;要&#8203;求&#8203;さ&#8203;れ、&#8203;長&#8203;い&#8203;実&#8203;行&#8203;時&#8203;間&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す&#8203;の&#8203;で、&#8203;そ&#8203;の&#8203;こ&#8203;と&#8203;に&#8203;留&#8203;意&#8203;し&#8203;実&#8203;行&#8203;し&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ここでは二つの可視化を行います。まず、LDAモデルより推定されたトピックがどのような単語と関連が深いかを表示します。これにより、コーパス全体をクラスター化でき、それぞれのクラスターがどのような特性や性質を持つか理解することができます。その後、トピック(クラスター)ごとの分布を可視化します。これにより、トピックのコーパスに対する寄与度(周辺確率分布)やトピック間の距離などを確認できます。</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># headline, keywords両方において可視化を行う。</span>
<span class="keyword">for</span> column <span class="keyword">in</span> [<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>]:
    parsed_by_ochasen = {
        <span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>: parsed_headline_by_ochasen,
        <span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>: parsed_keywords_by_ochasen,
    }[column]

    invalid_tokens = build_invalid_tokens(parsed_by_ochasen=parsed_by_ochasen)
    ldamodel, corpus = build_ldamodel(tagger=owakati, texts=articles[column], invalid_tokens=invalid_tokens)

    display_markdown(f<span class="string"><span class="delimiter">'</span><span class="content">#### column: {column}</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)

    <span class="comment"># 推定されたtopicと関連深い上位5つの単語をプリントする</span>
    <span class="keyword">for</span> topic <span class="keyword">in</span> ldamodel.print_topics(num_words=<span class="integer">5</span>):
        print(topic)

    <span class="comment"># トピック可視化</span>
    <span class="comment"># 可視化したトピックのidが0ではなく1から始まることに注意しましょう。</span>
    <span class="comment"># 左方の円は、各々の10個のトピックを表す。</span>
    <span class="comment"># 各円との距離は、それぞれトピックがどれだけ離れているかを表す。</span>
    vis = pyLDAvis.gensim.prepare(ldamodel, corpus, ldamodel.id2word, sort_topics=<span class="predefined-constant">False</span>)
    <span class="comment"># htmlを書き出します。出力されたhtmlファイルをダウンロードし、ブラウザで開いて御覧ください。</span>
    pyLDAvis.save_html(vis, f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/visualizations/vis_{column}_lda.html</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　<code>headline</code> &#8203;の&#8203;ト&#8203;ピッ&#8203;ク&#8203;と&#8203;関&#8203;連&#8203;す&#8203;る&#8203;上&#8203;位&#8203;5&#8203;つ&#8203;の&#8203;単&#8203;語&#8203;の&#8203;出&#8203;力&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;「米」&#8203;と&#8203;「中&#8203;国」&#8203;が&#8203;同&#8203;一&#8203;の&#8203;ト&#8203;ピッ&#8203;ク&#8203;に&#8203;登&#8203;場&#8203;し&#8203;や&#8203;す&#8203;い&#8203;こ&#8203;と、&#8203;「新&#8203;型&#8203;コ&#8203;ロ&#8203;ナ」、&#8203;「感&#8203;染」、&#8203;「対&#8203;策」&#8203;が&#8203;同&#8203;一&#8203;の&#8203;ト&#8203;ピッ&#8203;ク&#8203;に&#8203;登&#8203;場&#8203;し&#8203;や&#8203;す&#8203;い&#8203;こ&#8203;と&#8203;な&#8203;ど、&#8203;直&#8203;感&#8203;に&#8203;反&#8203;し&#8203;な&#8203;い&#8203;結&#8203;果&#8203;が&#8203;取&#8203;得&#8203;で&#8203;き&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">column: headline
(<span class="integer">0</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.035*&quot;減&quot; + 0.030*&quot;月&quot; + 0.025*&quot;期&quot; + 0.024*&quot;増&quot; + 0.018*&quot;東証&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">1</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.022*&quot;新型コロナ&quot; + 0.019*&quot;感染&quot; + 0.009*&quot;対策&quot; + 0.009*&quot;発行&quot; + 0.008*&quot;知事&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">2</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.014*&quot;政府&quot; + 0.013*&quot;バイデン&quot; + 0.013*&quot;オンライン&quot; + 0.012*&quot;欧州&quot; + 0.011*&quot;米&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">3</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.048*&quot;発売&quot; + 0.011*&quot;用&quot; + 0.011*&quot;型&quot; + 0.007*&quot;発表&quot; + 0.006*&quot;シリーズ&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">4</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.056*&quot;コロナ&quot; + 0.030*&quot;株&quot; + 0.026*&quot;米&quot; + 0.021*&quot;ぶり&quot; + 0.017*&quot;上昇&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">5</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.014*&quot;支援&quot; + 0.013*&quot;開始&quot; + 0.012*&quot;連携&quot; + 0.010*&quot;サービス&quot; + 0.008*&quot;活用&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">6</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.060*&quot;氏&quot; + 0.023*&quot;社長&quot; + 0.016*&quot;中国&quot; + 0.012*&quot;生産&quot; + 0.010*&quot;米&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">7</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.015*&quot;米国&quot; + 0.012*&quot;ロンドン&quot; + 0.011*&quot;発表&quot; + 0.009*&quot;市場&quot; + 0.009*&quot;年末年始&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">8</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.112*&quot;人事&quot; + 0.014*&quot;AI&quot; + 0.014*&quot;開発&quot; + 0.009*&quot;DX&quot; + 0.007*&quot;技術&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">9</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.016*&quot;発表&quot; + 0.013*&quot;調査&quot; + 0.009*&quot;機能&quot; + 0.009*&quot;県&quot; + 0.009*&quot;推進&quot;</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;各&#8203;単&#8203;語&#8203;の&#8203;前&#8203;に&#8203;あ&#8203;る&#8203;数&#8203;値&#8203;は、&#8203;該&#8203;当&#8203;す&#8203;る&#8203;ト&#8203;ピッ&#8203;ク&#8203;へ&#8203;の&#8203;寄&#8203;与&#8203;度&#8203;を&#8203;表&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;コー&#8203;パ&#8203;ス&#8203;を&#8203;10&#8203;個&#8203;の&#8203;ト&#8203;ピッ&#8203;ク&#8203;に&#8203;分&#8203;類&#8203;し&#8203;た&#8203;時&#8203;に、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;ト&#8203;ピッ&#8203;ク&#8203;の&#8203;特&#8203;性&#8203;を&#8203;寄&#8203;与&#8203;す&#8203;る&#8203;単&#8203;語&#8203;か&#8203;ら&#8203;理&#8203;解&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;次&#8203;に、&#8203;pyLDAvis&#8203;を&#8203;用&#8203;い&#8203;て&#8203; <code>headline</code> &#8203;の&#8203;ト&#8203;ピッ&#8203;ク&#8203;を&#8203;可&#8203;視&#8203;化&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter05/images/1_6_lda_headline.png" alt="1_6_lda_headline">
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;か&#8203;ら&#8203;さ&#8203;ら&#8203;に&#8203;細&#8203;か&#8203;な&#8203;分&#8203;析&#8203;を&#8203;行&#8203;う&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;上&#8203;の&#8203;左&#8203;図&#8203;の&#8203;円&#8203;は&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;ト&#8203;ピッ&#8203;ク&#8203;を&#8203;表&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;可&#8203;視&#8203;化&#8203;に&#8203;お&#8203;け&#8203;る&#8203;ト&#8203;ピッ&#8203;ク&#8203;の&#8203;番&#8203;号&#8203;は&#8203;1&#8203;か&#8203;ら&#8203;始&#8203;ま&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;ご&#8203;注&#8203;意&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;各&#8203;円&#8203;間&#8203;の&#8203;距&#8203;離&#8203;は、&#8203;ト&#8203;ピッ&#8203;ク&#8203;が&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;ど&#8203;れ&#8203;ほ&#8203;ど&#8203;異&#8203;な&#8203;る&#8203;か&#8203;を&#8203;表&#8203;し、&#8203;近&#8203;い&#8203;ほ&#8203;ど&#8203;似&#8203;て&#8203;い&#8203;る&#8203;ト&#8203;ピッ&#8203;ク&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;表&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　<code>keywords</code> &#8203;の&#8203;ト&#8203;ピッ&#8203;ク&#8203;と&#8203;そ&#8203;れ&#8203;に&#8203;関&#8203;連&#8203;す&#8203;る&#8203;上&#8203;位&#8203;5&#8203;つ&#8203;の&#8203;単&#8203;語&#8203;の&#8203;出&#8203;力&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;こ&#8203;ち&#8203;ら&#8203;も&#8203;コ&#8203;ロ&#8203;ナ&#8203;ウィ&#8203;ル&#8203;ス&#8203;関&#8203;連&#8203;や&#8203;株&#8203;式&#8203;市&#8203;場&#8203;関&#8203;連&#8203;な&#8203;ど、&#8203;直&#8203;感&#8203;に&#8203;反&#8203;し&#8203;な&#8203;い&#8203;結&#8203;果&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">column: keywords
(<span class="integer">0</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.019*&quot;大学&quot; + 0.014*&quot;教授&quot; + 0.010*&quot;検査&quot; + 0.009*&quot;医療&quot; + 0.008*&quot;ポイント&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">1</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.050*&quot;コロナ&quot; + 0.019*&quot;社長&quot; + 0.011*&quot;生産&quot; + 0.011*&quot;工場&quot; + 0.010*&quot;中国&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">2</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.059*&quot;日&quot; + 0.057*&quot;発表&quot; + 0.032*&quot;新製品&quot; + 0.020*&quot;株式会社&quot; + 0.011*&quot;販売&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">3</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.029*&quot;連結決算&quot; + 0.028*&quot;売上高&quot; + 0.025*&quot;純利益&quot; + 0.024*&quot;減益&quot; + 0.024*&quot;決算&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">4</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.025*&quot;政府&quot; + 0.019*&quot;首相&quot; + 0.019*&quot;米国政府&quot; + 0.016*&quot;大統領&quot; + 0.013*&quot;米国&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">5</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.014*&quot;コロナ禍&quot; + 0.011*&quot;オンライン&quot; + 0.008*&quot;イベント&quot; + 0.007*&quot;時代&quot; + 0.006*&quot;サッカー&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">6</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.019*&quot;動向&quot; + 0.017*&quot;民間&quot; + 0.015*&quot;市場&quot; + 0.015*&quot;統計&quot; + 0.013*&quot;政府統計&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">7</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.046*&quot;新型&quot; + 0.042*&quot;ウイルス&quot; + 0.039*&quot;コロナウイルス&quot; + 0.026*&quot;感染&quot; + 0.024*&quot;株式市場&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">8</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.018*&quot;株&quot; + 0.017*&quot;ロンドン&quot; + 0.013*&quot;投資&quot; + 0.013*&quot;外為市場&quot; + 0.012*&quot;ドル&quot;</span><span class="delimiter">'</span></span>)
(<span class="integer">9</span>, <span class="string"><span class="delimiter">'</span><span class="content">0.009*&quot;事業&quot; + 0.009*&quot;連携&quot; + 0.008*&quot;AI&quot; + 0.007*&quot;業務提携&quot; + 0.007*&quot;GoTo&quot;</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>次&#8203;に、&#8203;pyLDAvis&#8203;を&#8203;用&#8203;い&#8203;た&#8203; <code>keywords</code> &#8203;の&#8203;ト&#8203;ピッ&#8203;ク&#8203;を&#8203;可&#8203;視&#8203;化&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter05/images/1_6_lda_keywords.png" alt="1_6_lda_keywords">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_解析結果を活用した追加的なデータの前処理">5.7.6. 解析結果を活用した追加的なデータの前処理</h4>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;の&#8203;解&#8203;析&#8203;に&#8203;よっ&#8203;て&#8203;得&#8203;ら&#8203;れ&#8203;た&#8203;知&#8203;見&#8203;か&#8203;ら、&#8203;追&#8203;加&#8203;的&#8203;な&#8203;デー&#8203;タ&#8203;の&#8203;前&#8203;処&#8203;理&#8203;を&#8203;検&#8203;討&#8203;し&#8203;ま&#8203;す。&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;内&#8203;に&#8203;ノ&#8203;イ&#8203;ズ&#8203;と&#8203;な&#8203;り&#8203;得&#8203;る&#8203;単&#8203;語&#8203;の&#8203;規&#8203;則&#8203;性&#8203;が&#8203;確&#8203;認&#8203;で&#8203;き&#8203;た&#8203;場&#8203;合&#8203;や、&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;自&#8203;体&#8203;が&#8203;無&#8203;意&#8203;味&#8203;で&#8203;あ&#8203;る&#8203;か&#8203;ノ&#8203;イ&#8203;ズ&#8203;と&#8203;な&#8203;り&#8203;得&#8203;る&#8203;場&#8203;合&#8203;が&#8203;な&#8203;い&#8203;か&#8203;を&#8203;考&#8203;察&#8203;し&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
<div class="paragraph">
<p>　&#8203;前&#8203;章&#8203;で&#8203;の&#8203;可&#8203;視&#8203;化&#8203;及&#8203;び&#8203;解&#8203;析&#8203;を&#8203;通&#8203;じ&#8203;て、&#8203;コー&#8203;パ&#8203;ス&#8203;全&#8203;体&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;「人&#8203;事」&#8203;と&#8203;い&#8203;う&#8203;単&#8203;語&#8203;が&#8203;非&#8203;常&#8203;に&#8203;高&#8203;い&#8203;頻&#8203;度&#8203;で&#8203;観&#8203;測&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;し&#8203;た。&#8203;し&#8203;か&#8203;し、&#8203;CEO&#8203;等&#8203;の&#8203;交&#8203;代&#8203;が&#8203;プ&#8203;ラ&#8203;ス&#8203;の&#8203;効&#8203;果&#8203;を&#8203;持&#8203;つ&#8203;か、&#8203;マ&#8203;イ&#8203;ナ&#8203;ス&#8203;の&#8203;効&#8203;果&#8203;を&#8203;持&#8203;つ&#8203;か&#8203;は&#8203;ケー&#8203;ス&#8203;バ&#8203;イ&#8203;ケー&#8203;ス&#8203;と&#8203;思&#8203;わ&#8203;れ&#8203;る&#8203;た&#8203;め、&#8203;各&#8203;社&#8203;の&#8203;人&#8203;事&#8203;情&#8203;報&#8203;を&#8203;マー&#8203;ケッ&#8203;ト&#8203;の&#8203;予&#8203;測&#8203;に&#8203;役&#8203;立&#8203;て&#8203;る&#8203;難&#8203;易&#8203;度&#8203;は&#8203;非&#8203;常&#8203;に&#8203;高&#8203;い&#8203;と&#8203;想&#8203;定&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;仮&#8203;説&#8203;を&#8203;基&#8203;に、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は&#8203;人&#8203;事&#8203;の&#8203;内&#8203;容&#8203;を&#8203;含&#8203;む&#8203;ニュー&#8203;ス&#8203;を&#8203;除&#8203;去&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># owakatiを用いて、'人事'の単語を含む記事を除去する方法もあるが、本番環境でのリソースを軽減させるため、単純に文字列から人事を含む全てのニュースの除去を行う。</span>
<span class="comment"># headlineもしくは、keywordsどちらかで人事を含むニュース記事のindexマスクを作成。</span>
drop_mask = articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>].str.contains(<span class="string"><span class="delimiter">'</span><span class="content">人事</span><span class="delimiter">'</span></span>) | articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>].str.contains(<span class="string"><span class="delimiter">'</span><span class="content">人事</span><span class="delimiter">'</span></span>)

<span class="comment"># '人事'を含む例を表示する</span>
articles[drop_mask].head()</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter05/images/1_6_with_jinji.png" alt="1_6_with_jinji" width="50%">
</div>
</div>
<div class="paragraph">
<p>　'&#8203;人&#8203;事&#8203;'&#8203;と&#8203;い&#8203;う&#8203;単&#8203;語&#8203;を&#8203;含&#8203;む&#8203;ニュー&#8203;ス&#8203;を&#8203;取&#8203;り&#8203;除&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">articles = articles[~drop_mask]

<span class="comment"># '人事'を含むニュースが存在するか確認する。</span>
(articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>].str.contains(<span class="string"><span class="delimiter">'</span><span class="content">人事</span><span class="delimiter">'</span></span>) | articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>].str.contains(<span class="string"><span class="delimiter">'</span><span class="content">人事</span><span class="delimiter">'</span></span>)).any()</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;人&#8203;事&#8203;を&#8203;含&#8203;む&#8203;ニュー&#8203;ス&#8203;が&#8203;存&#8203;在&#8203;し&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;分&#8203;か&#8203;り、&#8203;正&#8203;し&#8203;く&#8203;取&#8203;り&#8203;除&#8203;く&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="predefined-constant">False</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_本番提出用のクラスへ組み込み_4">5.7.7. 本番提出用のクラスへ組み込み</h4>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;の&#8203;処&#8203;理&#8203;を&#8203;<code>drop_remove_list_words</code>&#8203;関&#8203;数&#8203;と&#8203;し&#8203;て&#8203; <code>SentimentGenerator</code> &#8203;ク&#8203;ラ&#8203;ス&#8203;に&#8203;追&#8203;加&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment">#上記のコードを用いて、本番提出用のクラスにclassmethodを追加</span>

<span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">drop_remove_list_words</span>(cls, articles, remove_list_words=[<span class="string"><span class="delimiter">&quot;</span><span class="content">人事</span><span class="delimiter">&quot;</span></span>]):
    articles = articles.copy()

    <span class="keyword">for</span> remove_list_word <span class="keyword">in</span> remove_list_words:
        <span class="comment"># headlineもしくは、keywordsどちらかでremove_list_wordを含むニュース記事のindexマスクを作成</span>
        drop_mask = articles[<span class="string"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>].str.contains(remove_list_word) | articles[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">keywords</span><span class="delimiter">&quot;</span></span>
        ].str.contains(remove_list_word)

        <span class="comment"># remove_list_wordを含まないニュースだけに精製する。</span>
        articles = articles[~drop_mask]

    <span class="keyword">return</span> articles

<span class="comment"># SentimentGeneratorに定義したclassmethodを追加する</span>
SentimentGenerator.drop_remove_list_words = drop_remove_list_words

<span class="comment"># SentimentGeneratorに使用する全体の流れを記述</span>
articles = SentimentGenerator.load_articles(path=CONFIG[<span class="string"><span class="delimiter">&quot;</span><span class="content">article_path</span><span class="delimiter">&quot;</span></span>])
articles = SentimentGenerator.normalize_articles(articles)
articles = SentimentGenerator.handle_punctuations_in_articles(articles)
articles = SentimentGenerator.drop_remove_list_words(articles)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_特徴量抽出機前処理機の定義">5.8. 特徴量抽出機、前処理機の定義</h3>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;の&#8203;前&#8203;処&#8203;理&#8203;等&#8203;を&#8203;踏&#8203;ま&#8203;え、&#8203;BERT&#8203;へ&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;を&#8203;投&#8203;入&#8203;す&#8203;る&#8203;準&#8203;備&#8203;が&#8203;整&#8203;い&#8203;ま&#8203;し&#8203;た。&#8203;こ&#8203;こ&#8203;か&#8203;ら&#8203;は&#8203;BERT&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;扱&#8203;う&#8203;上&#8203;で&#8203;必&#8203;要&#8203;な&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;時&#8203;に&#8203;使&#8203;う&#8203;デ&#8203;バ&#8203;イ&#8203;ス&#8203;（GPU）&#8203;の&#8203;定&#8203;義、&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;の&#8203;た&#8203;め&#8203;の&#8203;BERT&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;定&#8203;義、&#8203;BERT&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;係&#8203;る&#8203;前&#8203;処&#8203;理&#8203;の&#8203;定&#8203;義&#8203;等&#8203;を&#8203;行っ&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_本番提出用のクラスへ組み込み_5">5.8.1. 本番提出用のクラスへ組み込み</h4>
<div class="paragraph">
<p><code>SentimentGenerator</code> &#8203;ク&#8203;ラ&#8203;ス&#8203;に&#8203;複&#8203;数&#8203;の&#8203;関&#8203;数&#8203;を&#8203;追&#8203;加&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">_set_device</span>(cls):
    <span class="comment"># 使用可能なgpuがある場合、そちらを利用し特徴量抽出を行う</span>
    <span class="keyword">if</span> torch.cuda.device_count() &gt;= <span class="integer">1</span>:
        cls.device = <span class="string"><span class="delimiter">'</span><span class="content">cuda</span><span class="delimiter">'</span></span>
        print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] Set Device: GPU</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">else</span>:
        cls.device = <span class="string"><span class="delimiter">'</span><span class="content">cpu</span><span class="delimiter">'</span></span>
        print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] Set Device: CPU</span><span class="delimiter">&quot;</span></span>)

<span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">_build_feature_extractor</span>(cls):
    <span class="comment"># 特徴量抽出のため事前学習済みBERTモデルを用いる。</span>
    <span class="comment"># ここでは、&quot;cl-tohoku/bert-base-japanese-whole-word-masking&quot;モデルを使用しているが、異なる日本語BERTモデルを用いても良い。</span>
    cls.feature_extractor = (
        transformers.BertModel.from_pretrained(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">cl-tohoku/bert-base-japanese-whole-word-masking</span><span class="delimiter">&quot;</span></span>,
            return_dict=<span class="predefined-constant">True</span>,
            output_hidden_states=<span class="predefined-constant">True</span>,
        )
    )

    <span class="comment"># 使用するdeviceを指定</span>
    cls.feature_extractor = cls.feature_extractor.to(cls.device)

    <span class="comment"># 今回は特徴量抽出を行うのみであり、この事前モデル学習は行わないため、評価モードにセットする。</span>
    cls.feature_extractor.eval()

    print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] Built feature extractor</span><span class="delimiter">&quot;</span></span>)

<span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">_build_tokenizer</span>(cls):
    <span class="comment"># BERTモデルの入力とするコーパスはそのBERTモデルが学習された時と同様の前処理を行う必要がある。</span>
    <span class="comment"># 今回使用する&quot;cl-tohoku/bert-base-japanese-whole-word-masking&quot;モデルは、mecab-ipadic-NEologdによりトークナイズされ、その後Wordpiece subword encoderよりsubword化している。</span>
    <span class="comment"># Subwordとは形態素に類似な概念として、単語をより小さい意味のある単位に変換したものである。</span>
    <span class="comment"># transformersのBertJapaneseTokenizerを用いることで、その事前学習モデルの学習時と同様の前処理を簡単に使用することができる。</span>
    <span class="comment"># そのため、ここではBertJapaneseTokenizerを利用し、トークナイズ及びsubword化を行う。</span>
    cls.bert_tokenizer = BertJapaneseTokenizer.from_pretrained(<span class="string"><span class="delimiter">&quot;</span><span class="content">cl-tohoku/bert-base-japanese-whole-word-masking</span><span class="delimiter">&quot;</span></span>)
    print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] Built bert tokenizer</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># SentimentGeneratorに定義したclassmethodを追加する</span>
SentimentGenerator._set_device = _set_device
SentimentGenerator._build_feature_extractor = _build_feature_extractor
SentimentGenerator._build_tokenizer = _build_tokenizer

<span class="comment"># SentimentGenerator使用する全体流れを記述</span>
articles = SentimentGenerator.load_articles(path=CONFIG[<span class="string"><span class="delimiter">&quot;</span><span class="content">article_path</span><span class="delimiter">&quot;</span></span>])
articles = SentimentGenerator.normalize_articles(articles)
articles = SentimentGenerator.handle_punctuations_in_articles(articles)
articles = SentimentGenerator.drop_remove_list_words(articles)

SentimentGenerator._set_device()
SentimentGenerator._build_feature_extractor()
SentimentGenerator._build_tokenizer()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bertモデルを使用するための前処理">5.8.2. BERTモデルを使用するための前処理</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;節&#8203;で&#8203;は&#8203;以&#8203;下&#8203;の&#8203;2&#8203;つ&#8203;の&#8203;異&#8203;な&#8203;る&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ザ&#8203;を&#8203;用&#8203;い&#8203;て&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;し&#8203;た&#8203;結&#8203;果&#8203;を&#8203;比&#8203;較&#8203;し、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;前&#8203;処&#8203;理&#8203;の&#8203;違&#8203;い&#8203;を&#8203;確&#8203;認&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SentimentGenerator.bert_tokenizer: mecab-ipadic-NEologd + Wordpiece</p>
</li>
<li>
<p>owakati: mecab-ipadic-NEologd</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">text = <span class="string"><span class="delimiter">'</span><span class="content">我らは走り出す。</span><span class="delimiter">'</span></span>
display(SentimentGenerator.bert_tokenizer.tokenize(text))
display(owakati.parse(text).split())</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;Subword&#8203;化&#8203;を&#8203;行&#8203;う&#8203;bert_tokenizer&#8203;の&#8203;方&#8203;が&#8203;よ&#8203;り&#8203;小&#8203;さ&#8203;い&#8203;単&#8203;位&#8203;で&#8203;トー&#8203;ク&#8203;ン&#8203;化&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;subword&#8203;を&#8203;用&#8203;い&#8203;る&#8203;と、&#8203;学&#8203;習&#8203;時&#8203;に&#8203;出&#8203;現&#8203;し&#8203;て&#8203;い&#8203;な&#8203;い&#8203;単&#8203;語&#8203;(Out-of-Vocabulary)&#8203;に&#8203;関&#8203;す&#8203;る&#8203;問&#8203;題&#8203;を&#8203;緩&#8203;和&#8203;さ&#8203;せ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">[<span class="string"><span class="delimiter">'</span><span class="content">我</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">##ら</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">は</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">走り</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">##出す</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">。</span><span class="delimiter">'</span></span>]
[<span class="string"><span class="delimiter">'</span><span class="content">我ら</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">は</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">走り出す</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">。</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;基&#8203;本&#8203;的&#8203;に&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;言&#8203;語&#8203;モ&#8203;デ&#8203;ル&#8203;も&#8203;トー&#8203;ク&#8203;ナ&#8203;イ&#8203;ズ&#8203;後&#8203;の&#8203;トー&#8203;ク&#8203;ン&#8203;を&#8203;そ&#8203;の&#8203;ま&#8203;ま&#8203;受&#8203;け&#8203;取&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;で&#8203;き&#8203;ま&#8203;せ&#8203;ん。&#8203;トー&#8203;ク&#8203;ン&#8203;を&#8203;数&#8203;字&#8203;に&#8203;対&#8203;応&#8203;さ&#8203;せ&#8203;る&#8203;た&#8203;め&#8203;の&#8203;id&#8203;化&#8203;が&#8203;必&#8203;要&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;事&#8203;前&#8203;学&#8203;習&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;用&#8203;い&#8203;る&#8203;場&#8203;合、&#8203;各々&#8203;の&#8203;トー&#8203;ク&#8203;ン&#8203;は&#8203;す&#8203;で&#8203;に&#8203;id&#8203;が&#8203;付&#8203;与&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;入&#8203;力&#8203;す&#8203;る&#8203;トー&#8203;ク&#8203;ン&#8203;デー&#8203;タ&#8203;を&#8203;そ&#8203;の&#8203;id&#8203;に&#8203;変&#8203;換&#8203;し&#8203;た&#8203;上&#8203;で、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;入&#8203;力&#8203;と&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;BertJapaneseTokenizer&#8203;の&#8203;encode&#8203;メ&#8203;ソッ&#8203;ド&#8203;は&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;id&#8203;化&#8203;を&#8203;行っ&#8203;て&#8203;く&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">display(SentimentGenerator.bert_tokenizer.encode(text))</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">[<span class="integer">2</span>, <span class="integer">3706</span>, <span class="integer">28469</span>, <span class="integer">9</span>, <span class="integer">7498</span>, <span class="integer">2813</span>, <span class="integer">8</span>, <span class="integer">3</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;以&#8203;下&#8203;の&#8203;コー&#8203;ド&#8203;よ&#8203;り&#8203;id&#8203;化&#8203;し&#8203;た&#8203;トー&#8203;ク&#8203;ン&#8203;を、&#8203;再&#8203;び&#8203;トー&#8203;ク&#8203;ン&#8203;に&#8203;変&#8203;換&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">for</span> <span class="predefined">id</span> <span class="keyword">in</span> SentimentGenerator.bert_tokenizer.encode(text):
    print(f<span class="string"><span class="delimiter">'</span><span class="content">{id}: {SentimentGenerator.bert_tokenizer.decode(id)}</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="integer">2</span>: [ C L S ]
<span class="integer">3706</span>: 我
<span class="integer">28469</span>: <span class="comment"># # ら</span>
<span class="integer">9</span>: は
<span class="integer">7498</span>: 走 り
<span class="integer">2813</span>: <span class="comment"># # 出 す</span>
<span class="integer">8</span>: <span class="error">。</span>
<span class="integer">3</span>: [ S E P ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>　id&#8203;を&#8203;トー&#8203;ク&#8203;ン&#8203;に&#8203;再&#8203;び&#8203;戻&#8203;し&#8203;た&#8203;時、&#8203;元&#8203;の&#8203;デー&#8203;タ&#8203;に&#8203;は&#8203;存&#8203;在&#8203;し&#8203;て&#8203;い&#8203;な&#8203;かっ&#8203;た&#8203;[CLS]&#8203;と&#8203;[SEP]&#8203;が&#8203;現&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;二&#8203;つ&#8203;は&#8203; `special tokens `&#8203;と&#8203;呼&#8203;ば&#8203;れ、&#8203;[CLS]&#8203;は&#8203;全&#8203;て&#8203;の&#8203;文&#8203;章&#8203;の&#8203;先&#8203;頭&#8203;に&#8203;位&#8203;置&#8203;し、&#8203;文&#8203;章&#8203;の&#8203;分&#8203;類&#8203;タ&#8203;ス&#8203;ク&#8203;を&#8203;行&#8203;う&#8203;際&#8203;に&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;る&#8203;も&#8203;の&#8203;で&#8203;す。&#8203;ま&#8203;た、&#8203;[SEP]&#8203;は&#8203;複&#8203;数&#8203;の&#8203;文&#8203;章&#8203;を&#8203;区&#8203;切&#8203;る&#8203;た&#8203;め&#8203;に&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;ま&#8203;す。&#8203;BERT&#8203;へ&#8203;の&#8203;入&#8203;力&#8203;は、&#8203;必&#8203;ず&#8203;こ&#8203;の&#8203;フォー&#8203;マッ&#8203;ト&#8203;に&#8203;従&#8203;う&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　BERT&#8203;の&#8203;入&#8203;力&#8203;値&#8203;は&#8203;上&#8203;記&#8203;で&#8203;生&#8203;成&#8203;し&#8203;た&#8203;token&#8203;の&#8203;ids&#8203;以&#8203;外&#8203;に&#8203;, <code>token_type_ids</code> , <code>attention_mask</code> &#8203;の&#8203;ベ&#8203;ク&#8203;ト&#8203;ル&#8203;を&#8203;入&#8203;力&#8203;と&#8203;し&#8203;て&#8203;受&#8203;け&#8203;取&#8203;り&#8203;ま&#8203;す。&#8203; <code>token_type_ids</code> &#8203;は&#8203;複&#8203;数&#8203;の&#8203;文&#8203;章&#8203;を&#8203;区&#8203;切&#8203;る&#8203;た&#8203;め&#8203;用&#8203;い&#8203;ら&#8203;れ、&#8203; <code>attention mask</code> &#8203;は&#8203;実&#8203;際&#8203;に&#8203;トー&#8203;ク&#8203;ン&#8203;が&#8203;存&#8203;在&#8203;す&#8203;る&#8203;部&#8203;分&#8203;と&#8203;zero padding&#8203;さ&#8203;れ&#8203;た&#8203;部&#8203;分&#8203;を&#8203;区&#8203;切&#8203;る&#8203;た&#8203;め&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;ま&#8203;す。&#8203;SentimentGenerator.bert_tokenizer.encode_plus&#8203;メ&#8203;ソッ&#8203;ド&#8203;に&#8203;よ&#8203;り&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;ベ&#8203;ク&#8203;ト&#8203;ル&#8203;を&#8203;作&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">encoded = SentimentGenerator.bert_tokenizer.encode_plus(
    text,
    <span class="predefined-constant">None</span>,
    add_special_tokens=<span class="predefined-constant">True</span>,
    return_token_type_ids=<span class="predefined-constant">True</span>,
    truncation=<span class="predefined-constant">True</span>,
)

<span class="comment"># 確認する</span>
encoded</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">{<span class="string"><span class="delimiter">'</span><span class="content">input_ids</span><span class="delimiter">'</span></span>: [<span class="integer">2</span>, <span class="integer">3706</span>, <span class="integer">28469</span>, <span class="integer">9</span>, <span class="integer">7498</span>, <span class="integer">2813</span>, <span class="integer">8</span>, <span class="integer">3</span>], <span class="string"><span class="delimiter">'</span><span class="content">token_type_ids</span><span class="delimiter">'</span></span>: [<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>], <span class="string"><span class="delimiter">'</span><span class="content">attention_mask</span><span class="delimiter">'</span></span>: [<span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;れ&#8203;ら&#8203;は&#8203;torch&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;入&#8203;力&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;tensor&#8203;形&#8203;式&#8203;に&#8203;変&#8203;換&#8203;し、&#8203;device&#8203;を&#8203;指&#8203;定&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">input_ids = torch.tensor([encoded[<span class="string"><span class="delimiter">'</span><span class="content">input_ids</span><span class="delimiter">'</span></span>]], dtype=torch.long).to(SentimentGenerator.device)
token_type_ids = torch.tensor([encoded[<span class="string"><span class="delimiter">'</span><span class="content">token_type_ids</span><span class="delimiter">'</span></span>]], dtype=torch.long).to(SentimentGenerator.device)
attention_mask = torch.tensor([encoded[<span class="string"><span class="delimiter">'</span><span class="content">attention_mask</span><span class="delimiter">'</span></span>]], dtype=torch.long).to(SentimentGenerator.device)

<span class="comment"># 確認する</span>
display(input_ids)
display(token_type_ids)
display(attention_mask)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">tensor([[    <span class="integer">2</span>,  <span class="integer">3706</span>, <span class="integer">28469</span>,     <span class="integer">9</span>,  <span class="integer">7498</span>,  <span class="integer">2813</span>,     <span class="integer">8</span>,     <span class="integer">3</span>]])
tensor([[<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>]])
tensor([[<span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>]])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_特徴量抽出">5.8.3. 特徴量抽出</h4>
<div class="paragraph">
<p>　&#8203;前&#8203;処&#8203;理&#8203;の&#8203;最&#8203;後&#8203;で&#8203;取&#8203;得&#8203;し&#8203;た&#8203;三&#8203;つ&#8203;の&#8203;ベ&#8203;ク&#8203;ト&#8203;ル&#8203;[input_ids, token_type_ids, attention_mask]&#8203;を&#8203;BERT&#8203;モ&#8203;デ&#8203;ル&#8203;へ&#8203;入&#8203;力&#8203;し、&#8203;そ&#8203;の&#8203;output&#8203;を&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">output = SentimentGenerator.feature_extractor(input_ids=input_ids, token_type_ids=token_type_ids, attention_mask=attention_mask)

<span class="comment"># outputをdictionary形式に変換し、その中からどのようなkeyが存在するかをみてみる。</span>
output.__dict__.keys()</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;存&#8203;在&#8203;し&#8203;て&#8203;い&#8203;る&#8203;key&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">dict_keys([<span class="string"><span class="delimiter">'</span><span class="content">last_hidden_state</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">pooler_output</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">hidden_states</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">past_key_values</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">attentions</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">cross_attentions</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;各&#8203;key&#8203;か&#8203;ら&#8203;取&#8203;得&#8203;で&#8203;き&#8203;る&#8203;情&#8203;報&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>last_hidden_state</code> &#8203;に&#8203;は&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;最&#8203;終&#8203;層&#8203;の&#8203;hidden state&#8203;が&#8203;格&#8203;納&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</li>
<li>
<p><code>pooler_output</code> &#8203;に&#8203;は&#8203;モ&#8203;デ&#8203;ル&#8203;最&#8203;終&#8203;層&#8203;出&#8203;力&#8203;の&#8203;最&#8203;初&#8203;の&#8203;トー&#8203;ク&#8203;ン&#8203;の&#8203;hidden state&#8203;が&#8203;格&#8203;納&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</li>
<li>
<p><code>hidden_states</code> &#8203;に&#8203;は&#8203;モ&#8203;デ&#8203;ル&#8203;各&#8203;層&#8203;の&#8203;出&#8203;力&#8203;全&#8203;て&#8203;の&#8203;hidden state&#8203;が&#8203;格&#8203;納&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</li>
<li>
<p><code>attentions</code> &#8203;は&#8203;attention softmax&#8203;以&#8203;降&#8203;の&#8203;attentions weights&#8203;が&#8203;格&#8203;納&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</li>
<li>
<p><code>cross_attentions</code> &#8203;は&#8203;decoder&#8203;の&#8203;cross-attention&#8203;層&#8203;に&#8203;お&#8203;け&#8203;る、&#8203;attention softmax&#8203;以&#8203;降&#8203;の&#8203;attentions weights&#8203;が&#8203;格&#8203;納&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>　&#8203;一&#8203;般&#8203;的&#8203;に&#8203;BERT&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;は、&#8203;最&#8203;終&#8203;層&#8203;の&#8203;一&#8203;つ&#8203;前&#8203;の&#8203;hidden state&#8203;を&#8203;指&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;も、&#8203;最&#8203;終&#8203;層&#8203;の&#8203;一&#8203;つ&#8203;前&#8203;の&#8203;hidden state&#8203;を&#8203;抽&#8203;出&#8203;し、&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;用&#8203;い&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　hidden state&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;最&#8203;終&#8203;層&#8203;で&#8203;は&#8203;な&#8203;く&#8203;最&#8203;終&#8203;層&#8203;の&#8203;手&#8203;前&#8203;の&#8203;情&#8203;報&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;理&#8203;由&#8203;は、&#8203;最&#8203;終&#8203;層&#8203;は&#8203;個々&#8203;の&#8203;学&#8203;習&#8203;タ&#8203;ス&#8203;ク&#8203;に&#8203;強&#8203;く&#8203;関&#8203;連&#8203;情&#8203;報&#8203;を&#8203;持&#8203;つ&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;に&#8203;は&#8203;一&#8203;般&#8203;的&#8203;に&#8203;よ&#8203;り&#8203;豊&#8203;富&#8203;な&#8203;情&#8203;報&#8203;を&#8203;持&#8203;つ&#8203;最&#8203;終&#8203;層&#8203;の&#8203;手&#8203;前&#8203;を&#8203;使&#8203;用&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;内&#8203;容&#8203;に&#8203;関&#8203;し&#8203;て&#8203;よ&#8203;り&#8203;詳&#8203;し&#8203;く&#8203;知&#8203;り&#8203;た&#8203;い&#8203;場&#8203;合&#8203;は&#8203;<a href="https://bert-as-service.readthedocs.io/en/latest/section/faq.html#why-not-the-last-hidden-layer-why-second-to-last">こちら</a>&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;下&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>　&#8203;以&#8203;下&#8203;の&#8203;コー&#8203;ド&#8203;よ&#8203;り&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">features = output[<span class="string"><span class="delimiter">'</span><span class="content">hidden_states</span><span class="delimiter">'</span></span>][-<span class="integer">2</span>]

<span class="comment"># 確認する。</span>
display(features)
display(features.size())</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">tensor([[[-<span class="float">0.4128</span>, -<span class="float">0.1108</span>, -<span class="float">0.6859</span>,  ...,  <span class="float">0.5316</span>,  <span class="float">0.3867</span>,  <span class="float">0.4347</span>],
         [ <span class="float">0.7700</span>,  <span class="float">0.0892</span>,  <span class="float">0.7817</span>,  ..., -<span class="float">1.0288</span>,  <span class="float">0.4230</span>, -<span class="float">0.8906</span>],
         [ <span class="float">1.2572</span>,  <span class="float">0.3211</span>, -<span class="float">0.6861</span>,  ...,  <span class="float">0.0815</span>,  <span class="float">0.7084</span>, -<span class="float">1.0055</span>],
         ...,
         [ <span class="float">1.0648</span>, -<span class="float">1.3369</span>, -<span class="float">0.2810</span>,  ...,  <span class="float">0.5657</span>,  <span class="float">0.7713</span>, -<span class="float">0.6337</span>],
         [-<span class="float">0.3294</span>, -<span class="float">0.3912</span>,  <span class="float">0.2754</span>,  ..., -<span class="float">0.0620</span>,  <span class="float">1.1760</span>, -<span class="float">0.9139</span>],
         [ <span class="float">0.0639</span>,  <span class="float">0.2225</span>,  <span class="float">0.0474</span>,  ...,  <span class="float">0.1486</span>,  <span class="float">0.0587</span>,  <span class="float">0.0557</span>]]],
       grad_fn=&lt;NativeLayerNormBackward&gt;)

torch.Size([<span class="integer">1</span>, <span class="integer">8</span>, <span class="integer">768</span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　<code>features</code> &#8203;の&#8203;次&#8203;元&#8203;を&#8203;見&#8203;る&#8203;と、&#8203;[1, 8, 768]&#8203;の&#8203;次&#8203;元&#8203;を&#8203;持&#8203;つ&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;ら&#8203;は&#8203;各々&#8203;順&#8203;番&#8203;に&#8203;[&#8203;デー&#8203;タ&#8203;数、&#8203;シー&#8203;ケ&#8203;ン&#8203;ス&#8203;サ&#8203;イ&#8203;ズ、&#8203;hidden state&#8203;の&#8203;サ&#8203;イ&#8203;ズ&#8203;]&#8203;を&#8203;表&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;一&#8203;つ&#8203;注&#8203;意&#8203;す&#8203;べ&#8203;き&#8203;と&#8203;こ&#8203;ろ&#8203;は、&#8203;長&#8203;さ&#8203;の&#8203;異&#8203;な&#8203;る&#8203;sequence&#8203;を&#8203;入&#8203;力&#8203;す&#8203;る&#8203;と、&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;ベ&#8203;ク&#8203;ト&#8203;ル&#8203;の&#8203;サ&#8203;イ&#8203;ズ&#8203;が&#8203;変&#8203;わっ&#8203;て&#8203;く&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">text = <span class="string"><span class="delimiter">'</span><span class="content">こちらでは、より長い文章を用いて特徴量を抽出してみましょう。</span><span class="delimiter">'</span></span>
encoded = SentimentGenerator.bert_tokenizer.encode_plus(
    text,
    <span class="predefined-constant">None</span>,
    add_special_tokens=<span class="predefined-constant">True</span>,
    return_token_type_ids=<span class="predefined-constant">True</span>,
    truncation=<span class="predefined-constant">True</span>,
)

input_ids = torch.tensor([encoded[<span class="string"><span class="delimiter">'</span><span class="content">input_ids</span><span class="delimiter">'</span></span>]], dtype=torch.long).to(SentimentGenerator.device)
token_type_ids = torch.tensor([encoded[<span class="string"><span class="delimiter">'</span><span class="content">token_type_ids</span><span class="delimiter">'</span></span>]], dtype=torch.long).to(SentimentGenerator.device)
attention_mask = torch.tensor([encoded[<span class="string"><span class="delimiter">'</span><span class="content">attention_mask</span><span class="delimiter">'</span></span>]], dtype=torch.long).to(SentimentGenerator.device)

output = SentimentGenerator.feature_extractor(input_ids=input_ids, token_type_ids=token_type_ids, attention_mask=attention_mask)
features = output[<span class="string"><span class="delimiter">'</span><span class="content">hidden_states</span><span class="delimiter">'</span></span>][-<span class="integer">2</span>]

<span class="comment"># 確認する</span>
features.size()</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;dimension1&#8203;の&#8203;シー&#8203;ケ&#8203;ン&#8203;ス&#8203;サ&#8203;イ&#8203;ズ&#8203;の&#8203;箇&#8203;所&#8203;の&#8203;次&#8203;元&#8203;が&#8203;変&#8203;わっ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">torch.Size([<span class="integer">1</span>, <span class="integer">22</span>, <span class="integer">768</span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は&#8203;dimension1&#8203;の&#8203;次&#8203;元&#8203;を&#8203;平&#8203;均&#8203;化&#8203;し&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;扱&#8203;う&#8203;た&#8203;め、&#8203;シー&#8203;ク&#8203;エ&#8203;ン&#8203;ス&#8203;の&#8203;違&#8203;い&#8203;は&#8203;そ&#8203;れ&#8203;ほ&#8203;ど&#8203;問&#8203;題&#8203;と&#8203;は&#8203;な&#8203;り&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;並&#8203;列&#8203;化&#8203;す&#8203;る&#8203;上&#8203;で&#8203;は&#8203;問&#8203;題&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;シー&#8203;ケ&#8203;ン&#8203;ス&#8203;の&#8203;異&#8203;な&#8203;る&#8203;ベ&#8203;ク&#8203;ト&#8203;ル&#8203;を&#8203;重&#8203;ね&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;な&#8203;い&#8203;か&#8203;ら&#8203;で&#8203;す。&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;問&#8203;題&#8203;を&#8203;扱&#8203;う&#8203;た&#8203;め、&#8203;subwords&#8203;の&#8203;シー&#8203;ケ&#8203;ン&#8203;ス&#8203;の&#8203;max_length&#8203;を&#8203;決&#8203;め、&#8203;そ&#8203;れ&#8203;よ&#8203;り&#8203;短&#8203;い&#8203;場&#8203;合&#8203;は&#8203;max_length&#8203;の&#8203;長&#8203;さ&#8203;と&#8203;な&#8203;る&#8203;よ&#8203;う&#8203;に、&#8203;ベ&#8203;ク&#8203;ト&#8203;ル&#8203;の&#8203;末&#8203;端&#8203;を&#8203;0&#8203;で&#8203;埋&#8203;め&#8203;る&#8203;zero padding&#8203;が&#8203;よ&#8203;く&#8203;使&#8203;わ&#8203;れ&#8203;ま&#8203;す。&#8203;前&#8203;処&#8203;理&#8203;を&#8203;行&#8203;う&#8203;際&#8203;に&#8203;max_length&#8203;の&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203;を&#8203;渡&#8203;し、&#8203;padding='max_legnth'&#8203;を&#8203;指&#8203;定&#8203;す&#8203;る&#8203;と、&#8203;max_length&#8203;の&#8203;長&#8203;さ&#8203;が&#8203;な&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;zero padding&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">text = <span class="string"><span class="delimiter">'</span><span class="content">こちらでは、より長い文章を用いて特徴量を抽出してみましょう。</span><span class="delimiter">'</span></span>
encoded = SentimentGenerator.bert_tokenizer.encode_plus(
    text,
    <span class="predefined-constant">None</span>,
    max_length=<span class="integer">512</span>,
    padding=<span class="string"><span class="delimiter">'</span><span class="content">max_length</span><span class="delimiter">'</span></span>,
    add_special_tokens=<span class="predefined-constant">True</span>,
    return_token_type_ids=<span class="predefined-constant">True</span>,
    truncation=<span class="predefined-constant">True</span>,
)

<span class="comment"># 確認する</span>
encoded</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;zero padding&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">{<span class="string"><span class="delimiter">'</span><span class="content">input_ids</span><span class="delimiter">'</span></span>: [<span class="integer">2</span>, <span class="integer">4871</span>, <span class="integer">12</span>, <span class="integer">9</span>, <span class="integer">6</span>, <span class="integer">221</span>, <span class="integer">2894</span>, <span class="integer">7204</span>, <span class="integer">11</span>, <span class="integer">585</span>, <span class="integer">16</span>, <span class="integer">1427</span>, <span class="integer">1073</span>, <span class="integer">11</span>, <span class="integer">11674</span>, <span class="integer">15</span>, <span class="integer">16</span>, <span class="integer">546</span>, <span class="integer">17015</span>, <span class="integer">205</span>, <span class="integer">8</span>, <span class="integer">3</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>], <span class="string"><span class="delimiter">'</span><span class="content">token_type_ids</span><span class="delimiter">'</span></span>: [<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>], <span class="string"><span class="delimiter">'</span><span class="content">attention_mask</span><span class="delimiter">'</span></span>: [<span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">1</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;そ&#8203;れ&#8203;で&#8203;は、&#8203;異&#8203;な&#8203;る&#8203;長&#8203;さ&#8203;を&#8203;持&#8203;つ&#8203;複&#8203;数&#8203;の&#8203;文&#8203;章&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;padding&#8203;さ&#8203;れ&#8203;た&#8203;input&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;同&#8203;時&#8203;に&#8203;入&#8203;力&#8203;し&#8203;並&#8203;列&#8203;に&#8203;処&#8203;理&#8203;さ&#8203;れ&#8203;る&#8203;か&#8203;確&#8203;認&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">texts = [<span class="string"><span class="delimiter">'</span><span class="content">短いテキスト</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">少し長いテキストです</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">長い長い長い長いテキストです</span><span class="delimiter">'</span></span>]

input_ids = []
token_type_ids = []
attention_mask = []
<span class="keyword">for</span> text <span class="keyword">in</span> texts:
    encoded = SentimentGenerator.bert_tokenizer.encode_plus(
        text,
        <span class="predefined-constant">None</span>,
        add_special_tokens=<span class="predefined-constant">True</span>,
        max_length=<span class="integer">512</span>,
        padding=<span class="string"><span class="delimiter">&quot;</span><span class="content">max_length</span><span class="delimiter">&quot;</span></span>,
        return_token_type_ids=<span class="predefined-constant">True</span>,
        truncation=<span class="predefined-constant">True</span>,
    )

    input_ids.append(encoded[<span class="string"><span class="delimiter">'</span><span class="content">input_ids</span><span class="delimiter">'</span></span>])
    token_type_ids.append(encoded[<span class="string"><span class="delimiter">'</span><span class="content">token_type_ids</span><span class="delimiter">'</span></span>])
    attention_mask.append(encoded[<span class="string"><span class="delimiter">'</span><span class="content">attention_mask</span><span class="delimiter">'</span></span>])

input_ids = torch.tensor(input_ids, dtype=torch.long).to(SentimentGenerator.device)
token_type_ids = torch.tensor(token_type_ids, dtype=torch.long).to(SentimentGenerator.device)
attention_mask = torch.tensor(attention_mask, dtype=torch.long).to(SentimentGenerator.device)

output = SentimentGenerator.feature_extractor(input_ids=input_ids, token_type_ids=token_type_ids, attention_mask=attention_mask)
features = output[<span class="string"><span class="delimiter">'</span><span class="content">hidden_states</span><span class="delimiter">'</span></span>][-<span class="integer">2</span>]

<span class="comment"># 確認する</span>
features.size()</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;[3&#8203;つ&#8203;の&#8203;文&#8203;章、&#8203;シー&#8203;ケ&#8203;ン&#8203;ス&#8203;の&#8203;長&#8203;さ、&#8203;hidden state]&#8203;の&#8203;次&#8203;元&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;取&#8203;得&#8203;で&#8203;き、&#8203;dimention1&#8203;は&#8203;指&#8203;定&#8203;し&#8203;た&#8203;max_length&#8203;で&#8203;あ&#8203;る&#8203;512&#8203;に&#8203;一&#8203;致&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;リ&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">torch.Size([<span class="integer">3</span>, <span class="integer">512</span>, <span class="integer">768</span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は&#8203;最&#8203;終&#8203;的&#8203;に、&#8203;dimension1&#8203;を&#8203;平&#8203;均&#8203;化&#8203;し&#8203;て、&#8203;各&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;ご&#8203;と&#8203;に&#8203;768&#8203;次&#8203;元&#8203;の&#8203;ベ&#8203;ク&#8203;ト&#8203;ル&#8203;を&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;抽&#8203;出&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">features = features.mean(dim=<span class="integer">1</span>)

<span class="comment"># 確認する</span>
features.size()</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">torch.Size([<span class="integer">3</span>, <span class="integer">768</span>])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_本番提出用のクラスへ組み込み_6">5.8.4. 本番提出用のクラスへ組み込み</h4>
<div class="paragraph">
<p>上&#8203;記&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;纏&#8203;め、&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;か&#8203;ら&#8203;前&#8203;処&#8203;理&#8203;を&#8203;行&#8203;い、&#8203;モ&#8203;デ&#8203;ル&#8203;入&#8203;力&#8203;に&#8203;必&#8203;要&#8203;な&#8203;各々&#8203;の&#8203;ベ&#8203;ク&#8203;ト&#8203;ル&#8203;を&#8203;返&#8203;す&#8203;関&#8203;数&#8203;を&#8203; <code>SentimentGenerator</code> &#8203;ク&#8203;ラ&#8203;ス&#8203;に&#8203;追&#8203;加&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">build_inputs</span>(cls, texts, max_length=<span class="integer">512</span>):
    input_ids = []
    token_type_ids = []
    attention_mask = []
    <span class="keyword">for</span> text <span class="keyword">in</span> texts:
        encoded = cls.bert_tokenizer.encode_plus(
            text,
            <span class="predefined-constant">None</span>,
            add_special_tokens=<span class="predefined-constant">True</span>,
            max_length=max_length,
            padding=<span class="string"><span class="delimiter">&quot;</span><span class="content">max_length</span><span class="delimiter">&quot;</span></span>,
            return_token_type_ids=<span class="predefined-constant">True</span>,
            truncation=<span class="predefined-constant">True</span>,
        )

        input_ids.append(encoded[<span class="string"><span class="delimiter">'</span><span class="content">input_ids</span><span class="delimiter">'</span></span>])
        token_type_ids.append(encoded[<span class="string"><span class="delimiter">'</span><span class="content">token_type_ids</span><span class="delimiter">'</span></span>])
        attention_mask.append(encoded[<span class="string"><span class="delimiter">'</span><span class="content">attention_mask</span><span class="delimiter">'</span></span>])

    <span class="comment"># torchモデルに入力するためにはtensor形式に変え、deviceを指定する必要がある。</span>
    input_ids = torch.tensor(input_ids, dtype=torch.long).to(cls.device)
    token_type_ids = torch.tensor(token_type_ids, dtype=torch.long).to(cls.device)
    attention_mask = torch.tensor(attention_mask, dtype=torch.long).to(cls.device)

    <span class="keyword">return</span> input_ids, token_type_ids, attention_mask

<span class="comment"># 上記のコードでビルドしたベクトルをモデルに入力し、特徴量を抽出するコードを作成</span>
<span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">generate_features</span>(cls, input_ids, token_type_ids, attention_mask):
    output = cls.feature_extractor(input_ids=input_ids, token_type_ids=token_type_ids, attention_mask=attention_mask)
    features = output[<span class="string"><span class="delimiter">'</span><span class="content">hidden_states</span><span class="delimiter">'</span></span>][-<span class="integer">2</span>].mean(dim=<span class="integer">1</span>).cpu().detach().numpy()

    <span class="keyword">return</span> features


<span class="comment"># コーパス全体から特徴量を抽出するため、コーパス全体を同時にモデルへ入力することはメモリーの上限を遥かに超えてしまうので不可能に近い。</span>
<span class="comment"># 入力するコーパスを数回に分割し、上記で作成したコードbuild_inputsとgenerate_featuresを用いて並列化処理を行うため、以下のコードを作成する。</span>
<span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">generate_features_by_texts</span>(cls, texts, batch_size=<span class="integer">2</span>, max_length=<span class="integer">512</span>):
    n_batch = math.ceil(<span class="predefined">len</span>(texts) / batch_size)

    features = []
    <span class="keyword">for</span> idx <span class="keyword">in</span> tqdm(<span class="predefined">range</span>(n_batch)):
        input_ids, token_type_ids, attention_mask = cls.build_inputs(texts=texts[batch_size*idx:batch_size*(idx+<span class="integer">1</span>)], max_length=max_length)

        features.append(cls.generate_features(input_ids=input_ids, token_type_ids=token_type_ids, attention_mask=attention_mask))

    features = np.concatenate(features, axis=<span class="integer">0</span>)

    <span class="comment"># 抽出した特徴量はnp.ndarray形式となっており、これらは、日付の情報を失っているため、pd.DataFrame形式に変換する。</span>
    <span class="keyword">return</span> pd.DataFrame(features, index=texts.index)

<span class="comment"># SentimentGeneratorに定義したclassmethodを追加する</span>
SentimentGenerator.build_inputs = build_inputs
SentimentGenerator.generate_features = generate_features
SentimentGenerator.generate_features_by_texts = generate_features_by_texts

<span class="comment"># SentimentGenerator使用する全体流れを記述</span>
articles = SentimentGenerator.load_articles(path=CONFIG[<span class="string"><span class="delimiter">&quot;</span><span class="content">article_path</span><span class="delimiter">&quot;</span></span>])
articles = SentimentGenerator.normalize_articles(articles)
articles = SentimentGenerator.handle_punctuations_in_articles(articles)
articles = SentimentGenerator.drop_remove_list_words(articles)

SentimentGenerator._set_device()
SentimentGenerator._build_feature_extractor()
SentimentGenerator._build_tokenizer()

<span class="comment"># 以下のコードでコーパス全体の特徴量を抽出できる。しかし、抽出には長い時間が要求されるため、注意。</span>
headline_features = SentimentGenerator.generate_features_by_texts(texts=articles[<span class="string"><span class="delimiter">'</span><span class="content">headline</span><span class="delimiter">'</span></span>])
keywords_features = SentimentGenerator.generate_features_by_texts(texts=articles[<span class="string"><span class="delimiter">'</span><span class="content">keywords</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;そ&#8203;れ&#8203;で&#8203;は&#8203;上&#8203;記&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;実&#8203;行&#8203;し&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;抽&#8203;出&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;しょ&#8203;う。&#8203;こ&#8203;の&#8203;処&#8203;理&#8203;は&#8203;非&#8203;常&#8203;に&#8203;時&#8203;間&#8203;が&#8203;か&#8203;か&#8203;る&#8203;(GPU&#8203;が&#8203;あ&#8203;る&#8203;環&#8203;境&#8203;で&#8203;数&#8203;時&#8203;間、&#8203;GPU&#8203;が&#8203;な&#8203;い&#8203;と&#8203;数&#8203;十&#8203;時&#8203;間&#8203;必&#8203;要&#8203;)&#8203;た&#8203;め、&#8203;実&#8203;行&#8203;結&#8203;果&#8203;は&#8203;PKL&#8203;ファ&#8203;イ&#8203;ル&#8203;で&#8203;別&#8203;途&#8203;提&#8203;供&#8203;致&#8203;し&#8203;ま&#8203;す。&#8203;詳&#8203;細&#8203;は&#8203;<a href="#anchor-5.2">5.2. &#8203;実&#8203;行&#8203;環&#8203;境&#8203;</a>&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;も&#8203;し、&#8203;ご&#8203;自&#8203;分&#8203;の&#8203;環&#8203;境&#8203;で&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;を&#8203;実&#8203;行&#8203;し&#8203;た&#8203;場&#8203;合&#8203;は、&#8203;そ&#8203;の&#8203;結&#8203;果&#8203;を&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;PKL&#8203;ファ&#8203;イ&#8203;ル&#8203;で&#8203;保&#8203;存&#8203;し&#8203;て&#8203;お&#8203;く&#8203;こ&#8203;と&#8203;を&#8203;お&#8203;す&#8203;す&#8203;め&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># pklファイルとして保存しておく。</span>
headline_features.to_pickle(f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/headline_features/headline_features.pkl</span><span class="delimiter">'</span></span>)
keywords_features.to_pickle(f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/keywords_features/keywords_features.pkl</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pcaによるスコア化">5.8.5. PCAによるスコア化</h4>
<div class="paragraph">
<p>　BERT&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;は&#8203;高&#8203;次&#8203;元&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;で&#8203;あ&#8203;り、&#8203;機&#8203;械&#8203;学&#8203;習&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;利&#8203;用&#8203;す&#8203;る&#8203;場&#8203;合&#8203;に&#8203;は、&#8203;な&#8203;ん&#8203;ら&#8203;か&#8203;の&#8203;単&#8203;一&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;に&#8203;変&#8203;換&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;デー&#8203;タ&#8203;の&#8203;次&#8203;元&#8203;圧&#8203;縮&#8203;テ&#8203;ク&#8203;ニッ&#8203;ク&#8203;の&#8203;一&#8203;つ&#8203;と&#8203;し&#8203;て&#8203;主&#8203;成&#8203;分&#8203;分&#8203;析&#8203;(PCA:principal component analysis)&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;主&#8203;成&#8203;分&#8203;分&#8203;析&#8203;と&#8203;は、&#8203;多&#8203;変&#8203;量&#8203;解&#8203;析&#8203;手&#8203;法&#8203;の&#8203;う&#8203;ち&#8203;次&#8203;元&#8203;削&#8203;減&#8203;手&#8203;法&#8203;と&#8203;し&#8203;て&#8203;よ&#8203;く&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;る&#8203;手&#8203;法&#8203;の&#8203;一&#8203;種&#8203;で、&#8203;相&#8203;関&#8203;の&#8203;あ&#8203;る&#8203;多&#8203;変&#8203;数&#8203;か&#8203;ら、&#8203;相&#8203;関&#8203;の&#8203;な&#8203;い&#8203;少&#8203;数&#8203;で&#8203;全&#8203;体&#8203;の&#8203;ば&#8203;ら&#8203;つ&#8203;き&#8203;を&#8203;最&#8203;も&#8203;よ&#8203;く&#8203;表&#8203;す&#8203;変&#8203;数&#8203;を&#8203;合&#8203;成&#8203;す&#8203;る&#8203;も&#8203;の&#8203;で&#8203;す。&#8203;(&#8203;引&#8203;用&#8203;:<a href="https://qiita.com/maskot1977/items/082557fcda78c4cdb41f">Qiita:主成分分析を Python &#8203;で&#8203;理&#8203;解&#8203;す&#8203;る&#8203;</a>)。&#8203;PCA&#8203;に&#8203;は&#8203;通&#8203;常&#8203;の&#8203;PCA&#8203;と&#8203;カー&#8203;ネ&#8203;ル&#8203;PCA&#8203;が&#8203;あ&#8203;り、&#8203;２&#8203;つ&#8203;の&#8203;挙&#8203;動&#8203;は&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;異&#8203;な&#8203;る&#8203;の&#8203;で、&#8203;用&#8203;途&#8203;な&#8203;ど&#8203;を&#8203;考&#8203;慮&#8203;し&#8203;て&#8203;使&#8203;う&#8203;も&#8203;の&#8203;を&#8203;決&#8203;め&#8203;ま&#8203;す。&#8203; ( &#8203;引&#8203;用&#8203;: <a href="https://qiita.com/NoriakiOshita/items/138c10eada03938fcd79">カーネル主成分分析とは</a> )。</p>
</div>
<div class="paragraph">
<p>　&#8203;例&#8203;え&#8203;ば、&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;コー&#8203;ド&#8203;で&#8203;PCA&#8203;を&#8203;用&#8203;い&#8203;て&#8203;次&#8203;元&#8203;圧&#8203;縮&#8203;を&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;BERT&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;は&#8203;単&#8203;一&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;に&#8203;な&#8203;り、&#8203;機&#8203;械&#8203;学&#8203;習&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;扱&#8203;い&#8203;や&#8203;す&#8203;く&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 次元圧縮関数(PCA/KPCA)の定義</span>
<span class="keyword">def</span> <span class="function">_build_compressor</span>(compress_method):
    <span class="keyword">assert</span> compress_method <span class="keyword">in</span> (<span class="string"><span class="delimiter">'</span><span class="content">pca</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">kpca</span><span class="delimiter">'</span></span>)
    <span class="keyword">if</span> compress_method == <span class="string"><span class="delimiter">'</span><span class="content">pca</span><span class="delimiter">'</span></span>:
        <span class="keyword">return</span> PCA(n_components=<span class="integer">1</span>)

    <span class="keyword">if</span> compress_method == <span class="string"><span class="delimiter">'</span><span class="content">kpca</span><span class="delimiter">'</span></span>:
        <span class="keyword">return</span> KernelPCA(kernel=<span class="string"><span class="delimiter">'</span><span class="content">rbf</span><span class="delimiter">'</span></span>, n_components=<span class="integer">1</span>)

<span class="comment"># 次元圧縮処理を実施する関数</span>
<span class="keyword">def</span> <span class="function">compress_feature_n_samples</span>(features, compress_method, max_samples=<span class="integer">500</span>):
    feature_compressor = _build_compressor(compress_method=compress_method)
    compressed_features = pd.Series(feature_compressor.fit_transform(features).reshape(-<span class="integer">1</span>), index=features.index)

    sample_compressor = _build_compressor(compress_method=compress_method)

    weekly_group = pd.Series(<span class="predefined">zip</span>(compressed_features.index.year, compressed_features.index.week), index=compressed_features.index)
    grouped_compressed_features = compressed_features.groupby(weekly_group).apply(<span class="keyword">lambda</span> x: x[-max_samples:].reset_index(drop=<span class="predefined-constant">True</span>)).unstack()

    <span class="keyword">return</span> pd.Series(sample_compressor.fit_transform(grouped_compressed_features).reshape(-<span class="integer">1</span>), index=grouped_compressed_features.index)

<span class="comment"># 上記関数を用いてスコアを生成しPKLファイルに保存しています。モデルやバックテストに利用可能です。</span>
<span class="keyword">for</span> features, feature_type <span class="keyword">in</span> [(headline_features, <span class="string"><span class="delimiter">'</span><span class="content">headline_features</span><span class="delimiter">'</span></span>), (keywords_features, <span class="string"><span class="delimiter">'</span><span class="content">keywords_features</span><span class="delimiter">'</span></span>)]:
    <span class="keyword">for</span> compress_method <span class="keyword">in</span> [<span class="string"><span class="delimiter">'</span><span class="content">pca</span><span class="delimiter">'</span></span>]:
        compress_feature_n_samples(features=features, compress_method=compress_method).to_pickle(f<span class="string"><span class="delimiter">'</span><span class="content">{feature_type}_{compress_method}.pkl</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;で&#8203;取&#8203;得&#8203;し&#8203;た&#8203;PCA&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;は、&#8203;何&#8203;か&#8203;目&#8203;的&#8203;を&#8203;もっ&#8203;て&#8203;学&#8203;習&#8203;さ&#8203;せ&#8203;た&#8203;も&#8203;の&#8203;で&#8203;は&#8203;な&#8203;い&#8203;た&#8203;め、&#8203;単&#8203;体&#8203;で&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;に&#8203;利&#8203;用&#8203;す&#8203;る&#8203;の&#8203;は&#8203;難&#8203;し&#8203;い&#8203;と&#8203;思&#8203;わ&#8203;れ&#8203;ま&#8203;す&#8203;が、&#8203;機&#8203;械&#8203;学&#8203;習&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て、&#8203;例&#8203;え&#8203;ば&#8203;random forest&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;な&#8203;ど&#8203;に&#8203;は&#8203;そ&#8203;の&#8203;ま&#8203;ま&#8203;PCA&#8203;ス&#8203;コ&#8203;ア&#8203;を&#8203;投&#8203;入&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;可&#8203;能&#8203;で&#8203;す。&#8203;よ&#8203;り&#8203;シ&#8203;ン&#8203;プ&#8203;ル&#8203;な&#8203;利&#8203;用&#8203;方&#8203;法&#8203;と&#8203;し&#8203;て、&#8203;例&#8203;え&#8203;ば&#8203;PCA&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;と&#8203;連&#8203;動&#8203;し&#8203;や&#8203;す&#8203;い&#8203;銘&#8203;柄&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;相&#8203;関&#8203;係&#8203;数&#8203;な&#8203;ど&#8203;を&#8203;利&#8203;用&#8203;し&#8203;て&#8203;解&#8203;析&#8203;し、&#8203;PCA&#8203;ス&#8203;コ&#8203;ア&#8203;に&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;次&#8203;週&#8203;の&#8203;取&#8203;引&#8203;対&#8203;象&#8203;銘&#8203;柄&#8203;を&#8203;限&#8203;定&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;な&#8203;ア&#8203;プ&#8203;ロー&#8203;チ&#8203;も&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;章&#8203;で&#8203;は&#8203;BERT&#8203;を&#8203;用&#8203;い&#8203;て&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;か&#8203;ら&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;を&#8203;行っ&#8203;て&#8203;き&#8203;ま&#8203;し&#8203;た。&#8203;本&#8203;章&#8203;の&#8203;最&#8203;後&#8203;に&#8203;紹&#8203;介&#8203;し&#8203;た&#8203;PCA&#8203;に&#8203;よ&#8203;る&#8203;次&#8203;元&#8203;圧&#8203;縮&#8203;で&#8203;は、&#8203;圧&#8203;縮&#8203;時&#8203;に&#8203;目&#8203;的&#8203;関&#8203;数&#8203;を&#8203;設&#8203;定&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;で&#8203;き&#8203;な&#8203;い&#8203;た&#8203;め&#8203;に、&#8203;特&#8203;定&#8203;の&#8203;目&#8203;的&#8203;の&#8203;た&#8203;め&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;と&#8203;は&#8203;言&#8203;え&#8203;ま&#8203;せ&#8203;ん。&#8203;そ&#8203;こ&#8203;で&#8203;次&#8203;章&#8203;で&#8203;は、&#8203;リ&#8203;カ&#8203;レ&#8203;ン&#8203;ト&#8203;ニュー&#8203;ラ&#8203;ル&#8203;ネッ&#8203;ト&#8203;ワー&#8203;ク&#8203;で&#8203;あ&#8203;る&#8203;LSTM&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;週&#8203;毎&#8203;の&#8203;可&#8203;変&#8203;な&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;統&#8203;合&#8203;し&#8203;単&#8203;一&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;に&#8203;す&#8203;る&#8203;手&#8203;法&#8203;を&#8203;紹&#8203;介&#8203;し、&#8203;こ&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;を&#8203;活&#8203;用&#8203;す&#8203;る&#8203;方&#8203;法&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bert特徴量を用いてポートフォリオを構築しよう">6. BERT特徴量を用いてポートフォリオを構築しよう</h2>
<div class="sectionbody">
<div class="paragraph">
<p>　5&#8203;章&#8203;で&#8203;は&#8203;BERT&#8203;を&#8203;用&#8203;い&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;お&#8203;よ&#8203;び&#8203;簡&#8203;単&#8203;な&#8203;PCA&#8203;に&#8203;よ&#8203;る&#8203;ス&#8203;コ&#8203;ア&#8203;化&#8203;の&#8203;手&#8203;法&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;し&#8203;た。&#8203;PCA&#8203;は&#8203;次&#8203;元&#8203;圧&#8203;縮&#8203;の&#8203;代&#8203;表&#8203;的&#8203;な&#8203;手&#8203;法&#8203;で&#8203;す&#8203;が、&#8203;次&#8203;元&#8203;圧&#8203;縮&#8203;時&#8203;に&#8203;目&#8203;的&#8203;関&#8203;数&#8203;を&#8203;設&#8203;定&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;な&#8203;い&#8203;た&#8203;め&#8203;に、&#8203;特&#8203;定&#8203;の&#8203;目&#8203;的&#8203;に&#8203;合&#8203;わ&#8203;せ&#8203;た&#8203;ス&#8203;コ&#8203;ア&#8203;で&#8203;は&#8203;あ&#8203;り&#8203;ま&#8203;せ&#8203;ん。</p>
</div>
<div class="paragraph">
<p>　&#8203;そ&#8203;の&#8203;た&#8203;め，&#8203;本&#8203;章&#8203;で&#8203;は&#8203;LSTM&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;週&#8203;毎&#8203;の&#8203;可&#8203;変&#8203;な&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;統&#8203;合&#8203;し&#8203;単&#8203;一&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;に&#8203;す&#8203;る&#8203;手&#8203;法&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;手&#8203;法&#8203;を&#8203;紹&#8203;介&#8203;す&#8203;る&#8203;理&#8203;由&#8203;は、&#8203;LSTM&#8203;は&#8203;目&#8203;的&#8203;関&#8203;数&#8203;を&#8203;設&#8203;定&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き、&#8203;BERT&#8203;特&#8203;徴&#8203;量&#8203;か&#8203;ら&#8203;特&#8203;定&#8203;の&#8203;目&#8203;的&#8203;に&#8203;合&#8203;致&#8203;し&#8203;た&#8203;ス&#8203;コ&#8203;ア&#8203;を&#8203;構&#8203;築&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;可&#8203;能&#8203;と&#8203;な&#8203;る&#8203;た&#8203;め&#8203;で&#8203;す。&#8203;実&#8203;際&#8203;に&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;活&#8203;用&#8203;す&#8203;る&#8203;場&#8203;合&#8203;は、&#8203;そ&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;用&#8203;い&#8203;て&#8203;何&#8203;か&#8203;を&#8203;予&#8203;測&#8203;し&#8203;た&#8203;い&#8203;と&#8203;考&#8203;え&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;多&#8203;く、&#8203;目&#8203;的&#8203;変&#8203;数&#8203;を&#8203;設&#8203;定&#8203;で&#8203;き&#8203;る&#8203;レ&#8203;イ&#8203;ヤー&#8203;を&#8203;構&#8203;築&#8203;し&#8203;て、&#8203;用&#8203;途&#8203;に&#8203;特&#8203;化&#8203;し&#8203;た&#8203;ス&#8203;コ&#8203;ア&#8203;を&#8203;活&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;を&#8203;可&#8203;能&#8203;と&#8203;な&#8203;り、&#8203;応&#8203;用&#8203;可&#8203;能&#8203;性&#8203;が&#8203;広&#8203;が&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;な&#8203;お、&#8203;本&#8203;章&#8203;は&#8203;LSTM&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;ディー&#8203;プ&#8203;ニュー&#8203;ラ&#8203;ル&#8203;ネッ&#8203;ト&#8203;ワー&#8203;ク&#8203;を&#8203;活&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;習&#8203;熟&#8203;し&#8203;て&#8203;い&#8203;る&#8203;方&#8203;を&#8203;対&#8203;象&#8203;と&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;ア&#8203;ド&#8203;バ&#8203;ン&#8203;ス&#8203;な&#8203;知&#8203;識&#8203;を&#8203;前&#8203;提&#8203;と&#8203;し&#8203;た&#8203;章&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;ディー&#8203;プ&#8203;ニュー&#8203;ラ&#8203;ル&#8203;ネッ&#8203;ト&#8203;ワー&#8203;ク&#8203;自&#8203;体&#8203;の&#8203;説&#8203;明&#8203;は&#8203;あ&#8203;り&#8203;ま&#8203;せ&#8203;ん。&#8203;5&#8203;章&#8203;で&#8203;抽&#8203;出&#8203;し&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;で&#8203;も&#8203;様々&#8203;な&#8203;活&#8203;用&#8203;が&#8203;可&#8203;能&#8203;で&#8203;す&#8203;の&#8203;で、&#8203;本&#8203;章&#8203;は&#8203;発&#8203;展&#8203;的&#8203;な&#8203;内&#8203;容&#8203;と&#8203;し&#8203;て&#8203;ご&#8203;活&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;章&#8203;の&#8203;最&#8203;後&#8203;で&#8203;は、&#8203;5&#8203;章&#8203;お&#8203;よ&#8203;び&#8203;6&#8203;章&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;使&#8203;用&#8203;し&#8203;た&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;構&#8203;築&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;実&#8203;装&#8203;例&#8203;と&#8203;動&#8203;作&#8203;確&#8203;認&#8203;方&#8203;法&#8203;を&#8203;記&#8203;載&#8203;し&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;ご&#8203;自&#8203;身&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;実&#8203;装&#8203;さ&#8203;れ&#8203;る&#8203;際&#8203;に&#8203;参&#8203;考&#8203;と&#8203;し&#8203;て&#8203;ご&#8203;活&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="sect2">
<h3 id="_予測対象の検討">6.1. 予測対象の検討</h3>
<div class="paragraph">
<p>　5&#8203;章&#8203;で&#8203;BERT&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;抽&#8203;出&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;し&#8203;た&#8203;が、&#8203;特&#8203;徴&#8203;量&#8203;は&#8203;ニュー&#8203;ス&#8203;毎&#8203;に&#8203;取&#8203;得&#8203;で&#8203;き&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;毎&#8203;週&#8203;数&#8203;千&#8203;の&#8203;ニュー&#8203;ス&#8203;に&#8203;対&#8203;し&#8203;て&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;特&#8203;徴&#8203;量&#8203;が&#8203;出&#8203;力&#8203;さ&#8203;れ&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;ま&#8203;ず&#8203;は、&#8203;こ&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;活&#8203;用&#8203;し&#8203;て&#8203;何&#8203;を&#8203;予&#8203;測&#8203;す&#8203;る&#8203;か&#8203;目&#8203;的&#8203;を&#8203;決&#8203;め&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;シ&#8203;ン&#8203;プ&#8203;ル&#8203;に&#8203;次&#8203;の&#8203;週&#8203;に&#8203;ど&#8203;の&#8203;銘&#8203;柄&#8203;が&#8203;値&#8203;上&#8203;が&#8203;り&#8203;す&#8203;る&#8203;か&#8203;を&#8203;予&#8203;測&#8203;で&#8203;き&#8203;れ&#8203;ば、&#8203;手っ&#8203;取&#8203;り&#8203;早&#8203;く&#8203;収&#8203;益&#8203;を&#8203;上&#8203;げ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;そ&#8203;う&#8203;で&#8203;す。&#8203;た&#8203;だ&#8203;し、&#8203;各&#8203;週&#8203;の&#8203;数&#8203;千&#8203;個&#8203;の&#8203;ニュー&#8203;ス&#8203;を&#8203;利&#8203;用&#8203;し&#8203;て、&#8203;次&#8203;の&#8203;週&#8203;に&#8203;値&#8203;上&#8203;が&#8203;り&#8203;す&#8203;る&#8203;銘&#8203;柄&#8203;を&#8203;予&#8203;測&#8203;す&#8203;る&#8203;に&#8203;は、&#8203;ニュー&#8203;ス&#8203;数&#8203;と&#8203;銘&#8203;柄&#8203;数&#8203;の&#8203;バ&#8203;ラ&#8203;ン&#8203;ス&#8203;を&#8203;考&#8203;え&#8203;て&#8203;も&#8203;少&#8203;し&#8203;難&#8203;し&#8203;い&#8203;課&#8203;題&#8203;に&#8203;な&#8203;り&#8203;そ&#8203;う&#8203;で&#8203;す。&#8203;ま&#8203;た、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;課&#8203;題&#8203;に&#8203;お&#8203;い&#8203;て&#8203;は、&#8203;購&#8203;入&#8203;原&#8203;資&#8203;産&#8203;全&#8203;て&#8203;を&#8203;銘&#8203;柄&#8203;購&#8203;入&#8203;に&#8203;利&#8203;用&#8203;す&#8203;る&#8203;必&#8203;要&#8203;は&#8203;な&#8203;く、&#8203;一&#8203;部&#8203;は&#8203;現&#8203;金&#8203;で&#8203;保&#8203;持&#8203;で&#8203;き&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;着&#8203;目&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;マー&#8203;ケッ&#8203;ト&#8203;全&#8203;体&#8203;が&#8203;値&#8203;下&#8203;が&#8203;り&#8203;す&#8203;る&#8203;と&#8203;き&#8203;に&#8203;す&#8203;べ&#8203;て&#8203;の&#8203;現&#8203;金&#8203;を&#8203;銘&#8203;柄&#8203;購&#8203;入&#8203;に&#8203;利&#8203;用&#8203;す&#8203;る&#8203;と&#8203;収&#8203;益&#8203;が&#8203;低&#8203;下&#8203;す&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;つ&#8203;ま&#8203;り、&#8203;次&#8203;の&#8203;週&#8203;に&#8203;マー&#8203;ケッ&#8203;ト&#8203;が&#8203;下&#8203;落&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;れ&#8203;ば、&#8203;現&#8203;金&#8203;比&#8203;率&#8203;を&#8203;高&#8203;め&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;よっ&#8203;て、&#8203;マー&#8203;ケッ&#8203;ト&#8203;全&#8203;体&#8203;の&#8203;下&#8203;落&#8203;の&#8203;影&#8203;響&#8203;を&#8203;低&#8203;減&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る&#8203;は&#8203;ず&#8203;で&#8203;す。&#8203;実&#8203;際&#8203;に、&#8203;マー&#8203;ケッ&#8203;ト&#8203;の&#8203;状&#8203;況&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;現&#8203;金&#8203;比&#8203;率&#8203;を&#8203;操&#8203;作&#8203;す&#8203;る&#8203;運&#8203;用&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;ファ&#8203;ン&#8203;ド&#8203;も&#8203;存&#8203;在&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;以&#8203;上&#8203;の&#8203;考&#8203;察&#8203;か&#8203;ら、&#8203;ニュー&#8203;ス&#8203;か&#8203;ら&#8203;抽&#8203;出&#8203;し&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;予&#8203;測&#8203;対&#8203;象&#8203;と&#8203;し&#8203;て&#8203;は、&#8203;投&#8203;資&#8203;対&#8203;象&#8203;の&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;の&#8203;週&#8203;次&#8203;の&#8203;平&#8203;均&#8203;リ&#8203;ター&#8203;ン&#8203;と&#8203;し、&#8203;BERT&#8203;特&#8203;徴&#8203;量&#8203;か&#8203;ら&#8203;下&#8203;落&#8203;の&#8203;予&#8203;兆&#8203;を&#8203;検&#8203;知&#8203;し&#8203;た&#8203;場&#8203;合&#8203;は、&#8203;現&#8203;金&#8203;比&#8203;率&#8203;を&#8203;上&#8203;げ&#8203;る&#8203;と&#8203;い&#8203;う&#8203;手&#8203;法&#8203;を&#8203;採&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;し&#8203;ま&#8203;す。&#8203;他&#8203;に&#8203;も&#8203;セ&#8203;ク&#8203;ター&#8203;（33&#8203;業&#8203;種&#8203;分&#8203;類&#8203;な&#8203;ど）&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;予&#8203;測&#8203;し、&#8203;値&#8203;上&#8203;が&#8203;り&#8203;が&#8203;予&#8203;想&#8203;さ&#8203;れ&#8203;る&#8203;セ&#8203;ク&#8203;ター&#8203;の&#8203;代&#8203;表&#8203;的&#8203;な&#8203;銘&#8203;柄&#8203;を&#8203;購&#8203;入&#8203;す&#8203;る&#8203;な&#8203;ど&#8203;様々&#8203;な&#8203;手&#8203;法&#8203;が&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_可変な特徴量を扱う方法">6.1.1. 可変な特徴量を扱う方法</h4>
<div class="paragraph">
<p>　&#8203;各&#8203;週&#8203;で&#8203;公&#8203;表&#8203;さ&#8203;れ&#8203;る&#8203;ニュー&#8203;ス&#8203;の&#8203;数&#8203;は&#8203;可&#8203;変&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;か&#8203;ら&#8203;毎&#8203;週&#8203;抽&#8203;出&#8203;で&#8203;き&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;次&#8203;元&#8203;数&#8203;も&#8203;可&#8203;変&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;一&#8203;般&#8203;的&#8203;に&#8203;モ&#8203;デ&#8203;ル&#8203;構&#8203;築&#8203;す&#8203;る&#8203;と&#8203;き&#8203;は&#8203;投&#8203;入&#8203;す&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;次&#8203;元&#8203;数&#8203;は&#8203;固&#8203;定&#8203;化&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;可&#8203;変&#8203;な&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;用&#8203;い&#8203;て&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;設&#8203;計&#8203;す&#8203;る&#8203;場&#8203;合&#8203;に&#8203;は&#8203;工&#8203;夫&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。&#8203;例&#8203;え&#8203;ば、&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;方&#8203;法&#8203;が&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>予&#8203;測&#8203;時&#8203;点&#8203;か&#8203;ら&#8203;直&#8203;近&#8203;X&#8203;個&#8203;の&#8203;ニュー&#8203;ス&#8203;を&#8203;解&#8203;析&#8203;対&#8203;象&#8203;に&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;次&#8203;元&#8203;数&#8203;を&#8203;固&#8203;定&#8203;化&#8203;す&#8203;る</p>
</li>
<li>
<p>特&#8203;徴&#8203;量&#8203;を&#8203;PCA&#8203;な&#8203;ど&#8203;の&#8203;次&#8203;元&#8203;圧&#8203;縮&#8203;手&#8203;法&#8203;を&#8203;用&#8203;い&#8203;て&#8203;一&#8203;つ&#8203;の&#8203;ス&#8203;コ&#8203;ア&#8203;に&#8203;す&#8203;る&#8203;(5&#8203;章&#8203;で&#8203;紹&#8203;介&#8203;し&#8203;た&#8203;方&#8203;法&#8203;)</p>
</li>
<li>
<p>LSTM&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;可&#8203;変&#8203;長&#8203;の&#8203;入&#8203;力&#8203;が&#8203;可&#8203;能&#8203;な&#8203;レ&#8203;イ&#8203;ヤー&#8203;を&#8203;作&#8203;る</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>　&#8203;本&#8203;章&#8203;で&#8203;は、&#8203;学&#8203;習&#8203;時&#8203;に&#8203;目&#8203;的&#8203;関&#8203;数&#8203;を&#8203;設&#8203;定&#8203;で&#8203;き、&#8203;特&#8203;定&#8203;の&#8203;目&#8203;的&#8203;に&#8203;特&#8203;化&#8203;し&#8203;た&#8203;ス&#8203;コ&#8203;ア&#8203;を&#8203;設&#8203;計&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る&#8203;LSTM&#8203;を&#8203;可&#8203;変&#8203;長&#8203;入&#8203;力&#8203;が&#8203;可&#8203;能&#8203;な&#8203;レ&#8203;イ&#8203;ヤー&#8203;と&#8203;し&#8203;て&#8203;活&#8203;用&#8203;す&#8203;る&#8203;方&#8203;法&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lstmによる可変特徴量の統合処理">6.2. LSTMによる可変特徴量の統合処理</h3>
<div class="paragraph">
<p>　&#8203;こ&#8203;の&#8203;節&#8203;で&#8203;は、&#8203;LSTM&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;作&#8203;成&#8203;及&#8203;び、&#8203;学&#8203;習&#8203;の&#8203;方&#8203;法&#8203;を&#8203;説&#8203;明&#8203;し、&#8203;最&#8203;終&#8203;的&#8203;に&#8203;BERT&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;単&#8203;一&#8203;な&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;抽&#8203;出&#8203;す&#8203;る&#8203;方&#8203;法&#8203;を&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_bert特徴量ロード">6.2.1. BERT特徴量ロード</h4>
<div class="paragraph">
<p>　&#8203;ま&#8203;ず&#8203;は&#8203;BERT&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;ロー&#8203;ド&#8203;し&#8203;ま&#8203;す。&#8203;BERT&#8203;特&#8203;徴&#8203;量&#8203;は&#8203;5&#8203;章&#8203;で&#8203;ご&#8203;自&#8203;分&#8203;で&#8203;保&#8203;存&#8203;し&#8203;た&#8203;も&#8203;の、&#8203;も&#8203;し&#8203;く&#8203;は、&#8203; <a href="https://signate.jp/competitions/443/data">こちら</a> &#8203;か&#8203;ら&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;た&#8203;も&#8203;の&#8203;を&#8203;ご&#8203;利&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">headline_features = pd.read_pickle(f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/headline_features/headline_features.pkl</span><span class="delimiter">'</span></span>)
keywords_features = pd.read_pickle(f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/keywords_features/keywords_features.pkl</span><span class="delimiter">'</span></span>)

<span class="comment"># 確認する。</span>
headline_features.head(<span class="integer">3</span>)
keywords_features.head(<span class="integer">3</span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_データのロード">6.2.2. データのロード</h4>
<div class="paragraph">
<p>　LSTM&#8203;の&#8203;学&#8203;習&#8203;時&#8203;に&#8203;用&#8203;い&#8203;る&#8203;ラ&#8203;ベ&#8203;ル&#8203;(&#8203;投&#8203;資&#8203;対&#8203;象&#8203;の&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;の&#8203;平&#8203;均&#8203;の&#8203;週&#8203;次&#8203;リ&#8203;ター&#8203;ン&#8203;)&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;株&#8203;の&#8203;価&#8203;格&#8203;情&#8203;報&#8203;と&#8203;銘&#8203;柄&#8203;情&#8203;報&#8203;を&#8203;ロー&#8203;ド&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_priceとstock_listをロードします。</span>
stock_price = pd.read_csv(CONFIG[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price_path</span><span class="delimiter">&quot;</span></span>])
stock_list = pd.read_csv(CONFIG[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list_path</span><span class="delimiter">&quot;</span></span>])

<span class="comment"># 確認する</span>
stock_price.head(<span class="integer">3</span>)
stock_list.head(<span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　stock_list&#8203;か&#8203;ら&#8203;投&#8203;資&#8203;対&#8203;象&#8203;銘&#8203;柄&#8203;を&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">codes = stock_list[stock_list[<span class="string"><span class="delimiter">&quot;</span><span class="content">universe_comp2</span><span class="delimiter">&quot;</span></span>] == <span class="predefined-constant">True</span>][
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>
].values</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;投&#8203;資&#8203;対&#8203;象&#8203;銘&#8203;柄&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;stock_price&#8203;の&#8203;銘&#8203;柄&#8203;を&#8203;絞&#8203;り&#8203;込&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">stock_price = stock_price.loc[stock_price.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>].isin(codes)]</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;ロー&#8203;ド&#8203;し&#8203;た&#8203;デー&#8203;タ&#8203;の&#8203;生&#8203;成&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。&#8203;ま&#8203;ず、&#8203;stock_price&#8203;を&#8203;扱&#8203;い&#8203;や&#8203;す&#8203;い&#8203;形&#8203;に&#8203;変&#8203;換&#8203;し&#8203;ま&#8203;す。&#8203;デー&#8203;タ&#8203;の&#8203;う&#8203;ち&#8203; ['EndOfDayQuote Date', 'Local Code', "EndOfDayQuote Open", "EndOfDayQuote ExchangeOfficialClose"] &#8203;の&#8203;column&#8203;を&#8203;ラ&#8203;ベ&#8203;ル&#8203;作&#8203;成&#8203;の&#8203;た&#8203;め&#8203;に&#8203;使&#8203;用&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EndOfDayQuote Date: &#8203;デー&#8203;タ&#8203;の&#8203;日&#8203;付</p>
</li>
<li>
<p>Local Code: &#8203;銘&#8203;柄&#8203;コー&#8203;ド</p>
</li>
<li>
<p>EndOfDayQuote Open: &#8203;始&#8203;値</p>
</li>
<li>
<p>EndOfDayQuote ExchangeOfficialClose: &#8203;終&#8203;値</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">stock_price = stock_price[[<span class="string"><span class="delimiter">'</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Local Code</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Open</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]]

<span class="comment"># それぞれのcolumn名をわかりやすく変更する</span>
stock_price = stock_price.rename(columns={
    <span class="string"><span class="delimiter">'</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">Local Code</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">asset</span><span class="delimiter">'</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">EndOfDayQuote Open</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">open</span><span class="delimiter">'</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">close</span><span class="delimiter">'</span></span>,
})

<span class="comment"># データごとにindex形式が異なると大変扱いにくい。下記のコードより特徴量と同様のindexの形式を変更する。</span>
<span class="comment"># pd.to_datetimeより、string形式の日付をpd.Timestamp形式に変換する</span>
<span class="comment"># pd.Timestamp形式をpd.DatetimeIndex形式に変更し、time zoneをheadline_featuresと同様に設定する。</span>
<span class="comment"># この際、headline_featuresとkeywords_featuresはarticlesのindexを使用しているため、timezoneが一致している。どちらを用いても良い。</span>
stock_price[<span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>] = pd.to_datetime(stock_price[<span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>])
stock_price[<span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>] = pd.DatetimeIndex(stock_price[<span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>]).tz_localize(headline_features.index.tz)

<span class="comment"># indexを['date', 'asset']順のpd.MultiIndex形式として設定する。</span>
stock_price = stock_price.set_index([<span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">asset</span><span class="delimiter">'</span></span>]).sort_index()

<span class="comment"># unstack()より銘柄情報をcolumnに移動させる。</span>
stock_price = stock_price.unstack()

<span class="comment"># 今回使用するデータは2020年以降のデータであるので、2020年以前のデータを切り捨てる。</span>
stock_price = stock_price[<span class="string"><span class="delimiter">'</span><span class="content">2020-01-01</span><span class="delimiter">'</span></span>:]

<span class="comment"># 確認する</span>
display(stock_price.head())</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;stock_price&#8203;を&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;形&#8203;式&#8203;を&#8203;持&#8203;つ&#8203;よ&#8203;う&#8203;に&#8203;変&#8203;更&#8203;し&#8203;ま&#8203;し&#8203;た。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter06/images/1_9_stock_price.png" alt="1_9_stock_price">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_週ごとにグループされた特徴量とラベルの作成">6.2.3. 週ごとにグループされた特徴量とラベルの作成</h4>
<div class="paragraph">
<p>　&#8203;各&#8203;週&#8203;ご&#8203;と&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;統&#8203;合&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;は、&#8203;週&#8203;ご&#8203;と&#8203;の&#8203;全&#8203;て&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;グ&#8203;ルー&#8203;プ&#8203;化&#8203;す&#8203;る&#8203;と&#8203;扱&#8203;い&#8203;や&#8203;す&#8203;く&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;週&#8203;ご&#8203;と&#8203;に&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;価&#8203;格&#8203;情&#8203;報&#8203;を&#8203;グ&#8203;ルー&#8203;プ&#8203;化&#8203;す&#8203;る&#8203;方&#8203;法&#8203;を&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;週&#8203;ご&#8203;と&#8203;の&#8203;価&#8203;格&#8203;情&#8203;報&#8203;を&#8203;グ&#8203;ルー&#8203;プ&#8203;化&#8203;し、&#8203;週&#8203;次&#8203;の&#8203;平&#8203;均&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;計&#8203;算&#8203;し、&#8203;ラ&#8203;ベ&#8203;ル&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;方&#8203;法&#8203;を&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_本番提出用のクラスへ組み込み_7">6.2.4. 本番提出用のクラスへ組み込み</h4>
<div class="paragraph">
<p><code>SentimentGenerator</code>&#8203;ク&#8203;ラ&#8203;ス&#8203;に&#8203; ""_build_weekly_group"" &#8203;関&#8203;数&#8203;を&#8203;追&#8203;加&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">_build_weekly_group</span>(cls, df):
    <span class="comment"># index情報から、(year, week)の情報を得る。</span>
    <span class="keyword">return</span> pd.Series(<span class="predefined">list</span>(<span class="predefined">zip</span>(df.index.year, df.index.week)), index=df.index)

<span class="comment"># SentimentGeneratorに定義したclassmethodを追加する</span>
SentimentGenerator._build_weekly_group = _build_weekly_group

<span class="comment"># 特徴量に適用してみる</span>
display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### features</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
features = headline_features
weekly_group = SentimentGenerator._build_weekly_group(df=features)
display(weekly_group.head(<span class="integer">3</span>))
display(weekly_group.tail(<span class="integer">3</span>))

<span class="comment"># プライスに適用してみる。</span>
<span class="comment"># stock priceの2020年の1週目は、データが存在しないため、2020年の２週目から存在することがわかる。</span>
<span class="comment"># これらのindexをマッチさせる方法は後ほど説明する。</span>
display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### stock price</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
weekly_group = SentimentGenerator._build_weekly_group(stock_price)
display(weekly_group.head(<span class="integer">3</span>))
display(weekly_group.tail(<span class="integer">3</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">features
publish_datetime
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">01</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>    (<span class="integer">2020</span>, <span class="integer">1</span>)
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">01</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>    (<span class="integer">2020</span>, <span class="integer">1</span>)
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">01</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>    (<span class="integer">2020</span>, <span class="integer">1</span>)
dtype: <span class="predefined">object</span>
publish_datetime
<span class="integer">2020</span>-<span class="integer">12</span>-<span class="integer">31</span> <span class="integer">23</span>:<span class="octal">00</span>:<span class="octal">00</span>+<span class="integer">09</span>:<span class="octal">00</span>    (<span class="integer">2020</span>, <span class="integer">53</span>)
<span class="integer">2020</span>-<span class="integer">12</span>-<span class="integer">31</span> <span class="integer">23</span>:<span class="integer">12</span>:<span class="integer">31</span>+<span class="integer">09</span>:<span class="octal">00</span>    (<span class="integer">2020</span>, <span class="integer">53</span>)
<span class="integer">2020</span>-<span class="integer">12</span>-<span class="integer">31</span> <span class="integer">23</span>:<span class="integer">26</span>:<span class="integer">35</span>+<span class="integer">09</span>:<span class="octal">00</span>    (<span class="integer">2020</span>, <span class="integer">53</span>)
dtype: <span class="predefined">object</span>

labels
index
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">06</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>-<span class="octal">05</span>:<span class="octal">00</span>    (<span class="integer">2020</span>, <span class="integer">2</span>)
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="octal">07</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>-<span class="octal">05</span>:<span class="octal">00</span>    (<span class="integer">2020</span>, <span class="integer">2</span>)
<span class="integer">2020</span>-<span class="octal">01</span>-<span class="integer">08</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>-<span class="octal">05</span>:<span class="octal">00</span>    (<span class="integer">2020</span>, <span class="integer">2</span>)
dtype: <span class="predefined">object</span>
index
<span class="integer">2021</span>-<span class="octal">01</span>-<span class="integer">27</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>-<span class="octal">05</span>:<span class="octal">00</span>    (<span class="integer">2021</span>, <span class="integer">4</span>)
<span class="integer">2021</span>-<span class="octal">01</span>-<span class="integer">28</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>-<span class="octal">05</span>:<span class="octal">00</span>    (<span class="integer">2021</span>, <span class="integer">4</span>)
<span class="integer">2021</span>-<span class="octal">01</span>-<span class="integer">29</span> <span class="octal">00</span>:<span class="octal">00</span>:<span class="octal">00</span>-<span class="octal">05</span>:<span class="octal">00</span>    (<span class="integer">2021</span>, <span class="integer">4</span>)
dtype: <span class="predefined">object</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;週&#8203;ご&#8203;と&#8203;に&#8203;グ&#8203;ルー&#8203;プ&#8203;化&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">weekly_group = SentimentGenerator._build_weekly_group(df=features)
features = features.groupby(weekly_group).apply(<span class="keyword">lambda</span> x: x[:])

<span class="comment"># 確認する</span>
features.head(<span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;週&#8203;の&#8203;情&#8203;報&#8203;が&#8203;index&#8203;の&#8203;level0&#8203;に&#8203;付&#8203;与&#8203;さ&#8203;れ、&#8203;グ&#8203;ルー&#8203;プ&#8203;化&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;分&#8203;か&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter06/images/1_7_grouped_features.png" alt="1_7_grouped_features">
</div>
</div>
<div class="paragraph">
<p>　&#8203;続&#8203;い&#8203;て、&#8203;train&#8203;と&#8203;test&#8203;を&#8203;区&#8203;切&#8203;る&#8203;週&#8203;を&#8203;boundary_week&#8203;と&#8203;し&#8203;て&#8203;設&#8203;定&#8203;し、&#8203;train&#8203;用&#8203;に&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;と、&#8203;test&#8203;用&#8203;に&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;区&#8203;切&#8203;り&#8203;ま&#8203;す。&#8203;boundry_week&#8203;は&#8203;26&#8203;と&#8203;し、&#8203;train&#8203;と&#8203;test&#8203;を&#8203;52&#8203;週&#8203;の&#8203;半&#8203;分、&#8203;つ&#8203;ま&#8203;り、&#8203;2020&#8203;年&#8203;前&#8203;半&#8203;の&#8203;ニュー&#8203;ス&#8203;を&#8203;訓&#8203;練&#8203;用&#8203;デー&#8203;タ、&#8203;2020&#8203;年&#8203;後&#8203;半&#8203;の&#8203;ニュー&#8203;ス&#8203;を&#8203;テ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;と&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">boundary_week = (<span class="integer">2020</span>, <span class="integer">26</span>)
train_features = features[features.index.get_level_values(<span class="integer">0</span>) &lt;= boundary_week]
test_features = features[features.index.get_level_values(<span class="integer">0</span>) &gt; boundary_week]

display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### train_features</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
display(train_features.head(<span class="integer">3</span>))
display(train_features.tail(<span class="integer">3</span>))

display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### test_features</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
display(test_features.head(<span class="integer">3</span>))
display(test_features.tail(<span class="integer">3</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter06/images/1_7_grouped_train_features.png" alt="1_7_grouped_train_features">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter06/images/1_7_grouped_test_features.png" alt="1_7_grouped_test_features">
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;LSTM&#8203;の&#8203;学&#8203;習&#8203;に&#8203;係&#8203;る&#8203;の&#8203;ラ&#8203;ベ&#8203;ル&#8203;デー&#8203;タ&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に、&#8203;stock price&#8203;を&#8203;週&#8203;ご&#8203;と&#8203;に&#8203;グ&#8203;ルー&#8203;プ&#8203;化&#8203;し、&#8203;翌&#8203;週&#8203;の&#8203;週&#8203;初&#8203;営&#8203;業&#8203;日&#8203;の&#8203;始&#8203;値&#8203;か&#8203;ら&#8203;週&#8203;末&#8203;営&#8203;業&#8203;日&#8203;の&#8203;終&#8203;値&#8203;に&#8203;か&#8203;け&#8203;て&#8203;の&#8203;平&#8203;均&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;方&#8203;法&#8203;を&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。&#8203;ま&#8203;ず&#8203;は、&#8203;当&#8203;週&#8203;の&#8203;週&#8203;初&#8203;営&#8203;業&#8203;日&#8203;の&#8203;始&#8203;値&#8203;か&#8203;ら&#8203;週&#8203;末&#8203;営&#8203;業&#8203;日&#8203;の&#8203;終&#8203;値&#8203;に&#8203;か&#8203;け&#8203;て&#8203;の&#8203;平&#8203;均&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;作&#8203;成&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;しょ&#8203;う。&#8203;週&#8203;次&#8203;の&#8203;平&#8203;均&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;関&#8203;数&#8203;を&#8203;<code>_compute_weekly_return</code>&#8203;と&#8203;し&#8203;て&#8203;定&#8203;義&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">_compute_weekly_return</span>(x):
    <span class="comment"># その週の初営業日のopenから最終営業日のcloseまでのリターンを計算する。</span>
    weekly_return = ((x[<span class="string"><span class="delimiter">'</span><span class="content">close</span><span class="delimiter">'</span></span>].iloc[-<span class="integer">1</span>] - x[<span class="string"><span class="delimiter">'</span><span class="content">open</span><span class="delimiter">'</span></span>].iloc[<span class="integer">0</span>]) / x[<span class="string"><span class="delimiter">'</span><span class="content">open</span><span class="delimiter">'</span></span>].iloc[<span class="integer">0</span>])

    <span class="comment"># その日のvolumneが0であるデータは、openが0となっている。</span>
    <span class="comment"># openが0の場合、np.infの値となっているため、np.nanに変換し除去する。</span>
    <span class="comment"># 銘柄ごとのリターンを単純平均し、marketのweekly_returnを計算する。</span>
    <span class="keyword">return</span> weekly_return.replace([np.inf, -np.inf], np.nan).dropna().mean()

weekly_group = SentimentGenerator._build_weekly_group(df=stock_price)
weekly_return = stock_price.groupby(weekly_group).apply(_compute_weekly_return)

display(weekly_return.head(<span class="integer">3</span>))
display(weekly_return.tail(<span class="integer">3</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">(<span class="integer">2020</span>, <span class="integer">2</span>)    <span class="float">0.017291</span>
(<span class="integer">2020</span>, <span class="integer">3</span>)   -<span class="float">0.007994</span>
(<span class="integer">2020</span>, <span class="integer">4</span>)   -<span class="float">0.005600</span>
dtype: float64

(<span class="integer">2020</span>, <span class="integer">51</span>)    <span class="float">0.001516</span>
(<span class="integer">2020</span>, <span class="integer">52</span>)   -<span class="float">0.009117</span>
(<span class="integer">2020</span>, <span class="integer">53</span>)    <span class="float">0.005004</span>
dtype: float64</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;で、&#8203;weekly_return&#8203;を&#8203;shift(-1)&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;よ&#8203;り、&#8203;翌&#8203;週&#8203;の&#8203;return&#8203;情&#8203;報&#8203;が&#8203;現&#8203;在&#8203;の&#8203;index&#8203;に&#8203;入&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">weekly_fwd_return = weekly_return.shift(-<span class="integer">1</span>).dropna()

<span class="comment"># 確認する</span>
display(weekly_fwd_return.head(<span class="integer">3</span>))
display(weekly_fwd_return.tail(<span class="integer">3</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">(<span class="integer">2020</span>, <span class="integer">2</span>)   -<span class="float">0.007994</span>
(<span class="integer">2020</span>, <span class="integer">3</span>)   -<span class="float">0.005600</span>
(<span class="integer">2020</span>, <span class="integer">4</span>)   -<span class="float">0.015110</span>
dtype: float64

(<span class="integer">2020</span>, <span class="integer">50</span>)    <span class="float">0.001516</span>
(<span class="integer">2020</span>, <span class="integer">51</span>)   -<span class="float">0.009117</span>
(<span class="integer">2020</span>, <span class="integer">52</span>)    <span class="float">0.005004</span>
dtype: float64</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;で、&#8203;ラ&#8203;ベ&#8203;ル&#8203;デー&#8203;タ&#8203;を&#8203;訓&#8203;練&#8203;期&#8203;間&#8203;/&#8203;テ&#8203;ス&#8203;ト&#8203;期&#8203;間&#8203;に&#8203;分&#8203;割&#8203;し&#8203;ま&#8203;す。&#8203;現&#8203;在&#8203;の&#8203;デー&#8203;タ&#8203;は、&#8203;2020&#8203;年&#8203;の&#8203;第&#8203;1&#8203;週&#8203;か&#8203;ら&#8203;第&#8203;52&#8203;週&#8203;ま&#8203;で&#8203;あ&#8203;り、&#8203;前&#8203;半&#8203;の&#8203;第&#8203;1&#8203;週&#8203;か&#8203;ら&#8203;第&#8203;26&#8203;週&#8203;ま&#8203;で&#8203;を&#8203;訓&#8203;練&#8203;期&#8203;間、&#8203;第&#8203;27&#8203;週&#8203;か&#8203;ら&#8203;52&#8203;週&#8203;ま&#8203;で&#8203;を&#8203;テ&#8203;ス&#8203;ト&#8203;期&#8203;間&#8203;と&#8203;し&#8203;ま&#8203;す。&#8203;具&#8203;体&#8203;的&#8203;に&#8203;は、&#8203;訓&#8203;練&#8203;期&#8203;間&#8203;と&#8203;テ&#8203;ス&#8203;ト&#8203;期&#8203;間&#8203;を&#8203;区&#8203;切&#8203;る&#8203;週&#8203;を&#8203;`boundary_week`&#8203;と&#8203;し&#8203;て、&#8203;訓&#8203;練&#8203;用&#8203;に&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;と、&#8203;テ&#8203;ス&#8203;ト&#8203;用&#8203;に&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;区&#8203;切&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">boundary_week = (<span class="integer">2020</span>, <span class="integer">26</span>)
train_labels = weekly_fwd_return[weekly_fwd_return.index &lt;= boundary_week]
test_labels = weekly_fwd_return[weekly_fwd_return.index &gt; boundary_week]

display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### train_labels</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
display(train_labels.head(<span class="integer">3</span>))
display(train_labels.tail(<span class="integer">3</span>))

display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### test_labels</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
display(test_labels.head(<span class="integer">3</span>))
display(test_labels.tail(<span class="integer">3</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">train_labels
(<span class="integer">2020</span>, <span class="integer">2</span>)   -<span class="float">0.007994</span>
(<span class="integer">2020</span>, <span class="integer">3</span>)   -<span class="float">0.005600</span>
(<span class="integer">2020</span>, <span class="integer">4</span>)   -<span class="float">0.015110</span>
dtype: float64
(<span class="integer">2020</span>, <span class="integer">24</span>)    <span class="float">0.016623</span>
(<span class="integer">2020</span>, <span class="integer">25</span>)    <span class="float">0.001732</span>
(<span class="integer">2020</span>, <span class="integer">26</span>)   -<span class="float">0.019522</span>
dtype: float64

test_labels
(<span class="integer">2020</span>, <span class="integer">27</span>)   -<span class="float">0.017781</span>
(<span class="integer">2020</span>, <span class="integer">28</span>)    <span class="float">0.016613</span>
(<span class="integer">2020</span>, <span class="integer">29</span>)    <span class="float">0.001590</span>
dtype: float64
(<span class="integer">2020</span>, <span class="integer">50</span>)    <span class="float">0.001516</span>
(<span class="integer">2020</span>, <span class="integer">51</span>)   -<span class="float">0.009117</span>
(<span class="integer">2020</span>, <span class="integer">52</span>)    <span class="float">0.005004</span>
dtype: float64</code></pre>
</div>
</div>
<div class="paragraph">
<p>　fwd_return&#8203;の&#8203;上&#8203;げ&#8203;下&#8203;げ&#8203;の&#8203;情&#8203;報&#8203;の&#8203;み&#8203;を&#8203;ラ&#8203;ベ&#8203;ル&#8203;と&#8203;し&#8203;て&#8203;用&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;上&#8203;げ&#8203;を&#8203;1.0, &#8203;下&#8203;げ&#8203;を&#8203;0.0&#8203;に&#8203;変&#8203;換&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">train_labels = (train_labels &gt;= <span class="integer">0</span>) * <span class="float">1.0</span>
test_labels = (test_labels &gt;= <span class="integer">0</span>) * <span class="float">1.0</span>

display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### train_labels</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
display(train_labels.head(<span class="integer">3</span>))
display(train_labels.tail(<span class="integer">3</span>))

display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### test_labels</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
display(test_labels.head(<span class="integer">3</span>))
display(test_labels.tail(<span class="integer">3</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;う&#8203;ま&#8203;く&#8203;0.0&#8203;と&#8203;1.0&#8203;に&#8203;変&#8203;換&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">train_labels
(<span class="integer">2020</span>, <span class="integer">2</span>)    <span class="float">0.0</span>
(<span class="integer">2020</span>, <span class="integer">3</span>)    <span class="float">0.0</span>
(<span class="integer">2020</span>, <span class="integer">4</span>)    <span class="float">0.0</span>
dtype: float64
(<span class="integer">2020</span>, <span class="integer">24</span>)    <span class="float">1.0</span>
(<span class="integer">2020</span>, <span class="integer">25</span>)    <span class="float">1.0</span>
(<span class="integer">2020</span>, <span class="integer">26</span>)    <span class="float">0.0</span>
dtype: float64

test_labels
(<span class="integer">2020</span>, <span class="integer">27</span>)    <span class="float">0.0</span>
(<span class="integer">2020</span>, <span class="integer">28</span>)    <span class="float">1.0</span>
(<span class="integer">2020</span>, <span class="integer">29</span>)    <span class="float">1.0</span>
dtype: float64
(<span class="integer">2020</span>, <span class="integer">50</span>)    <span class="float">1.0</span>
(<span class="integer">2020</span>, <span class="integer">51</span>)    <span class="float">0.0</span>
(<span class="integer">2020</span>, <span class="integer">52</span>)    <span class="float">1.0</span>
dtype: float64</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_本番提出用のクラスへ組み込み_8">6.2.5. 本番提出用のクラスへ組み込み</h4>
<div class="paragraph">
<p>上&#8203;記&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;関&#8203;数&#8203;と&#8203;し&#8203;て、&#8203;<code>SentimentGenerator</code> &#8203;ク&#8203;ラ&#8203;ス&#8203;に&#8203;追&#8203;加&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">build_weekly_features</span>(cls, features, boundary_week):
    <span class="keyword">assert</span> <span class="predefined">isinstance</span>(boundary_week, <span class="predefined">tuple</span>)

    weekly_group = cls._build_weekly_group(df=features)
    features = features.groupby(weekly_group).apply(<span class="keyword">lambda</span> x: x[:])

    train_features = features[features.index.get_level_values(<span class="integer">0</span>) &lt;= boundary_week]
    test_features = features[features.index.get_level_values(<span class="integer">0</span>) &gt; boundary_week]

    <span class="keyword">return</span> {<span class="string"><span class="delimiter">'</span><span class="content">train</span><span class="delimiter">'</span></span>: train_features, <span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>: test_features}

<span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">build_weekly_labels</span>(cls, stock_price, boundary_week):
    <span class="keyword">def</span> <span class="function">_compute_weekly_return</span>(x):
        <span class="comment"># その週の初営業日のopenから最終営業日のcloseまでのリターンを計算する。</span>
        weekly_return = ((x[<span class="string"><span class="delimiter">'</span><span class="content">close</span><span class="delimiter">'</span></span>].iloc[-<span class="integer">1</span>] - x[<span class="string"><span class="delimiter">'</span><span class="content">open</span><span class="delimiter">'</span></span>].iloc[<span class="integer">0</span>]) / x[<span class="string"><span class="delimiter">'</span><span class="content">open</span><span class="delimiter">'</span></span>].iloc[<span class="integer">0</span>])

        <span class="comment"># その日のvolumneが0であるデータは、openが0となっている。</span>
        <span class="comment"># openが0の場合、np.infの値となっているため、np.nanに変換し除去する。</span>
        <span class="comment"># 銘柄ごとのリターンを単純平均し、marketのweekly_returnを計算する。</span>
        <span class="keyword">return</span> weekly_return.replace([np.inf, -np.inf], np.nan).dropna().mean()

    <span class="keyword">assert</span> <span class="predefined">isinstance</span>(boundary_week, <span class="predefined">tuple</span>)

    weekly_group = cls._build_weekly_group(df=stock_price)
    weekly_fwd_return = stock_price.groupby(weekly_group).apply(_compute_weekly_return).shift(-<span class="integer">1</span>).dropna()

    train_labels = weekly_fwd_return[weekly_fwd_return.index &lt;= boundary_week]
    test_labels = weekly_fwd_return[weekly_fwd_return.index &gt; boundary_week]

    train_labels = (train_labels &gt;= <span class="integer">0</span>) * <span class="float">1.0</span>
    test_labels = (test_labels &gt;= <span class="integer">0</span>) * <span class="float">1.0</span>

    <span class="keyword">return</span> {<span class="string"><span class="delimiter">'</span><span class="content">train</span><span class="delimiter">'</span></span>: train_labels, <span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>: test_labels}

<span class="comment"># SentimentGeneratorに定義したclassmethodを追加する</span>
SentimentGenerator.build_weekly_features = build_weekly_features
SentimentGenerator.build_weekly_labels = build_weekly_labels

<span class="comment"># SentimentGeneratorに定義したclassmethodを追加する</span>
SentimentGenerator.build_weekly_features = build_weekly_features
SentimentGenerator.build_weekly_labels = build_weekly_labels</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pytorch_dataset作成">6.2.6. Pytorch Dataset作成</h4>
<div class="paragraph">
<p>　pytorch&#8203;を&#8203;用&#8203;い&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;効&#8203;率&#8203;よ&#8203;く&#8203;学&#8203;習&#8203;さ&#8203;せ&#8203;る&#8203;た&#8203;め&#8203;に&#8203;は、&#8203;custom Dataset&#8203;ク&#8203;ラ&#8203;ス&#8203;と、&#8203;そ&#8203;れ&#8203;を&#8203;用&#8203;い&#8203;た&#8203;Dataloader&#8203;を&#8203;定&#8203;義&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;学&#8203;習&#8203;で&#8203;用&#8203;い&#8203;る&#8203;Dataset&#8203;を&#8203;定&#8203;義&#8203;す&#8203;る&#8203;方&#8203;法&#8203;を&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。&#8203;Dataset&#8203;の&#8203;__getitem__&#8203;は、&#8203;Dataloader&#8203;を&#8203;介&#8203;し&#8203;て&#8203;デー&#8203;タ&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;と&#8203;き&#8203;に&#8203;呼&#8203;ば&#8203;れ&#8203;ま&#8203;す。&#8203;具&#8203;体&#8203;的&#8203;に&#8203;は、&#8203;__init__&#8203;で&#8203;事&#8203;前&#8203;に&#8203;定&#8203;義&#8203;し&#8203;た&#8203;デー&#8203;タ&#8203;を&#8203;id&#8203;を&#8203;用&#8203;い&#8203;て&#8203;取&#8203;得&#8203;す&#8203;る&#8203;仕&#8203;組&#8203;み&#8203;に&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め、&#8203;id&#8203;が&#8203;与&#8203;え&#8203;ら&#8203;れ&#8203;た&#8203;ら、&#8203;そ&#8203;の&#8203;id&#8203;か&#8203;ら&#8203;feature&#8203;と&#8203;label&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;な&#8203;構&#8203;造&#8203;で&#8203;__init__&#8203;で&#8203;デー&#8203;タ&#8203;を&#8203;事&#8203;前&#8203;に&#8203;定&#8203;義&#8203;し&#8203;て&#8203;お&#8203;く&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;以&#8203;下&#8203;に&#8203;Pytorch&#8203;の&#8203;Dataset&#8203;及&#8203;び&#8203;DataLoader&#8203;に&#8203;関&#8203;す&#8203;る&#8203;参&#8203;考&#8203;記&#8203;事&#8203;を&#8203;少&#8203;し&#8203;紹&#8203;介&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pytorch&#8203;関&#8203;連&#8203;記&#8203;事</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/mathlive/items/2a512831878b8018db02">Qiita:pyTorchのtransforms,Datasets,Dataloaderの説明と自作Datasetの作成と使用</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/takurooo/items/e4c91c5d78059f92e76d">Qiita:PyTorch transforms/Dataset/DataLoader&#8203;の&#8203;基&#8203;本&#8203;動&#8203;作&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;例&#8203;と&#8203;し&#8203;て&#8203;train&#8203;デー&#8203;タ&#8203;の&#8203;み&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;Dataset&#8203;を&#8203;作っ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;任&#8203;意&#8203;に&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;は、&#8203;headline&#8203;を&#8203;使&#8203;い、&#8203;boundary_week&#8203;に&#8203;2020&#8203;年&#8203;の&#8203;26&#8203;週&#8203;目&#8203;を&#8203;設&#8203;定&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">features = headline_features
boundary_week = (<span class="integer">2020</span>, <span class="integer">26</span>)

<span class="comment"># 上記で作成したコードを用いて週次の特徴量とラベルを作成</span>
weekly_features = SentimentGenerator.build_weekly_features(features=features, boundary_week=boundary_week)[<span class="string"><span class="delimiter">'</span><span class="content">train</span><span class="delimiter">'</span></span>]
weekly_labels = SentimentGenerator.build_weekly_labels(stock_price=stock_price, boundary_week=boundary_week)[<span class="string"><span class="delimiter">'</span><span class="content">train</span><span class="delimiter">'</span></span>]

<span class="comment"># 共通する週のみのデータを使うため、共通するindex情報を取得する。</span>
mask_index = weekly_features.index.get_level_values(<span class="integer">0</span>).unique() &amp; weekly_labels.index
display(mask_index)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">Index([ (<span class="integer">2020</span>, <span class="integer">2</span>),  (<span class="integer">2020</span>, <span class="integer">3</span>),  (<span class="integer">2020</span>, <span class="integer">4</span>),  (<span class="integer">2020</span>, <span class="integer">5</span>),  (<span class="integer">2020</span>, <span class="integer">6</span>),  (<span class="integer">2020</span>, <span class="integer">7</span>),
        (<span class="integer">2020</span>, <span class="integer">8</span>),  (<span class="integer">2020</span>, <span class="integer">9</span>), (<span class="integer">2020</span>, <span class="integer">10</span>), (<span class="integer">2020</span>, <span class="integer">11</span>), (<span class="integer">2020</span>, <span class="integer">12</span>), (<span class="integer">2020</span>, <span class="integer">13</span>),
       (<span class="integer">2020</span>, <span class="integer">14</span>), (<span class="integer">2020</span>, <span class="integer">15</span>), (<span class="integer">2020</span>, <span class="integer">16</span>), (<span class="integer">2020</span>, <span class="integer">17</span>), (<span class="integer">2020</span>, <span class="integer">18</span>), (<span class="integer">2020</span>, <span class="integer">19</span>),
       (<span class="integer">2020</span>, <span class="integer">20</span>), (<span class="integer">2020</span>, <span class="integer">21</span>), (<span class="integer">2020</span>, <span class="integer">22</span>), (<span class="integer">2020</span>, <span class="integer">23</span>), (<span class="integer">2020</span>, <span class="integer">24</span>), (<span class="integer">2020</span>, <span class="integer">25</span>),
       (<span class="integer">2020</span>, <span class="integer">26</span>)],
      dtype=<span class="string"><span class="delimiter">'</span><span class="content">object</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;共&#8203;通&#8203;す&#8203;る&#8203;index&#8203;の&#8203;み&#8203;の&#8203;デー&#8203;タ&#8203;だ&#8203;け&#8203;で&#8203;reindex&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">weekly_features = weekly_features[weekly_features.index.get_level_values(<span class="integer">0</span>).isin(mask_index)]
weekly_labels = weekly_labels.reindex(mask_index)

display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### weekly_features</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
display(weekly_features.head(<span class="integer">3</span>))
display(weekly_features.tail(<span class="integer">3</span>))

display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### weekly_labels</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
display(weekly_labels.head(<span class="integer">3</span>))
display(weekly_labels.tail(<span class="integer">3</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter06/images/1_7_pytorch_dataset_reindex.png" alt="1_7_pytorch_dataset_reindex">
</div>
</div>
<div class="paragraph">
<p>　id&#8203;か&#8203;ら&#8203;week&#8203;の&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;で&#8203;き&#8203;る&#8203;よ&#8203;う、&#8203;id_to_week&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">id_to_week = {<span class="predefined">id</span>: week <span class="keyword">for</span> <span class="predefined">id</span>, week <span class="keyword">in</span> <span class="predefined">enumerate</span>(<span class="predefined">sorted</span>(weekly_labels.index))}
id_to_week</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">{<span class="integer">0</span>: (<span class="integer">2020</span>, <span class="integer">2</span>),
 <span class="integer">1</span>: (<span class="integer">2020</span>, <span class="integer">3</span>),
 <span class="integer">2</span>: (<span class="integer">2020</span>, <span class="integer">4</span>),
 <span class="integer">3</span>: (<span class="integer">2020</span>, <span class="integer">5</span>),
 <span class="integer">4</span>: (<span class="integer">2020</span>, <span class="integer">6</span>),
 <span class="integer">5</span>: (<span class="integer">2020</span>, <span class="integer">7</span>),
 <span class="integer">6</span>: (<span class="integer">2020</span>, <span class="integer">8</span>),
 <span class="integer">7</span>: (<span class="integer">2020</span>, <span class="integer">9</span>),
 <span class="integer">8</span>: (<span class="integer">2020</span>, <span class="integer">10</span>),
 <span class="integer">9</span>: (<span class="integer">2020</span>, <span class="integer">11</span>),
 <span class="integer">10</span>: (<span class="integer">2020</span>, <span class="integer">12</span>),
 <span class="integer">11</span>: (<span class="integer">2020</span>, <span class="integer">13</span>),
 <span class="integer">12</span>: (<span class="integer">2020</span>, <span class="integer">14</span>),
 <span class="integer">13</span>: (<span class="integer">2020</span>, <span class="integer">15</span>),
 <span class="integer">14</span>: (<span class="integer">2020</span>, <span class="integer">16</span>),
 <span class="integer">15</span>: (<span class="integer">2020</span>, <span class="integer">17</span>),
 <span class="integer">16</span>: (<span class="integer">2020</span>, <span class="integer">18</span>),
 <span class="integer">17</span>: (<span class="integer">2020</span>, <span class="integer">19</span>),
 <span class="integer">18</span>: (<span class="integer">2020</span>, <span class="integer">20</span>),
 <span class="integer">19</span>: (<span class="integer">2020</span>, <span class="integer">21</span>),
 <span class="integer">20</span>: (<span class="integer">2020</span>, <span class="integer">22</span>),
 <span class="integer">21</span>: (<span class="integer">2020</span>, <span class="integer">23</span>),
 <span class="integer">22</span>: (<span class="integer">2020</span>, <span class="integer">24</span>),
 <span class="integer">23</span>: (<span class="integer">2020</span>, <span class="integer">25</span>),
 <span class="integer">24</span>: (<span class="integer">2020</span>, <span class="integer">26</span>)}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>_getitem_</em>&#8203;で&#8203;付&#8203;与&#8203;さ&#8203;れ&#8203;た&#8203;id&#8203;か&#8203;ら、&#8203;デー&#8203;タ&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;ロ&#8203;ジッ&#8203;ク&#8203;を&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 例として、任意的にid = 10を用いる。</span>
id = <span class="integer">10</span>

<span class="comment"># idからweekの情報を取得する。</span>
week = id_to_week[<span class="predefined">id</span>]

<span class="comment"># 学習時のリソース軽減のため、全ての特徴量を入力とするわけではなく、直近n個を入力とする。ここでは1000個として定義する。</span>
max_sequence_length = <span class="integer">1000</span>

x = weekly_features.xs(week, axis=<span class="integer">0</span>, level=<span class="integer">0</span>)[-max_sequence_length:]
y = weekly_labels[week]

<span class="comment"># 上記のコードよりidが付与されたとき、idから週の情報を取得し、その週の情報から、特徴量とラベルを手にすることができた。</span>
display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### 特徴量</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
display(x.head(<span class="integer">3</span>))
print(<span class="string"><span class="delimiter">'</span><span class="content">shape:</span><span class="delimiter">'</span></span>, x.shape)

display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### ラベル</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
display(y)</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter06/images/1_7_pytorch_dataset_get_item.png" alt="1_7_pytorch_dataset_get_item">
</div>
</div>
<div class="paragraph">
<p>　pytorch&#8203;を&#8203;用&#8203;い&#8203;た&#8203;学&#8203;習・&#8203;推&#8203;論&#8203;で&#8203;は、&#8203;デー&#8203;タ&#8203;を&#8203;torch.Tensor&#8203;タ&#8203;イ&#8203;プ&#8203;と&#8203;し&#8203;て&#8203;扱&#8203;う&#8203;こ&#8203;と&#8203;が&#8203;要&#8203;求&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;以&#8203;下&#8203;で、&#8203;np.ndarray&#8203;を&#8203;tensor&#8203;形&#8203;式&#8203;に&#8203;変&#8203;換&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">x = torch.tensor(x.values, dtype=torch.float)
y = torch.tensor(y, dtype=torch.float)

display(x)
display(y)</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">tensor([[-<span class="float">0.2525</span>,  <span class="float">0.3046</span>, -<span class="float">0.2245</span>,  ..., -<span class="float">0.4402</span>, -<span class="float">0.2707</span>,  <span class="float">0.2823</span>],
        [ <span class="float">0.0670</span>,  <span class="float">0.1914</span>, -<span class="float">0.1088</span>,  ..., -<span class="float">0.0879</span>, -<span class="float">0.2142</span>,  <span class="float">0.1802</span>],
        [-<span class="float">0.2898</span>, -<span class="float">0.3260</span>, -<span class="float">0.1711</span>,  ..., -<span class="float">0.1327</span>, -<span class="float">0.2654</span>,  <span class="float">0.1255</span>],
        ...,
        [-<span class="float">0.2813</span>, -<span class="float">0.0425</span>,  <span class="float">0.0015</span>,  ..., -<span class="float">0.7122</span>,  <span class="float">0.1824</span>, -<span class="float">0.0727</span>],
        [-<span class="float">0.7515</span>,  <span class="float">0.1514</span>, -<span class="float">0.0536</span>,  ..., -<span class="float">0.5100</span>, -<span class="float">0.3639</span>, -<span class="float">0.2901</span>],
        [ <span class="float">0.0920</span>,  <span class="float">0.0485</span>, -<span class="float">0.2583</span>,  ..., -<span class="float">0.3228</span>,  <span class="float">0.3854</span>,  <span class="float">0.0924</span>]])
tensor(<span class="float">1.</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;今&#8203;回、&#8203;学&#8203;習&#8203;に&#8203;用&#8203;い&#8203;る&#8203;週&#8203;次&#8203;の&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;LSTM&#8203;の&#8203;学&#8203;習&#8203;に&#8203;は&#8203;週&#8203;毎&#8203;の&#8203;ニュー&#8203;ス&#8203;の&#8203;件&#8203;数&#8203;が&#8203;若&#8203;干&#8203;不&#8203;足&#8203;し&#8203;て&#8203;い&#8203;る&#8203;傾&#8203;向&#8203;に&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;過&#8203;学&#8203;習&#8203;防&#8203;止&#8203;の&#8203;た&#8203;め、&#8203;少&#8203;し&#8203;工&#8203;夫&#8203;を&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;具&#8203;体&#8203;的&#8203;に&#8203;は、&#8203;全&#8203;体&#8203;的&#8203;な&#8203;特&#8203;徴&#8203;量&#8203;(&#8203;ニュー&#8203;ス&#8203;の&#8203;情&#8203;報&#8203;)&#8203;の&#8203;順&#8203;序&#8203;は&#8203;維&#8203;持&#8203;し&#8203;つ&#8203;つ&#8203;複&#8203;数&#8203;に&#8203;分&#8203;割&#8203;し、&#8203;そ&#8203;の&#8203;分&#8203;割&#8203;の&#8203;中&#8203;で&#8203;シャッ&#8203;フ&#8203;ル&#8203;を&#8203;行&#8203;う&#8203;方&#8203;法&#8203;を&#8203;取&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;方&#8203;法&#8203;を&#8203;用&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;入&#8203;力&#8203;す&#8203;る&#8203;デー&#8203;タ&#8203;を&#8203;増&#8203;や&#8203;す&#8203;こ&#8203;と&#8203;で&#8203;き、&#8203;過&#8203;学&#8203;習&#8203;を&#8203;防&#8203;止&#8203;に&#8203;繋&#8203;が&#8203;る&#8203;効&#8203;果&#8203;が&#8203;期&#8203;待&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">_shuffle_by_local_split</span>(x, split_size=<span class="integer">50</span>):
    <span class="keyword">return</span> torch.cat([splitted[torch.randperm(splitted.size()[<span class="integer">0</span>])] <span class="keyword">for</span> splitted <span class="keyword">in</span> x.split(split_size, dim=<span class="integer">0</span>)], dim=<span class="integer">0</span>)

x = _shuffle_by_local_split(x=x)
display(x)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">tensor([[-<span class="float">0.1477</span>,  <span class="float">0.1549</span>, -<span class="float">0.0650</span>,  ...,  <span class="float">0.0304</span>,  <span class="float">0.0071</span>,  <span class="float">0.3565</span>],
        [-<span class="float">0.2660</span>,  <span class="float">0.6258</span>, -<span class="float">0.1581</span>,  ..., -<span class="float">0.2906</span>, -<span class="float">0.3727</span>,  <span class="float">0.0437</span>],
        [-<span class="float">0.2384</span>, -<span class="float">0.1165</span>, -<span class="float">0.2715</span>,  ..., -<span class="float">0.3553</span>, -<span class="float">0.6599</span>, -<span class="float">0.1545</span>],
        ...,
        [-<span class="float">0.7515</span>,  <span class="float">0.1514</span>, -<span class="float">0.0536</span>,  ..., -<span class="float">0.5100</span>, -<span class="float">0.3639</span>, -<span class="float">0.2901</span>],
        [-<span class="float">0.1901</span>,  <span class="float">0.2114</span>, -<span class="float">0.2073</span>,  ..., -<span class="float">0.3650</span>, -<span class="float">0.3166</span>,  <span class="float">0.2325</span>],
        [-<span class="float">0.4610</span>,  <span class="float">0.4689</span>, -<span class="float">0.0572</span>,  ..., -<span class="float">0.2271</span>, -<span class="float">0.2781</span>, -<span class="float">0.1097</span>]])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;学&#8203;習&#8203;中&#8203;に&#8203;お&#8203;い&#8203;て&#8203;は、&#8203;デー&#8203;タ&#8203;を&#8203;1&#8203;つ&#8203;ず&#8203;つ&#8203;読&#8203;み&#8203;込&#8203;ん&#8203;で&#8203;学&#8203;習&#8203;を&#8203;行&#8203;う&#8203;よ&#8203;り、&#8203;複&#8203;数&#8203;個&#8203;を&#8203;同&#8203;時&#8203;に&#8203;並&#8203;列&#8203;演&#8203;算&#8203;を&#8203;行&#8203;う&#8203;方&#8203;(mini batch)&#8203;が&#8203;時&#8203;間&#8203;短&#8203;縮&#8203;に&#8203;繋&#8203;が&#8203;り&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め&#8203;に&#8203;は、&#8203;デー&#8203;タ&#8203;行&#8203;列&#8203;を&#8203;重&#8203;ね&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り、&#8203;デー&#8203;タ&#8203;の&#8203;sequence&#8203;が&#8203;同&#8203;一&#8203;で&#8203;あ&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;本&#8203;節&#8203;で&#8203;は、&#8203;こ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;シー&#8203;ク&#8203;エ&#8203;ン&#8203;ス&#8203;の&#8203;異&#8203;な&#8203;る&#8203;デー&#8203;タ&#8203;を&#8203;扱&#8203;う&#8203;た&#8203;め、&#8203;max_sequence_length&#8203;を&#8203;決&#8203;め、&#8203;最&#8203;大&#8203;の&#8203;sequence&#8203;に&#8203;合&#8203;わ&#8203;せ&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;sequence&#8203;が&#8203;max_sequence_length&#8203;に&#8203;達&#8203;し&#8203;な&#8203;い&#8203;場&#8203;合&#8203;は、&#8203;前&#8203;か&#8203;ら&#8203;0&#8203;を&#8203;埋&#8203;め&#8203;(zero padding)、&#8203;sequence&#8203;を&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;な&#8203;お、&#8203;本&#8203;節&#8203;で&#8203;は&#8203;max_sequence_length&#8203;は&#8203;1000&#8203;と&#8203;定&#8203;義&#8203;し&#8203;て&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># sequenceがmax_sequence_lengthに達しないrandomのtensorをxとして、定義し、以下のコードでzero paddingを行ってみる。</span>
x = torch.randn(<span class="integer">100</span>, <span class="integer">768</span>)
display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### Padding前</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
display(x)
display(x.shape)

<span class="keyword">if</span> x.size()[<span class="integer">0</span>] &lt; max_sequence_length:
    x = F.pad(x, pad=(<span class="integer">0</span>, <span class="integer">0</span>, max_sequence_length - x.size()[<span class="integer">0</span>], <span class="integer">0</span>))

display_markdown(<span class="string"><span class="delimiter">'</span><span class="content">#### Padding後</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
display(x)
display(x.shape)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">Padding前
tensor([[-<span class="float">0.0767</span>,  <span class="float">1.8950</span>, -<span class="float">0.9323</span>,  ...,  <span class="float">0.1885</span>, -<span class="float">1.3335</span>,  <span class="float">0.3923</span>],
        [-<span class="float">0.5709</span>,  <span class="float">0.4231</span>,  <span class="float">0.4268</span>,  ..., -<span class="float">0.8555</span>, -<span class="float">0.6662</span>, -<span class="float">0.0097</span>],
        [ <span class="float">0.3191</span>, -<span class="float">0.3961</span>, -<span class="float">0.9253</span>,  ..., -<span class="float">1.0401</span>,  <span class="float">0.4225</span>, -<span class="float">0.2478</span>],
        ...,
        [-<span class="float">0.0769</span>, -<span class="float">0.0747</span>, -<span class="float">0.2437</span>,  ...,  <span class="float">0.3740</span>,  <span class="float">0.0970</span>,  <span class="float">0.6437</span>],
        [ <span class="float">1.1534</span>,  <span class="float">0.8583</span>,  <span class="float">1.2623</span>,  ...,  <span class="float">0.0882</span>,  <span class="float">0.5125</span>, -<span class="float">0.1485</span>],
        [ <span class="float">2.1272</span>,  <span class="float">0.8173</span>,  <span class="float">0.8997</span>,  ..., -<span class="float">0.5132</span>,  <span class="float">0.5023</span>,  <span class="float">0.3106</span>]])
torch.Size([<span class="integer">100</span>, <span class="integer">768</span>])

Padding後
tensor([[ <span class="float">0.0000</span>,  <span class="float">0.0000</span>,  <span class="float">0.0000</span>,  ...,  <span class="float">0.0000</span>,  <span class="float">0.0000</span>,  <span class="float">0.0000</span>],
        [ <span class="float">0.0000</span>,  <span class="float">0.0000</span>,  <span class="float">0.0000</span>,  ...,  <span class="float">0.0000</span>,  <span class="float">0.0000</span>,  <span class="float">0.0000</span>],
        [ <span class="float">0.0000</span>,  <span class="float">0.0000</span>,  <span class="float">0.0000</span>,  ...,  <span class="float">0.0000</span>,  <span class="float">0.0000</span>,  <span class="float">0.0000</span>],
        ...,
        [-<span class="float">0.0769</span>, -<span class="float">0.0747</span>, -<span class="float">0.2437</span>,  ...,  <span class="float">0.3740</span>,  <span class="float">0.0970</span>,  <span class="float">0.6437</span>],
        [ <span class="float">1.1534</span>,  <span class="float">0.8583</span>,  <span class="float">1.2623</span>,  ...,  <span class="float">0.0882</span>,  <span class="float">0.5125</span>, -<span class="float">0.1485</span>],
        [ <span class="float">2.1272</span>,  <span class="float">0.8173</span>,  <span class="float">0.8997</span>,  ..., -<span class="float">0.5132</span>,  <span class="float">0.5023</span>,  <span class="float">0.3106</span>]])
torch.Size([<span class="integer">1000</span>, <span class="integer">768</span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;上&#8203;記&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;ま&#8203;と&#8203;め&#8203;て、&#8203;pytorch&#8203;の&#8203;Dataset&#8203;ク&#8203;ラ&#8203;ス&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">Dataset</span>(_Dataset):
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="predefined-constant">self</span>, weekly_features, weekly_labels, max_sequence_length):
        <span class="comment"># 共通する週のみを使うため、共通するindex情報を取得する</span>
        mask_index = (
            weekly_features.index.get_level_values(<span class="integer">0</span>).unique() &amp; weekly_labels.index
        )

        <span class="comment"># 共通するindexのみのデータだけでreindexを行う。</span>
        <span class="predefined-constant">self</span>.weekly_features = weekly_features[
            weekly_features.index.get_level_values(<span class="integer">0</span>).isin(mask_index)
        ]
        <span class="predefined-constant">self</span>.weekly_labels = weekly_labels.reindex(mask_index)

        <span class="comment"># idからweekの情報を取得できるよう、id_to_weekをビルドする</span>
        <span class="predefined-constant">self</span>.id_to_week = {
            <span class="predefined">id</span>: week <span class="keyword">for</span> <span class="predefined">id</span>, week <span class="keyword">in</span> <span class="predefined">enumerate</span>(<span class="predefined">sorted</span>(weekly_labels.index))
        }

        <span class="predefined-constant">self</span>.max_sequence_length = max_sequence_length

    <span class="keyword">def</span> <span class="function">_shuffle_by_local_split</span>(<span class="predefined-constant">self</span>, x, split_size=<span class="integer">50</span>):
        <span class="keyword">return</span> torch.cat(
            [
                splitted[torch.randperm(splitted.size()[<span class="integer">0</span>])]
                <span class="keyword">for</span> splitted <span class="keyword">in</span> x.split(split_size, dim=<span class="integer">0</span>)
            ],
            dim=<span class="integer">0</span>,
        )

    <span class="keyword">def</span> <span class="function">__len__</span>(<span class="predefined-constant">self</span>):
        <span class="keyword">return</span> <span class="predefined">len</span>(<span class="predefined-constant">self</span>.weekly_labels)

    <span class="keyword">def</span> <span class="function">__getitem__</span>(<span class="predefined-constant">self</span>, <span class="predefined">id</span>):
        <span class="comment"># 付与されたidから週の情報を取得し、その週の情報から、特徴量とラベルを取得する。</span>
        week = <span class="predefined-constant">self</span>.id_to_week[<span class="predefined">id</span>]
        x = <span class="predefined-constant">self</span>.weekly_features.xs(week, axis=<span class="integer">0</span>, level=<span class="integer">0</span>)[-<span class="predefined-constant">self</span>.max_sequence_length :]
        y = <span class="predefined-constant">self</span>.weekly_labels[week]

        <span class="comment"># pytorchでは、データをtorch.Tensorタイプとして扱うことが要求される。</span>
        <span class="comment"># 全体的な特徴量(ニュースの情報)の順序は維持しつつ、入力とする特徴量を数分割し、その分割の中でシャッフルを行う。</span>
        x = <span class="predefined-constant">self</span>._shuffle_by_local_split(torch.tensor(x.values, dtype=torch.float))
        y = torch.tensor(y, dtype=torch.float)

        <span class="comment"># max_sequence_lengthに最大のsequenceを合わせ、sequenceがmax_sequence_lengthに達しない場合は、前から0を埋め、sequenceを合わせる</span>
        <span class="keyword">if</span> x.size()[<span class="integer">0</span>] &lt; <span class="predefined-constant">self</span>.max_sequence_length:
            x = F.pad(x, pad=(<span class="integer">0</span>, <span class="integer">0</span>, <span class="predefined-constant">self</span>.max_sequence_length - x.size()[<span class="integer">0</span>], <span class="integer">0</span>))

        <span class="keyword">return</span> x, y</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lstmによる特徴量合成モデル作成">6.2.7. LSTMによる特徴量合成モデル作成</h4>
<div class="paragraph">
<p>　LSTM&#8203;を&#8203;用&#8203;い&#8203;て&#8203;上&#8203;げ&#8203;下&#8203;げ&#8203;の&#8203;確&#8203;率&#8203;を&#8203;出&#8203;力&#8203;と&#8203;す&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;定&#8203;義&#8203;し、&#8203;binary_cross_entropy&#8203;を&#8203;損&#8203;失&#8203;関&#8203;数&#8203;と&#8203;し&#8203;て&#8203;学&#8203;習&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。&#8203;モ&#8203;デ&#8203;ル&#8203;へ&#8203;の&#8203;入&#8203;力&#8203;Sequence&#8203;が&#8203;か&#8203;な&#8203;り&#8203;長&#8203;い&#8203;た&#8203;め、&#8203;入&#8203;力&#8203;の&#8203;最&#8203;初&#8203;の&#8203;方&#8203;の&#8203;情&#8203;報&#8203;の&#8203;消&#8203;失&#8203;が&#8203;激&#8203;し&#8203;い&#8203;と&#8203;想&#8203;定&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;た&#8203;め&#8203;今&#8203;回&#8203;は、&#8203;LSTM&#8203;に&#8203;お&#8203;い&#8203;て&#8203; <code>bidirectional</code> &#8203;を&#8203;利&#8203;用&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;具&#8203;体&#8203;的&#8203;な&#8203;LSTM&#8203;の&#8203;定&#8203;義&#8203;は&#8203;以&#8203;下&#8203;の&#8203;ソー&#8203;ス&#8203;コー&#8203;ド&#8203;を&#8203;確&#8203;認&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;出&#8203;力&#8203;層&#8203;で&#8203;の&#8203;sentiment score&#8203;（上&#8203;げ&#8203;下&#8203;げ&#8203;の&#8203;情&#8203;報）&#8203;及&#8203;び&#8203;出&#8203;力&#8203;の&#8203;直&#8203;前&#8203;の&#8203;層&#8203;の&#8203;高&#8203;次&#8203;元&#8203;の&#8203;情&#8203;報&#8203;を&#8203;抽&#8203;出&#8203;し、&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;用&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;想&#8203;定&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">FeatureCombiner</span>(nn.Module):
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="predefined-constant">self</span>, input_size, hidden_size, compress_dim=<span class="integer">4</span>, num_layers=<span class="integer">2</span>):
        <span class="predefined">super</span>().__init__()
        <span class="predefined-constant">self</span>.input_size = input_size
        <span class="predefined-constant">self</span>.hidden_size = hidden_size

        <span class="comment"># LSTMの定義</span>
        <span class="comment"># batch_firstより、出力次元の最初がbatchとなる。</span>
        <span class="comment"># dropoutを用いて、内部状態のconnectionをdropすることより過学習を防ぐ。</span>
        <span class="comment"># Sequenceがかなり長く、入力の始めの方の情報の消失を防ぐため、bidirectionalのモデルを使う。</span>
        <span class="predefined-constant">self</span>.cell = nn.LSTM(
            input_size=input_size,
            hidden_size=hidden_size,
            num_layers=num_layers,
            batch_first=<span class="predefined-constant">True</span>,
            dropout=<span class="float">0.5</span>,
            bidirectional=<span class="predefined-constant">True</span>,
        )

        <span class="comment"># より高次元の特徴量を抽出できるようにするため、classifierの手前で、compress_dim次元への線形圧縮を行う。</span>
        <span class="predefined-constant">self</span>.compressor = nn.Linear(hidden_size * <span class="integer">2</span>, compress_dim)

        <span class="comment"># sentiment probabilityの出力層。</span>
        <span class="predefined-constant">self</span>.classifier = nn.Linear(compress_dim, <span class="integer">1</span>)

        <span class="comment"># outputの範囲を[0, 1]とする。</span>
        <span class="predefined-constant">self</span>.sigmoid = nn.Sigmoid()

    <span class="keyword">def</span> <span class="function">forward</span>(<span class="predefined-constant">self</span>, x):
        <span class="comment"># 入力値xから出力までの流れを定義する。</span>
        output, _ = <span class="predefined-constant">self</span>.cell(x)
        output = <span class="predefined-constant">self</span>.sigmoid(<span class="predefined-constant">self</span>.classifier(<span class="predefined-constant">self</span>.compressor(output[:, -<span class="integer">1</span>, :])))
        <span class="keyword">return</span> output

    <span class="keyword">def</span> <span class="function">extract_feature</span>(<span class="predefined-constant">self</span>, x):
        <span class="comment"># 入力値xから特徴量抽出までの流れを定義する。</span>
        output, _ = <span class="predefined-constant">self</span>.cell(x)
        output = <span class="predefined-constant">self</span>.compressor(output[:, -<span class="integer">1</span>, :])
        <span class="keyword">return</span> output</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_特徴量合成モデルのハンドラー作成">6.2.8. 特徴量合成モデルのハンドラー作成</h4>
<div class="paragraph">
<p>　&#8203;前&#8203;節&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;デー&#8203;タ&#8203;の&#8203;イ&#8203;ン&#8203;デ&#8203;ク&#8203;シ&#8203;ン&#8203;グ&#8203;ロ&#8203;ジッ&#8203;ク&#8203;や、&#8203;特&#8203;徴&#8203;量&#8203;合&#8203;成&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;し&#8203;た。&#8203;し&#8203;か&#8203;し、&#8203;こ&#8203;れ&#8203;ら&#8203;だ&#8203;け&#8203;で&#8203;は&#8203;モ&#8203;デ&#8203;ル&#8203;学&#8203;習&#8203;は&#8203;行&#8203;え&#8203;ま&#8203;せ&#8203;ん。&#8203;学&#8203;習&#8203;の&#8203;ロ&#8203;ジッ&#8203;ク&#8203;や、&#8203;学&#8203;習&#8203;さ&#8203;れ&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;セー&#8203;ブ&#8203;及&#8203;び&#8203;ロー&#8203;ド、&#8203;推&#8203;定、&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;を&#8203;実&#8203;装&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;本&#8203;節&#8203;で&#8203;は、&#8203;こ&#8203;れ&#8203;ら&#8203;を&#8203;実&#8203;装&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;FeatureCombinerHandler&#8203;の&#8203;ク&#8203;ラ&#8203;ス&#8203;を&#8203;定&#8203;義&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">FeatureCombinerHandler</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="predefined-constant">self</span>, feature_combiner_params, store_dir):
        <span class="comment"># モデル学習及び推論に用いるデバイスを定義する</span>
        <span class="keyword">if</span> torch.cuda.device_count() &gt;= <span class="integer">1</span>:
            <span class="predefined-constant">self</span>.device = <span class="string"><span class="delimiter">'</span><span class="content">cuda</span><span class="delimiter">'</span></span>
            print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] Set Device: GPU</span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">else</span>:
            <span class="predefined-constant">self</span>.device = <span class="string"><span class="delimiter">'</span><span class="content">cpu</span><span class="delimiter">'</span></span>
            print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] Set Device: CPU</span><span class="delimiter">&quot;</span></span>)

        <span class="comment"># モデルのcheckpointや抽出した特徴量及びsentimentをstoreする場所を定義する。</span>
        <span class="predefined-constant">self</span>.store_dir = store_dir
        os.makedirs(store_dir, exist_ok=<span class="predefined-constant">True</span>)

        <span class="comment"># 上記で作成したfeaturecombinerを定義する。</span>
        <span class="predefined-constant">self</span>.feature_combiner = FeatureCombiner(**feature_combiner_params).to(
            <span class="predefined-constant">self</span>.device
        )

        <span class="comment"># 学習に用いるoptimizerを定義する。</span>
        <span class="predefined-constant">self</span>.optimizer = torch.optim.Adam(
            params=<span class="predefined-constant">self</span>.feature_combiner.parameters(), lr=<span class="float">0.001</span>,
        )

        <span class="comment"># ロス関数の定義</span>
        <span class="predefined-constant">self</span>.criterion = nn.BCELoss().to(<span class="predefined-constant">self</span>.device)

        <span class="comment"># モデルのcheck pointが存在する場合、モデルをロードする</span>
        <span class="predefined-constant">self</span>._load_model()

    <span class="comment"># 学習に必要なデータ(並列のためbatch化されたもの)をサンプルする。</span>
    <span class="keyword">def</span> <span class="function">_sample_xy</span>(<span class="predefined-constant">self</span>, data_type):
        <span class="keyword">assert</span> data_type <span class="keyword">in</span> (<span class="string"><span class="delimiter">&quot;</span><span class="content">train</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">val</span><span class="delimiter">&quot;</span></span>)

        <span class="comment"># data_typeより、data_typeに合致したデータを取得するようにしている。</span>
        <span class="keyword">if</span> data_type == <span class="string"><span class="delimiter">&quot;</span><span class="content">train</span><span class="delimiter">&quot;</span></span>:
            <span class="comment"># dataloaderをiteratorとして定義し、next関数として毎時のデータをサンプルすることができる。</span>
            <span class="comment"># Iteratorは全てのデータがサンプルされると、StopIterationのエラーを発するが、そのようなエラーが出たとき、</span>
            <span class="comment"># Iteratorを再定義し、データをサンプルするようにしている。</span>
            <span class="keyword">try</span>:
                x, y = <span class="predefined">next</span>(<span class="predefined-constant">self</span>.iterable_train_dataloader)
            <span class="keyword">except</span> <span class="exception">StopIteration</span>:
                <span class="predefined-constant">self</span>.iterable_train_dataloader = <span class="predefined">iter</span>(<span class="predefined-constant">self</span>.train_dataloader)
                x, y = <span class="predefined">next</span>(<span class="predefined-constant">self</span>.iterable_train_dataloader)

        <span class="keyword">elif</span> data_type == <span class="string"><span class="delimiter">&quot;</span><span class="content">val</span><span class="delimiter">&quot;</span></span>:
            <span class="keyword">try</span>:
                x, y = <span class="predefined">next</span>(<span class="predefined-constant">self</span>.iterable_val_dataloader)
            <span class="keyword">except</span> <span class="exception">StopIteration</span>:
                <span class="predefined-constant">self</span>.iterable_val_dataloader = <span class="predefined">iter</span>(<span class="predefined-constant">self</span>.val_dataloader)
                x, y = <span class="predefined">next</span>(<span class="predefined-constant">self</span>.iterable_val_dataloader)

        <span class="keyword">return</span> x.to(<span class="predefined-constant">self</span>.device), y.to(<span class="predefined-constant">self</span>.device)

    <span class="comment"># モデルのパラメータをアップデートするロジック</span>
    <span class="keyword">def</span> <span class="function">_update_params</span>(<span class="predefined-constant">self</span>, loss):
        <span class="comment"># ロスから、gradientを逆伝播し、パラメータをアップデートする</span>
        loss.backward()
        <span class="predefined-constant">self</span>.optimizer.step()

    <span class="comment"># 学習されたfeature_combinerのパラメータをcheck_pointとしてstoreするロジック</span>
    <span class="keyword">def</span> <span class="function">_save_model</span>(<span class="predefined-constant">self</span>, epoch):
        torch.save(
            <span class="predefined-constant">self</span>.feature_combiner.state_dict(),
            os.path.join(<span class="predefined-constant">self</span>.store_dir, f<span class="string"><span class="delimiter">&quot;</span><span class="content">{epoch}.ckpt</span><span class="delimiter">&quot;</span></span>),
        )
        print(f<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] Epoch: {epoch}, Model is saved.</span><span class="delimiter">&quot;</span></span>)

    <span class="comment"># 学習されたcheckpointが存在す場合、feature_combinerにそのパラメータをロードするロジック</span>
    <span class="keyword">def</span> <span class="function">_load_model</span>(<span class="predefined-constant">self</span>):
        <span class="comment"># cudaで学習されたモデルなどを、cpu環境下でロードするときはこのパラメータが必要となる。</span>
        params_to_load = {}
        <span class="keyword">if</span> <span class="predefined-constant">self</span>.device == <span class="string"><span class="delimiter">&quot;</span><span class="content">cpu</span><span class="delimiter">&quot;</span></span>:
            params_to_load[<span class="string"><span class="delimiter">&quot;</span><span class="content">map_location</span><span class="delimiter">&quot;</span></span>] = torch.device(<span class="string"><span class="delimiter">&quot;</span><span class="content">cpu</span><span class="delimiter">&quot;</span></span>)

        <span class="comment"># .ckptファイルを探し、古い順から新しい順にソートする。</span>
        check_points = glob(os.path.join(<span class="predefined-constant">self</span>.store_dir, <span class="string"><span class="delimiter">&quot;</span><span class="content">*.ckpt</span><span class="delimiter">&quot;</span></span>))
        check_points = <span class="predefined">sorted</span>(
            check_points, key=<span class="keyword">lambda</span> x: <span class="predefined">int</span>(x.split(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)[-<span class="integer">1</span>].replace(<span class="string"><span class="delimiter">&quot;</span><span class="content">.ckpt</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)),
        )

        <span class="comment"># check_pointが存在しない場合は、スキップする。</span>
        <span class="keyword">if</span> <span class="predefined">len</span>(check_points) == <span class="integer">0</span>:
            print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[!] No exists checkpoint</span><span class="delimiter">&quot;</span></span>)
            <span class="keyword">return</span>

        <span class="comment"># 複数個のchieck_pointが存在する場合、一番最新のものを使い、モデルのパラメータをロードする</span>
        check_point = check_points[-<span class="integer">1</span>]
        <span class="predefined-constant">self</span>.feature_combiner.load_state_dict(torch.load(check_point, **params_to_load))
        print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] Model is loaded</span><span class="delimiter">&quot;</span></span>)

    <span class="comment"># Datasetからdataloaderを定義するロジック</span>
    <span class="keyword">def</span> <span class="function">_build_dataloader</span>(
        <span class="predefined-constant">self</span>, dataloader_params, weekly_features, weekly_labels, max_sequence_length
    ):
        <span class="comment"># 上記3で作成したしたdatasetを定義する</span>
        dataset = Dataset(
            weekly_features=weekly_features,
            weekly_labels=weekly_labels,
            max_sequence_length=max_sequence_length,
        )

        <span class="comment"># datasetのdataをiterableにロードできるよう、dataloaderを定義する、このとき、shuffle=Trueを渡すことで、データはランダムにサンプルされるようになる。</span>
        <span class="keyword">return</span> DataLoader(dataset=dataset, shuffle=<span class="predefined-constant">True</span>, **dataloader_params)

    <span class="comment"># train用に、featuresとlabelsを渡し、datasetを定義し、dataloaderを定義するロジック</span>
    <span class="keyword">def</span> <span class="function">set_train_dataloader</span>(
        <span class="predefined-constant">self</span>, dataloader_params, weekly_features, weekly_labels, max_sequence_length
    ):
        <span class="predefined-constant">self</span>.train_dataloader = <span class="predefined-constant">self</span>._build_dataloader(
            dataloader_params=dataloader_params,
            weekly_features=weekly_features,
            weekly_labels=weekly_labels,
            max_sequence_length=max_sequence_length,
        )

        <span class="comment"># dataloaderからiteratorを定義する</span>
        <span class="comment"># iteratorはnext関数よりデータをサンプルすることが可能となる。</span>
        <span class="predefined-constant">self</span>.iterable_train_dataloader = <span class="predefined">iter</span>(<span class="predefined-constant">self</span>.train_dataloader)

    <span class="comment"># validation用に、featuresとlabelsを渡し、datasetを定義し、dataloaderを定義するロジック</span>
    <span class="keyword">def</span> <span class="function">set_val_dataloader</span>(
        <span class="predefined-constant">self</span>, dataloader_params, weekly_features, weekly_labels, max_sequence_length
    ):
        <span class="predefined-constant">self</span>.val_dataloader = <span class="predefined-constant">self</span>._build_dataloader(
            dataloader_params=dataloader_params,
            weekly_features=weekly_features,
            weekly_labels=weekly_labels,
            max_sequence_length=max_sequence_length,
        )

        <span class="comment"># dataloaderからiteratorを定義する</span>
        <span class="comment"># iteratorはnext関数よりデータをサンプルすることが可能となる。</span>
        <span class="predefined-constant">self</span>.iterable_val_dataloader = <span class="predefined">iter</span>(<span class="predefined-constant">self</span>.val_dataloader)

    <span class="comment"># 学習ロジック</span>
    <span class="keyword">def</span> <span class="function">train</span>(<span class="predefined-constant">self</span>, n_epoch):
        <span class="comment"># n_epochの回数分、全学習データを複数回用いて学習する。</span>
        <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="predefined">range</span>(n_epoch):

            <span class="comment"># 各々のepochごとのaverage lossを表示するため、lossをstoreするリストを定義する。</span>
            train_losses = []
            test_losses = []

            <span class="comment"># train_dataloaderの長さは、全ての学習データを一度用いるときの長さと同様である。</span>
            <span class="comment"># batchを組むと、その分train_dataloaderの長さは可変し、ちょうど一度全てのデータで学習できる長さを返す。</span>
            <span class="keyword">for</span> iter_ <span class="keyword">in</span> tqdm(<span class="predefined">range</span>(<span class="predefined">len</span>(<span class="predefined-constant">self</span>.train_dataloader))):
                <span class="comment"># パラメータをtrainableにするため、feature_combinerをtrainモードにする。</span>
                <span class="predefined-constant">self</span>.feature_combiner.train()

                <span class="comment"># trainデータをサンプルする。</span>
                x, y = <span class="predefined-constant">self</span>._sample_xy(data_type=<span class="string"><span class="delimiter">&quot;</span><span class="content">train</span><span class="delimiter">&quot;</span></span>)

                <span class="comment"># feature_combinerに特徴量を入力し、sentiment scoreを取得する。</span>
                preds = <span class="predefined-constant">self</span>.feature_combiner(x=x)

                <span class="comment"># sentiment scoreとラベルとのロスを計算する。</span>
                train_loss = <span class="predefined-constant">self</span>.criterion(preds, y.view(-<span class="integer">1</span>, <span class="integer">1</span>))

                <span class="comment"># 計算されたロスは、後ほどepochごとのdisplayに使用するため、storeしておく。</span>
                train_losses.append(train_loss.detach().cpu())

                <span class="comment"># lossから、gradientを逆伝播させ、パラメータをupdateする。</span>
                <span class="predefined-constant">self</span>._update_params(loss=train_loss)

                <span class="comment"># validation用のロースを計算する。</span>
                <span class="comment"># 毎回計算を行うとコストがかかってくるので、iter_毎5回ごとに計算を行う。</span>
                <span class="keyword">if</span> iter_ % <span class="integer">5</span> == <span class="integer">0</span>:

                    <span class="comment"># 学習を行わないため、feature_combinerをevalモードにしておく。</span>
                    <span class="comment"># evalモードでは、dropoutの影響を受けない。</span>
                    <span class="predefined-constant">self</span>.feature_combiner.eval()

                    <span class="comment"># 各パラメータごとのgradientを計算するとリソースが高まる。</span>
                    <span class="comment"># evaluationの時には、gradient情報を持たせないことで、メモリーの節約に繋がる。</span>
                    <span class="keyword">with</span> torch.no_grad():
                        <span class="comment"># validationデータをサンプルする</span>
                        x, y = <span class="predefined-constant">self</span>._sample_xy(data_type=<span class="string"><span class="delimiter">&quot;</span><span class="content">val</span><span class="delimiter">&quot;</span></span>)

                        <span class="comment"># feature_combinerに特徴量を入力し、sentiment scoreを取得する。</span>
                        preds = <span class="predefined-constant">self</span>.feature_combiner(x=x)

                        <span class="comment"># sentiment scoreとラベルとのロスを計算する。</span>
                        test_loss = <span class="predefined-constant">self</span>.criterion(preds, y.view(-<span class="integer">1</span>, <span class="integer">1</span>))

                        <span class="comment"># 計算されたロスは、後ほどepochごとのdisplayに使用するため、storeしておく。</span>
                        test_losses.append(test_loss.detach().cpu())

            <span class="comment"># 毎epoch終了後、平均のロスをプリントする。</span>
            print(
                f<span class="string"><span class="delimiter">&quot;</span><span class="content">epoch: {epoch}, train_loss: {np.mean(train_losses):.4f}, val_loss: {np.mean(test_losses):.4f}</span><span class="delimiter">&quot;</span></span>
            )

            <span class="comment"># 毎epoch終了後、モデルのパラメータをstoreする。</span>
            <span class="predefined-constant">self</span>._save_model(epoch=epoch)

    <span class="comment"># 特徴量から、合成特徴量を抽出するロジック</span>
    <span class="keyword">def</span> <span class="function">combine_features</span>(<span class="predefined-constant">self</span>, features):
        <span class="comment"># 学習を行わないため、feature_combinerをevalモードにしておく。</span>
        <span class="predefined-constant">self</span>.feature_combiner.eval()

        <span class="comment"># gradient情報を持たせないことで、メモリーの節約する。</span>
        <span class="keyword">with</span> torch.no_grad():

            <span class="comment"># 特徴量をfeature_combinerのextract_feature関数に入力し、出力層手前の特徴量を抽出する。</span>
            <span class="comment"># 抽出するとき、tensorをcpu上に落とし、np.ndarray形式に変換する。</span>
            <span class="keyword">return</span> (
                <span class="predefined-constant">self</span>.feature_combiner.extract_feature(
                    x=torch.tensor(features, dtype=torch.float).to(<span class="predefined-constant">self</span>.device)
                )
                .cpu()
                .numpy()
            )

    <span class="comment"># 特徴量から、翌週のsentimentを予測するロジック</span>
    <span class="keyword">def</span> <span class="function">predict_sentiment</span>(<span class="predefined-constant">self</span>, features):
        <span class="comment"># 学習を行わないため、feature_combinerをevalモードにしておく。</span>
        <span class="predefined-constant">self</span>.feature_combiner.eval()

        <span class="comment"># gradient情報を持たせないことで、メモリーの節約する。</span>
        <span class="keyword">with</span> torch.no_grad():

            <span class="comment"># 特徴量をfeature_combinerに入力し、sentiment scoreを抽出する。</span>
            <span class="comment"># 抽出するとき、tensorをcpu上に落とし、np.ndarray形式に変換する。</span>
            <span class="keyword">return</span> (
                <span class="predefined-constant">self</span>.feature_combiner(x=torch.tensor(features, dtype=torch.float).to(<span class="predefined-constant">self</span>.device))
                .cpu()
                .numpy()
            )

    <span class="comment"># weeklyグループされた特徴量を入力に、合成特徴量もしくは、sentiment scoreを抽出するロジック</span>
    <span class="keyword">def</span> <span class="function">generate_by_weekly_features</span>(
        <span class="predefined-constant">self</span>, weekly_features, generate_target, max_sequence_length
    ):
        <span class="keyword">assert</span> generate_target <span class="keyword">in</span> (<span class="string"><span class="delimiter">&quot;</span><span class="content">features</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sentiment</span><span class="delimiter">&quot;</span></span>)
        generate_func = <span class="predefined">getattr</span>(
            <span class="predefined-constant">self</span>,
            {<span class="string"><span class="delimiter">&quot;</span><span class="content">features</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">combine_features</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sentiment</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">predict_sentiment</span><span class="delimiter">&quot;</span></span>}[
                generate_target
            ],
        )

        <span class="comment"># グループごとに特徴量もしくは、sentiment scoreを抽出し、最終的に重ねて返すため、リストを作成する。</span>
        outputs = []

        <span class="comment"># ユニークな週indexを取得する。</span>
        weeks = <span class="predefined">sorted</span>(weekly_features.index.get_level_values(<span class="integer">0</span>).unique())

        <span class="keyword">for</span> week <span class="keyword">in</span> tqdm(weeks):
            <span class="comment"># 各週ごとの特徴量を取得し、直近から、max_sequence_length分切る。</span>
            features = weekly_features.xs(week, axis=<span class="integer">0</span>, level=<span class="integer">0</span>)[-max_sequence_length:]

            <span class="comment"># 特徴量をモデルに入力し、合成特徴量もしくは、sentiment scoreを抽出し、outputsにappendする。</span>
            <span class="comment"># np.expand_dims(features, axis=0)を用いる理由は、特徴量合成機の入力期待値は、dimention0がbatchであるが、</span>
            <span class="comment"># featuresは、[1000, 768]の次元をもち、これらをunsqueezeし、[1, 1000, 768]に変換する必要がある。</span>
            outputs.append(generate_func(features=np.expand_dims(features, axis=<span class="integer">0</span>)))

        <span class="comment"># outputsを重ね、indexの情報とともにpd.DataFrame形式として返す。</span>
        <span class="keyword">return</span> pd.DataFrame(np.concatenate(outputs, axis=<span class="integer">0</span>), index=weeks)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_特徴量合成モデルの学習及び特徴量合成">6.2.9. 特徴量合成モデルの学習及び特徴量合成</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;節&#8203;で&#8203;は、&#8203;実&#8203;際&#8203;作&#8203;成&#8203;し&#8203;た&#8203;コー&#8203;ド&#8203;を&#8203;元&#8203;に、&#8203;特&#8203;徴&#8203;量&#8203;合&#8203;成&#8203;機&#8203;の&#8203;学&#8203;習&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。&#8203;さ&#8203;ら&#8203;に、&#8203;学&#8203;習&#8203;さ&#8203;れ&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;sentiment score&#8203;を&#8203;抽&#8203;出&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;実&#8203;装&#8203;で&#8203;は、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;過&#8203;学&#8203;習&#8203;を&#8203;防&#8203;止&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;二&#8203;つ&#8203;の&#8203;ラ&#8203;ン&#8203;ダ&#8203;ム&#8203;性&#8203;を&#8203;与&#8203;え&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;は、&#8203;学&#8203;習&#8203;の&#8203;た&#8203;び&#8203;に&#8203;異&#8203;な&#8203;る&#8203;ラ&#8203;ン&#8203;ダ&#8203;ム&#8203;性&#8203;を&#8203;与&#8203;え&#8203;ら&#8203;れ、&#8203;学&#8203;習&#8203;の&#8203;再&#8203;現&#8203;は&#8203;不&#8203;可&#8203;能&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;学&#8203;習&#8203;に&#8203;お&#8203;け&#8203;る&#8203;再&#8203;現&#8203;可&#8203;能&#8203;性&#8203;を&#8203;重&#8203;要&#8203;視&#8203;す&#8203;る&#8203;場&#8203;合、&#8203;ラ&#8203;ン&#8203;ダ&#8203;ム&#8203;性&#8203;を&#8203;固&#8203;定&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;し&#8203;か&#8203;し、&#8203;本&#8203;実&#8203;装&#8203;に&#8203;お&#8203;い&#8203;て&#8203;は&#8203;二&#8203;つ&#8203;の&#8203;ラ&#8203;ン&#8203;ダ&#8203;ム&#8203;性&#8203;を&#8203;同&#8203;時&#8203;に&#8203;固&#8203;定&#8203;し&#8203;な&#8203;い&#8203;と&#8203;い&#8203;け&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;そ&#8203;の&#8203;た&#8203;め&#8203;の&#8203;実&#8203;装&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;と&#8203;コー&#8203;ド&#8203;の&#8203;難&#8203;易&#8203;度&#8203;が&#8203;高&#8203;まっ&#8203;て&#8203;し&#8203;ま&#8203;い&#8203;ま&#8203;す。&#8203;以&#8203;上&#8203;の&#8203;こ&#8203;と&#8203;か&#8203;ら、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は&#8203;ラ&#8203;ン&#8203;ダ&#8203;ム&#8203;性&#8203;の&#8203;固&#8203;定&#8203;を&#8203;省&#8203;略&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;学&#8203;習&#8203;の&#8203;実&#8203;行&#8203;毎&#8203;に&#8203;少&#8203;し&#8203;異&#8203;な&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;構&#8203;築&#8203;さ&#8203;れ&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;留&#8203;意&#8203;し&#8203;ま&#8203;しょ&#8203;う。&#8203;た&#8203;だ&#8203;し、&#8203;推&#8203;論&#8203;処&#8203;理&#8203;に&#8203;お&#8203;い&#8203;て&#8203;は&#8203;こ&#8203;こ&#8203;で&#8203;固&#8203;定&#8203;化&#8203;し&#8203;な&#8203;かっ&#8203;た&#8203;ラ&#8203;ン&#8203;ダ&#8203;ム&#8203;性&#8203;の&#8203;影&#8203;響&#8203;は&#8203;あ&#8203;り&#8203;ま&#8203;せ&#8203;ん&#8203;の&#8203;で、&#8203;同&#8203;一&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;限&#8203;り&#8203;は&#8203;同&#8203;一&#8203;の&#8203;予&#8203;測&#8203;結&#8203;果&#8203;が&#8203;取&#8203;得&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;推&#8203;論&#8203;処&#8203;理&#8203;の&#8203;再&#8203;現&#8203;可&#8203;能&#8203;性&#8203;は&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;評&#8203;価&#8203;に&#8203;お&#8203;い&#8203;て&#8203;重&#8203;要&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;ま&#8203;ず&#8203;は、&#8203;上&#8203;記&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;FeatureCombinerHandler&#8203;を&#8203;イ&#8203;ン&#8203;ス&#8203;タ&#8203;ン&#8203;ス&#8203;化&#8203;し&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;と&#8203;き、&#8203;feature_combiner_params&#8203;に&#8203;{"input_size": 768, "hidden_size": 128}&#8203;を&#8203;渡&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;こ&#8203;れ&#8203;は&#8203;BERT&#8203;か&#8203;ら&#8203;抽&#8203;出&#8203;し&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;サ&#8203;イ&#8203;ズ&#8203;が&#8203;768&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め&#8203;で&#8203;す。&#8203;LSTM&#8203;が&#8203;持&#8203;つ&#8203;内&#8203;部&#8203;状&#8203;態&#8203;の&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203;の&#8203;次&#8203;元&#8203;に&#8203;お&#8203;い&#8203;て&#8203;は、&#8203;適&#8203;切&#8203;な&#8203;値&#8203;を&#8203;設&#8203;定&#8203;し&#8203;ま&#8203;しょ&#8203;う。&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;128&#8203;次&#8203;元&#8203;と&#8203;設&#8203;置&#8203;し&#8203;て&#8203;い&#8203;る&#8203;の&#8203;で&#8203;す&#8203;が、&#8203;過&#8203;学&#8203;習&#8203;の&#8203;恐&#8203;れ&#8203;が&#8203;高&#8203;い&#8203;と&#8203;き&#8203;や&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203;を&#8203;減&#8203;ら&#8203;し&#8203;て&#8203;も&#8203;十&#8203;分&#8203;学&#8203;習&#8203;可&#8203;能&#8203;な&#8203;時&#8203;に&#8203;は、&#8203;よ&#8203;り&#8203;低&#8203;い&#8203;値&#8203;を&#8203;セッ&#8203;ト&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">feature_combiner_handler = FeatureCombinerHandler(feature_combiner_params={<span class="string"><span class="delimiter">&quot;</span><span class="content">input_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">768</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">hidden_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">128</span>}, store_dir=f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/test</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;続&#8203;い&#8203;て、&#8203;学&#8203;習&#8203;用&#8203;と&#8203;validation&#8203;用&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;構&#8203;築&#8203;し&#8203;ま&#8203;す。&#8203;一&#8203;般&#8203;的&#8203;に、&#8203;デー&#8203;タ&#8203;は&#8203;学&#8203;習&#8203;に&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;る&#8203;Train&#8203;デー&#8203;タ&#8203;と、&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203;な&#8203;ど&#8203;の&#8203;調&#8203;整&#8203;の&#8203;た&#8203;め&#8203;用&#8203;い&#8203;ら&#8203;れ&#8203;る&#8203;validation&#8203;デー&#8203;タ、&#8203;学&#8203;習&#8203;後&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;評&#8203;価&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;test&#8203;デー&#8203;タ&#8203;に&#8203;分&#8203;け&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;多&#8203;い&#8203;で&#8203;す&#8203;が、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は、&#8203;LSTM&#8203;を&#8203;十&#8203;分&#8203;に&#8203;学&#8203;習&#8203;す&#8203;る&#8203;に&#8203;は&#8203;デー&#8203;タ&#8203;数&#8203;が&#8203;少&#8203;な&#8203;い&#8203;た&#8203;め、&#8203;Train&#8203;と&#8203;Test&#8203;デー&#8203;タ&#8203;に&#8203;分&#8203;割&#8203;し、&#8203;validation loss&#8203;の&#8203;算&#8203;出&#8203;時&#8203;に&#8203;も&#8203;test&#8203;デー&#8203;タ&#8203;を&#8203;用&#8203;い&#8203;ま&#8203;す。&#8203;ま&#8203;ず&#8203;は、&#8203;上&#8203;記&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;build_weekly_features&#8203;と&#8203;build_weekly_labels&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;生&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">boundary_week = (<span class="integer">2020</span>, <span class="integer">26</span>)
weekly_features = SentimentGenerator.build_weekly_features(features, boundary_week)
weekly_labels = SentimentGenerator.build_weekly_labels(stock_price, boundary_week)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;学&#8203;習&#8203;を&#8203;行&#8203;う&#8203;前&#8203;に、&#8203;デー&#8203;タ&#8203;の&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;及&#8203;び、&#8203;batch&#8203;処&#8203;理&#8203;を&#8203;行っ&#8203;て&#8203;く&#8203;れ&#8203;る&#8203;Dataloader&#8203;を&#8203;ビ&#8203;ル&#8203;ド&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;と&#8203;き、&#8203;batch_size&#8203;を&#8203;4&#8203;に&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;4&#8203;つ&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;並&#8203;列&#8203;に&#8203;学&#8203;習&#8203;し、&#8203;num_workers&#8203;を&#8203;2&#8203;に&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;dataloader&#8203;は&#8203;cpu 2core&#8203;を&#8203;用&#8203;い&#8203;て、&#8203;並&#8203;列&#8203;的&#8203;に&#8203;読&#8203;み&#8203;込&#8203;ま&#8203;れ&#8203;ま&#8203;す。&#8203;max_sequence_length&#8203;を&#8203;1,000&#8203;に&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;学&#8203;習&#8203;中&#8203;に&#8203;は&#8203;1,000&#8203;個&#8203;の&#8203;sequence&#8203;を&#8203;max&#8203;と&#8203;し&#8203;て&#8203;入&#8203;力&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># train dataloaderをsetする。</span>
feature_combiner_handler.set_train_dataloader(
    dataloader_params={
        <span class="string"><span class="delimiter">&quot;</span><span class="content">batch_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">num_workers</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
    },
    weekly_features=weekly_features[<span class="string"><span class="delimiter">'</span><span class="content">train</span><span class="delimiter">'</span></span>],
    weekly_labels=weekly_labels[<span class="string"><span class="delimiter">'</span><span class="content">train</span><span class="delimiter">'</span></span>],
    max_sequence_length=<span class="integer">1000</span>
)

<span class="comment"># validation dataloaderをsetする。</span>
feature_combiner_handler.set_val_dataloader(
    dataloader_params={
        <span class="string"><span class="delimiter">&quot;</span><span class="content">batch_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">num_workers</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
    },
    weekly_features=weekly_features[<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>],
    weekly_labels=weekly_labels[<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>],
    max_sequence_length=<span class="integer">1000</span>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;学&#8203;習&#8203;を&#8203;行っ&#8203;て&#8203;み&#8203;ま&#8203;しょ&#8203;う。&#8203;n_epoch&#8203;は&#8203;全&#8203;て&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;一&#8203;度&#8203;用&#8203;い&#8203;た&#8203;学&#8203;習&#8203;回&#8203;数&#8203;を&#8203;表&#8203;し、&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;テ&#8203;ス&#8203;ト&#8203;で&#8203;あ&#8203;る&#8203;た&#8203;め&#8203;1&#8203;と&#8203;設&#8203;定&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">feature_combiner_handler.train(n_epoch=<span class="integer">1</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">epoch: <span class="integer">0</span>, train_loss: <span class="float">0.7934</span>, val_loss: <span class="float">0.6816</span>
[+] Epoch: <span class="integer">0</span>, Model <span class="keyword">is</span> saved.</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;学&#8203;習&#8203;後、&#8203;特&#8203;徴&#8203;量&#8203;抽&#8203;出&#8203;機&#8203;か&#8203;ら、&#8203;特&#8203;徴&#8203;量&#8203;や&#8203;sentiment score&#8203;を&#8203;抽&#8203;出&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;今&#8203;回&#8203;は、&#8203;一&#8203;度&#8203;学&#8203;習&#8203;さ&#8203;れ&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;ロー&#8203;ド&#8203;し、&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;sentiment score&#8203;を&#8203;抽&#8203;出&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;す。&#8203;上&#8203;で&#8203;定&#8203;義&#8203;し&#8203;た、&#8203;feature_combiner_handler&#8203;を&#8203;同&#8203;様&#8203;に&#8203;定&#8203;義&#8203;す&#8203;る&#8203;と、&#8203;check_point&#8203;を&#8203;探&#8203;し、&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;ロー&#8203;ド&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">feature_combiner_handler = FeatureCombinerHandler(feature_combiner_params={<span class="string"><span class="delimiter">&quot;</span><span class="content">input_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">768</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">hidden_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">128</span>}, store_dir=f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/test</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　sentiment score&#8203;は&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;取&#8203;得&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;max_sequence_length&#8203;は&#8203;学&#8203;習&#8203;時&#8203;と&#8203;同&#8203;様&#8203;に、&#8203;直&#8203;近&#8203;か&#8203;ら&#8203;利&#8203;用&#8203;す&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;最&#8203;大&#8203;の&#8203;数&#8203;を&#8203;決&#8203;め&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す&#8203;が、&#8203;評&#8203;価&#8203;時&#8203;に&#8203;は、&#8203;十&#8203;分&#8203;長&#8203;い&#8203;(&#8203;全&#8203;部&#8203;か&#8203;ほ&#8203;ぼ&#8203;全&#8203;部&#8203;)&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;合&#8203;成&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;10,000&#8203;を&#8203;与&#8203;え&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">sentiment_score = feature_combiner_handler.generate_by_weekly_features(weekly_features=weekly_features[<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>], generate_target=<span class="string"><span class="delimiter">'</span><span class="content">sentiment</span><span class="delimiter">'</span></span>, max_sequence_length=<span class="integer">10000</span>)

display(sentiment_score.head(<span class="integer">3</span>))
display(sentiment_score.tail(<span class="integer">3</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter06/images/1_7_lstm_test_sentiment_score.png" alt="1_7_lstm_test_sentiment_score" width="20%">
</div>
</div>
<div class="paragraph">
<p>ま&#8203;た、&#8203;よ&#8203;り&#8203;高&#8203;次&#8203;元&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;は&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;取&#8203;得&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">combined_features = feature_combiner_handler.generate_by_weekly_features(weekly_features=weekly_features[<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>], generate_target=<span class="string"><span class="delimiter">'</span><span class="content">features</span><span class="delimiter">'</span></span>, max_sequence_length=<span class="integer">10000</span>)

display(combined_features.head(<span class="integer">3</span>))
display(combined_features.tail(<span class="integer">3</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter06/images/1_7_lstm_test_features.png" alt="1_7_lstm_test_features" width="50%">
</div>
</div>
<div class="paragraph">
<p>上&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;FeatureCombinerHandler&#8203;は、&#8203;本&#8203;番&#8203;環&#8203;境&#8203;に&#8203;お&#8203;い&#8203;て&#8203;も&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;合&#8203;成&#8203;時&#8203;に&#8203;用&#8203;い&#8203;ま&#8203;す。&#8203;<code>SentimentGenerator</code> &#8203;ク&#8203;ラ&#8203;ス&#8203;に、&#8203;イ&#8203;ン&#8203;ス&#8203;タ&#8203;ン&#8203;ス&#8203;と&#8203;し&#8203;て&#8203;ビ&#8203;ル&#8203;ド&#8203;し&#8203;て&#8203;お&#8203;き&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">SentimentGenerator.headline_feature_combiner_handler = FeatureCombinerHandler(feature_combiner_params={<span class="string"><span class="delimiter">&quot;</span><span class="content">input_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">768</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">hidden_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">128</span>}, store_dir=f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/headline_features</span><span class="delimiter">'</span></span>)
SentimentGenerator.keywords_feature_combiner_handler = FeatureCombinerHandler(feature_combiner_params={<span class="string"><span class="delimiter">&quot;</span><span class="content">input_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">768</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">hidden_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">128</span>}, store_dir=f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/keywords_features</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>上&#8203;記&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;ま&#8203;と&#8203;め、&#8203;headline&#8203;と&#8203;keywords&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;特&#8203;徴&#8203;量&#8203;合&#8203;成&#8203;機&#8203;を&#8203;学&#8203;習&#8203;し、&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;抽&#8203;出&#8203;す&#8203;る&#8203;コー&#8203;ド&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">boundary_week = (<span class="integer">2020</span>, <span class="integer">26</span>)
<span class="keyword">for</span> features, feature_type <span class="keyword">in</span> [(headline_features, <span class="string"><span class="delimiter">'</span><span class="content">headline_features</span><span class="delimiter">'</span></span>), (keywords_features, <span class="string"><span class="delimiter">'</span><span class="content">keywords_features</span><span class="delimiter">'</span></span>)]:
    <span class="comment"># feature_typeに合致するfeature_combiner_handlerをSentimentGeneratorから取得する。</span>
    feature_combiner_handler = {
        <span class="string"><span class="delimiter">'</span><span class="content">headline_features</span><span class="delimiter">'</span></span>: SentimentGenerator.headline_feature_combiner_handler,
        <span class="string"><span class="delimiter">'</span><span class="content">keywords_features</span><span class="delimiter">'</span></span>: SentimentGenerator.keywords_feature_combiner_handler,
    }[feature_type]

    <span class="comment"># 学習及び、validationに用いる、データをビルドする</span>
    weekly_features = SentimentGenerator.build_weekly_features(features, boundary_week)
    weekly_labels = SentimentGenerator.build_weekly_labels(stock_price, boundary_week)

    <span class="comment"># train dataloaderをsetする。</span>
    <span class="comment"># このとき、batch_sizeを4にすることで、4つのデータを並列に学習し、</span>
    <span class="comment"># num_workersを2にすることでdataloaderはcpu 2coreを用いて、並列的にロードされる。</span>
    feature_combiner_handler.set_train_dataloader(
        dataloader_params={
            <span class="string"><span class="delimiter">&quot;</span><span class="content">batch_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">num_workers</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
        },
        weekly_features=weekly_features[<span class="string"><span class="delimiter">'</span><span class="content">train</span><span class="delimiter">'</span></span>],
        weekly_labels=weekly_labels[<span class="string"><span class="delimiter">'</span><span class="content">train</span><span class="delimiter">'</span></span>],
        max_sequence_length=<span class="integer">1000</span>
    )

    <span class="comment"># validation dataloaderをsetする。</span>
    feature_combiner_handler.set_val_dataloader(
        dataloader_params={
            <span class="string"><span class="delimiter">&quot;</span><span class="content">batch_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">num_workers</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
        },
        weekly_features=weekly_features[<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>],
        weekly_labels=weekly_labels[<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>],
        max_sequence_length=<span class="integer">1000</span>
    )

    <span class="comment"># 学習</span>
    feature_combiner_handler.train(n_epoch=<span class="integer">20</span>)

    <span class="comment"># 特徴量及びsentiment scoreを抽出し、pickleとしてstoreする。</span>
    feature_combiner_handler.generate_by_weekly_features(weekly_features=weekly_features[<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>], generate_target=<span class="string"><span class="delimiter">'</span><span class="content">sentiment</span><span class="delimiter">'</span></span>, max_sequence_length=<span class="integer">10000</span>).to_pickle(os.path.join(f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/{feature_type}</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">LSTM_sentiment.pkl</span><span class="delimiter">'</span></span>))
    feature_combiner_handler.generate_by_weekly_features(weekly_features=weekly_features[<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>], generate_target=<span class="string"><span class="delimiter">'</span><span class="content">features</span><span class="delimiter">'</span></span>, max_sequence_length=<span class="integer">10000</span>).to_pickle(os.path.join(f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/{feature_type}</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">LSTM_features.pkl</span><span class="delimiter">'</span></span>))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_本番提出用のクラス作成">6.2.10. 本番提出用のクラス作成</h4>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;の、&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;の&#8203;読&#8203;み&#8203;込&#8203;み、&#8203;前&#8203;処&#8203;理、&#8203;BERT&#8203;特&#8203;徴&#8203;量、&#8203;LSTM&#8203;に&#8203;よ&#8203;る&#8203;特&#8203;徴&#8203;量&#8203;合&#8203;成&#8203;ま&#8203;で&#8203;の&#8203;一&#8203;連&#8203;の&#8203;処&#8203;理&#8203;を&#8203; <code>generate_lstm_features</code> &#8203;関&#8203;数&#8203;と&#8203;し&#8203;て、&#8203;<code>SentimentGenerator</code>&#8203;ク&#8203;ラ&#8203;ス&#8203;に&#8203;追&#8203;加&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="decorator">@classmethod</span>
<span class="keyword">def</span> <span class="function">generate_lstm_features</span>(
    cls,
    article_path,
    start_dt=<span class="predefined-constant">None</span>,
    boundary_week=(<span class="integer">2020</span>, <span class="integer">26</span>),
    target_feature_types=<span class="predefined-constant">None</span>,
):
    <span class="comment"># target_feature_typesが指定されなかったらデフォルト値設定</span>
    dfault_target_feature_types = [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">keywords</span><span class="delimiter">&quot;</span></span>,
    ]
    <span class="keyword">if</span> target_feature_types <span class="keyword">is</span> <span class="predefined-constant">None</span>:
        target_feature_types = dfault_target_feature_types
    <span class="comment"># feature typeが想定通りであることを確認</span>
    <span class="keyword">assert</span> <span class="predefined">set</span>(target_feature_types).issubset(dfault_target_feature_types)

    <span class="comment"># ニュースデータをロードする。</span>
    articles = cls.load_articles(start_dt=start_dt, path=article_path)

    <span class="comment"># 前処理を行う。</span>
    articles = cls.normalize_articles(articles)
    articles = cls.handle_punctuations_in_articles(articles)
    articles = cls.drop_remove_list_words(articles)

    <span class="comment"># headlineとkeywordsの特徴量をdict型で返す。</span>
    lstm_features = {}

    <span class="keyword">for</span> feature_type <span class="keyword">in</span> target_feature_types:
        <span class="comment"># コーパス全体のBERT特徴量を抽出する。</span>
        features = cls.generate_features_by_texts(texts=articles[feature_type])

        <span class="comment"># feature_typeに合致するfeature_combiner_handlerをclsから取得する。</span>
        feature_combiner_handler = {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>: cls.headline_feature_combiner_handler,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">keywords</span><span class="delimiter">&quot;</span></span>: cls.keywords_feature_combiner_handler,
        }[feature_type]

        <span class="comment"># 特徴量を週毎のグループ化する。</span>
        weekly_features = cls.build_weekly_features(features, boundary_week)[<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>]

        <span class="comment"># Sentiment scoreを抽出する。</span>
        lstm_features[
            f<span class="string"><span class="delimiter">&quot;</span><span class="content">{feature_type}_features</span><span class="delimiter">&quot;</span></span>
        ] = feature_combiner_handler.generate_by_weekly_features(
            weekly_features=weekly_features,
            generate_target=<span class="string"><span class="delimiter">&quot;</span><span class="content">sentiment</span><span class="delimiter">&quot;</span></span>,
            max_sequence_length=<span class="integer">10000</span>,
        )

    <span class="keyword">return</span> lstm_features</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;<code>SentimentGenerator</code>&#8203;に&#8203;追&#8203;加&#8203;し&#8203;た&#8203;class method&#8203;を&#8203;ま&#8203;と&#8203;め、&#8203;<code>SentimentGenerator</code>&#8203;ク&#8203;ラ&#8203;ス&#8203;を&#8203;仕&#8203;上&#8203;げ&#8203;ま&#8203;す。&#8203;5&#8203;章&#8203;で&#8203;実&#8203;装&#8203;し&#8203;た&#8203;処&#8203;理&#8203;も&#8203;一&#8203;部&#8203;利&#8203;用&#8203;し&#8203;て&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;注&#8203;意&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">SentimentGenerator</span>(<span class="predefined">object</span>):
    article_columns = <span class="predefined-constant">None</span>
    device = <span class="predefined-constant">None</span>
    feature_extractor = <span class="predefined-constant">None</span>
    headline_feature_combiner_handler = <span class="predefined-constant">None</span>
    keywords_feature_combiner_handler = <span class="predefined-constant">None</span>
    punctuation_replace_dict = <span class="predefined-constant">None</span>
    punctuation_remove_list = <span class="predefined-constant">None</span>

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">initialize</span>(cls, base_dir=<span class="string"><span class="delimiter">&quot;</span><span class="content">../model</span><span class="delimiter">&quot;</span></span>):
        <span class="comment"># 使用するcolumnをセットする。</span>
        cls.article_columns = [<span class="string"><span class="delimiter">&quot;</span><span class="content">publish_datetime</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">keywords</span><span class="delimiter">&quot;</span></span>]

        <span class="comment"># BERT特徴量抽出機をセットする。</span>
        cls._set_device()
        cls._build_feature_extractor()
        cls._build_tokenizer()

        <span class="comment"># LSTM特徴量合成機をセットする。</span>
        cls.headline_feature_combiner_handler = FeatureCombinerHandler(
            feature_combiner_params={<span class="string"><span class="delimiter">&quot;</span><span class="content">input_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">768</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">hidden_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">128</span>},
            store_dir=f<span class="string"><span class="delimiter">&quot;</span><span class="content">{base_dir}/headline_features</span><span class="delimiter">&quot;</span></span>,
        )
        cls.keywords_feature_combiner_handler = FeatureCombinerHandler(
            feature_combiner_params={<span class="string"><span class="delimiter">&quot;</span><span class="content">input_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">768</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">hidden_size</span><span class="delimiter">&quot;</span></span>: <span class="integer">128</span>},
            store_dir=f<span class="string"><span class="delimiter">&quot;</span><span class="content">{base_dir}/keywords_features</span><span class="delimiter">&quot;</span></span>,
        )

        <span class="comment"># 置換すべき記号のdictionaryを作成する。</span>
        JISx0208_replace_dict = {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">髙</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">高</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">﨑</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">崎</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">濵</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">浜</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">賴</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">頼</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">瀨</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">瀬</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">德</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">徳</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">蓜</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">配</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">昻</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">昂</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">桒</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">桑</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">栁</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">柳</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">犾</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">犹</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">琪</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">棋</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">裵</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">裴</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">魲</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">鱸</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">羽</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">羽</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">焏</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">丞</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">祥</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">祥</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">曻</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">昇</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">敎</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">教</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">澈</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">徹</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">曺</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">曹</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">黑</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">黒</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">塚</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">塚</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">閒</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">間</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">彅</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">薙</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">匤</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">匡</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">冝</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">宜</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">埇</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">甬</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">鮏</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">鮭</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">伹</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">但</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">杦</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">杉</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">罇</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">樽</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">柀</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">披</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">﨤</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">返</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">寬</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">寛</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">神</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">神</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">福</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">福</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">礼</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">礼</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">贒</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">賢</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">逸</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">逸</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">隆</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">隆</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">靑</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">青</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">飯</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">飯</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">飼</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">飼</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">緖</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">緒</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">埈</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">峻</span><span class="delimiter">&quot;</span></span>,
        }

        cls.punctuation_replace_dict = {
            **JISx0208_replace_dict,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">《</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">〈</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">》</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">〉</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">『</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">「</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">』</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">」</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">“</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">&quot;</span><span class="delimiter">'</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">!!</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">〔</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">[</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">〕</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">]</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">χ</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>,
        }

        <span class="comment"># 取り除く記号リスト。</span>
        cls.punctuation_remove_list = [
            <span class="string"><span class="delimiter">&quot;</span><span class="content">|</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">■</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">◆</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">●</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">★</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">☆</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">♪</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">〃</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">△</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">○</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">□</span><span class="delimiter">&quot;</span></span>,
        ]

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">_set_device</span>(cls):
        <span class="comment"># 使用可能なgpuがある場合、そちらを利用し特徴量抽出を行う</span>
        <span class="keyword">if</span> torch.cuda.device_count() &gt;= <span class="integer">1</span>:
            cls.device = <span class="string"><span class="delimiter">&quot;</span><span class="content">cuda</span><span class="delimiter">&quot;</span></span>
            print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] Set Device: GPU</span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">else</span>:
            cls.device = <span class="string"><span class="delimiter">&quot;</span><span class="content">cpu</span><span class="delimiter">&quot;</span></span>
            print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] Set Device: CPU</span><span class="delimiter">&quot;</span></span>)

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">_build_feature_extractor</span>(cls):
        <span class="comment"># 特徴量抽出のため事前学習済みBERTモデルを用いる。</span>
        <span class="comment"># ここでは、&quot;cl-tohoku/bert-base-japanese-whole-word-masking&quot;モデルを使用しているが、異なる日本語BERTモデルを用いても良い。</span>
        cls.feature_extractor = transformers.BertModel.from_pretrained(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">cl-tohoku/bert-base-japanese-whole-word-masking</span><span class="delimiter">&quot;</span></span>,
            return_dict=<span class="predefined-constant">True</span>,
            output_hidden_states=<span class="predefined-constant">True</span>,
        )

        <span class="comment"># 使用するdeviceを指定</span>
        cls.feature_extractor = cls.feature_extractor.to(cls.device)

        <span class="comment"># 今回、学習は行わない。特徴量抽出のためなので、評価モードにセットする。</span>
        cls.feature_extractor.eval()

        print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] Built feature extractor</span><span class="delimiter">&quot;</span></span>)

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">_build_tokenizer</span>(cls):
        <span class="comment"># BERTモデルの入力とするコーパスはそのBERTモデルが学習された時と同様の前処理を行う必要がある。</span>
        <span class="comment"># 今回使用する&quot;cl-tohoku/bert-base-japanese-whole-word-masking&quot;モデルは、mecab-ipadic-NEologdによりトークナイズされ、その後Wordpiece subword encoderよりsubword化している。</span>
        <span class="comment"># Subwordとは形態素の類似な概念として、単語をより小さい意味のある単位に変換したものである。</span>
        <span class="comment"># transformersのBertJapaneseTokenizerは、その事前学習モデルの学習時と同様の前処理を簡単に使用することができる。</span>
        <span class="comment"># この章ではBertJapaneseTokenizerを利用し、トークナイズ及びsubword化を行う。</span>
        cls.bert_tokenizer = BertJapaneseTokenizer.from_pretrained(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">cl-tohoku/bert-base-japanese-whole-word-masking</span><span class="delimiter">&quot;</span></span>
        )
        print(<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] Built bert tokenizer</span><span class="delimiter">&quot;</span></span>)

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">load_articles</span>(cls, path, start_dt=<span class="predefined-constant">None</span>, end_dt=<span class="predefined-constant">None</span>):
        <span class="comment"># csvをロードする</span>
        <span class="comment"># headline、keywordsをcolumnとして使用。publish_datetimeをindexとして使用。</span>
        articles = pd.read_csv(path)[cls.article_columns].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">publish_datetime</span><span class="delimiter">&quot;</span></span>)

        <span class="comment"># str形式のdatetimeをpd.Timestamp形式に変換</span>
        articles.index = pd.to_datetime(articles.index)

        <span class="comment"># NaN値を取り除く</span>
        articles = articles.dropna()

        <span class="comment"># 必要な場合、使用するデータの範囲を指定する</span>
        <span class="keyword">return</span> articles[start_dt:end_dt]

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">normalize_articles</span>(cls, articles):
        articles = articles.copy()

        <span class="comment"># 欠損値を取り除く</span>
        articles = articles.dropna()

        <span class="keyword">for</span> column <span class="keyword">in</span> articles.columns:
            <span class="comment"># スペース(全角スペースを含む)はneologdn正規化時に全て除去される。</span>
            <span class="comment"># ここでは、スペースの情報が失われないように、スペースを全て改行に書き換え、正規化後スペースに再変換する。</span>
            articles[column] = articles[column].apply(<span class="keyword">lambda</span> x: <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>.join(x.split()))

            <span class="comment"># neologdnを使って正規化を行う。</span>
            articles[column] = articles[column].apply(<span class="keyword">lambda</span> x: neologdn.normalize(x))

            <span class="comment"># 改行をスペースに置換する。</span>
            articles[column] = articles[column].str.replace(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>)

        <span class="keyword">return</span> articles

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">handle_punctuations_in_articles</span>(cls, articles):
        articles = articles.copy()

        <span class="keyword">for</span> column <span class="keyword">in</span> articles.columns:
            <span class="comment"># punctuation_remove_listに含まれる記号を除去する</span>
            articles[column] = articles[column].str.replace(
                fr<span class="string"><span class="delimiter">&quot;</span><span class="content">[{''.join(cls.punctuation_remove_list)}]</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
            )

            <span class="comment"># punctuation_replace_dictに含まれる記号を置換する</span>
            <span class="keyword">for</span> replace_base, replace_target <span class="keyword">in</span> cls.punctuation_replace_dict.items():
                articles[column] = articles[column].str.replace(
                    replace_base, replace_target
                )

            <span class="comment"># unicode正規化を行う</span>
            articles[column] = articles[column].apply(
                <span class="keyword">lambda</span> x: unicodedata.normalize(<span class="string"><span class="delimiter">&quot;</span><span class="content">NFKC</span><span class="delimiter">&quot;</span></span>, x)
            )

        <span class="keyword">return</span> articles

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">drop_remove_list_words</span>(cls, articles, remove_list_words=[<span class="string"><span class="delimiter">&quot;</span><span class="content">人事</span><span class="delimiter">&quot;</span></span>]):
        articles = articles.copy()

        <span class="keyword">for</span> remove_list_word <span class="keyword">in</span> remove_list_words:
            <span class="comment"># headlineもしくは、keywordsどちらかでremove_list_wordを含むニュース記事のindexマスクを作成。</span>
            drop_mask = articles[<span class="string"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>].str.contains(remove_list_word) | articles[
                <span class="string"><span class="delimiter">&quot;</span><span class="content">keywords</span><span class="delimiter">&quot;</span></span>
            ].str.contains(remove_list_word)

            <span class="comment"># remove_list_wordを含まないニュースだけに精製する。</span>
            articles = articles[~drop_mask]

        <span class="keyword">return</span> articles

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">build_inputs</span>(cls, texts, max_length=<span class="integer">512</span>):
        input_ids = []
        token_type_ids = []
        attention_mask = []
        <span class="keyword">for</span> text <span class="keyword">in</span> texts:
            encoded = cls.bert_tokenizer.encode_plus(
                text,
                <span class="predefined-constant">None</span>,
                add_special_tokens=<span class="predefined-constant">True</span>,
                max_length=max_length,
                padding=<span class="string"><span class="delimiter">&quot;</span><span class="content">max_length</span><span class="delimiter">&quot;</span></span>,
                return_token_type_ids=<span class="predefined-constant">True</span>,
                truncation=<span class="predefined-constant">True</span>,
            )

            input_ids.append(encoded[<span class="string"><span class="delimiter">&quot;</span><span class="content">input_ids</span><span class="delimiter">&quot;</span></span>])
            token_type_ids.append(encoded[<span class="string"><span class="delimiter">&quot;</span><span class="content">token_type_ids</span><span class="delimiter">&quot;</span></span>])
            attention_mask.append(encoded[<span class="string"><span class="delimiter">&quot;</span><span class="content">attention_mask</span><span class="delimiter">&quot;</span></span>])

        <span class="comment"># torchモデルに入力するためにはtensor形式に変え、deviceを指定する必要がある。</span>
        input_ids = torch.tensor(input_ids, dtype=torch.long).to(cls.device)
        token_type_ids = torch.tensor(token_type_ids, dtype=torch.long).to(cls.device)
        attention_mask = torch.tensor(attention_mask, dtype=torch.long).to(cls.device)

        <span class="keyword">return</span> input_ids, token_type_ids, attention_mask

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">generate_features</span>(cls, input_ids, token_type_ids, attention_mask):
        output = cls.feature_extractor(
            input_ids=input_ids,
            token_type_ids=token_type_ids,
            attention_mask=attention_mask,
        )
        features = output[<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden_states</span><span class="delimiter">&quot;</span></span>][-<span class="integer">2</span>].mean(dim=<span class="integer">1</span>).cpu().detach().numpy()

        <span class="keyword">return</span> features

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">generate_features_by_texts</span>(cls, texts, batch_size=<span class="integer">2</span>, max_length=<span class="integer">512</span>):
        n_batch = math.ceil(<span class="predefined">len</span>(texts) / batch_size)

        features = []
        <span class="keyword">for</span> idx <span class="keyword">in</span> tqdm(<span class="predefined">range</span>(n_batch)):
            input_ids, token_type_ids, attention_mask = cls.build_inputs(
                texts=texts[batch_size * idx : batch_size * (idx + <span class="integer">1</span>)],
                max_length=max_length,
            )

            features.append(
                cls.generate_features(
                    input_ids=input_ids,
                    token_type_ids=token_type_ids,
                    attention_mask=attention_mask,
                )
            )

        features = np.concatenate(features, axis=<span class="integer">0</span>)

        <span class="comment"># 抽出した特徴量はnp.ndarray形式となっており、これらは、日付の情報を失っているため、pd.DataFrame形式に変換する。</span>
        <span class="keyword">return</span> pd.DataFrame(features, index=texts.index)

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">_build_weekly_group</span>(cls, df):
        <span class="comment"># index情報から、(year, week)の情報を得る。</span>
        <span class="keyword">return</span> pd.Series(<span class="predefined">list</span>(<span class="predefined">zip</span>(df.index.year, df.index.week)), index=df.index)

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">build_weekly_features</span>(cls, features, boundary_week):
        <span class="keyword">assert</span> <span class="predefined">isinstance</span>(boundary_week, <span class="predefined">tuple</span>)

        weekly_group = cls._build_weekly_group(df=features)
        features = features.groupby(weekly_group).apply(<span class="keyword">lambda</span> x: x[:])

        train_features = features[features.index.get_level_values(<span class="integer">0</span>) &lt;= boundary_week]
        test_features = features[features.index.get_level_values(<span class="integer">0</span>) &gt; boundary_week]

        <span class="keyword">return</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">train</span><span class="delimiter">&quot;</span></span>: train_features, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>: test_features}

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">generate_lstm_features</span>(
        cls,
        article_path,
        start_dt=<span class="predefined-constant">None</span>,
        boundary_week=(<span class="integer">2020</span>, <span class="integer">26</span>),
        target_feature_types=<span class="predefined-constant">None</span>,
    ):
        <span class="comment"># target_feature_typesが指定されなかったらデフォルト値設定</span>
        dfault_target_feature_types = [
            <span class="string"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">keywords</span><span class="delimiter">&quot;</span></span>,
        ]
        <span class="keyword">if</span> target_feature_types <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            target_feature_types = dfault_target_feature_types
        <span class="comment"># feature typeが想定通りであることを確認</span>
        <span class="keyword">assert</span> <span class="predefined">set</span>(target_feature_types).issubset(dfault_target_feature_types)

        <span class="comment"># ニュースデータをロードする。</span>
        articles = cls.load_articles(start_dt=start_dt, path=article_path)

        <span class="comment"># 前処理を行う。</span>
        articles = cls.normalize_articles(articles)
        articles = cls.handle_punctuations_in_articles(articles)
        articles = cls.drop_remove_list_words(articles)

        <span class="comment"># headlineとkeywordsの特徴量をdict型で返す。</span>
        lstm_features = {}

        <span class="keyword">for</span> feature_type <span class="keyword">in</span> target_feature_types:
            <span class="comment"># コーパス全体のBERT特徴量を抽出する。</span>
            features = cls.generate_features_by_texts(texts=articles[feature_type])

            <span class="comment"># feature_typeに合致するfeature_combiner_handlerをclsから取得する。</span>
            feature_combiner_handler = {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>: cls.headline_feature_combiner_handler,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">keywords</span><span class="delimiter">&quot;</span></span>: cls.keywords_feature_combiner_handler,
            }[feature_type]

            <span class="comment"># 特徴量を週毎のグループ化する。</span>
            weekly_features = cls.build_weekly_features(features, boundary_week)[<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>]

            <span class="comment"># Sentiment scoreを抽出する。</span>
            lstm_features[
                f<span class="string"><span class="delimiter">&quot;</span><span class="content">{feature_type}_features</span><span class="delimiter">&quot;</span></span>
            ] = feature_combiner_handler.generate_by_weekly_features(
                weekly_features=weekly_features,
                generate_target=<span class="string"><span class="delimiter">&quot;</span><span class="content">sentiment</span><span class="delimiter">&quot;</span></span>,
                max_sequence_length=<span class="integer">10000</span>,
            )

        <span class="keyword">return</span> lstm_features</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_合成特徴量の解析">6.3. 合成特徴量の解析</h3>
<div class="paragraph">
<p>　&#8203;前&#8203;章&#8203;に&#8203;お&#8203;い&#8203;て&#8203;LSTM&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;成&#8203;し、&#8203;合&#8203;成&#8203;特&#8203;徴&#8203;量&#8203;で&#8203;あ&#8203;る&#8203;features&#8203;と&#8203;sentiment score&#8203;を&#8203;抽&#8203;出&#8203;し&#8203;ま&#8203;し&#8203;た。&#8203;sentiment score&#8203;は、&#8203;features&#8203;か&#8203;ら&#8203;線&#8203;形&#8203;次&#8203;元&#8203;圧&#8203;縮&#8203;さ&#8203;れ&#8203;た&#8203;も&#8203;の&#8203;で&#8203;あ&#8203;り、&#8203;features&#8203;と&#8203;比&#8203;べ&#8203;よ&#8203;り&#8203;低&#8203;次&#8203;元&#8203;の&#8203;情&#8203;報&#8203;を&#8203;保&#8203;持&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;し&#8203;か&#8203;し、&#8203;使&#8203;用&#8203;時&#8203;の&#8203;容&#8203;易&#8203;性&#8203;を&#8203;考&#8203;慮&#8203;し、&#8203;以&#8203;降&#8203;の&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;に&#8203;お&#8203;い&#8203;て&#8203;は、&#8203;sentiment score&#8203;の&#8203;み&#8203;を&#8203;用&#8203;い&#8203;て&#8203;マー&#8203;ケッ&#8203;ト&#8203;予&#8203;測&#8203;の&#8203;モ&#8203;デ&#8203;リ&#8203;ン&#8203;グ&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。&#8203;本&#8203;節&#8203;で&#8203;は、&#8203;sentiment score&#8203;が&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;性&#8203;質&#8203;を&#8203;持っ&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;予&#8203;測&#8203;対&#8203;象&#8203;と&#8203;な&#8203;る&#8203;マー&#8203;ケッ&#8203;ト&#8203;の&#8203;forward return&#8203;と&#8203;の&#8203;関&#8203;係&#8203;性&#8203;を&#8203;解&#8203;析&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_合成特徴量のデータのロード">6.3.1. 合成特徴量のデータのロード</h4>
<div class="paragraph">
<p>　&#8203;抽&#8203;出&#8203;し&#8203;た&#8203;sentiment score&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。&#8203;column&#8203;は、&#8203;次&#8203;元&#8203;順&#8203;に&#8203;付&#8203;与&#8203;さ&#8203;れ&#8203;た&#8203;id&#8203;を&#8203;表&#8203;し&#8203;ま&#8203;す。&#8203;sentiment&#8203;の&#8203;場&#8203;合&#8203;は&#8203;1&#8203;次&#8203;元&#8203;の&#8203;み&#8203;の&#8203;デー&#8203;タ&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;0&#8203;で&#8203;イ&#8203;ン&#8203;デ&#8203;ク&#8203;シ&#8203;ン&#8203;グ&#8203;し、&#8203;解&#8203;析&#8203;で&#8203;は&#8203;pd.series&#8203;形&#8203;式&#8203;と&#8203;し&#8203;て&#8203;扱&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">headline_features = pd.read_pickle(f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/headline_features/LSTM_sentiment.pkl</span><span class="delimiter">'</span></span>)[<span class="integer">0</span>].rename(<span class="string"><span class="delimiter">'</span><span class="content">features</span><span class="delimiter">'</span></span>)
keywords_features = pd.read_pickle(f<span class="string"><span class="delimiter">'</span><span class="content">{CONFIG[&quot;base_path&quot;]}/keywords_features/LSTM_sentiment.pkl</span><span class="delimiter">'</span></span>)[<span class="integer">0</span>].rename(<span class="string"><span class="delimiter">'</span><span class="content">features</span><span class="delimiter">'</span></span>)

display(headline_features.head())
display(keywords_features.head())</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;現&#8203;在、&#8203;LSTM&#8203;の&#8203;出&#8203;力&#8203;値&#8203;は、&#8203;値&#8203;上&#8203;が&#8203;り&#8203;と&#8203;値&#8203;下&#8203;が&#8203;り&#8203;の&#8203;確&#8203;率&#8203;と&#8203;な&#8203;り、&#8203;値&#8203;下&#8203;が&#8203;り&#8203;時&#8203;は&#8203;０、&#8203;値&#8203;上&#8203;が&#8203;り&#8203;時&#8203;は&#8203;１&#8203;に&#8203;近&#8203;い&#8203;値&#8203;を&#8203;出&#8203;力&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;学&#8203;習&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;十&#8203;分&#8203;な&#8203;デー&#8203;タ&#8203;を&#8203;揃&#8203;え&#8203;て&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;学&#8203;習&#8203;を&#8203;収&#8203;束&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;れ&#8203;ば、&#8203;実&#8203;際&#8203;に&#8203;0&#8203;に&#8203;近&#8203;い&#8203;値、&#8203;1&#8203;に&#8203;近&#8203;い&#8203;値&#8203;な&#8203;ど&#8203;も&#8203;出&#8203;力&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;今&#8203;回&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;収&#8203;束&#8203;す&#8203;る&#8203;ほ&#8203;ど&#8203;の&#8203;デー&#8203;タ&#8203;量&#8203;が&#8203;な&#8203;い&#8203;場&#8203;合、&#8203;学&#8203;習&#8203;時&#8203;に&#8203;観&#8203;察&#8203;し&#8203;た&#8203;ラ&#8203;ベ&#8203;ル&#8203;の&#8203;平&#8203;均&#8203;値&#8203;や&#8203;0.5&#8203;近&#8203;辺&#8203;に&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;は&#8203;近&#8203;く&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;マー&#8203;ケッ&#8203;ト&#8203;デー&#8203;タ&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;一&#8203;般&#8203;的&#8203;に&#8203;学&#8203;習&#8203;の&#8203;難&#8203;し&#8203;い&#8203;デー&#8203;タ&#8203;で&#8203;は、&#8203;こ&#8203;の&#8203;現&#8203;象&#8203;が&#8203;起&#8203;き&#8203;や&#8203;す&#8203;い&#8203;こ&#8203;と&#8203;に&#8203;注&#8203;意&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;た&#8203;だ&#8203;し、&#8203;出&#8203;力&#8203;自&#8203;体&#8203;は&#8203;き&#8203;ち&#8203;ん&#8203;と&#8203;入&#8203;力&#8203;デー&#8203;タ&#8203;に&#8203;対&#8203;し&#8203;て&#8203;変&#8203;化&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;確&#8203;認&#8203;で&#8203;き&#8203;る&#8203;の&#8203;で、&#8203;相&#8203;対&#8203;的&#8203;な&#8203;出&#8203;力&#8203;の&#8203;強&#8203;さ&#8203;を&#8203;計&#8203;測&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;ス&#8203;コ&#8203;ア&#8203;化&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;で&#8203;き、&#8203;相&#8203;関&#8203;係&#8203;数&#8203;や&#8203;順&#8203;位&#8203;相&#8203;関&#8203;係&#8203;数&#8203;を&#8203;用&#8203;い&#8203;て&#8203;ス&#8203;コ&#8203;ア&#8203;の&#8203;評&#8203;価&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;可&#8203;能&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">(<span class="integer">2020</span>, <span class="integer">27</span>)    <span class="float">0.601928</span>
(<span class="integer">2020</span>, <span class="integer">28</span>)    <span class="float">0.606229</span>
(<span class="integer">2020</span>, <span class="integer">29</span>)    <span class="float">0.603833</span>
(<span class="integer">2020</span>, <span class="integer">30</span>)    <span class="float">0.601890</span>
(<span class="integer">2020</span>, <span class="integer">31</span>)    <span class="float">0.605760</span>
Name: features, dtype: float32

(<span class="integer">2020</span>, <span class="integer">27</span>)    <span class="float">0.506807</span>
(<span class="integer">2020</span>, <span class="integer">28</span>)    <span class="float">0.508067</span>
(<span class="integer">2020</span>, <span class="integer">29</span>)    <span class="float">0.506754</span>
(<span class="integer">2020</span>, <span class="integer">30</span>)    <span class="float">0.506794</span>
(<span class="integer">2020</span>, <span class="integer">31</span>)    <span class="float">0.507054</span>
Name: features, dtype: float32</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_評価用ラベルをビルド">6.3.2. 評価用ラベルをビルド</h4>
<div class="paragraph">
<p>　&#8203;上&#8203;記&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;マー&#8203;ケッ&#8203;ト&#8203;の&#8203;weekly_fwd_return&#8203;の&#8203;作&#8203;成&#8203;ロ&#8203;ジッ&#8203;ク&#8203;と&#8203;同&#8203;様&#8203;に、&#8203;評&#8203;価&#8203;用&#8203;ラ&#8203;ベ&#8203;ル&#8203;で&#8203;あ&#8203;る&#8203;次&#8203;週&#8203;の&#8203;マー&#8203;ケッ&#8203;ト&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># boundary_weekを学習時境界と同様に設定し、weekly_fwd_returnsをビルドする。</span>
weekly_group = SentimentGenerator._build_weekly_group(df=stock_price)
weekly_returns = stock_price.groupby(weekly_group).apply(_compute_weekly_return)
weekly_fwd_returns = weekly_returns.shift(-<span class="integer">1</span>).rename(<span class="string"><span class="delimiter">'</span><span class="content">weekly_fwd_returns</span><span class="delimiter">'</span></span>)

<span class="comment"># 特徴量の期間と同様の期間のデータのみを使用する。</span>
weekly_fwd_returns = weekly_fwd_returns.reindex(headline_features.index)

display(weekly_fwd_returns)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">(<span class="integer">2020</span>, <span class="integer">27</span>)   -<span class="float">0.017781</span>
(<span class="integer">2020</span>, <span class="integer">28</span>)    <span class="float">0.016613</span>
(<span class="integer">2020</span>, <span class="integer">29</span>)    <span class="float">0.001590</span>
(<span class="integer">2020</span>, <span class="integer">30</span>)   -<span class="float">0.048742</span>
(<span class="integer">2020</span>, <span class="integer">31</span>)    <span class="float">0.029370</span>
(<span class="integer">2020</span>, <span class="integer">32</span>)    <span class="float">0.039417</span>
(<span class="integer">2020</span>, <span class="integer">33</span>)    <span class="float">0.000009</span>
(<span class="integer">2020</span>, <span class="integer">34</span>)   -<span class="float">0.006018</span>
(<span class="integer">2020</span>, <span class="integer">35</span>)    <span class="float">0.003958</span>
(<span class="integer">2020</span>, <span class="integer">36</span>)    <span class="float">0.023614</span>
(<span class="integer">2020</span>, <span class="integer">37</span>)    <span class="float">0.021705</span>
(<span class="integer">2020</span>, <span class="integer">38</span>)   -<span class="float">0.000459</span>
(<span class="integer">2020</span>, <span class="integer">39</span>)   -<span class="float">0.024606</span>
(<span class="integer">2020</span>, <span class="integer">40</span>)    <span class="float">0.017951</span>
(<span class="integer">2020</span>, <span class="integer">41</span>)   -<span class="float">0.022318</span>
(<span class="integer">2020</span>, <span class="integer">42</span>)    <span class="float">0.000046</span>
(<span class="integer">2020</span>, <span class="integer">43</span>)   -<span class="float">0.033692</span>
(<span class="integer">2020</span>, <span class="integer">44</span>)    <span class="float">0.040975</span>
(<span class="integer">2020</span>, <span class="integer">45</span>)    <span class="float">0.000463</span>
(<span class="integer">2020</span>, <span class="integer">46</span>)   -<span class="float">0.004318</span>
(<span class="integer">2020</span>, <span class="integer">47</span>)    <span class="float">0.008869</span>
(<span class="integer">2020</span>, <span class="integer">48</span>)   -<span class="float">0.002206</span>
(<span class="integer">2020</span>, <span class="integer">49</span>)   -<span class="float">0.003282</span>
(<span class="integer">2020</span>, <span class="integer">50</span>)    <span class="float">0.001516</span>
(<span class="integer">2020</span>, <span class="integer">51</span>)   -<span class="float">0.009117</span>
(<span class="integer">2020</span>, <span class="integer">52</span>)    <span class="float">0.005004</span>
Name: weekly_fwd_returns, dtype: float64</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_合成特徴量とラベル間の相関の確認">6.3.3. 合成特徴量とラベル間の相関の確認</h4>
<div class="paragraph">
<p>　&#8203;合&#8203;成&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;上&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;ラ&#8203;ベ&#8203;ル&#8203;間&#8203;の&#8203;相&#8203;関&#8203;を&#8203;調&#8203;べ&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 二つのpd.Seriesをconcatenateする。</span>
<span class="comment"># indexの違いがあるため、片方だけ存在するデータはドロップする。</span>
df = pd.concat([headline_features, weekly_fwd_returns], axis=<span class="integer">1</span>, sort=<span class="predefined-constant">True</span>).dropna()

<span class="comment"># 二つのコラムのシークエンス間の相関は、以下のように取得できる。</span>
display(df.corr()[df.columns[<span class="integer">0</span>]][df.columns[-<span class="integer">1</span>]])</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="float">0.6040216860152573</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>次&#8203;に、&#8203;corr&#8203;関&#8203;数&#8203;に&#8203;method&#8203;を&#8203;指&#8203;定&#8203;し&#8203;て、&#8203;pearson&#8203;の&#8203;相&#8203;関&#8203;係&#8203;数&#8203;及&#8203;び&#8203;spearman&#8203;の&#8203;順&#8203;位&#8203;相&#8203;関&#8203;係&#8203;数&#8203;を&#8203;計&#8203;算&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">display_corr</span>(df):
    display(pd.Series(
        {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">pearson</span><span class="delimiter">&quot;</span></span>: df.corr(method=<span class="string"><span class="delimiter">'</span><span class="content">pearson</span><span class="delimiter">'</span></span>)[df.columns[<span class="integer">0</span>]][df.columns[-<span class="integer">1</span>]],
            <span class="string"><span class="delimiter">&quot;</span><span class="content">spearman</span><span class="delimiter">&quot;</span></span>: df.corr(method=<span class="string"><span class="delimiter">'</span><span class="content">spearman</span><span class="delimiter">'</span></span>)[df.columns[<span class="integer">0</span>]][df.columns[-<span class="integer">1</span>]]
        }
    ))

display_corr(df)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">pearson     <span class="float">0.604022</span>
spearman    <span class="float">0.566496</span>
dtype: float64</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;上&#8203;記&#8203;の&#8203;関&#8203;数&#8203;を&#8203;headline, keywords&#8203;両&#8203;方&#8203;に&#8203;適&#8203;用&#8203;し、&#8203;ラ&#8203;ベ&#8203;ル&#8203;と&#8203;の&#8203;相&#8203;関&#8203;を&#8203;表&#8203;示&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">for</span> features, feature_type <span class="keyword">in</span> [(headline_features, <span class="string"><span class="delimiter">'</span><span class="content">headline_features</span><span class="delimiter">'</span></span>), (keywords_features, <span class="string"><span class="delimiter">'</span><span class="content">keywords_features</span><span class="delimiter">'</span></span>)]:
    display_markdown(f<span class="string"><span class="delimiter">'</span><span class="content">#### feature_type: {feature_type}</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
    df = pd.concat([features, weekly_fwd_returns], axis=<span class="integer">1</span>, sort=<span class="predefined-constant">True</span>).dropna()
    display_corr(df)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;headline_features&#8203;は&#8203;pearson&#8203;相&#8203;関&#8203;係&#8203;数&#8203;が&#8203;0.60、&#8203;spearman&#8203;の&#8203;相&#8203;関&#8203;係&#8203;数&#8203;が&#8203;0.57&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;keywords_features&#8203;は&#8203;若&#8203;干&#8203;相&#8203;関&#8203;係&#8203;数&#8203;が&#8203;下&#8203;が&#8203;り&#8203;ま&#8203;す&#8203;が、&#8203;そ&#8203;れ&#8203;で&#8203;も&#8203;十&#8203;分&#8203;に&#8203;高&#8203;い&#8203;相&#8203;関&#8203;係&#8203;数&#8203;を&#8203;保&#8203;持&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　&#8203;参&#8203;考&#8203;ま&#8203;で&#8203;に&#8203;相&#8203;関&#8203;係&#8203;数&#8203;0.6&#8203;と&#8203;い&#8203;う&#8203;の&#8203;は&#8203;株&#8203;式&#8203;予&#8203;測&#8203;に&#8203;お&#8203;け&#8203;る&#8203;予&#8203;測&#8203;ス&#8203;コ&#8203;ア&#8203;と&#8203;未&#8203;来&#8203;の&#8203;変&#8203;化&#8203;率&#8203;の&#8203;相&#8203;関&#8203;係&#8203;数&#8203;と&#8203;し&#8203;て&#8203;は&#8203;高&#8203;い&#8203;数&#8203;値&#8203;で&#8203;す。&#8203;通&#8203;常、&#8203;株&#8203;式&#8203;の&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;(&#8203;高&#8203;値・&#8203;安&#8203;値&#8203;の&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;は&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;に&#8203;注&#8203;意&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い&#8203;)&#8203;と&#8203;未&#8203;来&#8203;の&#8203;変&#8203;化&#8203;率&#8203;の&#8203;相&#8203;関&#8203;係&#8203;数&#8203;(&#8203;情&#8203;報&#8203;係&#8203;数&#8203;と&#8203;も&#8203;よ&#8203;ば&#8203;れ&#8203;ま&#8203;す&#8203;)&#8203;は、&#8203;10&#8203;年&#8203;程&#8203;度&#8203;の&#8203;十&#8203;分&#8203;に&#8203;長&#8203;い&#8203;期&#8203;間&#8203;で&#8203;検&#8203;定&#8203;し&#8203;た&#8203;時&#8203;は&#8203;0.1&#8203;か&#8203;ら&#8203;0.2&#8203;に&#8203;到&#8203;達&#8203;す&#8203;れ&#8203;ば&#8203;優&#8203;秀&#8203;な&#8203;モ&#8203;デ&#8203;ル&#8203;と&#8203;い&#8203;わ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;(&#8203;シ&#8203;ス&#8203;ト&#8203;レ&#8203;の&#8203;ス&#8203;ス&#8203;メ&#8203; 3.5.&#8203;投&#8203;資&#8203;指&#8203;標&#8203;の&#8203;探&#8203;索&#8203;要&#8203;領&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="http://we.love-profit.com/entry/2018/04/01/152750" class="bare">http://we.love-profit.com/entry/2018/04/01/152750</a> )。</p>
</div>
<div class="paragraph">
<p>　0.6&#8203;と&#8203;い&#8203;う&#8203;今&#8203;回&#8203;の&#8203;結&#8203;果&#8203;は、&#8203;2020&#8203;年&#8203;後&#8203;半&#8203;と&#8203;い&#8203;う&#8203;非&#8203;常&#8203;に&#8203;限&#8203;定&#8203;さ&#8203;れ&#8203;た&#8203;期&#8203;間&#8203;の&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;結&#8203;果&#8203;で&#8203;す&#8203;の&#8203;で、&#8203;こ&#8203;の&#8203;手&#8203;法&#8203;に&#8203;よ&#8203;る&#8203;ス&#8203;コ&#8203;ア&#8203;が&#8203;未&#8203;来&#8203;ま&#8203;で&#8203;高&#8203;い&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;を&#8203;発&#8203;揮&#8203;す&#8203;る&#8203;か&#8203;は&#8203;現&#8203;時&#8203;点&#8203;で&#8203;判&#8203;断&#8203;で&#8203;き&#8203;ま&#8203;せ&#8203;ん。&#8203;こ&#8203;れ&#8203;は&#8203;学&#8203;習&#8203;に&#8203;利&#8203;用&#8203;し&#8203;た&#8203;2020&#8203;年&#8203;前&#8203;半&#8203;の&#8203;デー&#8203;タ・&#8203;ラ&#8203;ベ&#8203;ル&#8203;の&#8203;分&#8203;布&#8203;と&#8203;評&#8203;価&#8203;に&#8203;利&#8203;用&#8203;し&#8203;た&#8203;期&#8203;間&#8203;の&#8203;デー&#8203;タ・&#8203;ラ&#8203;ベ&#8203;ル&#8203;の&#8203;分&#8203;布&#8203;が&#8203;似&#8203;通っ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;原&#8203;因&#8203;だ&#8203;ろ&#8203;う&#8203;と&#8203;推&#8203;測&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;5&#8203;章&#8203;で&#8203;コー&#8203;パ&#8203;ス&#8203;を&#8203;確&#8203;認&#8203;し&#8203;た&#8203;と&#8203;き&#8203;も、&#8203;「コ&#8203;ロ&#8203;ナ&#8203;ウィ&#8203;ル&#8203;ス」&#8203;な&#8203;ど&#8203;が&#8203;頻&#8203;出&#8203;単&#8203;語&#8203;と&#8203;し&#8203;て&#8203;登&#8203;場&#8203;し&#8203;ま&#8203;し&#8203;た&#8203;が、&#8203;2020&#8203;年&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;年&#8203;間&#8203;を&#8203;通&#8203;し&#8203;て&#8203;一&#8203;つ&#8203;の&#8203;「コ&#8203;ロ&#8203;ナ&#8203;ウィ&#8203;ル&#8203;ス」&#8203;と&#8203;い&#8203;う&#8203;単&#8203;語&#8203;が&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;で&#8203;支&#8203;配&#8203;的&#8203;で&#8203;あ&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;稀&#8203;で&#8203;あ&#8203;り、&#8203;こ&#8203;の&#8203;非&#8203;常&#8203;に&#8203;高&#8203;い&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;は&#8203;2020&#8203;年&#8203;の&#8203;デー&#8203;タ・&#8203;ラ&#8203;ベ&#8203;ル&#8203;の&#8203;分&#8203;布&#8203;が&#8203;原&#8203;因&#8203;で&#8203;あ&#8203;ろ&#8203;う&#8203;と&#8203;考&#8203;察&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">feature_type: headline_features
pearson     <span class="float">0.604022</span>
spearman    <span class="float">0.566496</span>
dtype: float64

feature_type: keywords_features
pearson     <span class="float">0.565515</span>
spearman    <span class="float">0.474872</span>
dtype: float64</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_結果の可視化">6.4. 結果の可視化</h3>
<div class="paragraph">
<p>　&#8203;結&#8203;果&#8203;の&#8203;妥&#8203;当&#8203;性&#8203;を&#8203;検&#8203;証&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;さ&#8203;ら&#8203;に&#8203;詳&#8203;し&#8203;い&#8203;可&#8203;視&#8203;化&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;い&#8203;き&#8203;ま&#8203;す。&#8203;結&#8203;果&#8203;の&#8203;可&#8203;視&#8203;化&#8203;は&#8203;主&#8203;に&#8203;以&#8203;下&#8203;の&#8203;観&#8203;点&#8203;の&#8203;た&#8203;め&#8203;に&#8203;必&#8203;要&#8203;で&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>時&#8203;系&#8203;列&#8203;的&#8203;に&#8203;予&#8203;測&#8203;の&#8203;方&#8203;向&#8203;性&#8203;な&#8203;ど&#8203;が&#8203;集&#8203;中&#8203;し&#8203;て&#8203;い&#8203;な&#8203;い&#8203;か</p>
</li>
<li>
<p>上&#8203;げ・&#8203;下&#8203;げ&#8203;の&#8203;ど&#8203;ち&#8203;ら&#8203;か&#8203;に&#8203;ス&#8203;コ&#8203;ア&#8203;が&#8203;偏っ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;か</p>
</li>
<li>
<p>ど&#8203;の&#8203;時&#8203;期&#8203;に&#8203;精&#8203;度&#8203;が&#8203;高&#8203;く、&#8203;ど&#8203;の&#8203;時&#8203;期&#8203;に&#8203;精&#8203;度&#8203;が&#8203;低&#8203;い&#8203;か</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>　&#8203;実&#8203;際&#8203;に&#8203;相&#8203;関&#8203;係&#8203;数&#8203;や&#8203;精&#8203;度&#8203;は&#8203;単&#8203;一&#8203;の&#8203;評&#8203;価&#8203;軸&#8203;で&#8203;あ&#8203;り、&#8203;可&#8203;視&#8203;化&#8203;を&#8203;通&#8203;し&#8203;て、&#8203;そ&#8203;の&#8203;結&#8203;果&#8203;が&#8203;本&#8203;当&#8203;に&#8203;妥&#8203;当&#8203;性&#8203;が&#8203;高&#8203;い&#8203;か&#8203;を&#8203;検&#8203;証&#8203;す&#8203;る&#8203;の&#8203;は&#8203;非&#8203;常&#8203;に&#8203;重&#8203;要&#8203;な&#8203;作&#8203;業&#8203;で&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_回帰分析による可視化">6.4.1. 回帰分析による可視化</h4>
<div class="paragraph">
<p>　&#8203;回&#8203;帰&#8203;分&#8203;析&#8203;に&#8203;よ&#8203;る&#8203;可&#8203;視&#8203;化&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 回帰を行うため、xとyとなるコラムを設定する。</span>
x_column = <span class="string"><span class="delimiter">'</span><span class="content">features</span><span class="delimiter">'</span></span>
y_column = <span class="string"><span class="delimiter">'</span><span class="content">weekly_fwd_returns</span><span class="delimiter">'</span></span>

<span class="comment"># stats.linregressを用いて、単回帰直線の係数とバイアスを取得する。</span>
df = pd.concat([headline_features, weekly_fwd_returns], axis=<span class="integer">1</span>, sort=<span class="predefined-constant">True</span>).dropna()

coef, bias, _, _, _ = stats.linregress(x=df[x_column], y=df[y_column])
print(f<span class="string"><span class="delimiter">'</span><span class="content">coef: {coef:.4f}, bias: {bias:.4f}</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">coef: <span class="float">6.6302</span>, bias: -<span class="float">4.0035</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;情&#8203;報&#8203;を&#8203;seaborn&#8203;の&#8203;regression plot&#8203;と&#8203;共&#8203;に&#8203;表&#8203;示&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">display_regplot</span>(df, x_column=<span class="string"><span class="delimiter">'</span><span class="content">features</span><span class="delimiter">'</span></span>, y_column=<span class="string"><span class="delimiter">'</span><span class="content">weekly_fwd_returns</span><span class="delimiter">'</span></span>):
    <span class="comment"># stats.linregressを用いて、単回帰直線の係数とバイアスを取得する。</span>
    coef, bias, _, _, _ = stats.linregress(x=df[x_column], y=df[y_column])

    <span class="comment"># seabornのregplotを用いて、単回帰直線及び、scatter sampleを表示する。</span>
    _, ax = plt.subplots(<span class="integer">1</span>, <span class="integer">1</span>, figsize=(<span class="integer">6</span>, <span class="integer">4</span>))
    sns.regplot(
        x=x_column,
        y=y_column,
        data=df,
        ax=ax,
        line_kws={
            <span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">y={0:.4f}x+{1:.4f}</span><span class="delimiter">&quot;</span></span>.format(coef, bias), <span class="comment"># 取得した係数とバイアスを用いて単項式を表示する。</span>
        },
    )
    plt.legend()
    plt.show()

<span class="keyword">for</span> features, feature_type <span class="keyword">in</span> [(headline_features, <span class="string"><span class="delimiter">'</span><span class="content">headline_features</span><span class="delimiter">'</span></span>), (keywords_features, <span class="string"><span class="delimiter">'</span><span class="content">keywords_features</span><span class="delimiter">'</span></span>)]:
    display_markdown(f<span class="string"><span class="delimiter">'</span><span class="content">#### feature_type: {feature_type}</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
    df = pd.concat([features, weekly_fwd_returns], axis=<span class="integer">1</span>, sort=<span class="predefined-constant">True</span>).dropna()
    display_regplot(df=df)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;headline_features&#8203;は、&#8203;x&#8203;軸&#8203;の&#8203;features&#8203;が&#8203;keywords_features&#8203;よ&#8203;り&#8203;若&#8203;干&#8203;で&#8203;す&#8203;が&#8203;幅&#8203;広&#8203;に&#8203;分&#8203;布&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;keywords_features&#8203;よ&#8203;り&#8203;も&#8203;上&#8203;手&#8203;く&#8203;学&#8203;習&#8203;が&#8203;出&#8203;来&#8203;た&#8203;可&#8203;能&#8203;性&#8203;を&#8203;示&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;ま&#8203;た。&#8203;ス&#8203;コ&#8203;ア&#8203;が&#8203;低&#8203;い&#8203;時&#8203;に&#8203;y&#8203;軸&#8203;の&#8203;次&#8203;の&#8203;週&#8203;の&#8203;投&#8203;資&#8203;対&#8203;象&#8203;の&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;の&#8203;平&#8203;均&#8203;変&#8203;化&#8203;率&#8203;が&#8203;低&#8203;く、&#8203;ス&#8203;コ&#8203;ア&#8203;が&#8203;高&#8203;い&#8203;時&#8203;に&#8203;平&#8203;均&#8203;変&#8203;化&#8203;率&#8203;が&#8203;高&#8203;い&#8203;傾&#8203;向&#8203;が&#8203;はっ&#8203;き&#8203;り&#8203;と&#8203;確&#8203;認&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;ス&#8203;コ&#8203;ア&#8203;が&#8203;中&#8203;間&#8203;の&#8203;場&#8203;合&#8203;は&#8203;平&#8203;均&#8203;変&#8203;化&#8203;率&#8203;も&#8203;0&#8203;近&#8203;辺&#8203;に&#8203;集&#8203;中&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;全&#8203;体&#8203;的&#8203;に&#8203;信&#8203;頼&#8203;性&#8203;の&#8203;高&#8203;い&#8203;結&#8203;果&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;わ&#8203;か&#8203;り&#8203;ま&#8203;す。&#8203;keywords_features&#8203;の&#8203;結&#8203;果&#8203;も&#8203;良&#8203;い&#8203;も&#8203;の&#8203;で&#8203;す&#8203;が、&#8203;headline_features&#8203;ほ&#8203;ど&#8203;は&#8203;優&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;せ&#8203;ん。&#8203;お&#8203;互&#8203;い&#8203;の&#8203;相&#8203;関&#8203;が&#8203;低&#8203;け&#8203;れ&#8203;ば、&#8203;ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル&#8203;を&#8203;考&#8203;慮&#8203;す&#8203;る&#8203;価&#8203;値&#8203;は&#8203;あ&#8203;り&#8203;そ&#8203;う&#8203;で&#8203;す&#8203;の&#8203;で、&#8203;時&#8203;系&#8203;列&#8203;の&#8203;可&#8203;視&#8203;化&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter06/images/1_7_vis_regplot.png" alt="1_7_vis_regplot" width="50%">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_時系列的な関係の可視化">6.4.2. 時系列的な関係の可視化</h4>
<div class="paragraph">
<p>　barplot&#8203;に&#8203;よ&#8203;り、&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;ラ&#8203;ベ&#8203;ル&#8203;間&#8203;で&#8203;の&#8203;時&#8203;系&#8203;列&#8203;的&#8203;な&#8203;関&#8203;係&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">df.plot(kind=<span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>, figsize=(<span class="integer">16</span>, <span class="integer">3</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter06/images/1_7_vis_barplot_without_norm.png" alt="1_7_vis_barplot_without_norm">
</div>
</div>
<div class="paragraph">
<p>　&#8203;二&#8203;つ&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;一&#8203;つ&#8203;の&#8203;軸&#8203;上&#8203;で&#8203;単&#8203;純&#8203;に&#8203;プ&#8203;ロッ&#8203;ト&#8203;す&#8203;る&#8203;と&#8203;値&#8203;の&#8203;ノ&#8203;ル&#8203;ム、&#8203;平&#8203;均、&#8203;分&#8203;散&#8203;の&#8203;違&#8203;い&#8203;か&#8203;ら、&#8203;相&#8203;互&#8203;的&#8203;な&#8203;動&#8203;き&#8203;を&#8203;確&#8203;認&#8203;し&#8203;に&#8203;く&#8203;い&#8203;で&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;手&#8203;元&#8203;に&#8203;あ&#8203;る&#8203;デー&#8203;タ&#8203;を&#8203;平&#8203;均&#8203;と&#8203;分&#8203;散&#8203;を&#8203;用&#8203;い&#8203;て&#8203;ノー&#8203;マ&#8203;ラ&#8203;イ&#8203;ズ&#8203;し&#8203;た&#8203;zscore&#8203;標&#8203;準&#8203;化&#8203;( <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.zscore.html" class="bare">https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.zscore.html</a> )&#8203;を&#8203;使っ&#8203;て&#8203;相&#8203;互&#8203;の&#8203;関&#8203;係&#8203;を&#8203;可&#8203;視&#8203;化&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">normalize</span>(df):
    <span class="comment"># zscore normalizeする。</span>
    <span class="keyword">return</span> pd.DataFrame(stats.zscore(df), index=df.index, columns=[f<span class="string"><span class="delimiter">'</span><span class="content">Z({column})</span><span class="delimiter">'</span></span> <span class="keyword">for</span> column <span class="keyword">in</span> df.columns])


<span class="keyword">def</span> <span class="function">display_bar_plot</span>(df):
    <span class="comment"># zscore normalizeしたデータを用いてbarplotする。</span>
    normalize(df).plot(kind=<span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>, figsize=(<span class="integer">16</span>, <span class="integer">3</span>))
    plt.show()


<span class="keyword">for</span> features, feature_type <span class="keyword">in</span> [(headline_features, <span class="string"><span class="delimiter">'</span><span class="content">headline_features</span><span class="delimiter">'</span></span>), (keywords_features, <span class="string"><span class="delimiter">'</span><span class="content">keywords_features</span><span class="delimiter">'</span></span>)]:
    display_markdown(f<span class="string"><span class="delimiter">'</span><span class="content">#### feature_type: {feature_type}</span><span class="delimiter">'</span></span>, raw=<span class="predefined-constant">True</span>)
    df = pd.concat([features, weekly_fwd_returns], axis=<span class="integer">1</span>, sort=<span class="predefined-constant">True</span>).dropna()
    display_bar_plot(df=df)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;出&#8203;力&#8203;結&#8203;果&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;headline_features&#8203;は&#8203;時&#8203;系&#8203;列&#8203;的&#8203;に&#8203;上&#8203;下&#8203;の&#8203;予&#8203;測&#8203;が&#8203;固&#8203;まっ&#8203;て&#8203;お&#8203;ら&#8203;ず、&#8203;安&#8203;定&#8203;的&#8203;に&#8203;分&#8203;布&#8203;し&#8203;て&#8203;お&#8203;り&#8203;次&#8203;の&#8203;週&#8203;の&#8203;マー&#8203;ケッ&#8203;ト&#8203;の&#8203;セ&#8203;ン&#8203;チ&#8203;メ&#8203;ン&#8203;ト&#8203;を&#8203;的&#8203;確&#8203;に&#8203;捉&#8203;え&#8203;て&#8203;い&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;高&#8203;そ&#8203;う&#8203;で&#8203;す。&#8203;headline_features&#8203;と&#8203;keywords_features&#8203;の&#8203;予&#8203;測&#8203;ス&#8203;コ&#8203;ア&#8203;は&#8203;時&#8203;系&#8203;列&#8203;的&#8203;に&#8203;似&#8203;通っ&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;無&#8203;理&#8203;に&#8203;ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル&#8203;な&#8203;ど&#8203;は&#8203;実&#8203;施&#8203;せ&#8203;ず、&#8203;以&#8203;降&#8203;は&#8203;シ&#8203;ン&#8203;プ&#8203;ル&#8203;に&#8203;headline_features&#8203;を&#8203;活&#8203;用&#8203;す&#8203;る&#8203;も&#8203;の&#8203;と&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter06/images/1_7_vis_barplot_with_norm.png" alt="1_7_vis_barplot_with_norm">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ストラテジーへの適用の実装例">6.5. ストラテジーへの適用の実装例</h3>
<div class="paragraph">
<p>　&#8203;こ&#8203;こ&#8203;で&#8203;は、&#8203;予&#8203;測&#8203;ス&#8203;コ&#8203;ア&#8203;を&#8203;利&#8203;用&#8203;し&#8203;て&#8203;現&#8203;金&#8203;比&#8203;率&#8203;を&#8203;操&#8203;作&#8203;す&#8203;る&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;コー&#8203;ド&#8203;を&#8203;示&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;章&#8203;は&#8203;LSTM&#8203;に&#8203;よ&#8203;り&#8203;目&#8203;的&#8203;関&#8203;数&#8203;を&#8203;設&#8203;定&#8203;し&#8203;た&#8203;ス&#8203;コ&#8203;ア&#8203;を&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;か&#8203;ら&#8203;取&#8203;得&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;目&#8203;的&#8203;で&#8203;あ&#8203;り、&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;コー&#8203;ド&#8203;を&#8203;紹&#8203;介&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;目&#8203;的&#8203;で&#8203;は&#8203;な&#8203;い&#8203;た&#8203;め、&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;実&#8203;装&#8203;を&#8203;示&#8203;す&#8203;程&#8203;度&#8203;に&#8203;と&#8203;ど&#8203;め&#8203;ま&#8203;す。&#8203;以&#8203;下&#8203;の&#8203;実&#8203;装&#8203;例&#8203;で&#8203;は、&#8203;デー&#8203;タ&#8203;を&#8203;扱&#8203;い&#8203;や&#8203;す&#8203;く&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;zscore&#8203;標&#8203;準&#8203;化&#8203;を&#8203;実&#8203;施&#8203;し、&#8203;そ&#8203;の&#8203;分&#8203;布&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;現&#8203;金&#8203;比&#8203;率&#8203;を&#8203;操&#8203;作&#8203;す&#8203;る&#8203;ロ&#8203;ジッ&#8203;ク&#8203;を&#8203;実&#8203;装&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">get_cash_ratio</span>(cls, df_sentiment):
    <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">    headline_m2_sentimentの値が低い時はリスクとみなし</span><span class="content">
</span><span class="content">    現金保有量を多くする。</span><span class="content">
</span><span class="content">
</span><span class="content">    入力:</span><span class="content">
</span><span class="content">      センチメント (DataFrame): センチメント情報</span><span class="content">
</span><span class="content">    出力:</span><span class="content">
</span><span class="content">      現金比率 (Dataframe): 入力値に現金比率を追加したもの</span><span class="content">
</span><span class="content">    </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    <span class="comment"># リスク値マッピング用の分布取得期間</span>
    DIST_START_DT = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-06-29</span><span class="delimiter">&quot;</span></span>
    DIST_END_DT = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-09-25</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># リスク値を計算する期間</span>
    USE_START_DT = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-10-02</span><span class="delimiter">&quot;</span></span>

    <span class="comment"># 出力用にコピー</span>
    df_sentiment = df_sentiment.copy()
    <span class="comment"># headline_m2_sentiment_0の値が高いほどポジティブなので符号反転させる</span>
    sentiment_dist = <span class="predefined">sorted</span>(df_sentiment.loc[DIST_START_DT:DIST_END_DT, <span class="string"><span class="delimiter">&quot;</span><span class="content">headline_m2_sentiment_0</span><span class="delimiter">&quot;</span></span>].values * -<span class="integer">1</span>)
    sentiment_use = df_sentiment.loc[USE_START_DT:, <span class="string"><span class="delimiter">&quot;</span><span class="content">headline_m2_sentiment_0</span><span class="delimiter">&quot;</span></span>].values * -<span class="integer">1</span>

    display(sentiment_dist)
    display(sentiment_use)

    <span class="comment"># DIST_START_DT:DIST_END_DTの分布を使用してリスク判定する</span>
    z = zscore(sentiment_dist)
    <span class="comment"># 閾値を決定</span>
    p = np.percentile(z, [<span class="integer">25</span>, <span class="integer">50</span>, <span class="integer">75</span>])
    <span class="comment"># リスク値を計算する</span>
    u = zscore(sentiment_use)
    <span class="comment"># 分布から現金比率の割合を決定</span>
    d = np.digitize(u, p)
    <span class="comment"># 出力用に整形して 0, 10, 20, 30 のいずれか返すようにする</span>
    df_sentiment.loc[USE_START_DT:, <span class="string"><span class="delimiter">&quot;</span><span class="content">risk</span><span class="delimiter">&quot;</span></span>] = d * <span class="integer">10</span>
    <span class="keyword">return</span> df_sentiment</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;現&#8203;金&#8203;比&#8203;率&#8203;の&#8203;操&#8203;作&#8203;以&#8203;外&#8203;の&#8203;活&#8203;用&#8203;方&#8203;法&#8203;と&#8203;し&#8203;て&#8203;は、&#8203;LSTM&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;学&#8203;習&#8203;レ&#8203;イ&#8203;ヤー&#8203;が&#8203;存&#8203;在&#8203;す&#8203;る&#8203;と、&#8203;ユ&#8203;ニ&#8203;バー&#8203;ス&#8203;の&#8203;時&#8203;価&#8203;総&#8203;額&#8203;や&#8203;ROE&#8203;が&#8203;高&#8203;い&#8203;銘&#8203;柄&#8203;と&#8203;低&#8203;い&#8203;銘&#8203;柄&#8203;の&#8203;ど&#8203;ち&#8203;ら&#8203;が&#8203;よ&#8203;り&#8203;多&#8203;く&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;産&#8203;み&#8203;出&#8203;す&#8203;か&#8203;を&#8203;予&#8203;測&#8203;さ&#8203;せ&#8203;る&#8203;よ&#8203;う&#8203;な&#8203;ス&#8203;ト&#8203;ラ&#8203;テ&#8203;ジー&#8203;を&#8203;構&#8203;築&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;是&#8203;非&#8203;自&#8203;由&#8203;な&#8203;発&#8203;想&#8203;で&#8203;BERT&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;活&#8203;用&#8203;し&#8203;て&#8203;み&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
</div>
<div class="sect2">
<h3 id="_投稿用コードの実装例">6.6. 投稿用コードの実装例</h3>
<div class="paragraph">
<p>　5&#8203;章&#8203;か&#8203;ら&#8203;こ&#8203;こ&#8203;ま&#8203;で&#8203;で、&#8203;ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;か&#8203;ら&#8203;現&#8203;金&#8203;比&#8203;率&#8203;を&#8203;操&#8203;作&#8203;す&#8203;る&#8203;ま&#8203;で&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;提&#8203;示&#8203;し&#8203;て&#8203;き&#8203;ま&#8203;し&#8203;た。&#8203;こ&#8203;れ&#8203;ま&#8203;で&#8203;提&#8203;示&#8203;し&#8203;た&#8203;コー&#8203;ド&#8203;を&#8203;組&#8203;み&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;実&#8203;装&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;で&#8203;動&#8203;作&#8203;す&#8203;る&#8203;投&#8203;稿&#8203;用&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す&#8203;が、&#8203;具&#8203;体&#8203;的&#8203;な&#8203;実&#8203;装&#8203;方&#8203;法&#8203;に&#8203;悩&#8203;ま&#8203;れ&#8203;る&#8203;か&#8203;も&#8203;し&#8203;れ&#8203;ま&#8203;せ&#8203;ん。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は&#8203;実&#8203;際&#8203;に&#8203;投&#8203;稿&#8203;し&#8203;て&#8203;リー&#8203;ダー&#8203;ボー&#8203;ド&#8203;で&#8203;動&#8203;作&#8203;を&#8203;確&#8203;認&#8203;可&#8203;能&#8203;な&#8203;実&#8203;装&#8203;例&#8203;を&#8203; <code>handson/Chapter06/archive/src</code> &#8203;配&#8203;下&#8203;に&#8203;配&#8203;置&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;内&#8203;で&#8203;は&#8203;実&#8203;装&#8203;例&#8203;の&#8203;詳&#8203;細&#8203;な&#8203;解&#8203;説&#8203;は&#8203;い&#8203;た&#8203;し&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;実&#8203;装&#8203;例&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;ご&#8203;覧&#8203;い&#8203;た&#8203;だ&#8203;く&#8203;こ&#8203;と&#8203;で&#8203;独&#8203;自&#8203;実&#8203;装&#8203;や&#8203;改&#8203;良&#8203;等&#8203;の&#8203;ヒ&#8203;ン&#8203;ト&#8203;と&#8203;な&#8203;る&#8203;か&#8203;も&#8203;し&#8203;れ&#8203;ま&#8203;せ&#8203;ん。</p>
</div>
<div class="paragraph">
<p>　&#8203;以&#8203;下&#8203;で&#8203;は、&#8203;実&#8203;装&#8203;例&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;実&#8203;際&#8203;に&#8203;動&#8203;作&#8203;さ&#8203;せ&#8203;る&#8203;た&#8203;め&#8203;に&#8203;必&#8203;要&#8203;な&#8203;ファ&#8203;イ&#8203;ル&#8203;の&#8203;配&#8203;置&#8203;や&#8203;投&#8203;稿&#8203;の&#8203;た&#8203;め&#8203;の&#8203;パッ&#8203;ケー&#8203;ジ&#8203;作&#8203;成&#8203;を&#8203;解&#8203;説&#8203;い&#8203;た&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;作&#8203;業&#8203;内&#8203;容&#8203;は&#8203; <code>handson/Chapter06/20210224_chapter06_tutorial_test_predictor.ipynb</code> &#8203;と&#8203;し&#8203;て&#8203; nootbook &#8203;に&#8203;も&#8203;記&#8203;載&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;実&#8203;際&#8203;の&#8203;動&#8203;作&#8203;確&#8203;認&#8203;な&#8203;ど&#8203;は&#8203;そ&#8203;ち&#8203;ら&#8203;を&#8203;ご&#8203;使&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;な&#8203;お、&#8203;実&#8203;装&#8203;例&#8203;の&#8203;確&#8203;認&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203; Google Colab &#8203;環&#8203;境&#8203;で&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;実&#8203;装&#8203;例&#8203;の&#8203;配&#8203;置&#8203;場&#8203;所&#8203;</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>handson/Chapter06/
|-- 20210224_chapter06_tutorial_test_predictor.ipynb  &lt;= 実装例の動作確認用ノートブック
|-- 20210226_chapter06_tutorial.ipynb  &lt;= 本章の作業用ノートブック
`-- archive
    |-- model
    |   `-- 本ディレクトリ内に事前学習済みのモデルやパラメーターを配置します。
    |-- requirements.txt  &lt;= 実装例を動作させるために必要なモジュールを記載しています。
    `-- src
        |-- module.py  &lt;= 5章/6章のコードをまとめたもの
        `-- predictor.py  &lt;= 4章で作成したScoringServiceクラスに現金比率操作用コード追加した実装例</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_事前準備">6.6.1. 事前準備</h4>
<div class="paragraph">
<p>本&#8203;ノー&#8203;ト&#8203;ブッ&#8203;ク&#8203;は&#8203; Google Colaboratory &#8203;で&#8203;実&#8203;行&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;想&#8203;定&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;実&#8203;行&#8203;時&#8203;に&#8203;は&#8203;以&#8203;下&#8203;の&#8203;事&#8203;前&#8203;準&#8203;備&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;ペー&#8203;ジ&#8203;か&#8203;ら&#8203;必&#8203;要&#8203;な&#8203;ファ&#8203;イ&#8203;ル&#8203;の&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド</p>
</li>
<li>
<p>Google Drive &#8203;に&#8203;必&#8203;要&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;配&#8203;置</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_コンペティションページから必要なファイルのダウンロード">6.6.2. コンペティションページから必要なファイルのダウンロード</h4>
<div class="paragraph">
<p>■&#8203;以&#8203;下&#8203;の&#8203;10&#8203;個&#8203;の&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;デー&#8203;タ&#8203;タ&#8203;ブ&#8203;か&#8203;ら&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。
<a href="https://signate.jp/competitions/443/data" class="bare">https://signate.jp/competitions/443/data</a></p>
</div>
<div class="paragraph">
<p>2&#8203;章&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;学&#8203;習&#8203;済&#8203;み&#8203;モ&#8203;デ&#8203;ル</p>
</div>
<div class="ulist">
<ul>
<li>
<p>01 my_model_label_high_20.pkl</p>
</li>
<li>
<p>02 my_model_label_low_20.pkl</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>LSTM&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;学&#8203;習&#8203;済&#8203;み&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203; (headline_features)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>03 19.ckpt</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>LSTM&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203; (headline_features)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>04 LSTM_sentiment.pkl</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>動&#8203;作&#8203;確&#8203;認&#8203;用&#8203;デー&#8203;タ</p>
</div>
<div class="ulist">
<ul>
<li>
<p>05 nikkei_article.csv.gz</p>
</li>
<li>
<p>06 stock_fin.csv.gz</p>
</li>
<li>
<p>07 stock_fin_price.csv.gz</p>
</li>
<li>
<p>08 stock_list.csv.gz</p>
</li>
<li>
<p>09 stock_price.csv.gz</p>
</li>
<li>
<p>10 tdnet.csv.gz</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>■&#8203;以&#8203;下&#8203;の&#8203;4&#8203;つ&#8203;の&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;リ&#8203;ポ&#8203;ジ&#8203;ト&#8203;リ&#8203;か&#8203;ら&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。
<a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial/tree/main/handson/Chapter06" class="bare">https://github.com/JapanExchangeGroup/J-Quants-Tutorial/tree/main/handson/Chapter06</a></p>
</div>
<div class="paragraph">
<p>動&#8203;作&#8203;確&#8203;認&#8203;用&#8203;ノー&#8203;ト&#8203;ブッ&#8203;ク&#8203; (&#8203;本&#8203;ノー&#8203;ト&#8203;ブッ&#8203;ク&#8203;)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>11 20210224_chapter06_tutorial_test_predictor.ipynb</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>実&#8203;装&#8203;例&#8203;の&#8203;requirements.txt</p>
</div>
<div class="ulist">
<ul>
<li>
<p>12 archive/requirements.txt</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>実&#8203;装&#8203;例&#8203;の&#8203;コー&#8203;ド</p>
</div>
<div class="ulist">
<ul>
<li>
<p>13 archive/src/module.py</p>
</li>
<li>
<p>14 archive/src/predictor.py</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_google_drive_に必要なファイルを配置">6.6.3. Google Drive に必要なファイルを配置</h4>
<div class="paragraph">
<p>　Google Drive &#8203;の&#8203; My Drive &#8203;配&#8203;下&#8203;に&#8203;以&#8203;下&#8203;の&#8203;フォ&#8203;ル&#8203;ダ&#8203;構&#8203;造&#8203;で&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;配&#8203;置&#8203;し&#8203;ま&#8203;す。&#8203;ファ&#8203;イ&#8203;ル&#8203;名&#8203;の&#8203;後&#8203;ろ&#8203;に&#8203;「download:&#8203;数&#8203;字」&#8203;と&#8203;し&#8203;て、&#8203;先&#8203;程&#8203;の&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;時&#8203;の&#8203;説&#8203;明&#8203;で&#8203;使&#8203;用&#8203;し&#8203;た&#8203;番&#8203;号&#8203;を&#8203;記&#8203;載&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>MyDrive/JPX_competition/
├── Chapter06
│   ├── 20210224_chapter06_tutorial_test_predictor.ipynb &lt;= 本ノートブック download:11
│   └── archive  &lt;= 投稿用パッケージの起点となるフォルダ
│       ├── model
│       │   ├── headline_features
│       │   │   ├── 19.ckpt  &lt;= 6章で作成した LSTM モデルの学習済みパラメータ download:03
│       │   │   └── LSTM_sentiment.pkl  &lt;= 6章で作成したセンチメント download:04
│       │   ├── my_model_label_high_20.pkl  &lt;= 2章で作成した最高値予測モデル download:01
│       │   ├── my_model_label_low_20.pkl  &lt;= 2章で作成した最安値予測モデル download:02
│       ├── src
│       │   ├── module.py  &lt;= 5章/6章のコードをまとめたもの download:13
│       │   └── predictor.py  &lt;= 4章のコードに一部追記してニュースデータを使用して現金比率操作を追記したもの download:14
│       └── requirements.txt
└── data_dir_comp2
     ├── nikkei_article.csv.gz  &lt;= download:05
     ├── stock_fin.csv.gz  &lt;= download:06
     ├── stock_fin_price.csv.gz  &lt;= download:07
     ├── stock_list.csv.gz  &lt;= download:08
     ├── stock_price.csv.gz  &lt;= download:09
     └── tdnet.csv.gz  &lt;= download:10</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_実行環境設定">6.6.4. 実行環境設定</h4>
<div class="paragraph">
<p>　&#8203;本&#8203;ノー&#8203;ト&#8203;ブッ&#8203;ク&#8203;を&#8203;実&#8203;行&#8203;す&#8203;る&#8203;に&#8203;あ&#8203;たっ&#8203;て&#8203;必&#8203;要&#8203;な&#8203;環&#8203;境&#8203;設&#8203;定&#8203;を&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Google Drive&#8203;の&#8203;マ&#8203;ウ&#8203;ン&#8203;ト</p>
</li>
<li>
<p>モ&#8203;ジュー&#8203;ル&#8203;を&#8203;import&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;sys.path&#8203;を&#8203;追&#8203;加</p>
</li>
<li>
<p>autoreload &#8203;拡&#8203;張&#8203;有&#8203;効&#8203;化</p>
</li>
<li>
<p>必&#8203;要&#8203;な&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;の&#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル</p>
</li>
<li>
<p>使&#8203;用&#8203;す&#8203;る&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;の&#8203;設&#8203;定</p>
</li>
<li>
<p>入&#8203;力&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203;作&#8203;成</p>
</li>
<li>
<p>BERT&#8203;の&#8203;事&#8203;前&#8203;学&#8203;習&#8203;済&#8203;み&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_google_driveのマウント">Google Driveのマウント</h5>
<div class="paragraph">
<p>　Google Drive&#8203;を&#8203;マ&#8203;ウ&#8203;ン&#8203;ト&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">import</span> <span class="include">sys</span>

<span class="keyword">if</span> <span class="string"><span class="delimiter">'</span><span class="content">google.colab</span><span class="delimiter">'</span></span> <span class="keyword">in</span> sys.modules:
    <span class="comment"># Google Drive をマウントします</span>
    <span class="keyword">from</span> <span class="include">google.colab</span> <span class="keyword">import</span> <span class="include">drive</span>
    mount_dir = <span class="string"><span class="delimiter">&quot;</span><span class="content">/content/drive</span><span class="delimiter">&quot;</span></span>
    drive.mount(mount_dir)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_使用するディレクトリの設定">使用するディレクトリの設定</h5>
<div class="paragraph">
<p>　&#8203;環&#8203;境&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;使&#8203;用&#8203;す&#8203;る&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;設&#8203;定&#8203;し&#8203;ま&#8203;す。&#8203;配&#8203;置&#8203;し&#8203;た&#8203;.py&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;import&#8203;で&#8203;き&#8203;る&#8203;よ&#8203;う&#8203;に&#8203;sys.path&#8203;に&#8203;配&#8203;置&#8203;先&#8203;の&#8203;ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ&#8203;を&#8203;追&#8203;加&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">if</span> <span class="string"><span class="delimiter">'</span><span class="content">google.colab</span><span class="delimiter">'</span></span> <span class="keyword">in</span> sys.modules:
    <span class="comment"># Google Colab環境では上記に示したディレクトリ設定を使用します。</span>
    <span class="comment"># archiveディレクトリを指定します。</span>
    archive_path = f<span class="string"><span class="delimiter">&quot;</span><span class="content">{mount_dir}/MyDrive/JPX_competition/Chapter06/archive</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 実装例のコードを配置したディレクトリを指定します。</span>
    src_path = f<span class="string"><span class="delimiter">&quot;</span><span class="content">{mount_dir}/MyDrive/JPX_competition/Chapter06/archive/src</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># sys.pathを設定</span>
    sys.path.append(src_path)
    <span class="comment"># ダウンロードしてきたデータを配置したディレクトリを設定します。</span>
    dataset_dir = f<span class="string"><span class="delimiter">&quot;</span><span class="content">{mount_dir}/MyDrive/JPX_competition/data_dir_comp2</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 2章のモデルを配置したディレクトリを設定します。</span>
    <span class="comment"># このディレクトリにBERTの事前学習済みモデルをダウンロードして保存します。</span>
    model_path = f<span class="string"><span class="delimiter">&quot;</span><span class="content">{mount_dir}/MyDrive/JPX_competition/Chapter06/archive/model</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># テスト用に出力したポートフォリオを保存するディレクトリを設定します</span>
    output_path = f<span class="string"><span class="delimiter">&quot;</span><span class="content">{mount_dir}/MyDrive/JPX_competition/Chapter06</span><span class="delimiter">&quot;</span></span>
<span class="keyword">else</span>:
    <span class="comment"># archiveディレクトリを指定します。</span>
    archive_path = <span class="string"><span class="delimiter">&quot;</span><span class="content">archive</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 実装例のコードを配置したディレクトリを指定します。</span>
    src_path = <span class="string"><span class="delimiter">&quot;</span><span class="content">archive/src</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># sys.pathを設定</span>
    sys.path.append(src_path)
    <span class="comment"># ダウンロードしてきたデータを配置したディレクトリを設定します。</span>
    dataset_dir = <span class="string"><span class="delimiter">&quot;</span><span class="content">/notebook/data_dir_comp2</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 2章のモデルを配置したディレクトリを設定します。</span>
    <span class="comment"># このディレクトリにBERTの事前学習済みモデルをダウンロードして保存します。</span>
    model_path = <span class="string"><span class="delimiter">&quot;</span><span class="content">archive/model</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># テスト用に出力したポートフォリオを保存するディレクトリを設定します</span>
    output_path = <span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_必要なライブラリのインストール_3">必要なライブラリのインストール</h5>
<div class="paragraph">
<p>　&#8203;必&#8203;要&#8203;な&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;を&#8203;イ&#8203;ン&#8203;ス&#8203;トー&#8203;ル&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># neologdnのためにg++をインストール
! apt-get update
! apt-get install -y --no-install-recommends g++</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># 必要なライブラリをインストール
!pip install -r $archive_path/requirements.txt</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_入力パラメータ作成">入力パラメータ作成</h5>
<div class="paragraph">
<p>　&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;で&#8203;predict&#8203;メ&#8203;ソッ&#8203;ド&#8203;が&#8203;呼&#8203;ば&#8203;れ&#8203;る&#8203;と&#8203;き&#8203;に&#8203;渡&#8203;さ&#8203;れ&#8203;る&#8203; inputs &#8203;パ&#8203;ラ&#8203;メー&#8203;ター&#8203;を&#8203;実&#8203;行&#8203;環&#8203;境&#8203;に&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># predictメソッドへの入力パラメーターを設定します。</span>
<span class="comment"># ランタイム環境での実行時と同一フォーマットにします</span>
inputs = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_list.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_price.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_fin.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin_price</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_fin_price.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="comment"># ニュースデータ</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">tdnet</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/tdnet.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/disclosureItems.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">nikkei_article</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/nikkei_article.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">article</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/article.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">industry</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/industry.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">industry2</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/industry2.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">region</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/region.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">theme</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/theme.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="comment"># 目的変数データ</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_labels.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="comment"># 購入日指定データ</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">purchase_date</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/purchase_date.csv</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bertの事前学習済みモデルをダウンロード">6.6.5. BERTの事前学習済みモデルをダウンロード</h4>
<div class="paragraph">
<p>　&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;で&#8203;は&#8203;イ&#8203;ン&#8203;ター&#8203;ネッ&#8203;ト&#8203;に&#8203;ア&#8203;ク&#8203;セ&#8203;ス&#8203;で&#8203;き&#8203;な&#8203;い&#8203;た&#8203;め、&#8203;BERT&#8203;の&#8203;事&#8203;前&#8203;学&#8203;習&#8203;済&#8203;み&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203; {model_path}/transformers &#8203;配&#8203;下&#8203;に&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;て&#8203;お&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>　SentimentGenerator&#8203;の&#8203;load_feature_extractor&#8203;お&#8203;よ&#8203;び&#8203;load_bert_tokenizer&#8203;メ&#8203;ソッ&#8203;ド&#8203;に&#8203;download&#8203;お&#8203;よ&#8203;び&#8203;save_local&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203;を&#8203;True&#8203;と&#8203;し&#8203;て&#8203;実&#8203;行&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;BERT&#8203;の&#8203;事&#8203;前&#8203;学&#8203;習&#8203;済&#8203;み&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;お&#8203;よ&#8203;び&#8203;保&#8203;存&#8203;し&#8203;ま&#8203;す。&#8203;次&#8203;に&#8203;SentimentGenrator&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">module</span> <span class="keyword">import</span> <span class="include">SentimentGenerator</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;事&#8203;前&#8203;学&#8203;習&#8203;済&#8203;み&#8203;の&#8203;BERT&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;て&#8203;保&#8203;存&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">SentimentGenerator.load_feature_extractor(model_path, download=<span class="predefined-constant">True</span>, save_local=<span class="predefined-constant">True</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;事&#8203;前&#8203;学&#8203;習&#8203;時&#8203;に&#8203;使&#8203;用&#8203;し&#8203;た&#8203;Tokenizer&#8203;も&#8203;合&#8203;わ&#8203;せ&#8203;て&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;て&#8203;保&#8203;存&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">SentimentGenerator.load_bert_tokenizer(model_path, download=<span class="predefined-constant">True</span>, save_local=<span class="predefined-constant">True</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　BERT&#8203;の&#8203;事&#8203;前&#8203;学&#8203;習&#8203;済&#8203;み&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;保&#8203;存&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">! ls -lhR $model_path</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/content/drive/MyDrive/JPX_competition/comp2/chapter06/archive/model:
total 71M
drwx------ 2 root root 4.0K Mar 11 07:37 headline_features
-rw------- 1 root root  36M Mar 11 07:37 my_model_label_high_20.pkl
-rw------- 1 root root  36M Mar 11 07:37 my_model_label_low_20.pkl
drwx------ 3 root root 4.0K Mar 11 07:37 transformers_pretrained

/content/drive/MyDrive/JPX_competition/comp2/chapter06/archive/model/headline_features:
total 5.1M
-rw------- 1 root root 5.1M Mar 11 07:37 19.ckpt
-rw------- 1 root root  958 Mar 11 07:37 LSTM_sentiment.pkl

/content/drive/MyDrive/JPX_competition/comp2/chapter06/archive/model/transformers_pretrained:
total 4.0K
drwx------ 3 root root 4.0K Mar 11 07:37 cl-tohoku

/content/drive/MyDrive/JPX_competition/comp2/chapter06/archive/model/transformers_pretrained/cl-tohoku:
total 4.0K
drwx------ 2 root root 4.0K Mar 11 07:37 bert-base-japanese-whole-word-masking

/content/drive/MyDrive/JPX_competition/comp2/chapter06/archive/model/transformers_pretrained/cl-tohoku/bert-base-japanese-whole-word-masking:
total 423M
-rw------- 1 root root  707 Mar 11 07:37 config.json
-rw------- 1 root root 423M Mar 11 07:37 pytorch_model.bin
-rw------- 1 root root  112 Mar 11 07:37 special_tokens_map.json
-rw------- 1 root root  397 Mar 11 07:37 tokenizer_config.json
-rw------- 1 root root 252K Mar 11 07:37 vocab.txt</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ランタイム環境を想定したテスト実行">6.6.6. ランタイム環境を想定したテスト実行</h4>
<div class="paragraph">
<p>ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;で&#8203;実&#8203;行&#8203;さ&#8203;れ&#8203;る&#8203;の&#8203;と&#8203;同&#8203;等&#8203;の&#8203;呼&#8203;び&#8203;出&#8203;し&#8203;方&#8203;で&#8203;テ&#8203;ス&#8203;ト&#8203;を&#8203;行&#8203;い&#8203;ま&#8203;す。&#8203;ま&#8203;ず&#8203;は、&#8203;ScoringService&#8203;ク&#8203;ラ&#8203;ス&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">predictor</span> <span class="keyword">import</span> <span class="include">ScoringService</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>get_model&#8203;メ&#8203;ソッ&#8203;ド&#8203;を&#8203;呼&#8203;び&#8203;出&#8203;す&#8203;こ&#8203;と&#8203;で&#8203;以&#8203;下&#8203;を&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>BERT&#8203;の&#8203;事&#8203;前&#8203;学&#8203;習&#8203;済&#8203;み&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み</p>
</li>
<li>
<p>BERT&#8203;の&#8203;事&#8203;前&#8203;学&#8203;習&#8203;済&#8203;み&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;使&#8203;用&#8203;し&#8203;た&#8203;Tokenizer&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み</p>
</li>
<li>
<p>事&#8203;前&#8203;学&#8203;習&#8203;済&#8203;み&#8203;の&#8203;最&#8203;高&#8203;値・&#8203;最&#8203;安&#8203;値&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;読&#8203;み&#8203;込&#8203;み</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">ScoringService.get_model(model_path)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;今&#8203;回&#8203;は&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;環&#8203;境&#8203;と&#8203;同&#8203;一&#8203;の&#8203;デー&#8203;タ&#8203;セッ&#8203;ト&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;い&#8203;な&#8203;い&#8203;た&#8203;め、&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;た&#8203;デー&#8203;タ&#8203;を&#8203;使&#8203;用&#8203;し&#8203;て&#8203;動&#8203;作&#8203;確&#8203;認&#8203;す&#8203;る&#8203;た&#8203;め&#8203;に&#8203;予&#8203;測&#8203;出&#8203;力&#8203;対&#8203;象&#8203;日&#8203; (start_dt) &#8203;を&#8203; 2020-12-28 &#8203;と&#8203;指&#8203;定&#8203;し&#8203;た&#8203;purchase_date&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;実&#8203;行&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;既&#8203;に&#8203; purchase_date.csv &#8203;が&#8203;存&#8203;在&#8203;し&#8203;て&#8203;い&#8203;る&#8203;場&#8203;合&#8203;は&#8203;上&#8203;書&#8203;き&#8203;さ&#8203;れ&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;注&#8203;意&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">! echo &quot;Purchase Date&quot; &gt; $dataset_dir/purchase_date.csv
! echo &quot;2020-12-28&quot; &gt;&gt; $dataset_dir/purchase_date.csv</code></pre>
</div>
</div>
<div class="paragraph">
<p>予&#8203;測&#8203;を&#8203;実&#8203;行&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">ret = ScoringService.predict(inputs)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_出力の確認">6.6.7. 出力の確認</h4>
<div class="paragraph">
<p>予&#8203;測&#8203;出&#8203;力&#8203;の&#8203;実&#8203;行&#8203;結&#8203;果&#8203;を&#8203;確&#8203;認&#8203;し&#8203;ま&#8203;す。&#8203;確&#8203;認&#8203;ポ&#8203;イ&#8203;ン&#8203;ト&#8203;は&#8203;以&#8203;下&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>出&#8203;力&#8203;の&#8203;フォー&#8203;マッ&#8203;ト&#8203;が&#8203;規&#8203;定&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;も&#8203;の&#8203;と&#8203;一&#8203;致&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">print(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>.join(ret.split(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>)[:<span class="integer">10</span>]))</code></pre>
</div>
</div>
<div class="paragraph">
<p>出&#8203;力</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>date,Local Code,budget
2020-12-28,4165,20000
2020-12-28,7694,20000
2020-12-28,4167,20000
2020-12-28,3677,20000
2020-12-28,4493,20000
2020-12-28,7358,20000
2020-12-28,8848,20000
2020-12-28,3328,20000
2020-12-28,6050,20000</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 出力を保存</span>
<span class="keyword">with</span> <span class="predefined">open</span>(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{output_path}/chapter06-tutorial-1.csv</span><span class="delimiter">&quot;</span></span>, mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">w</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
    f.write(ret)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_投稿用パッケージを作成">6.6.8. 投稿用パッケージを作成</h4>
<div class="paragraph">
<p>　&#8203;上&#8203;記&#8203;で&#8203;動&#8203;作&#8203;確&#8203;認&#8203;し&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;投&#8203;稿&#8203;用&#8203;に&#8203;パッ&#8203;ケー&#8203;ジ&#8203;化&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">import</span> <span class="include">os</span>
<span class="keyword">import</span> <span class="include">zipfile</span>

<span class="comment"># 提出用パッケージ名</span>
package_file = <span class="string"><span class="delimiter">&quot;</span><span class="content">chapter06-model.zip</span><span class="delimiter">&quot;</span></span>
<span class="comment"># パッケージファイルパス</span>
package_path = f<span class="string"><span class="delimiter">&quot;</span><span class="content">{output_path}/{package_file}</span><span class="delimiter">&quot;</span></span>

<span class="comment"># zipファイルを作成</span>
<span class="keyword">with</span> zipfile.ZipFile(package_path, <span class="string"><span class="delimiter">&quot;</span><span class="content">w</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
    <span class="comment"># requirements.txt を追加</span>
    print(f<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] add {archive_path}/requirements.txt to requirements.txt</span><span class="delimiter">&quot;</span></span>)
    f.write(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{archive_path}/requirements.txt</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">requirements.txt</span><span class="delimiter">&quot;</span></span>)

    <span class="comment"># model/配下を追加</span>
    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(model_path):
        <span class="keyword">for</span> <span class="predefined">file</span> <span class="keyword">in</span> files:
            add_path = os.path.join(root, <span class="predefined">file</span>)
            rel_path = os.path.relpath(
                os.path.join(root, <span class="predefined">file</span>),
                os.path.join(model_path, <span class="string"><span class="delimiter">'</span><span class="content">..</span><span class="delimiter">'</span></span>)
            )
            print(f<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] add {add_path} to {rel_path}</span><span class="delimiter">&quot;</span></span>)
            f.write(add_path, rel_path)

    <span class="comment"># src/module.py を追加</span>
    print(f<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] add {src_path}/module.py to src/module.py</span><span class="delimiter">&quot;</span></span>)
    f.write(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{src_path}/module.py</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">src/module.py</span><span class="delimiter">&quot;</span></span>)
    <span class="comment"># src/predictor.py を追加</span>
    print(f<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] add {src_path}/predictor.py to src/predictor.py</span><span class="delimiter">&quot;</span></span>)
    f.write(f<span class="string"><span class="delimiter">&quot;</span><span class="content">{src_path}/predictor.py</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">src/predictor.py</span><span class="delimiter">&quot;</span></span>)

print(f<span class="string"><span class="delimiter">&quot;</span><span class="content">[+] please check {package_path}</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>　&#8203;上&#8203;記&#8203;コー&#8203;ド&#8203;を&#8203;最&#8203;後&#8203;ま&#8203;で&#8203;実&#8203;行&#8203;す&#8203;る&#8203;と&#8203;Google Drive &#8203;に&#8203;投&#8203;稿&#8203;用&#8203;の&#8203; <code>chapter06-model.zip</code> &#8203;ファ&#8203;イ&#8203;ル&#8203;が&#8203;作&#8203;成&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;そ&#8203;ち&#8203;ら&#8203;を&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;て&#8203;投&#8203;稿&#8203;し&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tips集">7. tips集</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本&#8203;章&#8203;で&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;関&#8203;連&#8203;す&#8203;る&#8203;金&#8203;融・&#8203;デー&#8203;タ&#8203;解&#8203;析&#8203;一&#8203;般&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;の&#8203;tips&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect2">
<h3 id="_コンペティションフォーラムの紹介">7.1. コンペティションフォーラムの紹介</h3>
<div class="paragraph">
<p>J-Quants&#8203;で&#8203;は、&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;関&#8203;連&#8203;し&#8203;て&#8203;執&#8203;筆&#8203;さ&#8203;れ&#8203;た&#8203;記&#8203;事&#8203;の&#8203;投&#8203;稿&#8203;や&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;へ&#8203;の&#8203;ご&#8203;質&#8203;問&#8203;を&#8203;フォー&#8203;ラ&#8203;ム&#8203;（ "https://signate.jp/competitions/423/discussions" ）&#8203;に&#8203;て&#8203;募&#8203;集&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す&#8203;（コ&#8203;ン&#8203;ペ&#8203;の&#8203;登&#8203;録&#8203;が&#8203;必&#8203;要）。&#8203;ま&#8203;た、&#8203;下&#8203;記&#8203;内&#8203;容&#8203;以&#8203;外&#8203;に&#8203;も&#8203;有&#8203;志&#8203;の&#8203;方&#8203;に&#8203;よ&#8203;る&#8203;素&#8203;晴&#8203;ら&#8203;し&#8203;い&#8203;ス&#8203;レッ&#8203;ド&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;ぜ&#8203;ひ&#8203;ご&#8203;確&#8203;認&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;タ&#8203;イ&#8203;ト&#8203;ル&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>URL</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">参&#8203;考&#8203;書&#8203;籍・&#8203;記&#8203;事・&#8203;知&#8203;見&#8203;共&#8203;有&#8203;ス&#8203;レッ&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://signate.jp/competitions/423/discussions/jpx-1" class="bare">https://signate.jp/competitions/423/discussions/jpx-1</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web&#8203;記&#8203;事&#8203;投&#8203;稿&#8203;ス&#8203;レッ&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://signate.jp/competitions/423/discussions/jpx-web" class="bare">https://signate.jp/competitions/423/discussions/jpx-web</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;質&#8203;問&#8203;用&#8203;ス&#8203;レッ&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://signate.jp/competitions/423/discussions/jpx" class="bare">https://signate.jp/competitions/423/discussions/jpx</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_金融用語集">7.2. 金融用語集</h3>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;必&#8203;要&#8203;と&#8203;な&#8203;る&#8203;専&#8203;門&#8203;用&#8203;語&#8203;を&#8203;解&#8203;説&#8203;し&#8203;て&#8203;く&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;サ&#8203;イ&#8203;ト&#8203;を&#8203;ご&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。&#8203;<br>
も&#8203;し、&#8203;専&#8203;門&#8203;用&#8203;語&#8203;で&#8203;困っ&#8203;た&#8203;場&#8203;合&#8203;は、&#8203;下&#8203;記&#8203;リ&#8203;ン&#8203;ク&#8203;先&#8203;の&#8203;コ&#8203;ン&#8203;テ&#8203;ン&#8203;ツ&#8203;を&#8203;確&#8203;認&#8203;し&#8203;て&#8203;い&#8203;た&#8203;だ&#8203;け&#8203;れ&#8203;ば&#8203;幸&#8203;い&#8203;で&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;タ&#8203;イ&#8203;ト&#8203;ル&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;運&#8203;営&#8203;元&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>URL</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">証&#8203;券&#8203;用&#8203;語&#8203;解&#8203;説&#8203;集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">野&#8203;村&#8203;證&#8203;券</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nomura.co.jp/terms/" class="bare">https://www.nomura.co.jp/terms/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">金&#8203;融・&#8203;証&#8203;券&#8203;用&#8203;語&#8203;解&#8203;説&#8203;集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">大&#8203;和&#8203;証&#8203;券</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.daiwa.jp/glossary/" class="bare">https://www.daiwa.jp/glossary/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファ&#8203;イ&#8203;ナ&#8203;ン&#8203;ス&#8203;用&#8203;語&#8203;集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">み&#8203;ず&#8203;ほ&#8203;証&#8203;券</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://glossary.mizuho-sc.com/" class="bare">https://glossary.mizuho-sc.com/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">初&#8203;め&#8203;て&#8203;で&#8203;も&#8203;わ&#8203;か&#8203;り&#8203;や&#8203;す&#8203;い&#8203;用&#8203;語&#8203;集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ＳＭＢＣ&#8203;日&#8203;興&#8203;証&#8203;券</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.smbcnikko.co.jp/terms/index.html" class="bare">https://www.smbcnikko.co.jp/terms/index.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用&#8203;語&#8203;解&#8203;説</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">三&#8203;菱&#8203;UFJ&#8203;モ&#8203;ル&#8203;ガ&#8203;ン・&#8203;ス&#8203;タ&#8203;ン&#8203;レー&#8203;証&#8203;券&#8203;株&#8203;式&#8203;会&#8203;社</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.sc.mufg.jp/learn/terms/index.html" class="bare">https://www.sc.mufg.jp/learn/terms/index.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">金&#8203;融&#8203;用&#8203;語&#8203;解&#8203;説&#8203;(&#8203;知&#8203;る&#8203;ぽ&#8203;る&#8203;と&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">金&#8203;融&#8203;広&#8203;報&#8203;中&#8203;央&#8203;委&#8203;員&#8203;会</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.shiruporuto.jp/public/document/container/yogo/" class="bare">https://www.shiruporuto.jp/public/document/container/yogo/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">金&#8203;融・&#8203;証&#8203;券&#8203;用&#8203;語&#8203;集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日&#8203;本&#8203;証&#8203;券&#8203;業&#8203;協&#8203;会</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.jsda.or.jp/jikan/word/" class="bare">https://www.jsda.or.jp/jikan/word/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用&#8203;語&#8203;集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EY&#8203;新&#8203;日&#8203;本&#8203;有&#8203;限&#8203;責&#8203;任&#8203;監&#8203;査&#8203;法&#8203;人</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.shinnihon.or.jp/corporate-accounting/glossary/" class="bare">https://www.shinnihon.or.jp/corporate-accounting/glossary/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">会&#8203;計&#8203;監&#8203;査&#8203;用&#8203;語&#8203;解&#8203;説&#8203;集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日&#8203;本&#8203;公&#8203;認&#8203;会&#8203;計&#8203;士&#8203;協&#8203;会</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://jicpa.or.jp/cpainfo/introduction/keyword/" class="bare">https://jicpa.or.jp/cpainfo/introduction/keyword/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">財&#8203;務&#8203;諸&#8203;表&#8203;等&#8203;の&#8203;用&#8203;語、&#8203;様&#8203;式&#8203;及&#8203;び&#8203;作&#8203;成&#8203;方&#8203;法&#8203;に&#8203;関&#8203;す&#8203;る&#8203;規&#8203;則</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e-GOV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://elaws.e-gov.go.jp/document?lawid=338M50000040059" class="bare">https://elaws.e-gov.go.jp/document?lawid=338M50000040059</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用&#8203;語&#8203;集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">野&#8203;村&#8203;ア&#8203;セッ&#8203;ト&#8203;マ&#8203;ネ&#8203;ジ&#8203;メ&#8203;ン&#8203;ト</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nomura-am.co.jp/basicknowledge/word/" class="bare">https://www.nomura-am.co.jp/basicknowledge/word/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用&#8203;語&#8203;集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ア&#8203;セッ&#8203;ト&#8203;マ&#8203;ネ&#8203;ジ&#8203;メ&#8203;ン&#8203;ト&#8203;One</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.am-one.co.jp/shisankeisei/glossary/" class="bare">http://www.am-one.co.jp/shisankeisei/glossary/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用&#8203;語&#8203;集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">大&#8203;和&#8203;ア&#8203;セッ&#8203;ト&#8203;マ&#8203;ネ&#8203;ジ&#8203;メ&#8203;ン&#8203;ト</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.daiwa-am.co.jp/guide/term/" class="bare">https://www.daiwa-am.co.jp/guide/term/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">わ&#8203;か&#8203;り&#8203;や&#8203;す&#8203;い&#8203;用&#8203;語&#8203;集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">三&#8203;井&#8203;住&#8203;友&#8203;DS&#8203;ア&#8203;セッ&#8203;ト&#8203;マ&#8203;ネ&#8203;ジ&#8203;メ&#8203;ン&#8203;ト</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.smd-am.co.jp/learning/glossary/" class="bare">https://www.smd-am.co.jp/learning/glossary/</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_東証マネ部">7.3. 東証マネ部</h3>
<div class="paragraph">
<p>「東&#8203;証&#8203; &#8203;マ&#8203;ネ&#8203;部！」&#8203;は&#8203;身&#8203;近&#8203;な&#8203;お&#8203;金&#8203;の&#8203;話&#8203;か&#8203;ら、&#8203;プ&#8203;ロ&#8203;が&#8203;教&#8203;え&#8203;る&#8203;資&#8203;産&#8203;運&#8203;用&#8203;の&#8203;ノ&#8203;ウ&#8203;ハ&#8203;ウ&#8203;ま&#8203;で&#8203; 、&#8203;資&#8203;産&#8203;形&#8203;成&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;わ&#8203;か&#8203;り&#8203;や&#8203;す&#8203;く&#8203;解&#8203;説&#8203;す&#8203;る&#8203;サ&#8203;イ&#8203;ト&#8203;で&#8203;す。
今&#8203;回&#8203;は、&#8203;コ&#8203;ン&#8203;ペ&#8203;に&#8203;関&#8203;係&#8203;が&#8203;あ&#8203;り&#8203;そ&#8203;う&#8203;な&#8203;記&#8203;事&#8203;を&#8203;ピッ&#8203;ク&#8203;アッ&#8203;プ&#8203;し&#8203;て&#8203;み&#8203;ま&#8203;し&#8203;た。&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;息&#8203;抜&#8203;き&#8203;に&#8203;ぜ&#8203;ひ&#8203;ご&#8203;確&#8203;認&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;タ&#8203;イ&#8203;ト&#8203;ル&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;リ&#8203;ン&#8203;ク&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">投&#8203;資&#8203;に&#8203;不&#8203;可&#8203;欠&#8203;な&#8203;財&#8203;務&#8203;三&#8203;表&#8203;の&#8203;見&#8203;方</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article022723/" class="bare">https://money-bu-jpx.com/news/article022723/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">財&#8203;務&#8203;ニュー&#8203;ス&#8203;を&#8203;読&#8203;む</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article028193/" class="bare">https://money-bu-jpx.com/news/article028193/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">長&#8203;期&#8203;投&#8203;資&#8203;に&#8203;欠&#8203;か&#8203;せ&#8203;な&#8203;い&#8203;運&#8203;用&#8203;コ&#8203;ス&#8203;ト&#8203;を&#8203;意&#8203;識&#8203;し&#8203;よ&#8203;う</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article004555/" class="bare">https://money-bu-jpx.com/news/article004555/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">プ&#8203;ロ&#8203;の&#8203;投&#8203;資&#8203;家&#8203;が&#8203;注&#8203;目&#8203;す&#8203;る&#8203;指&#8203;標&#8203;「ROE」&#8203;と&#8203;は？</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article005169/" class="bare">https://money-bu-jpx.com/news/article005169/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ディー&#8203;プ&#8203;ラー&#8203;ニ&#8203;ン&#8203;グ&#8203;が&#8203;拓&#8203;く&#8203;「AI&#8203;投&#8203;資」&#8203;の&#8203;可&#8203;能&#8203;性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article008127/" class="bare">https://money-bu-jpx.com/news/article008127/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AI&#8203;が&#8203;導&#8203;く&#8203;金&#8203;融&#8203;市&#8203;場&#8203;の&#8203;未&#8203;来</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article008332/" class="bare">https://money-bu-jpx.com/news/article008332/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">４&#8203;大&#8203;投&#8203;資&#8203;指&#8203;標&#8203;の&#8203;ワ&#8203;ナ&#8203;～&#8203;解&#8203;析&#8203;力&#8203;の&#8203;鍛&#8203;錬&#8203;～</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article012308/" class="bare">https://money-bu-jpx.com/news/article012308/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AI&#8203;を&#8203;使っ&#8203;た&#8203;市&#8203;場&#8203;の&#8203;予&#8203;測&#8203;に&#8203;挑&#8203;む&#8203;「AlpacaJapan」</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article015448/" class="bare">https://money-bu-jpx.com/news/article015448/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">「AI&#8203;と&#8203;資&#8203;産&#8203;運&#8203;用」</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article016485/" class="bare">https://money-bu-jpx.com/news/article016485/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">投&#8203;資&#8203;に&#8203;役&#8203;立&#8203;つ&#8203;「会&#8203;社&#8203;四&#8203;季&#8203;報」&#8203;活&#8203;用&#8203;の&#8203;ポ&#8203;イ&#8203;ン&#8203;ト</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article020860/" class="bare">https://money-bu-jpx.com/news/article020860/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">最&#8203;低&#8203;投&#8203;資&#8203;金&#8203;額&#8203;50&#8203;万&#8203;円&#8203;以&#8203;下&#8203;の&#8203;銘&#8203;柄&#8203;特&#8203;集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article022924/" class="bare">https://money-bu-jpx.com/news/article022924/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ク&#8203;チ&#8203;コ&#8203;ミ&#8203;で&#8203;投&#8203;資&#8203;を&#8203;楽&#8203;し&#8203;め&#8203;る&#8203;ア&#8203;プ&#8203;リ&#8203;「ferci&#8203;（フェ&#8203;ル&#8203;シー&#8203;)」</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article023550/" class="bare">https://money-bu-jpx.com/news/article023550/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">コ&#8203;ロ&#8203;ナ&#8203;後&#8203;の&#8203;世&#8203;界</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article024736/" class="bare">https://money-bu-jpx.com/news/article024736/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">株&#8203;式&#8203;場&#8203;況&#8203;を&#8203;読&#8203;む&#8203;～&#8203;専&#8203;門&#8203;用&#8203;語&#8203;の&#8203;理&#8203;解&#8203;～</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article026712/" class="bare">https://money-bu-jpx.com/news/article026712/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">決&#8203;算&#8203;ニュー&#8203;ス&#8203;を&#8203;読&#8203;む&#8203;～&#8203;会&#8203;計&#8203;用&#8203;語&#8203;の&#8203;理&#8203;解&#8203;～</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article027285/" class="bare">https://money-bu-jpx.com/news/article027285/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">公&#8203;的&#8203;統&#8203;計&#8203;を&#8203;補&#8203;完&#8203;す&#8203;る&#8203;「オ&#8203;ル&#8203;タ&#8203;ナ&#8203;ティ&#8203;ブ&#8203;デー&#8203;タ」&#8203;と&#8203;は？</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article028023/" class="bare">https://money-bu-jpx.com/news/article028023/</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_参考になる書籍">7.4. 参考になる書籍</h3>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;参&#8203;考&#8203;に&#8203;な&#8203;る&#8203;書&#8203;籍&#8203;を&#8203;紹&#8203;介&#8203;致&#8203;し&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;タ&#8203;イ&#8203;ト&#8203;ル&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;著&#8203;者&#8203;</strong>　</th>
<th class="tableblock halign-left valign-top"><strong>&#8203;概&#8203;要&#8203;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファ&#8203;イ&#8203;ナ&#8203;ン&#8203;ス&#8203;機&#8203;械&#8203;学&#8203;習&#8203;―&#8203;金&#8203;融&#8203;市&#8203;場&#8203;分&#8203;析&#8203;を&#8203;変&#8203;え&#8203;る&#8203;機&#8203;械&#8203;学&#8203;習&#8203;ア&#8203;ル&#8203;ゴ&#8203;リ&#8203;ズ&#8203;ム&#8203;の&#8203;理&#8203;論&#8203;と&#8203;実&#8203;践</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マ&#8203;ル&#8203;コ&#8203;ス・&#8203;ロ&#8203;ペ&#8203;ス・&#8203;デ・&#8203;プ&#8203;ラ&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">機&#8203;械&#8203;学&#8203;習&#8203;を&#8203;用&#8203;い&#8203;て&#8203;金&#8203;融&#8203;デー&#8203;タ&#8203;を&#8203;分&#8203;析&#8203;す&#8203;る&#8203;上&#8203;で&#8203;の&#8203;知&#8203;識&#8203;を&#8203;網&#8203;羅&#8203;的&#8203;に&#8203;学&#8203;ぶ&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る。&#8203;金&#8203;融&#8203;の&#8203;ド&#8203;メ&#8203;イ&#8203;ン&#8203;知&#8203;識&#8203;を&#8203;デー&#8203;タ&#8203;サ&#8203;イ&#8203;エ&#8203;ン&#8203;ティ&#8203;ス&#8203;ト&#8203;が&#8203;学&#8203;ぶ&#8203;に&#8203;は&#8203;最&#8203;適&#8203;な&#8203;本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ア&#8203;セッ&#8203;ト&#8203;マ&#8203;ネー&#8203;ジャー&#8203;の&#8203;た&#8203;め&#8203;の&#8203;ファ&#8203;イ&#8203;ナ&#8203;ン&#8203;ス&#8203;機&#8203;械&#8203;学&#8203;習</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マ&#8203;ル&#8203;コ&#8203;ス・&#8203;ロ&#8203;ペ&#8203;ス・&#8203;デ・&#8203;プ&#8203;ラ&#8203;ド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファ&#8203;イ&#8203;ナ&#8203;ン&#8203;ス&#8203;機&#8203;械&#8203;学&#8203;習&#8203;に&#8203;続&#8203;き、&#8203;ノ&#8203;イ&#8203;ズ&#8203;除&#8203;去、&#8203;ク&#8203;ラ&#8203;ス&#8203;タ&#8203;リ&#8203;ン&#8203;グ、&#8203;ラ&#8203;ベ&#8203;リ&#8203;ン&#8203;グ、&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;重&#8203;要&#8203;度&#8203;分&#8203;析&#8203;な&#8203;ど&#8203;の&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;で&#8203;も&#8203;関&#8203;連&#8203;の&#8203;深&#8203;い&#8203;ト&#8203;ピッ&#8203;ク&#8203;を&#8203;学&#8203;ぶ&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る。&#8203;た&#8203;だ&#8203;し、&#8203;「ファ&#8203;イ&#8203;ナ&#8203;ン&#8203;ス&#8203;機&#8203;械&#8203;学&#8203;習」&#8203;と&#8203;比&#8203;較&#8203;す&#8203;る&#8203;と&#8203;網&#8203;羅&#8203;性&#8203;は&#8203;な&#8203;い&#8203;の&#8203;で、&#8203;2&#8203;冊&#8203;目&#8203;と&#8203;し&#8203;て&#8203;読&#8203;む&#8203;こ&#8203;と&#8203;を&#8203;推&#8203;奨。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kaggle&#8203;で&#8203;勝&#8203;つ&#8203;デー&#8203;タ&#8203;分&#8203;析&#8203;の&#8203;技&#8203;術</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">門&#8203;脇&#8203; &#8203;大&#8203;輔&#8203; &#8203;他</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モ&#8203;デ&#8203;ル&#8203;の&#8203;チュー&#8203;ニ&#8203;ン&#8203;グ・&#8203;ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル&#8203;な&#8203;ど&#8203;機&#8203;械&#8203;学&#8203;習&#8203;の&#8203;コ&#8203;ン&#8203;ペ&#8203;に&#8203;関&#8203;連&#8203;す&#8203;る&#8203;テ&#8203;ク&#8203;ニッ&#8203;ク&#8203;を&#8203;効&#8203;率&#8203;的&#8203;に&#8203;学&#8203;ぶ&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">株&#8203;を&#8203;買&#8203;う&#8203;な&#8203;ら&#8203;最&#8203;低&#8203;限&#8203;知っ&#8203;て&#8203;お&#8203;き&#8203;た&#8203;い&#8203; &#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;投&#8203;資&#8203;の&#8203;教&#8203;科&#8203;書&#8203; &#8203;改&#8203;訂&#8203;版</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">足&#8203;立&#8203; &#8203;武&#8203;志</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;分&#8203;析&#8203;に&#8203;必&#8203;要&#8203;な&#8203;基&#8203;礎&#8203;知&#8203;識&#8203;を&#8203;学&#8203;ぶ&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">経&#8203;済・&#8203;ファ&#8203;イ&#8203;ナ&#8203;ン&#8203;ス&#8203;デー&#8203;タ&#8203;の&#8203;計&#8203;量&#8203;時&#8203;系&#8203;列&#8203;分&#8203;析</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">沖&#8203;本&#8203;竜&#8203;義</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARIMA&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;ベー&#8203;ス&#8203;と&#8203;し&#8203;た&#8203;古&#8203;典&#8203;的&#8203;な&#8203;時&#8203;系&#8203;列&#8203;解&#8203;析&#8203;を&#8203;学&#8203;ぶ&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る。&#8203;ARIMA&#8203;モ&#8203;デ&#8203;ル&#8203;自&#8203;体&#8203;を&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;と&#8203;し&#8203;て&#8203;使&#8203;う&#8203;こ&#8203;と&#8203;は、&#8203;コ&#8203;ン&#8203;ペ&#8203;で&#8203;は&#8203;ま&#8203;れ&#8203;だ&#8203;が、&#8203;金&#8203;融&#8203;デー&#8203;タ&#8203;に&#8203;対&#8203;し&#8203;て&#8203;時&#8203;系&#8203;列&#8203;分&#8203;析&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;上&#8203;で&#8203;の&#8203;実&#8203;務&#8203;上&#8203;の&#8203;課&#8203;題&#8203;な&#8203;ど&#8203;も&#8203;学&#8203;ぶ&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">金&#8203;融・&#8203;経&#8203;済&#8203;分&#8203;析&#8203;の&#8203;た&#8203;め&#8203;の&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;マ&#8203;イ&#8203;ニ&#8203;ン&#8203;グ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">和&#8203;泉&#8203; &#8203;潔&#8203;他</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">市&#8203;場&#8203;レ&#8203;ポー&#8203;ト&#8203;や&#8203;経&#8203;済&#8203;ニュー&#8203;ス&#8203;な&#8203;ど&#8203;の&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;デー&#8203;タ&#8203;を&#8203;分&#8203;析&#8203;し、&#8203;資&#8203;産&#8203;運&#8203;用&#8203;や&#8203;市&#8203;場&#8203;分&#8203;析&#8203;に&#8203;活&#8203;か&#8203;す&#8203;手&#8203;法&#8203;を&#8203;解&#8203;説&#8203;し&#8203;て&#8203;い&#8203;る。&#8203;数&#8203;式&#8203;は&#8203;少&#8203;な&#8203;く、&#8203;金&#8203;融&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;マ&#8203;イ&#8203;ニ&#8203;ン&#8203;グ&#8203;の&#8203;独&#8203;特&#8203;な&#8203;注&#8203;意&#8203;点&#8203;や&#8203;思&#8203;考&#8203;法&#8203;を&#8203;中&#8203;心&#8203;に&#8203;整&#8203;理&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;初&#8203;め&#8203;て&#8203;金&#8203;融&#8203;分&#8203;野&#8203;の&#8203;テ&#8203;キ&#8203;ス&#8203;ト&#8203;マ&#8203;イ&#8203;ニ&#8203;ン&#8203;グ&#8203;を&#8203;す&#8203;る&#8203;人&#8203;に&#8203;は&#8203;助&#8203;か&#8203;る&#8203;一&#8203;冊。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">統&#8203;計&#8203;学&#8203;入&#8203;門</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">東&#8203;京&#8203;大&#8203;学&#8203;教&#8203;養&#8203;学&#8203;部&#8203;統&#8203;計&#8203;学&#8203;教&#8203;室&#8203; &#8203;編</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">文&#8203;科&#8203;と&#8203;理&#8203;科&#8203;両&#8203;方&#8203;の&#8203;学&#8203;生&#8203;の&#8203;た&#8203;め&#8203;に，&#8203;統&#8203;計&#8203;的&#8203;な&#8203;も&#8203;の&#8203;の&#8203;考&#8203;え&#8203;方&#8203;の&#8203;基&#8203;礎&#8203;が&#8203;や&#8203;さ&#8203;し&#8203;く&#8203;解&#8203;説&#8203;さ&#8203;れ&#8203;て&#8203;お&#8203;り、&#8203;統&#8203;計&#8203;学&#8203;の&#8203;体&#8203;系&#8203;的&#8203;な&#8203;知&#8203;識&#8203;を&#8203;与&#8203;え&#8203;る&#8203;よ&#8203;う&#8203;に，&#8203;編&#8203;集・&#8203;執&#8203;筆&#8203;さ&#8203;れ&#8203;た&#8203;一&#8203;冊。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Python&#8203;デー&#8203;タ&#8203;サ&#8203;イ&#8203;エ&#8203;ン&#8203;ス&#8203;ハ&#8203;ン&#8203;ド&#8203;ブッ&#8203;ク</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jake VanderPlas &#8203;著、&#8203;菊&#8203;池&#8203; &#8203;彰&#8203; &#8203;訳</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;に&#8203;お&#8203;い&#8203;て&#8203;も&#8203;利&#8203;用&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;Jupyter、&#8203;NumPy、&#8203;pandas、&#8203;Matplotlib、&#8203;scikit-learn&#8203;等&#8203;を&#8203;カ&#8203;バー&#8203;し&#8203;て&#8203;い&#8203;る&#8203;一&#8203;冊。&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;ト&#8203;ピッ&#8203;ク&#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;押&#8203;さ&#8203;え&#8203;て&#8203;お&#8203;く&#8203;べ&#8203;き&#8203;基&#8203;本、&#8203;tips、&#8203;便&#8203;利&#8203;な&#8203;コ&#8203;マ&#8203;ン&#8203;ド&#8203;な&#8203;ど&#8203;が&#8203;紹&#8203;介&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_参考になるコンペティション">7.5. 参考になるコンペティション</h3>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;に&#8203;関&#8203;連&#8203;し&#8203;た&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;を&#8203;紹&#8203;介&#8203;い&#8203;た&#8203;し&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;タ&#8203;イ&#8203;ト&#8203;ル&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;概&#8203;要&#8203;</strong>　</th>
<th class="tableblock halign-left valign-top"><strong>URL</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two Sigma: Using News to Predict Stock Movements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ニュー&#8203;ス&#8203;デー&#8203;タ&#8203;を&#8203;用&#8203;い&#8203;た&#8203;株&#8203;価&#8203;の&#8203;予&#8203;測</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.kaggle.com/c/two-sigma-financial-news" class="bare">https://www.kaggle.com/c/two-sigma-financial-news</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fintech Data Championship</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日&#8203;本&#8203;株&#8203;式&#8203;の&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;で&#8203;次&#8203;の&#8203;1&#8203;カ&#8203;月&#8203;後&#8203;に、&#8203;最&#8203;も&#8203;上&#8203;昇&#8203;す&#8203;る&#8203;組&#8203;み&#8203;合&#8203;わ&#8203;せ&#8203;を&#8203;検&#8203;討</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://compass.labbase.jp/articles/296" class="bare">https://compass.labbase.jp/articles/296</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Algorithmic Trading Challenge　</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">投&#8203;資&#8203;戦&#8203;略&#8203;に&#8203;関&#8203;す&#8203;る&#8203;収&#8203;益&#8203;率・&#8203;取&#8203;引&#8203;高&#8203;等&#8203;の&#8203;デー&#8203;タ&#8203;か&#8203;ら、&#8203;各&#8203;戦&#8203;略&#8203;へ&#8203;の&#8203;資&#8203;金&#8203;の&#8203;割&#8203;り&#8203;当&#8203;て&#8203;の&#8203;重&#8203;み&#8203;を&#8203;最&#8203;適&#8203;化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://signate.jp/competitions/146" class="bare">https://signate.jp/competitions/146</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">大&#8203;手&#8203;ヘッ&#8203;ジ&#8203;ファ&#8203;ン&#8203;ド&#8203;X: &#8203;金&#8203;融&#8203;モ&#8203;デ&#8203;リ&#8203;ン&#8203;グ&#8203;チャ&#8203;レ&#8203;ン&#8203;ジ&#8203;　</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">独&#8203;自&#8203;に&#8203;導&#8203;出&#8203;し&#8203;た&#8203;様々&#8203;な&#8203;特&#8203;徴&#8203;量&#8203;か&#8203;ら&#8203;将&#8203;来&#8203;の&#8203;動&#8203;き&#8203;を&#8203;予&#8203;想</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://signate.jp/competitions/53" class="bare">https://signate.jp/competitions/53</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">財&#8203;務・&#8203;非&#8203;財&#8203;務&#8203;情&#8203;報&#8203;を&#8203;活&#8203;用&#8203;し&#8203;た&#8203;株&#8203;主&#8203;価&#8203;値&#8203;予&#8203;測&#8203;　</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会&#8203;計&#8203;年&#8203;度&#8203;2014-2017&#8203;年&#8203;の&#8203;各&#8203;企&#8203;業&#8203;の&#8203;財&#8203;務・&#8203;非&#8203;財&#8203;務&#8203;情&#8203;報&#8203;か&#8203;ら、&#8203;会&#8203;計&#8203;年&#8203;度&#8203;2018&#8203;年&#8203;の&#8203;期&#8203;末&#8203;時&#8203;価&#8203;総&#8203;額&#8203;を&#8203;予&#8203;測</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nishika.com/competitions/4/summary" class="bare">https://www.nishika.com/competitions/4/summary</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Winton Stock Market Challenge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">過&#8203;去&#8203;の&#8203;株&#8203;価&#8203;と&#8203;マ&#8203;ス&#8203;ク&#8203;さ&#8203;れ&#8203;た&#8203;特&#8203;徴&#8203;量&#8203;か&#8203;ら&#8203;将&#8203;来&#8203;の&#8203;株&#8203;価&#8203;を&#8203;予&#8203;想</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.kaggle.com/c/the-winton-stock-market-challenge" class="bare">https://www.kaggle.com/c/the-winton-stock-market-challenge</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numerai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マ&#8203;ス&#8203;ク&#8203;さ&#8203;れ&#8203;た&#8203;銘&#8203;柄・&#8203;特&#8203;徴&#8203;量&#8203;か&#8203;ら&#8203;週&#8203;次&#8203;で&#8203;予&#8203;測&#8203;結&#8203;果&#8203;を&#8203;提&#8203;出</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://numer.ai/" class="bare">https://numer.ai/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quantconnect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">条&#8203;件&#8203;を&#8203;満&#8203;た&#8203;し&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;追&#8203;求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.quantconnect.com/competitions" class="bare">https://www.quantconnect.com/competitions</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bloomberg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESG&#8203;要&#8203;素&#8203;を&#8203;効&#8203;果&#8203;的&#8203;に&#8203;投&#8203;資&#8203;判&#8203;断&#8203;に&#8203;組&#8203;み&#8203;込&#8203;ん&#8203;で&#8203;い&#8203;る&#8203;か&#8203;な&#8203;ど&#8203;の&#8203;評&#8203;価</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.bloomberg.co.jp/company/stories/investment_contest_2020/" class="bare">https://www.bloomberg.co.jp/company/stories/investment_contest_2020/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jane Street Market Prediction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">株&#8203;の&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;を&#8203;採&#8203;用&#8203;す&#8203;る&#8203;か&#8203;ど&#8203;う&#8203;か&#8203;を&#8203;予&#8203;測</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.kaggle.com/c/jane-street-market-prediction/" class="bare">https://www.kaggle.com/c/jane-street-market-prediction/</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_ファンダメンタルズ分析の活用方法">7.6. ファンダメンタルズ分析の活用方法</h3>
<div class="paragraph">
<p>ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;ズ&#8203;分&#8203;析&#8203;と&#8203;は、&#8203;企&#8203;業&#8203;の&#8203;成&#8203;長&#8203;性、&#8203;収&#8203;益&#8203;性、&#8203;割&#8203;安&#8203;性、&#8203;安&#8203;定&#8203;性、&#8203;効&#8203;率&#8203;性&#8203;な&#8203;ど&#8203;を&#8203;分&#8203;析&#8203;し、&#8203;投&#8203;資&#8203;判&#8203;断&#8203;な&#8203;ど&#8203;に&#8203;活&#8203;用&#8203;す&#8203;る&#8203;手&#8203;法&#8203;で&#8203;す。&#8203;こ&#8203;こ&#8203;で&#8203;は&#8203;成&#8203;長&#8203;性、&#8203;収&#8203;益&#8203;性、&#8203;割&#8203;安&#8203;性、&#8203;安&#8203;定&#8203;性、&#8203;効&#8203;率&#8203;性&#8203;の&#8203;代&#8203;表&#8203;的&#8203;な&#8203;指&#8203;標&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>（<strong>&#8203;成&#8203;長&#8203;性&#8203;</strong>）&#8203;<br>
成&#8203;長&#8203;性&#8203;と&#8203;は、&#8203;売&#8203;上&#8203;や&#8203;利&#8203;益&#8203;の&#8203;増&#8203;加&#8203;が&#8203;継&#8203;続&#8203;し&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;指&#8203;し、&#8203;企&#8203;業&#8203;価&#8203;値&#8203;の&#8203;増&#8203;大&#8203;に&#8203;直&#8203;結&#8203;す&#8203;る&#8203;指&#8203;標&#8203;で&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;の&#8203;デー&#8203;タ&#8203;で&#8203;は、&#8203;純&#8203;資&#8203;産&#8203;や&#8203;営&#8203;業&#8203;利&#8203;益&#8203;の&#8203;上&#8203;昇&#8203;率&#8203;に&#8203;着&#8203;目&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;そ&#8203;の&#8203;銘&#8203;柄&#8203;の&#8203;成&#8203;長&#8203;性&#8203;を&#8203;測&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;出&#8203;来&#8203;ま&#8203;す。&#8203;営&#8203;業&#8203;利&#8203;益&#8203;の&#8203;上&#8203;昇&#8203;率&#8203;を&#8203;計&#8203;算&#8203;す&#8203;る&#8203;場&#8203;合&#8203;は、&#8203;季&#8203;節&#8203;性&#8203;を&#8203;考&#8203;慮&#8203;し、&#8203;前&#8203;年&#8203;同&#8203;期&#8203;比&#8203;と&#8203;比&#8203;較&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;多&#8203;い&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>ま&#8203;た、&#8203;年&#8203;間&#8203;を&#8203;通&#8203;し&#8203;て&#8203;同&#8203;一&#8203;の&#8203;指&#8203;標&#8203;で&#8203;評&#8203;価&#8203;を&#8203;行&#8203;い&#8203;た&#8203;い&#8203;と&#8203;き&#8203;は、&#8203;直&#8203;近&#8203;の&#8203;四&#8203;半&#8203;期&#8203;の&#8203;デー&#8203;タ&#8203;で&#8203;移&#8203;動&#8203;平&#8203;均&#8203;な&#8203;ど&#8203;を&#8203;取&#8203;る&#8203;方&#8203;法&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;成&#8203;長&#8203;性&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;利&#8203;用&#8203;さ&#8203;れ&#8203;る&#8203;様々&#8203;な&#8203;指&#8203;標&#8203;と&#8203;し&#8203;て&#8203;売&#8203;上&#8203;高&#8203;増&#8203;加&#8203;率、&#8203;営&#8203;業&#8203;利&#8203;益&#8203;増&#8203;加&#8203;率、&#8203;経&#8203;常&#8203;利&#8203;益&#8203;増&#8203;加&#8203;率、&#8203;総&#8203;資&#8203;本&#8203;増&#8203;加&#8203;率、&#8203;純&#8203;資&#8203;本&#8203;増&#8203;加&#8203;率、&#8203;従&#8203;業&#8203;員&#8203;増&#8203;加&#8203;率、&#8203;一&#8203;株&#8203;当&#8203;た&#8203;り&#8203;当&#8203;期&#8203;純&#8203;利&#8203;益&#8203;（EPS）&#8203;(&#8203;成&#8203;長&#8203;性&#8203;分&#8203;析&#8203;で&#8203;企&#8203;業&#8203;の&#8203;成&#8203;長&#8203;度&#8203;を&#8203;測&#8203;る&#8203; &#8203;知っ&#8203;て&#8203;お&#8203;く&#8203;べ&#8203;き&#8203;指&#8203;標&#8203;や&#8203;分&#8203;析&#8203;方&#8203;法&#8203; &#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://keiei.freee.co.jp/articles/c0201686" class="bare">https://keiei.freee.co.jp/articles/c0201686</a> )&#8203;な&#8203;ど&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>な&#8203;お、&#8203;過&#8203;去&#8203;の&#8203;成&#8203;長&#8203;性&#8203;を&#8203;解&#8203;析&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;で&#8203;き&#8203;ま&#8203;す&#8203;が、&#8203;そ&#8203;の&#8203;成&#8203;長&#8203;性&#8203;が&#8203;長&#8203;期&#8203;間&#8203;に&#8203;渡っ&#8203;て&#8203;継&#8203;続&#8203;す&#8203;る&#8203;か&#8203;を&#8203;予&#8203;測&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;は、&#8203;様々&#8203;な&#8203;要&#8203;因&#8203;が&#8203;関&#8203;係&#8203;す&#8203;る&#8203;た&#8203;め&#8203;難&#8203;し&#8203;い&#8203;問&#8203;題&#8203;で&#8203;す。&#8203;ま&#8203;た、&#8203;株&#8203;価&#8203;そ&#8203;の&#8203;も&#8203;の&#8203;で&#8203;は&#8203;な&#8203;く&#8203;成&#8203;長&#8203;性&#8203;自&#8203;体&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;予&#8203;測&#8203;対&#8203;象&#8203;に&#8203;し&#8203;て、&#8203;そ&#8203;の&#8203;予&#8203;測&#8203;に&#8203;基&#8203;づ&#8203;き&#8203;投&#8203;資&#8203;を&#8203;行&#8203;う&#8203;ス&#8203;タ&#8203;イ&#8203;ル&#8203;も&#8203;存&#8203;在&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>（<strong>&#8203;収&#8203;益&#8203;性&#8203;</strong>）&#8203;<br>
収&#8203;益&#8203;性&#8203;は、&#8203;営&#8203;業&#8203;利&#8203;益&#8203;率&#8203;や&#8203;経&#8203;常&#8203;利&#8203;益&#8203;率&#8203;等&#8203;を&#8203;指&#8203;し、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;営&#8203;業&#8203;利&#8203;益、&#8203;経&#8203;常&#8203;利&#8203;益&#8203;を&#8203;売&#8203;上&#8203;高&#8203;で&#8203;割&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;計&#8203;算&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;営&#8203;業&#8203;利&#8203;益&#8203;率&#8203;や&#8203;経&#8203;常&#8203;利&#8203;益&#8203;率&#8203;が&#8203;高&#8203;い&#8203;企&#8203;業&#8203;は&#8203;優&#8203;れ&#8203;た&#8203;ビ&#8203;ジ&#8203;ネ&#8203;ス&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;保&#8203;持&#8203;し&#8203;て&#8203;い&#8203;た&#8203;り、&#8203;販&#8203;管&#8203;費&#8203;を&#8203;低&#8203;く&#8203;保&#8203;つ&#8203;オ&#8203;ペ&#8203;レー&#8203;ショ&#8203;ン&#8203;が&#8203;徹&#8203;底&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;た&#8203;り&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;多&#8203;く、&#8203;優&#8203;良&#8203;企&#8203;業&#8203;を&#8203;判&#8203;断&#8203;す&#8203;る&#8203;上&#8203;で&#8203;の&#8203;指&#8203;標&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;そ&#8203;し&#8203;て、&#8203;こ&#8203;の&#8203;収&#8203;益&#8203;性&#8203;の&#8203;変&#8203;化&#8203;率&#8203;を&#8203;成&#8203;長&#8203;性&#8203;と&#8203;扱&#8203;う&#8203;こ&#8203;と&#8203;も&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>一&#8203;般&#8203;的&#8203;に&#8203;投&#8203;資&#8203;家&#8203;が&#8203;期&#8203;待&#8203;す&#8203;る&#8203;収&#8203;益&#8203;性&#8203;は、&#8203;業&#8203;種&#8203;に&#8203;お&#8203;い&#8203;て&#8203;大&#8203;き&#8203;く&#8203;異&#8203;な&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;注&#8203;意&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。&#8203;<br>
例&#8203;え&#8203;ば、&#8203;様々&#8203;あ&#8203;る&#8203;業&#8203;種&#8203;の&#8203;う&#8203;ち、&#8203;情&#8203;報&#8203;通&#8203;信&#8203;と&#8203;食&#8203;品&#8203;に&#8203;期&#8203;待&#8203;さ&#8203;れ&#8203;る&#8203;営&#8203;業&#8203;利&#8203;益&#8203;率&#8203;は&#8203;大&#8203;き&#8203;く&#8203;異&#8203;な&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;想&#8203;定&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;場&#8203;合、&#8203;銘&#8203;柄&#8203;情&#8203;報&#8203;に&#8203;は&#8203;セ&#8203;ク&#8203;ター&#8203;情&#8203;報&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;セ&#8203;ク&#8203;ター&#8203;平&#8203;均&#8203;の&#8203;営&#8203;業&#8203;利&#8203;益&#8203;率&#8203;を&#8203;計&#8203;算&#8203;し、&#8203;そ&#8203;の&#8203;差&#8203;分&#8203;を&#8203;計&#8203;算&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;セ&#8203;ク&#8203;ター&#8203;平&#8203;均&#8203;か&#8203;ら&#8203;の&#8203;上&#8203;振&#8203;れ&#8203;や&#8203;下&#8203;振&#8203;れ&#8203;を&#8203;特&#8203;徴&#8203;量&#8203;に&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>（<strong>&#8203;割&#8203;安&#8203;性&#8203;</strong>）&#8203;<br>
株&#8203;式&#8203;が&#8203;割&#8203;安&#8203;で&#8203;あ&#8203;る&#8203;と&#8203;は、&#8203;そ&#8203;の&#8203;企&#8203;業&#8203;の&#8203;株&#8203;価&#8203;が&#8203;企&#8203;業&#8203;価&#8203;値&#8203;と&#8203;比&#8203;較&#8203;し&#8203;て&#8203;安&#8203;い&#8203;と&#8203;い&#8203;う&#8203;こ&#8203;と&#8203;で&#8203;す。&#8203;代&#8203;表&#8203;的&#8203;な&#8203;指&#8203;標&#8203;と&#8203;し&#8203;て&#8203;は&#8203;PBR&#8203;が&#8203;挙&#8203;げ&#8203;ら&#8203;れ&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;指&#8203;標&#8203;は、&#8203;企&#8203;業&#8203;の&#8203;純&#8203;資&#8203;産&#8203;と&#8203;発&#8203;行&#8203;済&#8203;み&#8203;株&#8203;式&#8203;数&#8203;を&#8203;割っ&#8203;て、&#8203;1&#8203;株&#8203;当&#8203;た&#8203;り&#8203;の&#8203;純&#8203;資&#8203;産&#8203;を&#8203;計&#8203;算&#8203;し&#8203;ま&#8203;す。&#8203;そ&#8203;し&#8203;て、&#8203;現&#8203;在&#8203;の&#8203;株&#8203;価&#8203;を&#8203;こ&#8203;の&#8203;1&#8203;株&#8203;当&#8203;た&#8203;り&#8203;の&#8203;純&#8203;資&#8203;産&#8203;で&#8203;割っ&#8203;て&#8203;PBR&#8203;を&#8203;求&#8203;め&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;指&#8203;標&#8203;が&#8203;1&#8203;を&#8203;割っ&#8203;て&#8203;い&#8203;る&#8203;場&#8203;合&#8203;は、&#8203;そ&#8203;の&#8203;企&#8203;業&#8203;の&#8203;本&#8203;来&#8203;の&#8203;価&#8203;値&#8203;よ&#8203;り&#8203;も&#8203;安&#8203;い&#8203;値&#8203;段&#8203;で&#8203;株&#8203;を&#8203;買&#8203;え&#8203;る&#8203;こ&#8203;と&#8203;に&#8203;な&#8203;る&#8203;の&#8203;で、&#8203;割&#8203;安&#8203;で&#8203;あ&#8203;る&#8203;と&#8203;考&#8203;え&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;PBR&#8203;が&#8203;高&#8203;い&#8203;銘&#8203;柄&#8203;を&#8203;グ&#8203;ロー&#8203;ス&#8203;銘&#8203;柄、&#8203;低&#8203;い&#8203;銘&#8203;柄&#8203;を&#8203;バ&#8203;リュー&#8203;銘&#8203;柄&#8203;と&#8203;し&#8203;て&#8203;扱&#8203;い&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;異&#8203;な&#8203;る&#8203;特&#8203;性&#8203;を&#8203;持っ&#8203;た&#8203;銘&#8203;柄&#8203;と&#8203;し&#8203;て&#8203;分&#8203;析&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;あ&#8203;り、&#8203;企&#8203;業&#8203;の&#8203;状&#8203;態&#8203;を&#8203;知&#8203;る&#8203;上&#8203;で&#8203;重&#8203;要&#8203;な&#8203;指&#8203;標&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>現&#8203;状&#8203;の&#8203;日&#8203;本&#8203;マー&#8203;ケッ&#8203;ト&#8203;に&#8203;お&#8203;い&#8203;て&#8203;は、&#8203;PBR&#8203;が&#8203;1&#8203;未&#8203;満&#8203;の&#8203;銘&#8203;柄&#8203;が&#8203;数&#8203;多&#8203;く&#8203;あ&#8203;り&#8203;ま&#8203;す&#8203;(Yahoo&#8203;ファ&#8203;イ&#8203;ナ&#8203;ン&#8203;ス&#8203; &#8203;低&#8203;PBR&#8203;ラ&#8203;ン&#8203;キ&#8203;ン&#8203;グ&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://info.finance.yahoo.co.jp/ranking/?kd=12" class="bare">https://info.finance.yahoo.co.jp/ranking/?kd=12</a> )。
こ&#8203;れ&#8203;ら&#8203;の&#8203;極&#8203;め&#8203;て&#8203;割&#8203;安&#8203;な&#8203;銘&#8203;柄&#8203;は&#8203;ディー&#8203;プ&#8203;バ&#8203;リュー&#8203;株&#8203;と&#8203;呼&#8203;ば&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;PBR&#8203;が&#8203;低&#8203;い&#8203;理&#8203;由&#8203;と&#8203;し&#8203;て&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;理&#8203;由&#8203;も&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;PBR&#8203;を&#8203;もっ&#8203;て&#8203;一&#8203;概&#8203;に&#8203;割&#8203;安&#8203;銘&#8203;柄&#8203;と&#8203;す&#8203;る&#8203;の&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;各&#8203;企&#8203;業&#8203;の&#8203;そ&#8203;の&#8203;他&#8203;の&#8203;決&#8203;算&#8203;情&#8203;報&#8203;を&#8203;参&#8203;照&#8203;す&#8203;る&#8203;な&#8203;ど、&#8203;複&#8203;数&#8203;の&#8203;情&#8203;報&#8203;を&#8203;考&#8203;慮&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;重&#8203;要&#8203;で&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>株&#8203;式&#8203;市&#8203;場&#8203;全&#8203;体&#8203;が&#8203;調&#8203;整&#8203;局&#8203;面&#8203;に&#8203;あ&#8203;る&#8203;な&#8203;ど&#8203;の&#8203;理&#8203;由&#8203;に&#8203;よ&#8203;り、&#8203;企&#8203;業&#8203;実&#8203;態&#8203;よ&#8203;り&#8203;株&#8203;価&#8203;が&#8203;売&#8203;り&#8203;込&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る。</p>
</li>
<li>
<p>含&#8203;み&#8203;損&#8203;の&#8203;実&#8203;現&#8203;や&#8203;業&#8203;績&#8203;の&#8203;悪&#8203;化&#8203;に&#8203;よ&#8203;る&#8203;純&#8203;資&#8203;産&#8203;の&#8203;減&#8203;少&#8203;を&#8203;株&#8203;価&#8203;が&#8203;先&#8203;取&#8203;り&#8203;し&#8203;て&#8203;織&#8203;り&#8203;込&#8203;ん&#8203;で&#8203;下&#8203;落&#8203;し&#8203;て&#8203;い&#8203;る。</p>
</li>
<li>
<p>不&#8203;人&#8203;気&#8203;の&#8203;た&#8203;め&#8203;安&#8203;値&#8203;に&#8203;放&#8203;置&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>（<strong>&#8203;安&#8203;定&#8203;性&#8203;</strong>）&#8203;<br>
安&#8203;定&#8203;性&#8203;は、&#8203;大&#8203;型&#8203;株&#8203;や&#8203;安&#8203;定&#8203;性&#8203;が&#8203;重&#8203;視&#8203;さ&#8203;れ&#8203;る&#8203;金&#8203;融・&#8203;銀&#8203;行&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;特&#8203;定&#8203;の&#8203;セ&#8203;ク&#8203;ター&#8203;で&#8203;重&#8203;視&#8203;さ&#8203;れ&#8203;る&#8203;指&#8203;標&#8203;で&#8203;す。&#8203;安&#8203;定&#8203;性&#8203;を&#8203;計&#8203;算&#8203;す&#8203;る&#8203;代&#8203;表&#8203;的&#8203;な&#8203;指&#8203;標&#8203;は&#8203;「自&#8203;己&#8203;資&#8203;本&#8203;比&#8203;率」&#8203;で&#8203;す。&#8203;<br>
「自&#8203;己&#8203;資&#8203;本&#8203;比&#8203;率」&#8203;は&#8203;総&#8203;資&#8203;本&#8203;に&#8203;お&#8203;け&#8203;る&#8203;自&#8203;己&#8203;資&#8203;本&#8203;の&#8203;割&#8203;合&#8203;を&#8203;計&#8203;算&#8203;し&#8203;て&#8203;得&#8203;ら&#8203;れ&#8203;ま&#8203;す。&#8203;自&#8203;己&#8203;資&#8203;本&#8203;比&#8203;率&#8203;が&#8203;高&#8203;け&#8203;れ&#8203;ば、&#8203;自&#8203;己&#8203;資&#8203;本&#8203;が&#8203;多&#8203;い、&#8203;つ&#8203;ま&#8203;り&#8203;返&#8203;済&#8203;義&#8203;務&#8203;の&#8203;な&#8203;い&#8203;お&#8203;金&#8203;を&#8203;潤&#8203;沢&#8203;に&#8203;持っ&#8203;て&#8203;い&#8203;る&#8203;と&#8203;い&#8203;う&#8203;こ&#8203;と&#8203;に&#8203;な&#8203;る&#8203;の&#8203;で&#8203;「中&#8203;長&#8203;期&#8203;的&#8203;に&#8203;見&#8203;て&#8203;倒&#8203;産&#8203;し&#8203;に&#8203;く&#8203;い&#8203;会&#8203;社」&#8203;と&#8203;い&#8203;う&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き、&#8203;株&#8203;式&#8203;の&#8203;中&#8203;長&#8203;期&#8203;保&#8203;有&#8203;を&#8203;行&#8203;う&#8203;上&#8203;で&#8203;倒&#8203;産&#8203;リ&#8203;ス&#8203;ク&#8203;を&#8203;減&#8203;ら&#8203;す&#8203;た&#8203;め&#8203;の&#8203;重&#8203;要&#8203;な&#8203;チェッ&#8203;ク&#8203;ポ&#8203;イ&#8203;ン&#8203;ト&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;(&#8203;自&#8203;己&#8203;資&#8203;本&#8203;比&#8203;率&#8203;｜&#8203;会&#8203;社&#8203;経&#8203;営&#8203;の&#8203;「安&#8203;全&#8203;性」&#8203;を&#8203;あ&#8203;ら&#8203;わ&#8203;す&#8203;指&#8203;標&#8203; &#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://advisors-freee.jp/article/category/cat-big-03/cat-small-08/9011/" class="bare">https://advisors-freee.jp/article/category/cat-big-03/cat-small-08/9011/</a> )</p>
</div>
<div class="paragraph">
<p>な&#8203;お、&#8203;以&#8203;下&#8203;の&#8203;効&#8203;率&#8203;性&#8203;に&#8203;関&#8203;す&#8203;る&#8203;記&#8203;載&#8203;で&#8203;も&#8203;紹&#8203;介&#8203;し&#8203;て&#8203;い&#8203;る&#8203;ROE&#8203;で&#8203;は、&#8203;当&#8203;期&#8203;純&#8203;利&#8203;益&#8203;と&#8203;自&#8203;己&#8203;資&#8203;本&#8203;の&#8203;割&#8203;合&#8203;を&#8203;見&#8203;ま&#8203;す&#8203;が、&#8203;自&#8203;己&#8203;資&#8203;本&#8203;が&#8203;低&#8203;い&#8203;株&#8203;は&#8203;ROE&#8203;が&#8203;高&#8203;く&#8203;な&#8203;る&#8203;の&#8203;で&#8203;注&#8203;意&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。&#8203;つ&#8203;ま&#8203;り、&#8203;借&#8203;り&#8203;入&#8203;れ&#8203;を&#8203;増&#8203;や&#8203;し&#8203;リ&#8203;ス&#8203;ク&#8203;を&#8203;取っ&#8203;て&#8203;い&#8203;る&#8203;銘&#8203;柄&#8203;で&#8203;は&#8203;ROE&#8203;が&#8203;高&#8203;く&#8203;な&#8203;り&#8203;や&#8203;す&#8203;く、&#8203;安&#8203;定&#8203;性&#8203;が&#8203;低&#8203;く&#8203;な&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;小&#8203;型&#8203;株&#8203;に&#8203;お&#8203;い&#8203;て&#8203;は&#8203;安&#8203;定&#8203;性&#8203;よ&#8203;り&#8203;も&#8203;成&#8203;長&#8203;性&#8203;を&#8203;重&#8203;視&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;あ&#8203;る&#8203;と&#8203;い&#8203;う&#8203;点&#8203;に&#8203;注&#8203;意&#8203;が&#8203;必&#8203;要&#8203;で&#8203;す。&#8203;特&#8203;定&#8203;の&#8203;セ&#8203;ク&#8203;ター&#8203;や&#8203;特&#8203;定&#8203;の&#8203;領&#8203;域&#8203;に&#8203;お&#8203;い&#8203;て&#8203;重&#8203;要&#8203;視&#8203;さ&#8203;れ&#8203;る&#8203;指&#8203;標&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;投&#8203;入&#8203;す&#8203;る&#8203;場&#8203;合、&#8203;セ&#8203;ク&#8203;ター&#8203;の&#8203;情&#8203;報&#8203;を&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;投&#8203;入&#8203;す&#8203;る&#8203;な&#8203;ど、&#8203;一&#8203;緒&#8203;に&#8203;銘&#8203;柄&#8203;を&#8203;分&#8203;類&#8203;で&#8203;き&#8203;る&#8203;情&#8203;報&#8203;を&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;投&#8203;入&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;そ&#8203;れ&#8203;ら&#8203;の&#8203;特&#8203;性&#8203;を&#8203;学&#8203;ば&#8203;せ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;可&#8203;能&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>（<strong>&#8203;効&#8203;率&#8203;性&#8203;</strong>）&#8203;<br>
効&#8203;率&#8203;性&#8203;は、&#8203;近&#8203;年&#8203;注&#8203;目&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;ROE&#8203;や&#8203;ROA&#8203;か&#8203;ら&#8203;計&#8203;算&#8203;さ&#8203;れ&#8203;る&#8203;指&#8203;標&#8203;で&#8203;す。&#8203;<br>
ROE&#8203;は、&#8203;当&#8203;期&#8203;純&#8203;利&#8203;益&#8203; ÷ &#8203;自&#8203;己&#8203;資&#8203;本&#8203; × 100&#8203;と&#8203;し&#8203;て&#8203;計&#8203;算&#8203;さ&#8203;れ、&#8203;自&#8203;己&#8203;資&#8203;本&#8203;に&#8203;対&#8203;し&#8203;て&#8203;ど&#8203;れ&#8203;だ&#8203;け&#8203;の&#8203;利&#8203;益&#8203;が&#8203;生&#8203;み&#8203;出&#8203;さ&#8203;れ&#8203;た&#8203;の&#8203;か&#8203;を&#8203;示&#8203;し&#8203;ま&#8203;す。&#8203;<br>
ROA&#8203;は、&#8203;借&#8203;り&#8203;入&#8203;れ&#8203;な&#8203;ど&#8203;を&#8203;含&#8203;む&#8203;総&#8203;資&#8203;産&#8203;を&#8203;使っ&#8203;て&#8203;ど&#8203;れ&#8203;だ&#8203;け&#8203;利&#8203;益&#8203;を&#8203;生&#8203;み&#8203;出&#8203;し&#8203;た&#8203;か&#8203;を&#8203;表&#8203;す&#8203;指&#8203;標&#8203;で&#8203;す。&#8203;<br>
ROE&#8203;や&#8203;ROA&#8203;は、&#8203;効&#8203;率&#8203;性&#8203;を&#8203;示&#8203;す&#8203;指&#8203;標&#8203;と&#8203;し&#8203;て&#8203;注&#8203;目&#8203;さ&#8203;れ&#8203;て&#8203;お&#8203;り、&#8203;政&#8203;府&#8203;が&#8203;2017&#8203;年&#8203;に&#8203;公&#8203;表&#8203;し&#8203;た&#8203;成&#8203;長&#8203;戦&#8203;略&#8203;「未&#8203;来&#8203;投&#8203;資&#8203;戦&#8203;略&#8203;2017」&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;「《KPI》&#8203;大&#8203;企&#8203;業&#8203;（TOPIX500）&#8203;の&#8203; ROA &#8203;に&#8203;つ&#8203;い&#8203;て、&#8203;2025 &#8203;年&#8203;ま&#8203;で&#8203;に&#8203;欧&#8203;米&#8203;企&#8203;業&#8203;に&#8203;遜&#8203;色&#8203;の&#8203;な&#8203;い&#8203;水&#8203;準&#8203;を&#8203;目&#8203;指&#8203;す。」&#8203;(&#8203;未&#8203;来&#8203;投&#8203;資&#8203;戦&#8203;略&#8203;2017 &#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.kantei.go.jp/jp/singi/keizaisaisei/pdf/miraitousi2017_sisaku.pdf" class="bare">https://www.kantei.go.jp/jp/singi/keizaisaisei/pdf/miraitousi2017_sisaku.pdf</a> )&#8203;と&#8203;い&#8203;う&#8203;KPI&#8203;が&#8203;設&#8203;定&#8203;さ&#8203;れ&#8203;注&#8203;目&#8203;を&#8203;浴&#8203;び&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>ROE&#8203;が&#8203;高&#8203;い&#8203;銘&#8203;柄&#8203;ほ&#8203;ど&#8203;効&#8203;率&#8203;性&#8203;が&#8203;高&#8203;い&#8203;と&#8203;考&#8203;え&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き、&#8203;企&#8203;業&#8203;価&#8203;値&#8203;を&#8203;高&#8203;め&#8203;る&#8203;た&#8203;め&#8203;の&#8203;施&#8203;策&#8203;と&#8203;し&#8203;て&#8203;ROE&#8203;の&#8203;向&#8203;上、&#8203;ま&#8203;た&#8203;は&#8203;維&#8203;持&#8203;を&#8203;目&#8203;標&#8203;と&#8203;す&#8203;る&#8203;企&#8203;業&#8203;が&#8203;多&#8203;く、&#8203;ROE&#8203;重&#8203;視&#8203;の&#8203;流&#8203;れ&#8203;の&#8203;背&#8203;景&#8203;は&#8203;「投&#8203;資&#8203;指&#8203;標&#8203;と&#8203;し&#8203;て&#8203;の&#8203; ROE」&#8203;(<a href="https://www.tr.mufg.jp/houjin/jutaku/pdf/u201503_1.pdf" class="bare">https://www.tr.mufg.jp/houjin/jutaku/pdf/u201503_1.pdf</a>) &#8203;で&#8203;詳&#8203;し&#8203;く&#8203;解&#8203;説&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>上&#8203;記&#8203;の&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;提&#8203;供&#8203;さ&#8203;れ&#8203;る&#8203;デー&#8203;タ&#8203;で&#8203;計&#8203;算&#8203;可&#8203;能&#8203;で&#8203;す&#8203;の&#8203;で、&#8203;様々&#8203;な&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;情&#8203;報&#8203;を&#8203;勉&#8203;強&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;は、&#8203;特&#8203;徴&#8203;量&#8203;設&#8203;計&#8203;の&#8203;次&#8203;の&#8203;一&#8203;歩&#8203;に&#8203;繋&#8203;が&#8203;る&#8203;で&#8203;しょ&#8203;う。</p>
</div>
</div>
<div class="sect2">
<h3 id="_テクニカル分析の活用方法">7.7. テクニカル分析の活用方法</h3>
<div class="paragraph">
<p>テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;は、&#8203;将&#8203;来&#8203;の&#8203;株&#8203;価&#8203;の&#8203;変&#8203;化&#8203;を&#8203;過&#8203;去&#8203;に&#8203;発&#8203;生&#8203;し&#8203;た&#8203;価&#8203;格&#8203;や&#8203;出&#8203;来&#8203;高&#8203;等&#8203;の&#8203;時&#8203;系&#8203;列&#8203;パ&#8203;ター&#8203;ン&#8203;か&#8203;ら&#8203;予&#8203;想・&#8203;分&#8203;析&#8203;し&#8203;よ&#8203;う&#8203;と&#8203;す&#8203;る&#8203;手&#8203;法&#8203;で&#8203;あ&#8203;り、&#8203;メ&#8203;ジャー&#8203;な&#8203;分&#8203;析&#8203;手&#8203;法&#8203;の&#8203;一&#8203;つ&#8203;で&#8203;す。&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;に&#8203;は&#8203;ト&#8203;レ&#8203;ン&#8203;ド&#8203;分&#8203;析、&#8203;オ&#8203;シ&#8203;レー&#8203;ター&#8203;分&#8203;析、&#8203;フォー&#8203;メー&#8203;ショ&#8203;ン&#8203;分&#8203;析、&#8203;ロー&#8203;ソ&#8203;ク&#8203;足&#8203;分&#8203;析&#8203;(&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;指&#8203;標&#8203;一&#8203;覧&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://info.monex.co.jp/technical-analysis/indicators/" class="bare">https://info.monex.co.jp/technical-analysis/indicators/</a> )&#8203;が&#8203;あ&#8203;り、&#8203;2&#8203;章&#8203;に&#8203;お&#8203;い&#8203;て&#8203;も&#8203;オ&#8203;シ&#8203;レー&#8203;ター&#8203;の&#8203;代&#8203;表&#8203;的&#8203;な&#8203;分&#8203;析&#8203;手&#8203;法&#8203;の&#8203;一&#8203;つ&#8203;で&#8203;あ&#8203;る&#8203;「移&#8203;動&#8203;平&#8203;均&#8203;乖&#8203;離&#8203;率」&#8203;を&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;一&#8203;つ&#8203;と&#8203;し&#8203;て&#8203;採&#8203;用&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は、&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;を&#8203;更&#8203;に&#8203;活&#8203;用&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;注&#8203;意&#8203;事&#8203;項&#8203;を&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;を&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;採&#8203;用&#8203;す&#8203;る&#8203;場&#8203;合、&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;に&#8203;よ&#8203;り&#8203;得&#8203;た&#8203;新&#8203;規&#8203;の&#8203;情&#8203;報&#8203;が&#8203;す&#8203;で&#8203;に&#8203;投&#8203;入&#8203;済&#8203;み&#8203;の&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;比&#8203;較&#8203;し&#8203;て、&#8203;ど&#8203;の&#8203;程&#8203;度&#8203;新&#8203;し&#8203;い&#8203;情&#8203;報&#8203;を&#8203;保&#8203;持&#8203;し&#8203;て&#8203;い&#8203;る&#8203;か、&#8203;と&#8203;い&#8203;う&#8203;観&#8203;点&#8203;か&#8203;ら&#8203;考&#8203;え&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;重&#8203;要&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>例&#8203;え&#8203;ば、&#8203;移&#8203;動&#8203;平&#8203;均&#8203;と&#8203;移&#8203;動&#8203;平&#8203;均&#8203;乖&#8203;離&#8203;率&#8203;は、&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;似&#8203;た&#8203;よ&#8203;う&#8203;な&#8203;情&#8203;報&#8203;を&#8203;保&#8203;持&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;容&#8203;易&#8203;に&#8203;想&#8203;像&#8203;が&#8203;つ&#8203;き&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;情&#8203;報&#8203;を&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;考&#8203;え&#8203;た&#8203;場&#8203;合、&#8203;「20&#8203;日&#8203;移&#8203;動&#8203;平&#8203;均&#8203;乖&#8203;離&#8203;率」&#8203;の&#8203;方&#8203;が&#8203;0&#8203;平&#8203;均&#8203;と&#8203;な&#8203;る&#8203;た&#8203;め、&#8203;定&#8203;常&#8203;性&#8203;を&#8203;仮&#8203;定&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き、&#8203;扱&#8203;い&#8203;や&#8203;す&#8203;い&#8203;こ&#8203;と&#8203;か&#8203;ら&#8203;移&#8203;動&#8203;平&#8203;均&#8203;乖&#8203;離&#8203;率&#8203;を&#8203;2&#8203;章&#8203;で&#8203;は&#8203;採&#8203;用&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;<br>
ス&#8203;ト&#8203;キャ&#8203;ス&#8203;ティ&#8203;ク&#8203;ス&#8203;(&#8203;詳&#8203;細&#8203;は&#8203; <a href="https://info.monex.co.jp/technical-analysis/indicators/006.html" class="bare">https://info.monex.co.jp/technical-analysis/indicators/006.html</a> &#8203;を&#8203;参&#8203;照&#8203;)&#8203;や&#8203;RSI(&#8203;詳&#8203;細&#8203;は&#8203; <a href="https://info.monex.co.jp/technical-analysis/indicators/005.html" class="bare">https://info.monex.co.jp/technical-analysis/indicators/005.html</a> &#8203;を&#8203;参&#8203;照&#8203;)&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;オ&#8203;シ&#8203;レー&#8203;ター&#8203;系&#8203;の&#8203;分&#8203;析&#8203;も、&#8203;似&#8203;通っ&#8203;た&#8203;情&#8203;報&#8203;を&#8203;保&#8203;持&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;推&#8203;測&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>機&#8203;械&#8203;学&#8203;習&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;構&#8203;築&#8203;に&#8203;お&#8203;い&#8203;て、&#8203;若&#8203;干&#8203;の&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203;を&#8203;変&#8203;更&#8203;し&#8203;た&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;を&#8203;複&#8203;数&#8203;個&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;投&#8203;入&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;は、&#8203;ほ&#8203;と&#8203;ん&#8203;ど&#8203;の&#8203;場&#8203;合&#8203;良&#8203;い&#8203;結&#8203;果&#8203;に&#8203;結&#8203;び&#8203;つ&#8203;き&#8203;ま&#8203;せ&#8203;ん。&#8203;こ&#8203;れ&#8203;は、&#8203;パ&#8203;ラ&#8203;メー&#8203;タ&#8203;違&#8203;い&#8203;の&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;や&#8203;同&#8203;一&#8203;種&#8203;類&#8203;の&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;は、&#8203;ほ&#8203;ぼ&#8203;同&#8203;一&#8203;の&#8203;情&#8203;報&#8203;を&#8203;保&#8203;持&#8203;し&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;多&#8203;く、&#8203;複&#8203;数&#8203;個&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;投&#8203;入&#8203;し&#8203;た&#8203;と&#8203;し&#8203;て&#8203;も、&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;が&#8203;向&#8203;上&#8203;す&#8203;る&#8203;程&#8203;の&#8203;新&#8203;規&#8203;の&#8203;情&#8203;報&#8203;を&#8203;発&#8203;見&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;難&#8203;し&#8203;い&#8203;た&#8203;め&#8203;で&#8203;す。&#8203;ま&#8203;た、&#8203;時&#8203;系&#8203;列&#8203;解&#8203;析&#8203;は&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;数&#8203;が&#8203;限&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;多&#8203;く、&#8203;特&#8203;徴&#8203;量&#8203;の&#8203;種&#8203;類&#8203;を&#8203;多&#8203;く&#8203;す&#8203;る&#8203;と&#8203;学&#8203;習&#8203;に&#8203;必&#8203;要&#8203;な&#8203;十&#8203;分&#8203;な&#8203;デー&#8203;タ&#8203;量&#8203;を&#8203;確&#8203;保&#8203;で&#8203;き&#8203;な&#8203;い&#8203;た&#8203;め、&#8203;む&#8203;や&#8203;み&#8203;に&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;増&#8203;や&#8203;す&#8203;べ&#8203;き&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;特&#8203;徴&#8203;量&#8203;自&#8203;体&#8203;に&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;向&#8203;上&#8203;に&#8203;結&#8203;び&#8203;つ&#8203;く&#8203;新&#8203;し&#8203;い&#8203;情&#8203;報&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;重&#8203;視&#8203;し&#8203;ま&#8203;しょ&#8203;う。</p>
</div>
<div class="paragraph">
<p>例&#8203;え&#8203;ば、&#8203;2&#8203;章&#8203;に&#8203;あ&#8203;る&#8203;よ&#8203;う&#8203;な&#8203;移&#8203;動&#8203;平&#8203;均&#8203;乖&#8203;離&#8203;率&#8203;と&#8203;標&#8203;準&#8203;偏&#8203;差&#8203;の&#8203;組&#8203;み&#8203;合&#8203;わ&#8203;せ&#8203;は、&#8203;お&#8203;互&#8203;い&#8203;に&#8203;直&#8203;近&#8203;時&#8203;系&#8203;列&#8203;に&#8203;対&#8203;し&#8203;て&#8203;ト&#8203;レ&#8203;ン&#8203;ド&#8203;と&#8203;ボ&#8203;ラ&#8203;ティ&#8203;リ&#8203;ティ&#8203;と&#8203;い&#8203;う&#8203;異&#8203;な&#8203;る&#8203;情&#8203;報&#8203;を&#8203;保&#8203;持&#8203;し&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め、&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;向&#8203;上&#8203;に&#8203;期&#8203;待&#8203;が&#8203;持&#8203;て&#8203;ま&#8203;す。&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;分&#8203;析&#8203;は&#8203;順&#8203;張&#8203;り&#8203;系、&#8203;逆&#8203;張&#8203;り&#8203;系&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;系&#8203;統&#8203;で&#8203;く&#8203;く&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る&#8203;(&#8203;第&#8203;1&#8203;回&#8203; &#8203;数&#8203;多&#8203;く&#8203;あ&#8203;る&#8203;テ&#8203;ク&#8203;ニ&#8203;カ&#8203;ル&#8203;指&#8203;標&#8203;を&#8203;体&#8203;系&#8203;的&#8203;に&#8203;解&#8203;説&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://kabu.com/investment/guide/technical/01.html" class="bare">https://kabu.com/investment/guide/technical/01.html</a> )&#8203;の&#8203;で、&#8203;そ&#8203;れ&#8203;ら&#8203;の&#8203;系&#8203;統&#8203;の&#8203;中&#8203;か&#8203;ら&#8203;選&#8203;択&#8203;し&#8203;た&#8203;り、&#8203;異&#8203;な&#8203;る&#8203;系&#8203;統&#8203;と&#8203;し&#8203;て&#8203;時&#8203;間&#8203;時&#8203;系&#8203;列&#8203;に&#8203;対&#8203;し&#8203;て&#8203;依&#8203;存&#8203;し&#8203;な&#8203;い&#8203;手&#8203;法、&#8203;例&#8203;え&#8203;ば、&#8203;過&#8203;去&#8203;の&#8203;高&#8203;値&#8203;圏&#8203;に&#8203;ど&#8203;れ&#8203;だ&#8203;け&#8203;近&#8203;づ&#8203;い&#8203;て&#8203;い&#8203;る&#8203;か&#8203;を&#8203;計&#8203;算&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;な&#8203;方&#8203;法&#8203;な&#8203;ど&#8203;も&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect2">
<h3 id="_ファクター分析の活用方法">7.8. ファクター分析の活用方法</h3>
<div class="paragraph">
<p>ファ&#8203;ク&#8203;ター&#8203;分&#8203;析&#8203;と&#8203;は、&#8203;投&#8203;資&#8203;が&#8203;産&#8203;み&#8203;出&#8203;す&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;説&#8203;明&#8203;す&#8203;る&#8203;ファ&#8203;ク&#8203;ター&#8203;を&#8203;定&#8203;義&#8203;し、&#8203;そ&#8203;の&#8203;ファ&#8203;ク&#8203;ター&#8203;の&#8203;挙&#8203;動&#8203;か&#8203;ら&#8203;分&#8203;析&#8203;を&#8203;行&#8203;う&#8203;手&#8203;法&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>例&#8203;え&#8203;ば、&#8203;ファー&#8203;マ&#8203;-&#8203;フ&#8203;レ&#8203;ン&#8203;チ&#8203;の&#8203;3&#8203;ファ&#8203;ク&#8203;ター&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;は、&#8203;株&#8203;式&#8203;投&#8203;資&#8203;が&#8203;産&#8203;み&#8203;出&#8203;す&#8203;リ&#8203;ター&#8203;ン&#8203;を&#8203;リ&#8203;ス&#8203;ク&#8203;プ&#8203;レ&#8203;ミ&#8203;ア&#8203;ム、&#8203;時&#8203;価&#8203;総&#8203;額&#8203;リ&#8203;ス&#8203;ク&#8203;ファ&#8203;ク&#8203;ター、&#8203;簿&#8203;価&#8203;時&#8203;価&#8203;比&#8203;率&#8203;リ&#8203;ス&#8203;ク&#8203;ファ&#8203;ク&#8203;ター&#8203;の&#8203;3&#8203;要&#8203;素&#8203;に&#8203;分&#8203;解&#8203;し&#8203;て&#8203;ま&#8203;す。&#8203;(Wikipedia &#8203;ファー&#8203;マ&#8203;-&#8203;フ&#8203;レ&#8203;ン&#8203;チ&#8203;の&#8203;3&#8203;ファ&#8203;ク&#8203;ター&#8203;モ&#8203;デ&#8203;ル&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://ja.wikipedia.org/wiki/%E3%83%95%E3%82%A1%E3%83%BC%E3%83%9E-%E3%83%95%E3%83%AC%E3%83%B3%E3%83%81%E3%81%AE3%E3%83%95%E3%82%A1%E3%82%AF%E3%82%BF%E3%83%BC%E3%83%A2%E3%83%87%E3%83%AB" class="bare">https://ja.wikipedia.org/wiki/%E3%83%95%E3%82%A1%E3%83%BC%E3%83%9E-%E3%83%95%E3%83%AC%E3%83%B3%E3%83%81%E3%81%AE3%E3%83%95%E3%82%A1%E3%82%AF%E3%82%BF%E3%83%BC%E3%83%A2%E3%83%87%E3%83%AB</a> )</p>
</div>
<div class="paragraph">
<p>株&#8203;式&#8203;投&#8203;資&#8203;に&#8203;お&#8203;け&#8203;る&#8203;ファ&#8203;ク&#8203;ター&#8203;分&#8203;析&#8203;を&#8203;知っ&#8203;て&#8203;お&#8203;く&#8203;こ&#8203;と&#8203;は、&#8203;ど&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;設&#8203;計&#8203;す&#8203;る&#8203;か&#8203;と&#8203;い&#8203;う&#8203;考&#8203;察&#8203;を&#8203;行&#8203;う&#8203;た&#8203;め&#8203;に&#8203;役&#8203;立&#8203;ち&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>例&#8203;え&#8203;ば、&#8203;主&#8203;要&#8203;な&#8203;ファ&#8203;ク&#8203;ター&#8203;で&#8203;あ&#8203;る&#8203;時&#8203;価&#8203;総&#8203;額&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;考&#8203;え&#8203;て&#8203;み&#8203;ま&#8203;しょ&#8203;う。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;で&#8203;利&#8203;用&#8203;で&#8203;き&#8203;る&#8203;デー&#8203;タ&#8203;を&#8203;利&#8203;用&#8203;し、&#8203;株&#8203;価&#8203;と&#8203;発&#8203;行&#8203;済&#8203;株&#8203;式&#8203;数&#8203;か&#8203;ら&#8203;各&#8203;銘&#8203;柄&#8203;の&#8203;時&#8203;価&#8203;総&#8203;額&#8203;を&#8203;計&#8203;算&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;一&#8203;般&#8203;的&#8203;に&#8203;マー&#8203;ケッ&#8203;ト&#8203;は&#8203;小&#8203;型&#8203;株&#8203;が&#8203;優&#8203;位&#8203;な&#8203;と&#8203;き&#8203;も&#8203;あ&#8203;れ&#8203;ば、&#8203;大&#8203;型&#8203;株&#8203;が&#8203;優&#8203;位&#8203;な&#8203;と&#8203;き&#8203;も&#8203;あ&#8203;る&#8203;た&#8203;め、&#8203;ど&#8203;ち&#8203;ら&#8203;に&#8203;投&#8203;資&#8203;す&#8203;る&#8203;べ&#8203;き&#8203;か&#8203;を&#8203;簡&#8203;単&#8203;に&#8203;決&#8203;め&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;で&#8203;き&#8203;ま&#8203;せ&#8203;ん。&#8203;し&#8203;か&#8203;し、&#8203;こ&#8203;の&#8203;時&#8203;価&#8203;総&#8203;額&#8203;が&#8203;株&#8203;価&#8203;の&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;説&#8203;明&#8203;要&#8203;因&#8203;の&#8203;一&#8203;つ&#8203;で&#8203;あ&#8203;る&#8203;と&#8203;い&#8203;う&#8203;こ&#8203;と&#8203;を&#8203;知っ&#8203;て&#8203;い&#8203;れ&#8203;ば、&#8203;少&#8203;な&#8203;く&#8203;と&#8203;も&#8203;特&#8203;徴&#8203;量&#8203;に&#8203;追&#8203;加&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;何&#8203;ら&#8203;か&#8203;の&#8203;学&#8203;習&#8203;を&#8203;行&#8203;え&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;る&#8203;の&#8203;で&#8203;は&#8203;と&#8203;考&#8203;え&#8203;る&#8203;事&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;時&#8203;価&#8203;総&#8203;額&#8203;が&#8203;入&#8203;力&#8203;デー&#8203;タ&#8203;に&#8203;含&#8203;ま&#8203;れ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;場&#8203;合、&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203;時&#8203;価&#8203;総&#8203;額&#8203;ファ&#8203;ク&#8203;ター&#8203;に&#8203;関&#8203;連&#8203;し&#8203;た&#8203;相&#8203;場&#8203;変&#8203;動&#8203;を&#8203;理&#8203;解&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;難&#8203;し&#8203;く&#8203;な&#8203;り&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;特&#8203;徴&#8203;量&#8203;と&#8203;し&#8203;て&#8203;投&#8203;入&#8203;し&#8203;た&#8203;ほ&#8203;う&#8203;が&#8203;良&#8203;さ&#8203;そ&#8203;う&#8203;だ&#8203;と&#8203;い&#8203;う&#8203;こ&#8203;と&#8203;が&#8203;推&#8203;測&#8203;さ&#8203;れ&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>ま&#8203;た、&#8203;近&#8203;年&#8203;新&#8203;た&#8203;な&#8203;投&#8203;資&#8203;手&#8203;法&#8203;と&#8203;し&#8203;て&#8203;現&#8203;れ&#8203;た&#8203;ス&#8203;マー&#8203;ト&#8203;ベー&#8203;タ&#8203;投&#8203;資&#8203;も、&#8203;こ&#8203;の&#8203;ファ&#8203;ク&#8203;ター&#8203;分&#8203;析&#8203;を&#8203;利&#8203;用&#8203;し&#8203;た&#8203;ア&#8203;プ&#8203;ロー&#8203;チ&#8203;の&#8203;一&#8203;つ&#8203;で&#8203;あ&#8203;り、&#8203;ファ&#8203;ク&#8203;ター&#8203;分&#8203;析&#8203;は&#8203;新&#8203;し&#8203;い&#8203;投&#8203;資&#8203;手&#8203;法&#8203;を&#8203;考&#8203;え&#8203;る&#8203;上&#8203;で、&#8203;基&#8203;礎&#8203;知&#8203;識&#8203;の&#8203;一&#8203;つ&#8203;に&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;ス&#8203;マー&#8203;ト&#8203;ベー&#8203;タ&#8203;投&#8203;資&#8203;と&#8203;は、&#8203;特&#8203;定&#8203;の&#8203;ファ&#8203;ク&#8203;ター&#8203;を&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;と&#8203;し&#8203;て&#8203;制&#8203;御&#8203;す&#8203;る&#8203;手&#8203;法&#8203;で&#8203;す。&#8203;具&#8203;体&#8203;的&#8203;に&#8203;は、&#8203;高&#8203;配&#8203;当、&#8203;バ&#8203;リュー、&#8203;低&#8203;リ&#8203;ス&#8203;ク、&#8203;最&#8203;小&#8203;分&#8203;散、&#8203;ク&#8203;オ&#8203;リ&#8203;ティ、&#8203;モ&#8203;メ&#8203;ン&#8203;タ&#8203;ム、&#8203;及&#8203;び&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;組&#8203;み&#8203;合&#8203;わ&#8203;せ&#8203;等&#8203;が、&#8203;ベ&#8203;ン&#8203;チ&#8203;マー&#8203;ク&#8203;と&#8203;し&#8203;て&#8203;制&#8203;御&#8203;す&#8203;る&#8203;ファ&#8203;ク&#8203;ター&#8203;の&#8203;候&#8203;補&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;(&#8203;ス&#8203;マー&#8203;ト&#8203;ベー&#8203;タ&#8203;と&#8203;リ&#8203;ター&#8203;ン&#8203;特&#8203;性&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://www.mizuho-ir.co.jp/publication/report/2020/fe36.html" class="bare">https://www.mizuho-ir.co.jp/publication/report/2020/fe36.html</a> )。</p>
</div>
<div class="paragraph">
<p>ファ&#8203;ク&#8203;ター&#8203;分&#8203;析&#8203;で&#8203;扱&#8203;わ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;ファ&#8203;ク&#8203;ター&#8203;は、&#8203;リ&#8203;ター&#8203;ン&#8203;の&#8203;要&#8203;因&#8203;と&#8203;し&#8203;て&#8203;定&#8203;義&#8203;さ&#8203;れ、&#8203;株&#8203;価&#8203;に&#8203;も&#8203;何&#8203;ら&#8203;か&#8203;の&#8203;影&#8203;響&#8203;力&#8203;が&#8203;あ&#8203;る&#8203;と&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;た&#8203;も&#8203;の&#8203;で&#8203;す。&#8203;様々&#8203;な&#8203;ファ&#8203;ク&#8203;ター&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;勉&#8203;強&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が、&#8203;特&#8203;徴&#8203;量&#8203;設&#8203;計&#8203;の&#8203;次&#8203;の&#8203;一&#8203;歩&#8203;に&#8203;繋&#8203;が&#8203;る&#8203;で&#8203;しょ&#8203;う。</p>
</div>
</div>
<div class="sect2">
<h3 id="_複数個のモデルの出力をアンサンブルするアプローチ">7.9. 複数個のモデルの出力をアンサンブルするアプローチ</h3>
<div class="paragraph">
<p>ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル&#8203;の&#8203;活&#8203;用&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。&#8203;機&#8203;械&#8203;学&#8203;習&#8203;に&#8203;お&#8203;け&#8203;る&#8203;「ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル」&#8203;と&#8203;は、&#8203;複&#8203;数&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;組&#8203;み&#8203;合&#8203;わ&#8203;せ&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;の&#8203;高&#8203;い&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;手&#8203;法&#8203;を&#8203;意&#8203;味&#8203;し&#8203;ま&#8203;す。&#8203;ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル&#8203;に&#8203;使&#8203;う&#8203;モ&#8203;デ&#8203;ル&#8203;は&#8203;多&#8203;様&#8203;性&#8203;が&#8203;あ&#8203;れ&#8203;ば&#8203;あ&#8203;る&#8203;程&#8203;基&#8203;本&#8203;的&#8203;に&#8203;は&#8203;好&#8203;ま&#8203;し&#8203;く、&#8203;多&#8203;様&#8203;性&#8203;の&#8203;あ&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;り、&#8203;最&#8203;終&#8203;的&#8203;に&#8203;ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;単&#8203;一&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;は&#8203;達&#8203;成&#8203;で&#8203;き&#8203;な&#8203;い&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;を&#8203;最&#8203;終&#8203;的&#8203;に&#8203;達&#8203;成&#8203;す&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル&#8203;に&#8203;は、&#8203;シ&#8203;ン&#8203;プ&#8203;ル&#8203;に&#8203;複&#8203;数&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;の&#8203;平&#8203;均&#8203;を&#8203;取&#8203;る&#8203;モ&#8203;デ&#8203;ル&#8203;平&#8203;均&#8203;法、&#8203;scikit-learn&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;の&#8203;StandardScaler( <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html" class="bare">https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html</a> )&#8203;に&#8203;よ&#8203;る&#8203;標&#8203;準&#8203;化&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;分&#8203;布&#8203;を&#8203;あ&#8203;る&#8203;程&#8203;度&#8203;揃&#8203;え&#8203;て&#8203;か&#8203;ら&#8203;足&#8203;し&#8203;合&#8203;わ&#8203;せ&#8203;る&#8203;方&#8203;法&#8203;な&#8203;ど&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;よ&#8203;り&#8203;高&#8203;度&#8203;な&#8203;手&#8203;法&#8203;で&#8203;あ&#8203;る&#8203;ス&#8203;タッ&#8203;キ&#8203;ン&#8203;グ&#8203;も&#8203;scikit-learn&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;に&#8203;は&#8203;StackingClassifer/StackingRegressor&#8203;が&#8203;あ&#8203;る&#8203;た&#8203;め&#8203;容&#8203;易&#8203;に&#8203;実&#8203;施&#8203;(&#8203;ス&#8203;タッ&#8203;キ&#8203;ン&#8203;グ&#8203;で&#8203;分&#8203;類・&#8203;回&#8203;帰&#8203; (scikit-learn) &#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://qiita.com/maskot1977/items/de7383898123fa378d86" class="bare">https://qiita.com/maskot1977/items/de7383898123fa378d86</a> )&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;可&#8203;能&#8203;で&#8203;す。&#8203;kaggle&#8203;で&#8203;活&#8203;用&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;る&#8203;様々&#8203;な&#8203;ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル&#8203;の&#8203;方&#8203;法&#8203;が&#8203;KAGGLE ENSEMBLING GUIDE( <a href="https://mlwave.com/kaggle-ensembling-guide/" class="bare">https://mlwave.com/kaggle-ensembling-guide/</a> )&#8203;で&#8203;は&#8203;紹&#8203;介&#8203;さ&#8203;れ&#8203;て&#8203;お&#8203;り、&#8203;英&#8203;文&#8203;で&#8203;す&#8203;が&#8203;読&#8203;む&#8203;価&#8203;値&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は、&#8203;時&#8203;価&#8203;総&#8203;額&#8203;に&#8203;着&#8203;目&#8203;し&#8203;て&#8203;学&#8203;習&#8203;の&#8203;対&#8203;象&#8203;を&#8203;分&#8203;け&#8203;て&#8203;複&#8203;数&#8203;個&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;る&#8203;ア&#8203;プ&#8203;ロー&#8203;チ&#8203;を&#8203;考&#8203;え&#8203;て&#8203;み&#8203;ま&#8203;す。&#8203;一&#8203;般&#8203;的&#8203;に&#8203;時&#8203;価&#8203;総&#8203;額&#8203;が&#8203;低&#8203;い&#8203;銘&#8203;柄&#8203;は、&#8203;大&#8203;き&#8203;な&#8203;値&#8203;動&#8203;き&#8203;が&#8203;発&#8203;生&#8203;し&#8203;や&#8203;す&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;知&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;は&#8203;市&#8203;場&#8203;の&#8203;流&#8203;動&#8203;性&#8203;に&#8203;違&#8203;い&#8203;が&#8203;あ&#8203;り、&#8203;同&#8203;一&#8203;額&#8203;の&#8203;投&#8203;資&#8203;が&#8203;発&#8203;生&#8203;し&#8203;て&#8203;も、&#8203;小&#8203;型&#8203;株&#8203;の&#8203;ほ&#8203;う&#8203;が&#8203;よ&#8203;り&#8203;イ&#8203;ン&#8203;パ&#8203;ク&#8203;ト&#8203;が&#8203;大&#8203;き&#8203;い&#8203;た&#8203;め&#8203;で&#8203;す。&#8203;今&#8203;回&#8203;の&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;で&#8203;は、&#8203;全&#8203;銘&#8203;柄&#8203;を&#8203;予&#8203;測&#8203;対&#8203;象&#8203;と&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;が、&#8203;実&#8203;際&#8203;に&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;る&#8203;と&#8203;全&#8203;銘&#8203;柄&#8203;の&#8203;時&#8203;価&#8203;総&#8203;額&#8203;の&#8203;下&#8203;位&#8203;の&#8203;銘&#8203;柄&#8203;を&#8203;学&#8203;習&#8203;対&#8203;象&#8203;か&#8203;ら&#8203;除&#8203;外&#8203;す&#8203;る&#8203;と、&#8203;よ&#8203;り&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;が&#8203;高&#8203;く&#8203;な&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;は&#8203;時&#8203;価&#8203;総&#8203;額&#8203;が&#8203;低&#8203;い&#8203;銘&#8203;柄&#8203;は、&#8203;ラ&#8203;ン&#8203;ダ&#8203;ム&#8203;性&#8203;が&#8203;よ&#8203;り&#8203;高&#8203;く、&#8203;ま&#8203;た&#8203;ファ&#8203;ン&#8203;ダ&#8203;メ&#8203;ン&#8203;タ&#8203;ル&#8203;に&#8203;従&#8203;わ&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;が&#8203;多&#8203;い&#8203;た&#8203;め&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>で&#8203;は、&#8203;以&#8203;下&#8203;の&#8203;2&#8203;つ&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;つ&#8203;くっ&#8203;た&#8203;場&#8203;合&#8203;を&#8203;考&#8203;え&#8203;て&#8203;み&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>A</strong>: &#8203;全&#8203;銘&#8203;柄&#8203;を&#8203;対&#8203;象&#8203;に&#8203;学&#8203;習&#8203;し&#8203;た&#8203;モ&#8203;デ&#8203;ル</p>
</div>
<div class="paragraph">
<p><strong>B</strong>: &#8203;時&#8203;価&#8203;総&#8203;額&#8203;の&#8203;下&#8203;位&#8203;の&#8203;銘&#8203;柄&#8203;を&#8203;学&#8203;習&#8203;か&#8203;ら&#8203;除&#8203;外&#8203;し&#8203;た&#8203;上&#8203;で、&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;を&#8203;チュー&#8203;ニ&#8203;ン&#8203;グ&#8203;し&#8203;た&#8203;モ&#8203;デ&#8203;ル</p>
</div>
<div class="paragraph">
<p>こ&#8203;の&#8203;2&#8203;つ&#8203;が&#8203;異&#8203;な&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;学&#8203;習&#8203;し&#8203;た&#8203;と&#8203;し&#8203;た&#8203;場&#8203;合、&#8203;B&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;に&#8203;対&#8203;し&#8203;て&#8203;StandardScaler&#8203;に&#8203;よ&#8203;る&#8203;標&#8203;準&#8203;化&#8203;を&#8203;実&#8203;施&#8203;し、&#8203;A&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;に&#8203;足&#8203;し&#8203;合&#8203;わ&#8203;せ&#8203;る&#8203;と、&#8203;B&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;学&#8203;ん&#8203;だ&#8203;こ&#8203;と&#8203;を&#8203;B&#8203;の&#8203;学&#8203;習&#8203;対&#8203;象&#8203;の&#8203;銘&#8203;柄&#8203;に&#8203;足&#8203;し&#8203;合&#8203;わ&#8203;せ&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;B&#8203;の&#8203;出&#8203;力&#8203;に&#8203;対&#8203;し&#8203;て&#8203;は、&#8203;StandardScaler&#8203;に&#8203;よ&#8203;る&#8203;標&#8203;準&#8203;化&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;い&#8203;る&#8203;た&#8203;め&#8203;分&#8203;布&#8203;が&#8203;0&#8203;平&#8203;均&#8203;と&#8203;なっ&#8203;て&#8203;お&#8203;り、&#8203;学&#8203;習&#8203;対&#8203;象&#8203;外&#8203;の&#8203;銘&#8203;柄&#8203;に&#8203;対&#8203;す&#8203;る&#8203;影&#8203;響&#8203;も&#8203;限&#8203;定&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>異&#8203;な&#8203;る&#8203;特&#8203;性&#8203;を&#8203;もっ&#8203;た&#8203;デー&#8203;タ&#8203;を&#8203;学&#8203;習&#8203;さ&#8203;せ&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;異&#8203;な&#8203;る&#8203;こ&#8203;と&#8203;を&#8203;学&#8203;び、&#8203;結&#8203;果&#8203;的&#8203;に&#8203;モ&#8203;デ&#8203;ル&#8203;同&#8203;士&#8203;の&#8203;出&#8203;力&#8203;の&#8203;相&#8203;関&#8203;が&#8203;低&#8203;く&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;モ&#8203;デ&#8203;ル&#8203;間&#8203;の&#8203;出&#8203;力&#8203;の&#8203;相&#8203;関&#8203;が&#8203;低&#8203;い&#8203;も&#8203;の&#8203;同&#8203;士&#8203;を&#8203;ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル&#8203;さ&#8203;せ&#8203;る&#8203;と、&#8203;相&#8203;関&#8203;の&#8203;高&#8203;い&#8203;も&#8203;の&#8203;同&#8203;士&#8203;を&#8203;ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル&#8203;さ&#8203;せ&#8203;た&#8203;時&#8203;よ&#8203;り&#8203;も、&#8203;ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル&#8203;の&#8203;効&#8203;果&#8203;は&#8203;高&#8203;く&#8203;出&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;多&#8203;い&#8203;た&#8203;め、&#8203;上&#8203;記&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;学&#8203;習&#8203;対&#8203;象&#8203;を&#8203;変&#8203;え&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;複&#8203;数&#8203;の&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;り、&#8203;ア&#8203;ン&#8203;サ&#8203;ン&#8203;ブ&#8203;ル&#8203;を&#8203;実&#8203;施&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;な&#8203;ア&#8203;プ&#8203;ロー&#8203;チ&#8203;は&#8203;有&#8203;用&#8203;で&#8203;す。</p>
</div>
</div>
<div class="sect2">
<h3 id="_プライベート期間の性能の向上のために考慮すべきこと">7.10. プライベート期間の性能の向上のために考慮すべきこと</h3>
<div class="paragraph">
<p>金&#8203;融&#8203;時&#8203;系&#8203;列&#8203;は&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;数&#8203;が&#8203;少&#8203;な&#8203;い&#8203;た&#8203;め、&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;大&#8203;量&#8203;に&#8203;生&#8203;成&#8203;し、&#8203;特&#8203;徴&#8203;量&#8203;選&#8203;択&#8203;を&#8203;す&#8203;べ&#8203;て&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;任&#8203;せ&#8203;る&#8203;ア&#8203;プ&#8203;ロー&#8203;チ&#8203;を&#8203;採&#8203;用&#8203;す&#8203;る&#8203;場&#8203;合、&#8203;ラ&#8203;イ&#8203;ブ&#8203;性&#8203;能&#8203;の&#8203;劣&#8203;化&#8203;に&#8203;注&#8203;意&#8203;す&#8203;る&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;特&#8203;徴&#8203;量&#8203;を&#8203;ど&#8203;ん&#8203;ど&#8203;ん&#8203;増&#8203;や&#8203;す&#8203;と、&#8203;訓&#8203;練&#8203;期&#8203;間&#8203;の&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;は&#8203;伸&#8203;び&#8203;て&#8203;い&#8203;て&#8203;も、&#8203;評&#8203;価&#8203;期&#8203;間&#8203;の&#8203;パ&#8203;フォー&#8203;マ&#8203;ン&#8203;ス&#8203;の&#8203;向&#8203;上&#8203;が&#8203;止&#8203;ま&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;100&#8203;種&#8203;類&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;使&#8203;う&#8203;モ&#8203;デ&#8203;ル&#8203;と&#8203;10&#8203;種&#8203;類&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;使&#8203;う&#8203;モ&#8203;デ&#8203;ル&#8203;が、&#8203;同&#8203;一&#8203;の&#8203;訓&#8203;練&#8203;期&#8203;間&#8203;で&#8203;同&#8203;一&#8203;の&#8203;精&#8203;度&#8203;を&#8203;達&#8203;成&#8203;し&#8203;た&#8203;場&#8203;合、&#8203;評&#8203;価&#8203;期&#8203;間・&#8203;ラ&#8203;イ&#8203;ブ&#8203;期&#8203;間&#8203;で&#8203;は、&#8203;少&#8203;な&#8203;い&#8203;デー&#8203;タ&#8203;を&#8203;使っ&#8203;た&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;方&#8203;が&#8203;高&#8203;い&#8203;性&#8203;能&#8203;を&#8203;期&#8203;待&#8203;で&#8203;き&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;高&#8203;い&#8203;こ&#8203;と&#8203;が、&#8203;経&#8203;験&#8203;的&#8203;に&#8203;わ&#8203;かっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;こ&#8203;れ&#8203;は、&#8203;説&#8203;明&#8203;変&#8203;数&#8203;の&#8203;取&#8203;り&#8203;う&#8203;る&#8203;パ&#8203;ター&#8203;ン&#8203;が&#8203;多&#8203;い&#8203;と、&#8203;未&#8203;来&#8203;で&#8203;同&#8203;じ&#8203;現&#8203;象&#8203;を&#8203;発&#8203;生&#8203;す&#8203;る&#8203;確&#8203;率&#8203;が&#8203;下&#8203;がっ&#8203;て&#8203;い&#8203;く&#8203;た&#8203;め&#8203;と&#8203;考&#8203;え&#8203;ら&#8203;れ&#8203;ま&#8203;す。&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;複&#8203;雑&#8203;さ&#8203;と&#8203;デー&#8203;タ&#8203;へ&#8203;の&#8203;適&#8203;合&#8203;度&#8203;と&#8203;の&#8203;バ&#8203;ラ&#8203;ン&#8203;ス&#8203;を&#8203;取&#8203;る&#8203;た&#8203;め&#8203;に&#8203;は、&#8203;オッ&#8203;カ&#8203;ム&#8203;の&#8203;剃&#8203;刀&#8203;(Wikipedia &#8203;オッ&#8203;カ&#8203;ム&#8203;の&#8203;剃&#8203;刀&#8203;よ&#8203;り&#8203;引&#8203;用&#8203; <a href="https://ja.wikipedia.org/wiki/%E3%82%AA%E3%83%83%E3%82%AB%E3%83%A0%E3%81%AE%E5%89%83%E5%88%80" class="bare">https://ja.wikipedia.org/wiki/%E3%82%AA%E3%83%83%E3%82%AB%E3%83%A0%E3%81%AE%E5%89%83%E5%88%80</a> ) &#8203;の&#8203;よ&#8203;う&#8203;な&#8203;発&#8203;想&#8203;が&#8203;必&#8203;要&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect2">
<h3 id="_本コンペでは利用できないがモデルを将来的に発展させるために検討する価値のある外部データ">7.11. 本コンペでは利用できないが、モデルを将来的に発展させるために検討する価値のある外部データ</h3>
<div class="paragraph">
<p>日&#8203;本&#8203;株&#8203;の&#8203;デー&#8203;タ&#8203;以&#8203;外&#8203;に&#8203;特&#8203;徴&#8203;量&#8203;設&#8203;計&#8203;に&#8203;利&#8203;用&#8203;可&#8203;能&#8203;と&#8203;思&#8203;わ&#8203;れ&#8203;る&#8203;デー&#8203;タ&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;で&#8203;は、&#8203;あ&#8203;ら&#8203;か&#8203;じ&#8203;め&#8203;定&#8203;め&#8203;ら&#8203;れ&#8203;た&#8203;デー&#8203;タ&#8203;し&#8203;か&#8203;利&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;で&#8203;き&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;今&#8203;後&#8203;手&#8203;元&#8203;で&#8203;新&#8203;た&#8203;な&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;成&#8203;す&#8203;る&#8203;と&#8203;き&#8203;の&#8203;知&#8203;識&#8203;と&#8203;し&#8203;て&#8203;ご&#8203;活&#8203;用&#8203;下&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;為&#8203;替&#8203;デー&#8203;タ&#8203;</strong>: &#8203;ド&#8203;ル&#8203;円&#8203;の&#8203;値&#8203;動&#8203;き&#8203;が&#8203;株&#8203;式&#8203;市&#8203;場&#8203;に&#8203;影&#8203;響&#8203;を&#8203;与&#8203;え&#8203;て&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;よ&#8203;く&#8203;知&#8203;ら&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;特&#8203;に&#8203;日&#8203;本&#8203;市&#8203;場&#8203;の&#8203;株&#8203;式&#8203;は&#8203;輸&#8203;出&#8203;関&#8203;連&#8203;銘&#8203;柄&#8203;が&#8203;多&#8203;い&#8203;た&#8203;め、&#8203;ド&#8203;ル&#8203;円&#8203;の&#8203;値&#8203;動&#8203;き&#8203;は&#8203;直&#8203;接&#8203;収&#8203;益&#8203;に&#8203;関&#8203;連&#8203;し&#8203;ま&#8203;す。&#8203;よっ&#8203;て、&#8203;為&#8203;替&#8203;デー&#8203;タ&#8203;を&#8203;説&#8203;明&#8203;変&#8203;数&#8203;に&#8203;採&#8203;用&#8203;す&#8203;る&#8203;ア&#8203;プ&#8203;ロー&#8203;チ&#8203;も&#8203;想&#8203;定&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;為&#8203;替&#8203;デー&#8203;タ&#8203;は、&#8203;い&#8203;く&#8203;つ&#8203;か&#8203;の&#8203;FX&#8203;会&#8203;社&#8203;が&#8203;API&#8203;を&#8203;提&#8203;供&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;金&#8203;利&#8203;デー&#8203;タ&#8203;</strong>: &#8203;金&#8203;利&#8203;デー&#8203;タ&#8203;と&#8203;は、&#8203;例&#8203;え&#8203;ば&#8203;米&#8203;国&#8203;債&#8203;10&#8203;年&#8203;金&#8203;利&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;各&#8203;国&#8203;の&#8203;債&#8203;券&#8203;の&#8203;金&#8203;利&#8203;を&#8203;指&#8203;し&#8203;ま&#8203;す。&#8203;一&#8203;般&#8203;的&#8203;に、&#8203;機&#8203;関&#8203;投&#8203;資&#8203;家&#8203;は&#8203;債&#8203;券&#8203;と&#8203;株&#8203;式&#8203;の&#8203;両&#8203;方&#8203;を&#8203;投&#8203;資&#8203;対&#8203;象&#8203;と&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;債&#8203;券&#8203;市&#8203;場&#8203;の&#8203;動&#8203;き&#8203;は&#8203;株&#8203;式&#8203;市&#8203;場&#8203;に&#8203;反&#8203;映&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;こ&#8203;ち&#8203;ら&#8203;は、&#8203;API&#8203;に&#8203;よ&#8203;る&#8203;デー&#8203;タ&#8203;習&#8203;得&#8203;は&#8203;容&#8203;易&#8203;で&#8203;は&#8203;あ&#8203;り&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;そ&#8203;こ&#8203;ま&#8203;で&#8203;数&#8203;は&#8203;多&#8203;く&#8203;な&#8203;い&#8203;た&#8203;め、&#8203;説&#8203;明&#8203;変&#8203;数&#8203;と&#8203;し&#8203;て&#8203;利&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;は&#8203;難&#8203;し&#8203;く&#8203;あ&#8203;り&#8203;ま&#8203;せ&#8203;ん。</p>
</div>
<div class="paragraph">
<p><strong>&#8203;米&#8203;国&#8203;株&#8203;デー&#8203;タ&#8203;</strong>: Alpaca US( <a href="https://alpaca.markets/data" class="bare">https://alpaca.markets/data</a> )&#8203;や&#8203;IEX Cloud( <a href="https://iexcloud.io/" class="bare">https://iexcloud.io/</a> )&#8203;な&#8203;ど、&#8203;様々&#8203;な&#8203;米&#8203;国&#8203;株&#8203;の&#8203;株&#8203;価&#8203;/ETF&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;提&#8203;供&#8203;す&#8203;る&#8203;サー&#8203;ビ&#8203;ス&#8203;が&#8203;存&#8203;在&#8203;し&#8203;ま&#8203;す。&#8203;日&#8203;本&#8203;株&#8203;式&#8203;の&#8203;マー&#8203;ケッ&#8203;ト&#8203;は、&#8203;米&#8203;国&#8203;株&#8203;式&#8203;の&#8203;マー&#8203;ケッ&#8203;ト&#8203;ク&#8203;ロー&#8203;ズ&#8203;後&#8203;に&#8203;オー&#8203;プ&#8203;ン&#8203;す&#8203;る&#8203;た&#8203;め、&#8203;米&#8203;国&#8203;市&#8203;場&#8203;が&#8203;日&#8203;本&#8203;市&#8203;場&#8203;に&#8203;与&#8203;え&#8203;る&#8203;影&#8203;響&#8203;を&#8203;解&#8203;析&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;様々&#8203;な&#8203;情&#8203;報&#8203;を&#8203;分&#8203;析&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;可&#8203;能&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>他&#8203;に&#8203;も&#8203;政&#8203;府&#8203;が&#8203;発&#8203;表&#8203;す&#8203;る&#8203;GDP&#8203;な&#8203;ど&#8203;の&#8203;各&#8203;国&#8203;の&#8203;経&#8203;済&#8203;動&#8203;向、&#8203;金&#8203;な&#8203;ど&#8203;の&#8203;コ&#8203;モ&#8203;ディ&#8203;ティ&#8203;市&#8203;場&#8203;も、&#8203;密&#8203;接&#8203;に&#8203;株&#8203;式&#8203;市&#8203;場&#8203;の&#8203;長&#8203;期&#8203;ト&#8203;レ&#8203;ン&#8203;ド&#8203;の&#8203;形&#8203;成&#8203;に&#8203;関&#8203;わっ&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;様々&#8203;な&#8203;外&#8203;部&#8203;デー&#8203;タ&#8203;の&#8203;利&#8203;用&#8203;を&#8203;検&#8203;討&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;新&#8203;た&#8203;な&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;作&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect2">
<h3 id="_モデルの再学習の運用について">7.12. モデルの再学習の運用について</h3>
<div class="paragraph">
<p>長&#8203;期&#8203;間&#8203;に&#8203;渡&#8203;り&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;運&#8203;用&#8203;し&#8203;よ&#8203;う&#8203;と&#8203;す&#8203;る&#8203;場&#8203;合、&#8203;再&#8203;学&#8203;習&#8203;の&#8203;運&#8203;用&#8203;を&#8203;考&#8203;慮&#8203;し&#8203;て&#8203;お&#8203;く&#8203;必&#8203;要&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;再&#8203;学&#8203;習&#8203;の&#8203;運&#8203;用&#8203;と&#8203;は、&#8203;例&#8203;え&#8203;ば&#8203;2019&#8203;年&#8203;ま&#8203;で&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;用&#8203;い&#8203;て&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;学&#8203;習&#8203;し&#8203;2020&#8203;年&#8203;で&#8203;運&#8203;用&#8203;し&#8203;た&#8203;場&#8203;合、&#8203;2020&#8203;年&#8203;末&#8203;に&#8203;2020&#8203;年&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;用&#8203;い&#8203;て&#8203;再&#8203;学&#8203;習&#8203;を&#8203;行&#8203;う&#8203;と&#8203;いっ&#8203;た&#8203;よ&#8203;う&#8203;な&#8203;こ&#8203;と&#8203;を&#8203;指&#8203;し&#8203;ま&#8203;す。&#8203;再&#8203;学&#8203;習&#8203;を&#8203;行&#8203;う&#8203;に&#8203;あ&#8203;たっ&#8203;て&#8203;い&#8203;く&#8203;つ&#8203;か&#8203;考&#8203;慮&#8203;し&#8203;て&#8203;お&#8203;く&#8203;べ&#8203;き&#8203;ポ&#8203;イ&#8203;ン&#8203;ト&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_再学習を行う必要があるほど新規のデータが存在するか">7.12.1. 再学習を行う必要があるほど新規のデータが存在するか</h4>
<div class="paragraph">
<p>再&#8203;学&#8203;習&#8203;は、&#8203;新&#8203;規&#8203;の&#8203;デー&#8203;タ&#8203;が&#8203;溜&#8203;まっ&#8203;た&#8203;時&#8203;に&#8203;実&#8203;施&#8203;し&#8203;ま&#8203;す。&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;も&#8203;依&#8203;存&#8203;し&#8203;ま&#8203;す&#8203;が、&#8203;モ&#8203;デ&#8203;ル&#8203;が&#8203;挙&#8203;動&#8203;を&#8203;変&#8203;え&#8203;る&#8203;に&#8203;は、&#8203;既&#8203;存&#8203;の&#8203;学&#8203;習&#8203;に&#8203;用&#8203;い&#8203;た&#8203;デー&#8203;タ&#8203;量&#8203;と&#8203;比&#8203;較&#8203;し&#8203;て&#8203;あ&#8203;る&#8203;程&#8203;度&#8203;の&#8203;量&#8203;の&#8203;新&#8203;規&#8203;デー&#8203;タ&#8203;が&#8203;存&#8203;在&#8203;し&#8203;な&#8203;い&#8203;と、&#8203;再&#8203;学&#8203;習&#8203;を&#8203;実&#8203;施&#8203;し&#8203;て&#8203;も&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;挙&#8203;動&#8203;は&#8203;変&#8203;わ&#8203;り&#8203;ま&#8203;せ&#8203;ん。&#8203;再&#8203;学&#8203;習&#8203;す&#8203;る&#8203;際&#8203;に&#8203;有&#8203;用&#8203;な&#8203;新&#8203;規&#8203;デー&#8203;タ&#8203;量&#8203;は&#8203;一&#8203;概&#8203;に&#8203;は&#8203;言&#8203;え&#8203;ず、&#8203;モ&#8203;デ&#8203;ル&#8203;に&#8203;よっ&#8203;て&#8203;変&#8203;わ&#8203;り&#8203;ま&#8203;す。&#8203;毎&#8203;日&#8203;モ&#8203;デ&#8203;ル&#8203;を&#8203;ト&#8203;レー&#8203;ニ&#8203;ン&#8203;グ&#8203;す&#8203;る&#8203;よ&#8203;う&#8203;な&#8203;運&#8203;用&#8203;も&#8203;可&#8203;能&#8203;で&#8203;す&#8203;が、&#8203;デー&#8203;タ&#8203;量&#8203;が&#8203;多&#8203;少&#8203;増&#8203;え&#8203;た&#8203;だ&#8203;け&#8203;で&#8203;は、&#8203;ほ&#8203;ぼ&#8203;同&#8203;じ&#8203;挙&#8203;動&#8203;と&#8203;な&#8203;る&#8203;可&#8203;能&#8203;性&#8203;が&#8203;高&#8203;い&#8203;で&#8203;す。</p>
</div>
</div>
<div class="sect3">
<h4 id="_再学習を行うことでモデルの出力分布が変わらないか">7.12.2. 再学習を行うことでモデルの出力分布が変わらないか</h4>
<div class="paragraph">
<p>こ&#8203;ち&#8203;ら&#8203;は、&#8203;シ&#8203;ス&#8203;テ&#8203;ム&#8203;で&#8203;運&#8203;用&#8203;す&#8203;る&#8203;場&#8203;合&#8203;に&#8203;発&#8203;生&#8203;し&#8203;や&#8203;す&#8203;い&#8203;問&#8203;題&#8203;で&#8203;す。&#8203;例&#8203;え&#8203;ば、&#8203;投&#8203;資&#8203;す&#8203;る&#8203;際&#8203;の&#8203;購&#8203;入&#8203;タ&#8203;イ&#8203;ミ&#8203;ン&#8203;グ&#8203;を、&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;が&#8203;0.8&#8203;以&#8203;上&#8203;と&#8203;いっ&#8203;た&#8203;し&#8203;き&#8203;い&#8203;値&#8203;を&#8203;用&#8203;い&#8203;た&#8203;実&#8203;装&#8203;を&#8203;し&#8203;て&#8203;い&#8203;た&#8203;と&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;際&#8203;に&#8203;再&#8203;学&#8203;習&#8203;を&#8203;行&#8203;う&#8203;こ&#8203;と&#8203;で&#8203;モ&#8203;デ&#8203;ル&#8203;の&#8203;出&#8203;力&#8203;が&#8203;変&#8203;わ&#8203;る&#8203;と、&#8203;想&#8203;像&#8203;以&#8203;上&#8203;に&#8203;購&#8203;入&#8203;し&#8203;た&#8203;り、&#8203;逆&#8203;に&#8203;購&#8203;入&#8203;を&#8203;実&#8203;施&#8203;し&#8203;な&#8203;く&#8203;なっ&#8203;た&#8203;り&#8203;し&#8203;ま&#8203;す。&#8203;再&#8203;学&#8203;習&#8203;を&#8203;行っ&#8203;た&#8203;場&#8203;合、&#8203;直&#8203;近&#8203;数&#8203;週&#8203;間&#8203;程&#8203;度&#8203;の&#8203;デー&#8203;タ&#8203;は&#8203;利&#8203;用&#8203;せ&#8203;ず&#8203;に、&#8203;古&#8203;い&#8203;モ&#8203;デ&#8203;ル&#8203;と&#8203;新&#8203;し&#8203;い&#8203;モ&#8203;デ&#8203;ル&#8203;で&#8203;出&#8203;力&#8203;を&#8203;比&#8203;較&#8203;し、&#8203;出&#8203;力&#8203;の&#8203;分&#8203;布&#8203;が&#8203;変&#8203;わっ&#8203;て&#8203;い&#8203;な&#8203;い&#8203;こ&#8203;と&#8203;を&#8203;確&#8203;認&#8203;す&#8203;る&#8203;の&#8203;が&#8203;良&#8203;い&#8203;で&#8203;しょ&#8203;う。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_google_colaboratoryの使用法">7.13. Google Colaboratoryの使用法</h3>
<div class="paragraph">
<p>Google Colaboratory&#8203;は、&#8203;ブ&#8203;ラ&#8203;ウ&#8203;ザ&#8203;か&#8203;ら&#8203; Python &#8203;を&#8203;ノー&#8203;ト&#8203;ブッ&#8203;ク&#8203;形&#8203;式&#8203;で&#8203;記&#8203;述、&#8203;実&#8203;行&#8203;で&#8203;き&#8203;る&#8203;サー&#8203;ビ&#8203;ス&#8203;で&#8203;す。&#8203;環&#8203;境&#8203;構&#8203;築&#8203;が&#8203;不&#8203;要&#8203;と&#8203;なっ&#8203;て&#8203;お&#8203;り、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;も&#8203;Google Colaboratory&#8203;で&#8203;実&#8203;行&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;可&#8203;能&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;時&#8203;間&#8203;等&#8203;の&#8203;制&#8203;限&#8203;は&#8203;ご&#8203;ざ&#8203;い&#8203;ま&#8203;す&#8203;が&#8203;GPU&#8203;を&#8203;利&#8203;用&#8203;で&#8203;き&#8203;る&#8203;こ&#8203;と&#8203;や、&#8203;ノー&#8203;ト&#8203;ブッ&#8203;ク&#8203;の&#8203;共&#8203;有&#8203;が&#8203;簡&#8203;単&#8203;に&#8203;で&#8203;き&#8203;る&#8203;こ&#8203;と&#8203;な&#8203;ど、&#8203;多&#8203;く&#8203;の&#8203;利&#8203;点&#8203;を&#8203;備&#8203;え&#8203;て&#8203;い&#8203;ま&#8203;す&#8203; (<a href="https://colab.research.google.com/notebooks/intro.ipynb?hl=ja#">参考元</a>  )。</p>
</div>
<div class="sect3">
<h4 id="_colab_でノートブックが動作する時間は">7.13.1. <strong>Colab でノートブックが動作する時間は？</strong></h4>
<div class="paragraph">
<p>本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;を&#8203;Google Colaboratory&#8203;で&#8203;実&#8203;行&#8203;す&#8203;る&#8203;際&#8203;に&#8203;は&#8203;時&#8203;間&#8203;制&#8203;限&#8203;に&#8203;ご&#8203;注&#8203;意&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;ノー&#8203;ト&#8203;ブッ&#8203;ク&#8203;は、&#8203;イ&#8203;ン&#8203;ス&#8203;タ&#8203;ン&#8203;ス&#8203;が&#8203;起&#8203;動&#8203;さ&#8203;れ&#8203;た&#8203;後&#8203; 12 &#8203;時&#8203;間&#8203;経&#8203;過&#8203;す&#8203;る&#8203;と&#8203;自&#8203;動&#8203;的&#8203;に&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;が&#8203;リ&#8203;セッ&#8203;ト&#8203;さ&#8203;れ&#8203;実&#8203;行&#8203;環&#8203;境&#8203;が&#8203;初&#8203;期&#8203;化&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;ま&#8203;た、&#8203;ノー&#8203;ト&#8203;ブッ&#8203;ク&#8203;の&#8203;ア&#8203;イ&#8203;ド&#8203;ル&#8203;状&#8203;態&#8203;が&#8203; 90 &#8203;分&#8203;続&#8203;く&#8203;と&#8203;タ&#8203;イ&#8203;ム&#8203;ア&#8203;ウ&#8203;ト&#8203;し、&#8203;こ&#8203;ち&#8203;ら&#8203;も&#8203;ラ&#8203;ン&#8203;タ&#8203;イ&#8203;ム&#8203;が&#8203;リ&#8203;セッ&#8203;ト&#8203;さ&#8203;れ&#8203;ま&#8203;す。&#8203;(&#8203;詳&#8203;細&#8203;は&#8203;<a href="https://research.google.com/colaboratory/faq.html#:~:text=How%20long%20can%20notebooks%20run,or%20based%20on%20your%20usage">Google Colaboratory&#8203;の&#8203;Q&amp;A</a>&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;)。</p>
</div>
</div>
<div class="sect3">
<h4 id="_2章でgoogle_colaboratoryを使用するために">7.13.2. 2章でGoogle Colaboratoryを使用するために</h4>
<div class="paragraph">
<p>本&#8203;コ&#8203;ン&#8203;ペ&#8203;の&#8203;2&#8203;章&#8203;の&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;を&#8203;Google Colaboratory&#8203;上&#8203;で&#8203;動&#8203;か&#8203;す&#8203;た&#8203;め&#8203;に&#8203;は、&#8203;ま&#8203;ず&#8203;以&#8203;下&#8203;の&#8203;手&#8203;順&#8203;で&#8203;Google Drive&#8203;上&#8203;に&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;設&#8203;置&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Google Drive&#8203;の&#8203;My Drive&#8203;に&#8203;<code>JPX_competition</code>&#8203;と&#8203;い&#8203;う&#8203;フォ&#8203;ル&#8203;ダー&#8203;を&#8203;作&#8203;成&#8203;し&#8203;ま&#8203;す。</p>
</li>
<li>
<p>SIGNATE&#8203;の&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;サ&#8203;イ&#8203;ト&#8203;よ&#8203;り&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;た&#8203;各&#8203;種&#8203;デー&#8203;タ&#8203;を&#8203;1&#8203;で&#8203;作&#8203;成&#8203;し&#8203;た&#8203;フォ&#8203;ル&#8203;ダー&#8203;に&#8203;アッ&#8203;プ&#8203;ロー&#8203;ド&#8203;し&#8203;ま&#8203;す。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>次&#8203;に&#8203;Google Colaboratory&#8203;上&#8203;で&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;ノー&#8203;ト&#8203;ブッ&#8203;ク&#8203;を&#8203;展&#8203;開&#8203;し&#8203;ま&#8203;す。&#8203;ノー&#8203;ト&#8203;ブッ&#8203;ク&#8203;は&#8203;Google Colaboratory&#8203;上&#8203;で&#8203;も&#8203;実&#8203;行&#8203;可&#8203;能&#8203;と&#8203;なっ&#8203;て&#8203;お&#8203;り、&#8203;そ&#8203;の&#8203;ま&#8203;ま&#8203;編&#8203;集&#8203;な&#8203;し&#8203;で&#8203;実&#8203;行&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;以&#8203;下、&#8203;具&#8203;体&#8203;的&#8203;な&#8203;方&#8203;法&#8203;を&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ノー&#8203;ト&#8203;ブッ&#8203;ク&#8203;を&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;し&#8203;ま&#8203;す。&#8203; <a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial/blob/main/handson/Chapter02/20210121-chapter02-tutorial.ipynb">こちらのGithubリポジトリ</a>&#8203;よ&#8203;り&#8203;Raw&#8203;ボ&#8203;タ&#8203;ン&#8203;を&#8203;右&#8203;ク&#8203;リッ&#8203;ク&#8203;し、&#8203;「リ&#8203;ン&#8203;ク&#8203;先&#8203;を&#8203;名&#8203;前&#8203;を&#8203;つ&#8203;け&#8203;て&#8203;保&#8203;存」&#8203;を&#8203;選&#8203;択&#8203;し&#8203;て&#8203;先&#8203;程&#8203;作&#8203;成&#8203;し&#8203;た&#8203;<code>JPX_competition</code>&#8203;に&#8203;保&#8203;存&#8203;し&#8203;て&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</li>
<li>
<p>Google Drive&#8203;に&#8203;アッ&#8203;プ&#8203;ロー&#8203;ド&#8203;し&#8203;た&#8203; <code>20210121-chapter02-tutorial.ipynb</code> &#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;ダ&#8203;ブ&#8203;ル&#8203;ク&#8203;リッ&#8203;ク&#8203;し&#8203;て&#8203; Google Colaboratory &#8203;で&#8203;開&#8203;き&#8203;ま&#8203;す。</p>
</li>
<li>
<p>コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;デー&#8203;タ&#8203;を&#8203;ノー&#8203;ト&#8203;ブッ&#8203;ク&#8203;で&#8203;読&#8203;み&#8203;込&#8203;む&#8203;た&#8203;め&#8203;に、&#8203;Google Drive&#8203;へ&#8203;マ&#8203;ウ&#8203;ン&#8203;ト&#8203;し&#8203;ま&#8203;す。&#8203;マ&#8203;ウ&#8203;ン&#8203;ト&#8203;方&#8203;法&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は&#8203;<a href="https://qiita.com/kado_u/items/45b76f9a6f920bf0f786">こちら</a>&#8203;の&#8203;記&#8203;事&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_内国株の売買制度">7.14. 内国株の売買制度</h3>
<div class="paragraph">
<p>本&#8203;節&#8203;で&#8203;は、&#8203;本&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;の&#8203;題&#8203;材&#8203;と&#8203;なっ&#8203;て&#8203;い&#8203;る&#8203;株&#8203;式&#8203;の&#8203;売&#8203;買&#8203;制&#8203;度&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;説&#8203;明&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="sect3">
<h4 id="_制限値幅">7.14.1. 制限値幅</h4>
<div class="paragraph">
<p>東&#8203;京&#8203;証&#8203;券&#8203;取&#8203;引&#8203;所&#8203;で&#8203;は、&#8203;一&#8203;日&#8203;の&#8203;売&#8203;買&#8203;に&#8203;お&#8203;け&#8203;る&#8203;値&#8203;動&#8203;き&#8203;の&#8203;幅&#8203;を&#8203;価&#8203;格&#8203;水&#8203;準&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;一&#8203;定&#8203;に&#8203;制&#8203;限&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;こ&#8203;の&#8203;値&#8203;幅&#8203;を&#8203; <strong>&#8203;制&#8203;限&#8203;値&#8203;幅&#8203;</strong> &#8203;と&#8203;い&#8203;い&#8203;ま&#8203;す。&#8203;制&#8203;限&#8203;値&#8203;幅&#8203;は、&#8203;前&#8203;日&#8203;の&#8203;終&#8203;値&#8203;又&#8203;は&#8203;最&#8203;終&#8203;気&#8203;配&#8203;値&#8203;段&#8203;な&#8203;ど&#8203;（以&#8203;下、&#8203;「基&#8203;準&#8203;値&#8203;段」&#8203;と&#8203;言&#8203;い&#8203;ま&#8203;す）&#8203;を&#8203;基&#8203;準&#8203;と&#8203;し&#8203;て&#8203;お&#8203;り、&#8203;そ&#8203;の&#8203;値&#8203;幅&#8203;の&#8203;大&#8203;き&#8203;さ&#8203;は&#8203;基&#8203;準&#8203;値&#8203;段&#8203;に&#8203;よっ&#8203;て&#8203;異&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;詳&#8203;細&#8203;は&#8203;<a href="https://www.jpx.co.jp/equities/trading/domestic/06.html">こちら</a>&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
</div>
<div class="sect3">
<h4 id="_呼値の単位">7.14.2. 呼値の単位</h4>
<div class="paragraph">
<p>内&#8203;国&#8203;株&#8203;式&#8203;の&#8203;売&#8203;買&#8203;の&#8203;注&#8203;文&#8203;を&#8203;す&#8203;る&#8203;際&#8203;の&#8203;値&#8203;段&#8203;の&#8203;刻&#8203;み&#8203;こ&#8203;と&#8203;を&#8203; <strong>&#8203;呼&#8203;値&#8203;の&#8203;単&#8203;位&#8203;</strong> &#8203;と&#8203;い&#8203;い、&#8203;こ&#8203;の&#8203;呼&#8203;値&#8203;の&#8203;単&#8203;位&#8203;は、&#8203;売&#8203;買&#8203;の&#8203;対&#8203;象&#8203;と&#8203;な&#8203;る&#8203;銘&#8203;柄&#8203;及&#8203;び&#8203;そ&#8203;の&#8203;値&#8203;段&#8203;の&#8203;水&#8203;準&#8203;に&#8203;応&#8203;じ&#8203;て&#8203;異&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;各&#8203;値&#8203;段&#8203;の&#8203;水&#8203;準&#8203;に&#8203;お&#8203;け&#8203;る&#8203;詳&#8203;細&#8203;な&#8203;呼&#8203;値&#8203;の&#8203;単&#8203;位&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;は、&#8203;<a href="https://www.jpx.co.jp/equities/trading/domestic/07.html">こちら</a>&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;な&#8203;お、&#8203;銘&#8203;柄&#8203;に&#8203;よっ&#8203;て&#8203;は&#8203;呼&#8203;値&#8203;の&#8203;単&#8203;位&#8203;は&#8203;整&#8203;数&#8203;で&#8203;は&#8203;な&#8203;く、&#8203;小&#8203;数&#8203;点&#8203;が&#8203;あ&#8203;る&#8203;も&#8203;の&#8203;も&#8203;ご&#8203;ざ&#8203;い&#8203;ま&#8203;す&#8203;の&#8203;で&#8203;ご&#8203;留&#8203;意&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_バックテスト用ライブラリ">7.15. バックテスト用ライブラリ</h3>
<div class="paragraph">
<p>有&#8203;名&#8203;な&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;/&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;と&#8203;し&#8203;て&#8203;は&#8203;Zipline( <a href="https://github.com/quantopian/zipline" class="bare">https://github.com/quantopian/zipline</a> )&#8203;や&#8203;Backtrader( <a href="https://github.com/mementum/backtrader" class="bare">https://github.com/mementum/backtrader</a> )&#8203;が&#8203;あ&#8203;り&#8203;ま&#8203;す。&#8203;Zipline&#8203;は&#8203;人&#8203;気&#8203;の&#8203;あ&#8203;る&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;で&#8203;し&#8203;た&#8203;が、&#8203;開&#8203;発&#8203;元&#8203;の&#8203;Quantopian&#8203;が&#8203;な&#8203;く&#8203;なっ&#8203;た&#8203;た&#8203;め、&#8203;現&#8203;在&#8203;開&#8203;発&#8203;が&#8203;止&#8203;まっ&#8203;て&#8203;い&#8203;ま&#8203;す。&#8203;Backtrader&#8203;は&#8203;機&#8203;能&#8203;が&#8203;多&#8203;用&#8203;で&#8203;す&#8203;が、&#8203;初&#8203;心&#8203;者&#8203;に&#8203;は&#8203;若&#8203;干&#8203;敷&#8203;居&#8203;が&#8203;高&#8203;い&#8203;で&#8203;す。&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;は&#8203;定&#8203;番&#8203;と&#8203;言&#8203;え&#8203;る&#8203;も&#8203;の&#8203;が&#8203;無&#8203;く、&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;を&#8203;実&#8203;装&#8203;す&#8203;る&#8203;場&#8203;合、&#8203;フ&#8203;レー&#8203;ム&#8203;ワー&#8203;ク&#8203;は&#8203;利&#8203;用&#8203;せ&#8203;ず&#8203;個&#8203;別&#8203;に&#8203;自&#8203;分&#8203;の&#8203;取&#8203;引&#8203;戦&#8203;略&#8203;に&#8203;合&#8203;致&#8203;し&#8203;た&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;書&#8203;い&#8203;て&#8203;評&#8203;価&#8203;し、&#8203;結&#8203;果&#8203;は&#8203;matplotlib&#8203;な&#8203;ど&#8203;の&#8203;描&#8203;画&#8203;用&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;で&#8203;直&#8203;接&#8203;描&#8203;画&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;も&#8203;多&#8203;く、&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;も&#8203;そ&#8203;の&#8203;方&#8203;式&#8203;を&#8203;採&#8203;用&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;構&#8203;築&#8203;せ&#8203;ず&#8203;に、&#8203;ま&#8203;ず&#8203;は&#8203;ポー&#8203;ト&#8203;フォ&#8203;リ&#8203;オ&#8203;を&#8203;構&#8203;築&#8203;す&#8203;る&#8203;た&#8203;め&#8203;の&#8203;予&#8203;測&#8203;モ&#8203;デ&#8203;ル&#8203;自&#8203;体&#8203;の&#8203;評&#8203;価&#8203;を&#8203;情&#8203;報&#8203;係&#8203;数&#8203;(IC)&#8203;や&#8203;分&#8203;位&#8203;点&#8203;リ&#8203;ター&#8203;ン&#8203;な&#8203;ど&#8203;を&#8203;利&#8203;用&#8203;し&#8203;て&#8203;行&#8203;う&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;も&#8203;存&#8203;在&#8203;し&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;手&#8203;法&#8203;は&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;で&#8203;は&#8203;扱&#8203;い&#8203;ま&#8203;せ&#8203;ん&#8203;が、&#8203;qlib( <a href="https://github.com/microsoft/qlib" class="bare">https://github.com/microsoft/qlib</a> )&#8203;や&#8203;alphalense( <a href="https://github.com/quantopian/alphalens" class="bare">https://github.com/quantopian/alphalens</a> )&#8203;な&#8203;ど&#8203;の&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;に&#8203;様々&#8203;な&#8203;方&#8203;法&#8203;が&#8203;紹&#8203;介&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す&#8203;の&#8203;で、&#8203;是&#8203;非&#8203;御&#8203;覧&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;日&#8203;本&#8203;語&#8203;で&#8203;は&#8203;あ&#8203;ま&#8203;り&#8203;網&#8203;羅&#8203;的&#8203;な&#8203;サ&#8203;イ&#8203;ト&#8203;は&#8203;無&#8203;い&#8203;の&#8203;で&#8203;す&#8203;が、&#8203;書&#8203;籍&#8203;で&#8203;紹&#8203;介&#8203;し&#8203;た&#8203;「ファ&#8203;イ&#8203;ナ&#8203;ン&#8203;ス&#8203;機&#8203;械&#8203;学&#8203;習&#8203;―&#8203;金&#8203;融&#8203;市&#8203;場&#8203;分&#8203;析&#8203;を&#8203;変&#8203;え&#8203;る&#8203;機&#8203;械&#8203;学&#8203;習&#8203;ア&#8203;ル&#8203;ゴ&#8203;リ&#8203;ズ&#8203;ム&#8203;の&#8203;理&#8203;論&#8203;と&#8203;実&#8203;践」&#8203;に&#8203;お&#8203;い&#8203;て&#8203;網&#8203;羅&#8203;的&#8203;な&#8203;説&#8203;明&#8203;が&#8203;さ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;説&#8203;明&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>Github</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zipline</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イ&#8203;ベ&#8203;ン&#8203;ト&#8203;駆&#8203;動&#8203;型&#8203;の&#8203;ア&#8203;ル&#8203;ゴ&#8203;リ&#8203;ズ&#8203;ム&#8203;ト&#8203;レー&#8203;ディ&#8203;ン&#8203;グ&#8203;の&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/quantopian/zipline" class="bare">https://github.com/quantopian/zipline</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">backtrader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;と&#8203;ラ&#8203;イ&#8203;ブ&#8203;ト&#8203;レー&#8203;ド&#8203;の&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/mementum/backtrader" class="bare">https://github.com/mementum/backtrader</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">qlib</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft&#8203;の&#8203;開&#8203;発&#8203;す&#8203;る&#8203;AI&#8203;投&#8203;資&#8203;向&#8203;け&#8203;の&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/microsoft/qlib" class="bare">https://github.com/microsoft/qlib</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alphalense</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">株&#8203;式&#8203;ファ&#8203;ク&#8203;ター&#8203;に&#8203;フォー&#8203;カ&#8203;ス&#8203;し&#8203;た&#8203;バッ&#8203;ク&#8203;テ&#8203;ス&#8203;ト&#8203;ラ&#8203;イ&#8203;ブ&#8203;ラ&#8203;リ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/quantopian/alphalens" class="bare">https://github.com/quantopian/alphalens</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_j_quantsapi">8. J-QuantsAPI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_概要">8.1. 概要</h3>
<div class="paragraph">
<p>こ&#8203;の&#8203;章&#8203;で&#8203;は、&#8203;各&#8203;種&#8203;デー&#8203;タ&#8203;を&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;で&#8203;き&#8203;る&#8203;J-QuantsAPI&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;ご&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。&#8203;API&#8203;の&#8203;詳&#8203;細&#8203;な&#8203;仕&#8203;様&#8203;は&#8203;こ&#8203;ち&#8203;ら&#8203;("https://jpx-jquants.com/apidoc.html")&#8203;を&#8203;ご&#8203;確&#8203;認&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
</div>
<div class="sect2">
<h3 id="_apiの利用">8.2. APIの利用</h3>
<div class="paragraph">
<p>API&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;に&#8203;は、&#8203;SIGNATE&#8203;で&#8203;の&#8203;コ&#8203;ン&#8203;ペ&#8203;ティ&#8203;ショ&#8203;ン&#8203;へ&#8203;の&#8203;ご&#8203;登&#8203;録&#8203;と&#8203;J-QuantsAPI&#8203;の&#8203;利&#8203;用&#8203;登&#8203;録&#8203;が&#8203;必&#8203;要&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
</div>
<div class="sect2">
<h3 id="_必要なパッケージのインポート">8.3. 必要なパッケージのインポート</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">import</span> <span class="include">os</span>
<span class="keyword">import</span> <span class="include">json</span>
<span class="keyword">import</span> <span class="include">requests</span>
<span class="keyword">import</span> <span class="include">base64</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>&#8203;パッ&#8203;ケー&#8203;ジ&#8203;名&#8203;</strong></th>
<th class="tableblock halign-left valign-top"><strong>&#8203;目&#8203;的&#8203;</strong>　</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">os</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ディ&#8203;レ&#8203;ク&#8203;ト&#8203;リ、&#8203;ファ&#8203;イ&#8203;ル&#8203;操&#8203;作&#8203;の&#8203;た&#8203;め</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">レ&#8203;ス&#8203;ポ&#8203;ン&#8203;ス&#8203;の&#8203;加&#8203;工&#8203;の&#8203;た&#8203;め</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">API&#8203;の&#8203;GET&#8203;や&#8203;POST&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;た&#8203;め</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">base64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDnet&#8203;の&#8203;ファ&#8203;イ&#8203;ル&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;API&#8203;で&#8203;Base64&#8203;形&#8203;式&#8203;で&#8203;返っ&#8203;て&#8203;く&#8203;る&#8203;デー&#8203;タ&#8203;を&#8203;デ&#8203;コー&#8203;ド&#8203;す&#8203;る&#8203;た&#8203;め</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_refresh_api">8.4. Refresh API</h3>
<div class="paragraph">
<p>は&#8203;じ&#8203;め&#8203;に、&#8203;idToken&#8203;を&#8203;リ&#8203;フ&#8203;レッ&#8203;シュ&#8203;す&#8203;る&#8203;Refresh API("/refresh")&#8203;を&#8203;ご&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。&#8203;こ&#8203;の&#8203;API&#8203;で&#8203;は、&#8203;J-Quants&#8203;の&#8203;ロ&#8203;グ&#8203;イ&#8203;ン&#8203;後&#8203;の&#8203;画&#8203;面&#8203;で&#8203;ご&#8203;確&#8203;認&#8203;い&#8203;た&#8203;だ&#8203;く&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る&#8203;refreshToken&#8203;を&#8203;使&#8203;用&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>Refresh API&#8203;を&#8203;使&#8203;う&#8203;た&#8203;め&#8203;の&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;コー&#8203;ド&#8203;は&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">call_refresh_api</span>(refreshtoken: <span class="predefined">str</span>):
    <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">    idTokenをリフレッシュするメソッド。</span><span class="content">
</span><span class="content">
</span><span class="content">    Parameters</span><span class="content">
</span><span class="content">    ----------</span><span class="content">
</span><span class="content">    refreshtoken : str</span><span class="content">
</span><span class="content">        refreshtoken。ログイン後の画面からご確認いただけます。</span><span class="content">
</span><span class="content">
</span><span class="content">    Returns</span><span class="content">
</span><span class="content">    -------</span><span class="content">
</span><span class="content">    resjson : dict</span><span class="content">
</span><span class="content">        新しいidtokenが格納されたAPIレスポンス(json形式)</span><span class="content">
</span><span class="content">    </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    headers = {<span class="string"><span class="delimiter">&quot;</span><span class="content">accept</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>}
    data = {<span class="string"><span class="delimiter">&quot;</span><span class="content">refresh-token</span><span class="delimiter">&quot;</span></span>: refreshtoken}

    response = requests.post(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">https://api.jpx-jquants.com/refresh</span><span class="delimiter">&quot;</span></span>, headers=headers, data=json.dumps(data)
    )

    resjson = json.loads(response.text)
    <span class="keyword">return</span> resjson</code></pre>
</div>
</div>
<div class="paragraph">
<p>こ&#8203;の&#8203;API&#8203;を&#8203;使&#8203;う&#8203;こ&#8203;と&#8203;で&#8203;新&#8203;し&#8203;い&#8203;idtoken&#8203;を&#8203;払&#8203;い&#8203;出&#8203;す&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;使&#8203;用&#8203;例&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">refreshtoken = &lt;Your refreshtoken&gt;
call_refresh_api(refreshtoken)</code></pre>
</div>
</div>
<div class="paragraph">
<p>以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;レ&#8203;ス&#8203;ポ&#8203;ン&#8203;ス&#8203;が&#8203;返&#8203;り&#8203;ま&#8203;す。&#8203;な&#8203;お、&#8203;idtoken&#8203;の&#8203;有&#8203;効&#8203;期&#8203;限&#8203;は&#8203;１&#8203;時&#8203;間&#8203;（3600sec）&#8203;と&#8203;なっ&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">idToken</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Your New idtoken&gt;</span><span class="delimiter">&quot;</span></span>,
<span class="key"><span class="delimiter">&quot;</span><span class="content">expiresIn</span><span class="delimiter">&quot;</span></span>: <span class="integer">3600</span>}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_共通で使用するメソッド">8.5. 共通で使用するメソッド</h3>
<div class="paragraph">
<p>こ&#8203;こ&#8203;で&#8203;は、&#8203;API&#8203;共&#8203;通&#8203;の&#8203;関&#8203;数&#8203;を&#8203;用&#8203;意&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>サ&#8203;ン&#8203;プ&#8203;ル&#8203;コー&#8203;ド&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。&#8203;引&#8203;数&#8203;"apitype"&#8203;に&#8203;各&#8203;API&#8203;を&#8203;指&#8203;定&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;呼&#8203;び&#8203;出&#8203;す&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">d</span><span class="error">e</span><span class="error">f</span> <span class="error">c</span><span class="error">a</span><span class="error">l</span><span class="error">l</span><span class="error">_</span><span class="error">j</span><span class="error">q</span><span class="error">u</span><span class="error">a</span><span class="error">n</span><span class="error">t</span><span class="error">s</span><span class="error">_</span><span class="error">a</span><span class="error">p</span><span class="error">i</span><span class="error">(</span><span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span>: <span class="error">d</span><span class="error">i</span><span class="error">c</span><span class="error">t</span>, <span class="error">i</span><span class="error">d</span><span class="error">t</span><span class="error">o</span><span class="error">k</span><span class="error">e</span><span class="error">n</span>: <span class="error">s</span><span class="error">t</span><span class="error">r</span>, <span class="error">a</span><span class="error">p</span><span class="error">i</span><span class="error">t</span><span class="error">y</span><span class="error">p</span><span class="error">e</span>: <span class="error">s</span><span class="error">t</span><span class="error">r</span>, <span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span>: <span class="error">s</span><span class="error">t</span><span class="error">r</span> <span class="error">=</span> <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>:
    <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="string"><span class="delimiter">&quot;</span><span class="content">
    J-QuantsのAPIを試すメソッド。

    Parameters
    ----------
    params : dict
        リクエストパラメータ。
    idtoken : str
        idTokenはログイン後の画面からご確認いただけます。
    apitype: str
        APIの種類。</span><span class="delimiter">&quot;</span></span><span class="error">n</span><span class="error">e</span><span class="error">w</span><span class="error">s</span><span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span><span class="error">p</span><span class="error">r</span><span class="error">i</span><span class="error">c</span><span class="error">e</span><span class="error">s</span><span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span><span class="error">l</span><span class="error">i</span><span class="error">s</span><span class="error">t</span><span class="error">s</span><span class="string"><span class="delimiter">&quot;</span><span class="content">などがあります。
    code: str
        銘柄を指定するAPIの場合に設定します。

    Returns
    -------
    resjson : dict
        APIレスポンス(json形式)
    </span><span class="delimiter">&quot;</span></span><span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
    <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">e</span><span class="error">f</span><span class="error">r</span><span class="error">o</span><span class="error">m</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">datefrom</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">e</span><span class="error">t</span><span class="error">o</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">dateto</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">e</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">i</span><span class="error">n</span><span class="error">c</span><span class="error">l</span><span class="error">u</span><span class="error">d</span><span class="error">e</span><span class="error">d</span><span class="error">e</span><span class="error">t</span><span class="error">a</span><span class="error">i</span><span class="error">l</span><span class="error">s</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="error">)</span>
    <span class="error">k</span><span class="error">e</span><span class="error">y</span><span class="error">w</span><span class="error">o</span><span class="error">r</span><span class="error">d</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">keyword</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">l</span><span class="error">i</span><span class="error">n</span><span class="error">e</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">n</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">t</span><span class="error">o</span><span class="error">k</span><span class="error">e</span><span class="error">n</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">nextToken</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">e</span><span class="error">r</span><span class="error">s</span> <span class="error">=</span> {<span class="key"><span class="delimiter">&quot;</span><span class="content">accept</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">Authorization</span><span class="delimiter">&quot;</span></span>: <span class="error">i</span><span class="error">d</span><span class="error">t</span><span class="error">o</span><span class="error">k</span><span class="error">e</span><span class="error">n</span>}
    <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">a</span> <span class="error">=</span> {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>: <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">e</span><span class="error">f</span><span class="error">r</span><span class="error">o</span><span class="error">m</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>: <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">e</span><span class="error">t</span><span class="error">o</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">includeDetails</span><span class="delimiter">&quot;</span></span>: <span class="error">i</span><span class="error">n</span><span class="error">c</span><span class="error">l</span><span class="error">u</span><span class="error">d</span><span class="error">e</span><span class="error">d</span><span class="error">e</span><span class="error">t</span><span class="error">a</span><span class="error">i</span><span class="error">l</span><span class="error">s</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">nextToken</span><span class="delimiter">&quot;</span></span>: <span class="error">n</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">t</span><span class="error">o</span><span class="error">k</span><span class="error">e</span><span class="error">n</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>: <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">e</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">keyword</span><span class="delimiter">&quot;</span></span>: <span class="error">k</span><span class="error">e</span><span class="error">y</span><span class="error">w</span><span class="error">o</span><span class="error">r</span><span class="error">d</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>: <span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">l</span><span class="error">i</span><span class="error">n</span><span class="error">e</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>: <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span>,
    }

    <span class="error">i</span><span class="error">f</span> <span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span>:
        <span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span> <span class="error">=</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> <span class="error">+</span> <span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span>
        <span class="error">r</span> <span class="error">=</span> <span class="error">r</span><span class="error">e</span><span class="error">q</span><span class="error">u</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span>
            <span class="string"><span class="delimiter">&quot;</span><span class="content">https://api.jpx-jquants.com/</span><span class="delimiter">&quot;</span></span> <span class="error">+</span> <span class="error">a</span><span class="error">p</span><span class="error">i</span><span class="error">t</span><span class="error">y</span><span class="error">p</span><span class="error">e</span> <span class="error">+</span> <span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span>,
            <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">=</span><span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">a</span>,
            <span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">=</span><span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">e</span><span class="error">r</span><span class="error">s</span>,
        <span class="error">)</span>
    <span class="error">e</span><span class="error">l</span><span class="error">s</span><span class="error">e</span>:
        <span class="error">r</span> <span class="error">=</span> <span class="error">r</span><span class="error">e</span><span class="error">q</span><span class="error">u</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span>
            <span class="string"><span class="delimiter">&quot;</span><span class="content">https://api.jpx-jquants.com/</span><span class="delimiter">&quot;</span></span> <span class="error">+</span> <span class="error">a</span><span class="error">p</span><span class="error">i</span><span class="error">t</span><span class="error">y</span><span class="error">p</span><span class="error">e</span>, <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">=</span><span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">a</span>, <span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">=</span><span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">e</span><span class="error">r</span><span class="error">s</span>
        <span class="error">)</span>
    <span class="error">r</span><span class="error">e</span><span class="error">s</span><span class="error">j</span><span class="error">s</span><span class="error">o</span><span class="error">n</span> <span class="error">=</span> <span class="error">j</span><span class="error">s</span><span class="error">o</span><span class="error">n</span><span class="error">.</span><span class="error">l</span><span class="error">o</span><span class="error">a</span><span class="error">d</span><span class="error">s</span><span class="error">(</span><span class="error">r</span><span class="error">.</span><span class="error">t</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">)</span>
    <span class="error">r</span><span class="error">e</span><span class="error">t</span><span class="error">u</span><span class="error">r</span><span class="error">n</span> <span class="error">r</span><span class="error">e</span><span class="error">s</span><span class="error">j</span><span class="error">s</span><span class="error">o</span><span class="error">n</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stock_lists_api">8.6. Stock Lists API</h3>
<div class="paragraph">
<p>銘&#8203;柄&#8203;一&#8203;覧&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;API&#8203;に&#8203;つ&#8203;い&#8203;て&#8203;紹&#8203;介&#8203;い&#8203;た&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>こ&#8203;の&#8203;API&#8203;で&#8203;は、&#8203;企&#8203;業&#8203;名&#8203;や&#8203;業&#8203;種&#8203;区&#8203;分&#8203;な&#8203;ど&#8203;の&#8203;基&#8203;本&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;全&#8203;銘&#8203;柄&#8203;の&#8203;一&#8203;覧&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;"/lists"&#8203;と&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;を&#8203;指&#8203;定&#8203;し&#8203;た&#8203;"/lists/{code}"&#8203;が&#8203;利&#8203;用&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">idtk=&lt;your idtoken&gt;
<span class="comment"># Codeを指定しない場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">lists</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># Codeを指定する場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">lists</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>レ&#8203;ス&#8203;ポ&#8203;ン&#8203;ス&#8203;は&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>: [{<span class="key"><span class="delimiter">&quot;</span><span class="content">33 Sector(name)</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Other Financing Business</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Effective Date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">20201230</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">prediction_target</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Section/Products</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">First Section (Domestic)</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">33 Sector(Code)</span><span class="delimiter">&quot;</span></span>: <span class="float">7200.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Name (English)</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Japan Exchange Group,Inc.</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">IssuedShareEquityQuote IssuedShare</span><span class="delimiter">&quot;</span></span>: <span class="float">536351448.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>}]}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prices_api">8.7. Prices API</h3>
<div class="paragraph">
<p>株&#8203;価&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;Price API&#8203;を&#8203;ご&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>検&#8203;索&#8203;期&#8203;間&#8203;や&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;を&#8203;指&#8203;定&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;四&#8203;本&#8203;値、&#8203;売&#8203;買&#8203;高、&#8203;前&#8203;日&#8203;比&#8203;変&#8203;化&#8203;率&#8203;な&#8203;ど&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;を&#8203;指&#8203;定&#8203;す&#8203;る&#8203;場&#8203;合&#8203;は&#8203;"/prices/{code}"&#8203;で&#8203;API&#8203;を&#8203;ご&#8203;利&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。&#8203;"includeDetails"&#8203;を&#8203;True&#8203;に&#8203;し&#8203;た&#8203;場&#8203;合&#8203;は、&#8203;全&#8203;て&#8203;の&#8203;デー&#8203;タ&#8203;系&#8203;列&#8203;を&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">idtk=&lt;your idtoken&gt;
<span class="comment"># Codeを指定しない場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-12-30</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">prices</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># Codeを指定する場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">datefrom</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-17</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">dateto</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-31</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">prices</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>レ&#8203;ス&#8203;ポ&#8203;ン&#8203;ス&#8203;の&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">prices</span><span class="delimiter">&quot;</span></span>: [{<span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Open</span><span class="delimiter">&quot;</span></span>: <span class="float">2005.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousClose</span><span class="delimiter">&quot;</span></span>: <span class="float">1972.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote CumulativeAdjustmentFactor</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote VWAP</span><span class="delimiter">&quot;</span></span>: <span class="float">1994.792</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Low</span><span class="delimiter">&quot;</span></span>: <span class="float">1989.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>: <span class="float">1972.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote High</span><span class="delimiter">&quot;</span></span>: <span class="float">2008.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/20</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Close</span><span class="delimiter">&quot;</span></span>: <span class="float">1990.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousExchangeOfficialCloseDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/17</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>: <span class="float">1990.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ChangeFromPreviousClose</span><span class="delimiter">&quot;</span></span>: <span class="float">18.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PercentChangeFromPreviousClose</span><span class="delimiter">&quot;</span></span>: <span class="float">0.913</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousCloseDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/17</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Volume</span><span class="delimiter">&quot;</span></span>: <span class="float">528600.0</span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Open</span><span class="delimiter">&quot;</span></span>: <span class="float">1989.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousClose</span><span class="delimiter">&quot;</span></span>: <span class="float">1990.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote CumulativeAdjustmentFactor</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote VWAP</span><span class="delimiter">&quot;</span></span>: <span class="float">1976.539</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Low</span><span class="delimiter">&quot;</span></span>: <span class="float">1965.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>: <span class="float">1990.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote High</span><span class="delimiter">&quot;</span></span>: <span class="float">1995.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/21</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Close</span><span class="delimiter">&quot;</span></span>: <span class="float">1977.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousExchangeOfficialCloseDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/20</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>: <span class="float">1977.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ChangeFromPreviousClose</span><span class="delimiter">&quot;</span></span>: <span class="float">-13.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PercentChangeFromPreviousClose</span><span class="delimiter">&quot;</span></span>: <span class="float">-0.653</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousCloseDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/20</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Volume</span><span class="delimiter">&quot;</span></span>: <span class="float">571000.0</span>},
    <span class="error">.</span><span class="error">.</span><span class="error">.</span>]}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stock_fins_api">8.8. Stock Fins API</h3>
<div class="paragraph">
<p>各&#8203;銘&#8203;柄&#8203;の&#8203;財&#8203;務&#8203;諸&#8203;表&#8203;デー&#8203;タ&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;API&#8203;を&#8203;ご&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>特&#8203;定&#8203;の&#8203;日&#8203;の&#8203;全&#8203;銘&#8203;柄&#8203;の&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;"/stockfins"&#8203;と&#8203;１&#8203;銘&#8203;柄&#8203;の&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;"/stockfins/{code}"&#8203;が&#8203;ご&#8203;ざ&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">idtk=&lt;your idtoken&gt;
<span class="comment"># Codeを指定しない場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-12-30</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">stockfins</span><span class="delimiter">&quot;</span></span>)


<span class="comment"># Codeを指定する場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">datefrom</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-01</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">dateto</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-12-30</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">stockfins</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>レ&#8203;ス&#8203;ポ&#8203;ン&#8203;ス&#8203;は&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">stockfin</span><span class="delimiter">&quot;</span></span>: [{<span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement TotalAssets</span><span class="delimiter">&quot;</span></span>: <span class="float">56671198.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">base_date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/30</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement FiscalPeriodEnd</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2019/12</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Q3</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OrdinaryIncome</span><span class="delimiter">&quot;</span></span>: <span class="float">48586.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromOperatingActivities</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetSales</span><span class="delimiter">&quot;</span></span>: <span class="float">87433.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromFinancingActivities</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromInvestingActivities</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement AccountingStandard</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ConsolidatedIFRS</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetIncome</span><span class="delimiter">&quot;</span></span>: <span class="float">33317.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OperatingIncome</span><span class="delimiter">&quot;</span></span>: <span class="float">48176.0</span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement TotalAssets</span><span class="delimiter">&quot;</span></span>: <span class="float">56671198.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">base_date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/03/23</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement FiscalPeriodEnd</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2019/12</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Q3</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OrdinaryIncome</span><span class="delimiter">&quot;</span></span>: <span class="float">48586.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromOperatingActivities</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetSales</span><span class="delimiter">&quot;</span></span>: <span class="float">87433.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromFinancingActivities</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromInvestingActivities</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement AccountingStandard</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ConsolidatedIFRS</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetIncome</span><span class="delimiter">&quot;</span></span>: <span class="float">33317.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OperatingIncome</span><span class="delimiter">&quot;</span></span>: <span class="float">48176.0</span>}]}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stock_labels_api">8.9. Stock Labels API</h3>
<div class="paragraph">
<p>基&#8203;準&#8203;日&#8203;か&#8203;ら&#8203;一&#8203;定&#8203;期&#8203;間&#8203;の&#8203;株&#8203;価&#8203;の&#8203;最&#8203;大&#8203;上&#8203;昇&#8203;率、&#8203;最&#8203;大&#8203;下&#8203;落&#8203;率&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;API&#8203;を&#8203;ご&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>Stock Labels API&#8203;は&#8203;期&#8203;間&#8203;や&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;を&#8203;指&#8203;定&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で&#8203;該&#8203;当&#8203;す&#8203;る&#8203;株&#8203;価&#8203;騰&#8203;落&#8203;率&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;取&#8203;得&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># Codeを指定しない場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2018-05-31</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">stocklabels</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># Codeを指定する場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-01</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-28</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">stocklabels</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1301</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>レ&#8203;ス&#8203;ポ&#8203;ン&#8203;ス&#8203;の&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">labels</span><span class="delimiter">&quot;</span></span>: [{<span class="key"><span class="delimiter">&quot;</span><span class="content">label_low_10</span><span class="delimiter">&quot;</span></span>: <span class="float">-0.01748</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_low_20</span><span class="delimiter">&quot;</span></span>: <span class="float">-0.10699</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_low_5</span><span class="delimiter">&quot;</span></span>: <span class="float">0.0021</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>: <span class="float">0.02203</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">base_date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-04</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_high_10</span><span class="delimiter">&quot;</span></span>: <span class="float">0.02203</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_date_5</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-12</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_date_10</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-19</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_high_5</span><span class="delimiter">&quot;</span></span>: <span class="float">0.02203</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_date_20</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-03-05</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1301</span><span class="delimiter">&quot;</span></span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">label_low_10</span><span class="delimiter">&quot;</span></span>: <span class="float">-0.02507</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_low_20</span><span class="delimiter">&quot;</span></span>: <span class="float">-0.11072</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_low_5</span><span class="delimiter">&quot;</span></span>: <span class="float">-0.00557</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>: <span class="float">0.01776</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">base_date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-05</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_high_10</span><span class="delimiter">&quot;</span></span>: <span class="float">0.01776</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_date_5</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-13</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_date_10</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-20</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_high_5</span><span class="delimiter">&quot;</span></span>: <span class="float">0.01776</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_date_20</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-03-06</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1301</span><span class="delimiter">&quot;</span></span>}],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">scrollId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">eyJMb2NhbCBDb2RlIjogIjEzMDEiLCAiYmFzZV9kYXRlIjogIjIwMjAtMDItMDUifQ==</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_news_api">8.10. News API</h3>
<div class="paragraph">
<p>日&#8203;経&#8203;新&#8203;聞&#8203;の&#8203;記&#8203;事&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;API&#8203;を&#8203;ご&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>News API&#8203;は&#8203;ヘッ&#8203;ド&#8203;ラ&#8203;イ&#8203;ン、&#8203;キー&#8203;ワー&#8203;ド、&#8203;期&#8203;間&#8203;な&#8203;ど&#8203;で&#8203;該&#8203;当&#8203;す&#8203;る&#8203;ニュー&#8203;ス&#8203;記&#8203;事&#8203;デー&#8203;タ&#8203;を&#8203;検&#8203;索&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">idtk=&lt;your idtoken&gt;
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">datefrom</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-01</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">dateto</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-25</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">日本取引所</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">keyword</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">エネルギー</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">news</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>レ&#8203;ス&#8203;ポ&#8203;ン&#8203;ス&#8203;フィー&#8203;ル&#8203;ド&#8203;の&#8203;詳&#8203;細&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>media_code: &#8203;媒&#8203;体&#8203;の&#8203;略&#8203;号&#8203;で&#8203;す。&#8203;今&#8203;回&#8203;は&#8203;"TNY"&#8203;の&#8203;デー&#8203;タ&#8203;の&#8203;み&#8203;提&#8203;供&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。</p>
</li>
<li>
<p>men_name: &#8203;面&#8203;の&#8203;名&#8203;前&#8203;で&#8203;す。&#8203;地&#8203;方&#8203;経&#8203;済&#8203;面&#8203;の&#8203;場&#8203;合&#8203;な&#8203;ど&#8203;に&#8203;収&#8203;録&#8203;さ&#8203;れ&#8203;ま&#8203;す&#8203;が、&#8203;今&#8203;回&#8203;は&#8203;全&#8203;て&#8203;""&#8203;で&#8203;す。</p>
</li>
<li>
<p>headline: &#8203;見&#8203;出&#8203;し&#8203;で&#8203;す。&#8203;改&#8203;行&#8203;コー&#8203;ド&#8203;"\n"&#8203;が&#8203;含&#8203;ま&#8203;れ&#8203;ま&#8203;す。</p>
</li>
<li>
<p>keywords: &#8203;記&#8203;事&#8203;の&#8203;文&#8203;中&#8203;か&#8203;ら&#8203;主&#8203;題&#8203;語&#8203;と&#8203;し&#8203;て&#8203;切&#8203;り&#8203;出&#8203;し&#8203;た&#8203;キー&#8203;ワー&#8203;ド&#8203;で&#8203;す。&#8203;改&#8203;行&#8203;コー&#8203;ド&#8203;"\n"&#8203;で&#8203;そ&#8203;れ&#8203;ぞ&#8203;れ&#8203;の&#8203;キー&#8203;ワー&#8203;ド&#8203;が&#8203;区&#8203;切&#8203;ら&#8203;れ&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。</p>
</li>
<li>
<p>classifications: &#8203;記&#8203;事&#8203;の&#8203;分&#8203;類&#8203;で&#8203;す。&#8203;当&#8203;該&#8203;記&#8203;事&#8203;に&#8203;紐&#8203;づ&#8203;く&#8203;さ&#8203;ま&#8203;ざ&#8203;ま&#8203;な&#8203;コー&#8203;ド&#8203;が&#8203;収&#8203;録&#8203;さ&#8203;れ&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。&#8203;マ&#8203;ス&#8203;タ&#8203;デー&#8203;タ&#8203;は&#8203;
<a href="https://jquantsmastertable.s3-ap-northeast-1.amazonaws.com/newsmaster.zip">こちら</a>&#8203;か&#8203;ら&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;い&#8203;た&#8203;だ&#8203;け&#8203;ま&#8203;す。</p>
<div class="ulist">
<ul>
<li>
<p>"＃W〜&#8203;": &#8203;記&#8203;事&#8203;の&#8203;主&#8203;題&#8203;を&#8203;表&#8203;す&#8203;内&#8203;容&#8203;別&#8203;の&#8203;136&#8203;分&#8203;類&#8203;で&#8203;す。&#8203;分&#8203;類&#8203;体&#8203;系&#8203;は&#8203;「企&#8203;業&#8203;活&#8203;動」&#8203;（大&#8203;分&#8203;類：&#8203;企&#8203;業）&#8203;と&#8203;「企&#8203;業&#8203;を&#8203;取&#8203;り&#8203;巻&#8203;く&#8203;環&#8203;境」&#8203;（大&#8203;分&#8203;類：&#8203;政&#8203;治・&#8203;経&#8203;済・&#8203;技&#8203;術・&#8203;社&#8203;会）&#8203;か&#8203;ら&#8203;構&#8203;成&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。&#8203;マ&#8203;ス&#8203;タ&#8203;デー&#8203;タ&#8203;は&#8203;theme.csv&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</li>
<li>
<p>"＃B〜&#8203;": &#8203;記&#8203;事&#8203;の&#8203;主&#8203;題&#8203;と&#8203;関&#8203;連&#8203;す&#8203;る&#8203;業&#8203;界&#8203;別&#8203;の&#8203;63&#8203;分&#8203;類&#8203;で&#8203;す。&#8203;日&#8203;経&#8203;新&#8203;業&#8203;種&#8203;分&#8203;類&#8203;を&#8203;元&#8203;に&#8203;定&#8203;義&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。&#8203;マ&#8203;ス&#8203;タ&#8203;デー&#8203;タ&#8203;は&#8203;industry.csv&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</li>
<li>
<p>"＃A〜&#8203;": &#8203;記&#8203;事&#8203;の&#8203;主&#8203;題&#8203;と&#8203;関&#8203;連&#8203;す&#8203;る&#8203;地&#8203;域&#8203;別&#8203;に&#8203;「海&#8203;外&#8203;地&#8203;域」&#8203;「国」&#8203;「国&#8203;内&#8203;地&#8203;域」&#8203;単&#8203;位&#8203;で&#8203;分&#8203;類&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。&#8203;マ&#8203;ス&#8203;タ&#8203;デー&#8203;タ&#8203;は&#8203;region.csv&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</li>
<li>
<p>"＃K〜&#8203;": &#8203;記&#8203;事&#8203;種&#8203;別&#8203;で&#8203;す。&#8203;記&#8203;事&#8203;の&#8203;タ&#8203;イ&#8203;プ&#8203;別&#8203;に&#8203;７&#8203;種&#8203;類&#8203;に&#8203;分&#8203;類&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。</p>
</li>
<li>
<p>"＃T〜&#8203;": &#8203;株&#8203;式&#8203;コー&#8203;ド&#8203;で&#8203;す。</p>
</li>
<li>
<p>"＃N〜&#8203;": &#8203;日&#8203;経&#8203;会&#8203;社&#8203;コー&#8203;ド&#8203;で&#8203;す。</p>
</li>
<li>
<p>"＃PD〜&#8203;": &#8203;業&#8203;界&#8203;コー&#8203;ド&#8203;で&#8203;す。&#8203;株&#8203;式&#8203;コー&#8203;ド&#8203;お&#8203;よ&#8203;び&#8203;一&#8203;部&#8203;主&#8203;要&#8203;企&#8203;業&#8203;の&#8203;日&#8203;経&#8203;会&#8203;社&#8203;コー&#8203;ド&#8203;を&#8203;一&#8203;括&#8203;し&#8203;て&#8203;指&#8203;定&#8203;可&#8203;能&#8203;な&#8203;コー&#8203;ド&#8203;で&#8203;す。&#8203;マ&#8203;ス&#8203;タ&#8203;デー&#8203;タ&#8203;は&#8203;industry2.csv&#8203;を&#8203;ご&#8203;参&#8203;照&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</li>
<li>
<p>コ&#8203;ラ&#8203;ム&#8203;名&#8203;: &#8203;主&#8203;要&#8203;な&#8203;コ&#8203;ラ&#8203;ム&#8203;や&#8203;大&#8203;型&#8203;連&#8203;載&#8203;記&#8203;事&#8203;が&#8203;検&#8203;索&#8203;可&#8203;能&#8203;で&#8203;す。&#8203;例&#8203;え&#8203;ば&#8203;「春&#8203;秋」&#8203;な&#8203;ど。</p>
</li>
<li>
<p>"＄〜&#8203;": &#8203;記&#8203;事&#8203;分&#8203;類&#8203;キー&#8203;ワー&#8203;ド&#8203;で&#8203;す。&#8203;新&#8203;聞&#8203;を&#8203;紙&#8203;面&#8203;単&#8203;位&#8203;で&#8203;指&#8203;定&#8203;可&#8203;能&#8203;で&#8203;す。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>レ&#8203;ス&#8203;ポ&#8203;ン&#8203;ス&#8203;の&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">news</span><span class="delimiter">&quot;</span></span>: [{<span class="key"><span class="delimiter">&quot;</span><span class="content">article_id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TDSKDBDGXLASFL21HM9_21022020000000</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">publish_datetime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-21T16:34:00Z</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">media_code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TNY</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">media_name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">日本経済新聞電子版</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">men_name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">日本取引所ＣＥＯ、東商取のエネルギー市場「早期に統合したい」</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">keywords</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">最高経営責任者</span><span class="char">\n</span><span class="content">東京商品取引所</span><span class="char">\n</span><span class="content">日本取引所グループ</span><span class="char">\n</span><span class="content">清田瞭</span><span class="char">\n</span><span class="content">エネルギー市場</span><span class="char">\n</span><span class="content">大阪取引所</span><span class="char">\n</span><span class="content">統合</span><span class="char">\n</span><span class="content">定例</span><span class="char">\n</span><span class="content">早期</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">classifications</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Ｔ８６９７</span><span class="char">\n</span><span class="content">ＰＤ５２１</span><span class="char">\n</span><span class="content">Ｎ００４０４３１</span><span class="char">\n</span><span class="content">Ｎ００７５１０７</span><span class="char">\n</span><span class="content">Ｎ００４０７７９</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">stock_code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>}],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">scrollId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FGluY2x1ZGVfY29u</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tdnet_api">8.11. TDnet API</h3>
<div class="paragraph">
<p>適&#8203;時&#8203;開&#8203;示&#8203;を&#8203;取&#8203;得&#8203;で&#8203;き&#8203;る&#8203;TDnetAPI&#8203;を&#8203;紹&#8203;介&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>TDnetAPI&#8203;は&#8203;TDnet&#8203;で&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;た&#8203;資&#8203;料&#8203;に&#8203;関&#8203;す&#8203;る&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得、&#8203;ま&#8203;た&#8203;は&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;る&#8203;api&#8203;で&#8203;す。</p>
</div>
<div class="paragraph">
<p>資&#8203;料&#8203;に&#8203;関&#8203;す&#8203;る&#8203;情&#8203;報&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;API&#8203;は、&#8203;通&#8203;常&#8203;は&#8203;("/tdfiles")、&#8203;銘&#8203;柄&#8203;コー&#8203;ド&#8203;を&#8203;指&#8203;定&#8203;す&#8203;る&#8203;場&#8203;合&#8203;は、”&#8203;/tdnet/{code}&#8203;で&#8203;API&#8203;を&#8203;ご&#8203;利&#8203;用&#8203;く&#8203;だ&#8203;さ&#8203;い。
"includeDetails"&#8203;を&#8203;True&#8203;に&#8203;し&#8203;た&#8203;場&#8203;合&#8203;は、&#8203;全&#8203;て&#8203;の&#8203;デー&#8203;タ&#8203;系&#8203;列&#8203;を&#8203;取&#8203;得&#8203;し&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">idtk=&lt;your idtoken&gt;
<span class="comment"># Codeを指定しない場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-12-30</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">tdnet</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># Codeを指定する場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">datefrom</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-01</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">dateto</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-28</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">tdnet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>レ&#8203;ス&#8203;ポ&#8203;ン&#8203;ス&#8203;の&#8203;サ&#8203;ン&#8203;プ&#8203;ル&#8203;は&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;に&#8203;な&#8203;り&#8203;ま&#8203;す。&#8203;な&#8203;お&#8203;disclosureItems&#8203;は&#8203;公&#8203;開&#8203;項&#8203;目&#8203;コー&#8203;ド&#8203;を&#8203;示&#8203;し&#8203;ま&#8203;す。&#8203;一&#8203;覧&#8203;は&#8203;こ&#8203;ち&#8203;ら&#8203;か&#8203;ら&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">tdnet</span><span class="delimiter">&quot;</span></span>: [{<span class="key"><span class="delimiter">&quot;</span><span class="content">pdfSumaryFlag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">modifiedHistory</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ＪＰＸ</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">11384</span><span class="delimiter">&quot;</span></span>],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">86970</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosedDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-30</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-30:12:00:00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">handlingType</span><span class="delimiter">&quot;</span></span>: <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosedTime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">12:00:00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">pdfGeneralFlag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">20200129453073</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">xbrlFlag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020年３月期 第３四半期決算短信〔ＩＦＲＳ〕（連結） </span><span class="delimiter">&quot;</span></span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">pdfSumaryFlag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">modifiedHistory</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ＪＰＸ</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">11804</span><span class="delimiter">&quot;</span></span>],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">86970</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosedDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-30</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-30:12:00:00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">handlingType</span><span class="delimiter">&quot;</span></span>: <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosedTime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">12:00:00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">pdfGeneralFlag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">20200129453074</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">xbrlFlag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Consolidated financial results for the nine months ended December 31, 2019</span><span class="delimiter">&quot;</span></span>},
    <span class="error">.</span><span class="error">.</span><span class="error">.</span>]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>公&#8203;開&#8203;項&#8203;目&#8203;コー&#8203;ド&#8203;を&#8203;用&#8203;い&#8203;る&#8203;と&#8203;出&#8203;力&#8203;結&#8203;果&#8203;を&#8203;絞&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;可&#8203;能&#8203;で&#8203;す。
例&#8203;え&#8203;ば、&#8203;第&#8203;三&#8203;四&#8203;半&#8203;期&#8203;決&#8203;算&#8203;短&#8203;信&#8203;（連&#8203;結・&#8203;日&#8203;本&#8203;基&#8203;準・&#8203;公&#8203;開&#8203;項&#8203;目&#8203;コー&#8203;ド&#8203;11310）&#8203;は&#8203;以&#8203;下&#8203;の&#8203;よ&#8203;う&#8203;な&#8203;コー&#8203;ド&#8203;と&#8203;な&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">resp = call_jquants_api({}, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">tdnet</span><span class="delimiter">&quot;</span></span>)
[f <span class="keyword">for</span> f <span class="keyword">in</span> resp[<span class="string"><span class="delimiter">&quot;</span><span class="content">tdnet</span><span class="delimiter">&quot;</span></span>] <span class="keyword">if</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">11310</span><span class="delimiter">&quot;</span></span> <span class="keyword">in</span> f[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>こ&#8203;ち&#8203;ら&#8203;の&#8203;コー&#8203;ド&#8203;を&#8203;実&#8203;行&#8203;す&#8203;る&#8203;と、&#8203;第&#8203;3&#8203;四&#8203;半&#8203;期&#8203;決&#8203;算&#8203;短&#8203;信&#8203;の&#8203;み&#8203;抽&#8203;出&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Ｊ－インターライフ</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">11310</span><span class="delimiter">&quot;</span></span>],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2021-01-13:16:00:00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">14180</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">handlingType</span><span class="delimiter">&quot;</span></span>: <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">20210112443207</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2021年２月期</span><span class="char">\u3000</span><span class="content">第３四半期決算短信〔日本基準〕（連結）</span><span class="delimiter">&quot;</span></span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Ｓ</span><span class="char">\u3000</span><span class="content">ＦＯＯＤＳ</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">11310</span><span class="delimiter">&quot;</span></span>],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2021-01-13:15:00:00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">22920</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">handlingType</span><span class="delimiter">&quot;</span></span>: <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">20210113443358</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2021年２月期第３四半期決算短信〔日本基準〕(連結)</span><span class="delimiter">&quot;</span></span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">いちご</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">11310</span><span class="delimiter">&quot;</span></span>],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2021-01-13:15:00:00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">23370</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">handlingType</span><span class="delimiter">&quot;</span></span>: <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">20210113443616</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2021年2月期 第3四半期 決算短信〔日本基準〕（連結）</span><span class="delimiter">&quot;</span></span>},
    <span class="error">.</span><span class="error">.</span><span class="error">.</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>こ&#8203;の&#8203;API&#8203;の&#8203;レ&#8203;ス&#8203;ポ&#8203;ン&#8203;ス&#8203;の&#8203;disclosureNumber&#8203;を&#8203;用&#8203;い&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;PDF&#8203;ファ&#8203;イ&#8203;ル&#8203;や&#8203;XBRL&#8203;ファ&#8203;イ&#8203;ル&#8203;を&#8203;取&#8203;得&#8203;す&#8203;る&#8203;(/tdfiles)&#8203;も&#8203;ご&#8203;ざ&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>決&#8203;算&#8203;短&#8203;信&#8203;は&#8203;サ&#8203;マ&#8203;リ&#8203;-PDF("fileTypeFlag"&#8203;が&#8203;"s")&#8203;や&#8203;XBRL("fileTypeFlag"&#8203;が&#8203;"x")&#8203;を&#8203;ダ&#8203;ウ&#8203;ン&#8203;ロー&#8203;ド&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;が&#8203;で&#8203;き&#8203;ま&#8203;す。&#8203;そ&#8203;の&#8203;ほ&#8203;か&#8203;の&#8203;資&#8203;料&#8203;は&#8203;全&#8203;文&#8203;PDF&#8203;の&#8203;み&#8203;で&#8203;す&#8203;の&#8203;で、&#8203;("fileTypeFlag"&#8203;が&#8203;"g")&#8203;を&#8203;ご&#8203;指&#8203;定&#8203;く&#8203;だ&#8203;さ&#8203;い。</p>
</div>
<div class="paragraph">
<p>た&#8203;だ&#8203;し、&#8203;こ&#8203;れ&#8203;ら&#8203;の&#8203;ファ&#8203;イ&#8203;ル&#8203;が&#8203;取&#8203;得&#8203;で&#8203;き&#8203;る&#8203;も&#8203;の&#8203;は&#8203;2020&#8203;年&#8203;以&#8203;降&#8203;開&#8203;示&#8203;さ&#8203;れ&#8203;た&#8203;も&#8203;の&#8203;に&#8203;限&#8203;り&#8203;ま&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">call_tdfiles_api</span>(params: <span class="predefined">dict</span>, idtoken: <span class="predefined">str</span>, outputdir: str = <span class="predefined-constant">None</span>):
    <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">    TDnetで開示された資料をダウンロードするAPI。</span><span class="content">
</span><span class="content">
</span><span class="content">    Parameters</span><span class="content">
</span><span class="content">    ----------</span><span class="content">
</span><span class="content">    params : dict</span><span class="content">
</span><span class="content">        リクエストパラメータ。</span><span class="content">
</span><span class="content">    idtoken : str</span><span class="content">
</span><span class="content">        idtokenはログイン後の画面からご確認いただけます。</span><span class="content">
</span><span class="content">    outputdir : str</span><span class="content">
</span><span class="content">        ダウンロードしたファイルを格納するフォルダパスを指定いただけます。</span><span class="content">
</span><span class="content">    </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    disclnum = params.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosurenumber</span><span class="delimiter">&quot;</span></span>)
    ftype = params.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">filetypeflag</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">g</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">if</span> <span class="keyword">not</span> outputdir:
        outputdir = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>

    headers = {<span class="string"><span class="delimiter">&quot;</span><span class="content">Authorization</span><span class="delimiter">&quot;</span></span>: idToken, <span class="string"><span class="delimiter">&quot;</span><span class="content">accept</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>}
    data = {<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>: disclnum, <span class="string"><span class="delimiter">&quot;</span><span class="content">fileTypeFlag</span><span class="delimiter">&quot;</span></span>: ftype}

    r = requests.get(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">https://api.jpx-jquants.com/tdfiles</span><span class="delimiter">&quot;</span></span>, params=data, headers=headers
    )
    resjson = json.loads(r.text)

    <span class="keyword">if</span> resjson[<span class="string"><span class="delimiter">&quot;</span><span class="content">responseType</span><span class="delimiter">&quot;</span></span>] == <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>:
        bjson = resjson[<span class="string"><span class="delimiter">&quot;</span><span class="content">fileData</span><span class="delimiter">&quot;</span></span>].encode()
    <span class="keyword">elif</span> resjson[<span class="string"><span class="delimiter">&quot;</span><span class="content">responseType</span><span class="delimiter">&quot;</span></span>] == <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>:
        filedata = requests.get(resjson[<span class="string"><span class="delimiter">&quot;</span><span class="content">fileUrl</span><span class="delimiter">&quot;</span></span>]).text
        bjson = filedata.encode()

    <span class="keyword">if</span> ftype == <span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>:
        fname = outputdir + <span class="string"><span class="delimiter">&quot;</span><span class="content">/x_</span><span class="delimiter">&quot;</span></span> + disclnum + <span class="string"><span class="delimiter">&quot;</span><span class="content">.zip</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">elif</span> ftype == <span class="string"><span class="delimiter">&quot;</span><span class="content">g</span><span class="delimiter">&quot;</span></span>:
        fname = outputdir + <span class="string"><span class="delimiter">&quot;</span><span class="content">/g_</span><span class="delimiter">&quot;</span></span> + disclnum + <span class="string"><span class="delimiter">&quot;</span><span class="content">.pdf</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">elif</span> ftype == <span class="string"><span class="delimiter">&quot;</span><span class="content">s</span><span class="delimiter">&quot;</span></span>:
        fname = outputdir + <span class="string"><span class="delimiter">&quot;</span><span class="content">/s_</span><span class="delimiter">&quot;</span></span> + disclnum + <span class="string"><span class="delimiter">&quot;</span><span class="content">.pdf</span><span class="delimiter">&quot;</span></span>

    <span class="keyword">with</span> <span class="predefined">open</span>(fname, <span class="string"><span class="delimiter">&quot;</span><span class="content">wb</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> theFile:
        theFile.write(base64.b64decode(bjson))

    print(<span class="string"><span class="delimiter">&quot;</span><span class="content">Finish Download: </span><span class="delimiter">&quot;</span></span> + disclnum)</code></pre>
</div>
</div>
<div class="paragraph">
<p>こ&#8203;の&#8203;メ&#8203;ソッ&#8203;ド&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;こ&#8203;と&#8203;で、&#8203;base64&#8203;形&#8203;式&#8203;の&#8203;デー&#8203;タ&#8203;を&#8203;ファ&#8203;イ&#8203;ル&#8203;に&#8203;書&#8203;き&#8203;出&#8203;す&#8203;こ&#8203;と&#8203;が&#8203;可&#8203;能&#8203;で&#8203;す。&#8203;実&#8203;際&#8203;に&#8203;こ&#8203;の&#8203;メ&#8203;ソッ&#8203;ド&#8203;を&#8203;利&#8203;用&#8203;す&#8203;る&#8203;方&#8203;法&#8203;は&#8203;以&#8203;下&#8203;の&#8203;通&#8203;り&#8203;で&#8203;す。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">idtk=&lt;your idtoken&gt;
<span class="comment"># 出力フォルダを指定</span>
outputdir = <span class="string"><span class="delimiter">&quot;</span><span class="content">./</span><span class="delimiter">&quot;</span></span>
<span class="comment"># 全文PDFを取得する場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosurenumber</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">20200129453073</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">filetypeflag</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">g</span><span class="delimiter">&quot;</span></span>
call_tdfiles_api(paramdict, idtk, outputdir)

<span class="comment"># サマリーPDFを取得する場合（決算短信で指定可能です）</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosurenumber</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">20200129453073</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">filetypeflag</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">s</span><span class="delimiter">&quot;</span></span>
call_tdfiles_api(paramdict, idtk, outputdir)

<span class="comment"># XBRLデータを取得する場合（決算短信で指定可能です）</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">disclosurenumber</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">20200129453073</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">filetypeflag</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>
call_tdfiles_api(paramdict, idtk, outputdir)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_チュートリアル作成環境の参考文献">9. チュートリアル作成環境の参考文献</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本&#8203;文&#8203;書&#8203;の&#8203;執&#8203;筆&#8203;で&#8203;は&#8203;次&#8203;の&#8203;プ&#8203;ロ&#8203;ダ&#8203;ク&#8203;ト&#8203;と&#8203;技&#8203;術&#8203;資&#8203;料&#8203;が&#8203;使&#8203;わ&#8203;れ&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="注記"></i>
</td>
<td class="content">
プ&#8203;ロ&#8203;ダ&#8203;ク&#8203;ト&#8203;名&#8203;の&#8203;隣&#8203;に&#8203;ラ&#8203;イ&#8203;セ&#8203;ン&#8203;ス&#8203;を&#8203;併&#8203;記&#8203;し&#8203;て&#8203;お&#8203;り&#8203;ま&#8203;す。
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Template</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Asciidoctor&#8203;と&#8203;Gradle&#8203;で&#8203;つ&#8203;く&#8203;る&#8203;文&#8203;書&#8203;執&#8203;筆&#8203;環&#8203;境&#8203; - MIT License -
<a href="https://h1romas4.github.io/asciidoctor-gradle-template/index.html" class="bare">https://h1romas4.github.io/asciidoctor-gradle-template/index.html</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Font</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>源&#8203;真&#8203;ゴ&#8203;シッ&#8203;ク&#8203; - SIL Open Font License 1.1  - <a href="http://jikasei.me/font/genshin/" class="bare">http://jikasei.me/font/genshin/</a></p>
</li>
<li>
<p>源&#8203;様&#8203;明&#8203;朝&#8203; - SIL Open Font License 1.1 - <a href="https://github.com/ButTaiwan/genyo-font" class="bare">https://github.com/ButTaiwan/genyo-font</a></p>
</li>
<li>
<p>Ricty Diminished - SIL Open Font License 1.1 - <a href="https://github.com/edihbrandon/RictyDiminished" class="bare">https://github.com/edihbrandon/RictyDiminished</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Asciidoc</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Asciidoctor - MIT License - <a href="https://asciidoctor.org/" class="bare">https://asciidoctor.org/</a></p>
</li>
<li>
<p>Asciidoctorj - Apache License 2.0 - <a href="https://github.com/asciidoctor/asciidoctorj" class="bare">https://github.com/asciidoctor/asciidoctorj</a></p>
</li>
<li>
<p>Asciidoctor.js - MIT License - <a href="https://asciidoctor.org/docs/asciidoctor.js/" class="bare">https://asciidoctor.org/docs/asciidoctor.js/</a></p>
</li>
<li>
<p>Asciidoctor PDF - MIT License - <a href="https://asciidoctor.org/docs/asciidoctor-pdf/" class="bare">https://asciidoctor.org/docs/asciidoctor-pdf/</a></p>
</li>
<li>
<p>Asciidoctor Gradle Plugin Suite - Apache License 2.0 - <a href="https://github.com/asciidoctor/asciidoctor-gradle-plugin" class="bare">https://github.com/asciidoctor/asciidoctor-gradle-plugin</a></p>
</li>
<li>
<p>asciidoctor-pdf-linewrap-ja - MIT License - <a href="https://github.com/fuka/asciidoctor-pdf-linewrap-ja" class="bare">https://github.com/fuka/asciidoctor-pdf-linewrap-ja</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Build Tool</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>SDKMAN - Apache License 2.0 - <a href="https://sdkman.io/" class="bare">https://sdkman.io/</a></p>
</li>
<li>
<p>Gradle - Apache License 2.0 - <a href="https://gradle.org/" class="bare">https://gradle.org/</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Text Editor</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Visual Studio Code - Microsoft - <a href="https://code.visualstudio.com/" class="bare">https://code.visualstudio.com/</a></p>
</li>
<li>
<p>asciidoctor-vscode - MIT License - <a href="https://github.com/asciidoctor/asciidoctor-vscode" class="bare">https://github.com/asciidoctor/asciidoctor-vscode</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Guide</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>asciidoctor-pdf&#8203;で&#8203;かっ&#8203;こ&#8203;い&#8203;い&#8203;PDF&#8203;を&#8203;作&#8203;る&#8203; - <a href="https://qiita.com/kuboaki/items/67774c5ebd41467b83e2" class="bare">https://qiita.com/kuboaki/items/67774c5ebd41467b83e2</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">OGP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Socialify - <a href="https://github.com/wei/socialify" class="bare">https://github.com/wei/socialify</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="_商標">9.1. 商標</h3>
<div class="ulist">
<ul>
<li>
<p>Windows、&#8203;PowerShell&#8203;は、&#8203;Microsoft Corporation &#8203;の&#8203;登&#8203;録&#8203;商&#8203;標&#8203;ま&#8203;た&#8203;は&#8203;商&#8203;標&#8203;で&#8203;す。</p>
</li>
<li>
<p>Docker &#8203;は、&#8203;Docker Inc.&#8203;の&#8203;登&#8203;録&#8203;商&#8203;標&#8203;ま&#8203;た&#8203;は&#8203;商&#8203;標&#8203;で&#8203;す。</p>
</li>
<li>
<p>CoLaboratory™ &#8203;は、&#8203;Google Inc. &#8203;の&#8203;登&#8203;録&#8203;商&#8203;標&#8203;ま&#8203;た&#8203;は&#8203;商&#8203;標&#8203;で&#8203;す。</p>
</li>
<li>
<p>GitHub &#8203;は、&#8203;GitHub Inc.&#8203;の&#8203;登&#8203;録&#8203;商&#8203;標&#8203;ま&#8203;た&#8203;は&#8203;商&#8203;標&#8203;で&#8203;す</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ライセンス">10. ライセンス</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;お&#8203;よ&#8203;び&#8203;ハ&#8203;ン&#8203;ズ&#8203;オ&#8203;ン&#8203;の&#8203;ソー&#8203;ス&#8203;コー&#8203;ド&#8203;は&#8203; <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a> &#8203;に&#8203;従&#8203;う&#8203;ラ&#8203;イ&#8203;セ&#8203;ン&#8203;ス&#8203;で&#8203;公&#8203;開&#8203;し&#8203;て&#8203;い&#8203;ま&#8203;す。</p>
</div>
<div class="paragraph">
<p>教&#8203;育&#8203;な&#8203;ど&#8203;非&#8203;商&#8203;用&#8203;の&#8203;目&#8203;的&#8203;で&#8203;の&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;使&#8203;用&#8203;や&#8203;再&#8203;配&#8203;布&#8203;は&#8203;自&#8203;由&#8203;に&#8203;行&#8203;う&#8203;こ&#8203;と&#8203;が&#8203;可&#8203;能&#8203;で&#8203;す。
商&#8203;用&#8203;目&#8203;的&#8203;で&#8203;本&#8203;チュー&#8203;ト&#8203;リ&#8203;ア&#8203;ル&#8203;の&#8203;全&#8203;体&#8203;ま&#8203;た&#8203;は&#8203;そ&#8203;の&#8203;一&#8203;部&#8203;を&#8203;無&#8203;断&#8203;で&#8203;転&#8203;載&#8203;す&#8203;る&#8203;行&#8203;為&#8203;は，&#8203;こ&#8203;れ&#8203;を&#8203;固&#8203;く&#8203;禁&#8203;じ&#8203;ま&#8203;す。</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="ChapterLicence/images/cc_by_nc_nd.png" alt="cc_by_nc_nd.png" width="400">
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
最終更新 2021-04-09 18:28:23 +0900
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "AMS" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>