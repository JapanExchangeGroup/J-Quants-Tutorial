<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<meta property="og:url" content="https://japanexchangegroup.github.io/J-Quants-Tutorial/" />
<meta property="og:type" content="website" />
<meta property="og:title" content="J-Quants-Tutorial" />
<meta property="og:description" content="（JPX）株式分析チュートリアル" />
<meta property="og:site_name" content="J-Quants-Tutorial" />
<meta property="og:image" content="https://jquants-tutorial.s3-ap-northeast-1.amazonaws.com/J-Quants-ogp.png" />
<meta name="author" content="本資料は、(株)日本取引所グループがデータサイエンスに興味のある個人向けに提供する、ITやデータ分析を活用した取引の学習を目的とした、ハンズオン形式のチュートリアルです。">
<title>株式分析チュートリアル | 日本取引所グループ</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:'Hiragino Sans',sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-weight:bold}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:"Courier New",monospace;}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
/* fix serif; body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased} */
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:'Hiragino Sans',"Noto Serif","DejaVu Serif";font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.7;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-weight:bold}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:'Hiragino Sans',"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#2d466b;text-rendering:optimizeLegibility;margin-top:1.5em;margin-bottom:1.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-weight:bold;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Courier New",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Courier New",monospace;font-size:16px;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Courier New",monospace;display:inline-block;color:rgba(0,0,0,.8);line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-weight:bold}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#2d466b;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#2d466b;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:2em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:'Hiragino Sans',"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-weight:normal}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-top:3em;margin-bottom:3em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#2d466b;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.listingblock{margin: 2em 0}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:2.25em 1em 2.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
/* fix font style; .quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-weight:bold;text-align:justify} */
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1em;line-height:1.75;word-spacing:.1em;letter-spacing:0;}
.quoteblock blockquote{margin:0;padding:0;border:0;background-color:#fff;}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#2d466b;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-weight:normal}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate;margin: 2em 0;}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock{margin: 2em 0}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock{margin: 2em 0}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>株式分析チュートリアル | 日本取引所グループ</h1>
<div class="details">
<span id="author" class="author">本資料は、(株)日本取引所グループがデータサイエンスに興味のある個人向けに提供する、ITやデータ分析を活用した取引の学習を目的とした、ハンズオン形式のチュートリアルです。</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">目次</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. はじめに</a></li>
<li><a href="#_財務諸表で株価の先行きを予測しよう">2. 財務諸表で株価の先行きを予測しよう</a>
<ul class="sectlevel2">
<li><a href="#_予測対象">2.1. 予測対象</a></li>
<li><a href="#_データセットの説明">2.2. データセットの説明</a></li>
<li><a href="#_実行環境及び必要なライブラリ">2.3. 実行環境及び必要なライブラリ</a></li>
<li><a href="#_データセットの読み込み">2.4. データセットの読み込み</a></li>
<li><a href="#_データセットの可視化">2.5. データセットの可視化</a></li>
<li><a href="#_データセットの前処理">2.6. データセットの前処理</a></li>
<li><a href="#_特徴量の生成">2.7. 特徴量の生成</a></li>
<li><a href="#_バックテスト用のテストデータ作成">2.8. バックテスト用のテストデータ作成</a></li>
<li><a href="#_モデルの構築">2.9. モデルの構築</a></li>
<li><a href="#_モデルの推論">2.10. モデルの推論</a></li>
<li><a href="#_予測結果に対する分析の道筋">2.11. 予測結果に対する分析の道筋</a></li>
<li><a href="#_モデルの評価">2.12. モデルの評価</a></li>
<li><a href="#_モデルの提出">2.13. モデルの提出</a></li>
</ul>
</li>
<li><a href="#_ニュースでポートフォリオを構築しよう">3. ニュースでポートフォリオを構築しよう</a></li>
<li><a href="#_tips集">4. tips集</a>
<ul class="sectlevel2">
<li><a href="#_コンペティションフォーラムの紹介">4.1. コンペティションフォーラムの紹介</a></li>
<li><a href="#_金融用語集">4.2. 金融用語集</a></li>
<li><a href="#_東証マネ部">4.3. 東証マネ部</a></li>
<li><a href="#_参考になる書籍">4.4. 参考になる書籍</a></li>
<li><a href="#_参考になるコンペティション">4.5. 参考になるコンペティション</a></li>
<li><a href="#_ファンダメンタルズ分析の活用方法">4.6. ファンダメンタルズ分析の活用方法</a></li>
<li><a href="#_テクニカル分析の活用方法">4.7. テクニカル分析の活用方法</a></li>
<li><a href="#_ファクター分析の活用方法">4.8. ファクター分析の活用方法</a></li>
<li><a href="#_複数個のモデルの出力をアンサンブルするアプローチ">4.9. 複数個のモデルの出力をアンサンブルするアプローチ</a></li>
<li><a href="#_プライベート期間の性能の向上のために考慮すべきこと">4.10. プライベート期間の性能の向上のために考慮すべきこと</a></li>
<li><a href="#_本コンペでは利用できないがモデルを将来的に発展させるために検討する価値のある外部データ">4.11. 本コンペでは利用できないが、モデルを将来的に発展させるために検討する価値のある外部データ</a></li>
<li><a href="#_モデルの再学習の運用について">4.12. モデルの再学習の運用について</a></li>
<li><a href="#_google_colaboratoryの使用法">4.13. Google Colaboratoryの使用法</a></li>
<li><a href="#_内国株の売買制度">4.14. 内国株の売買制度</a></li>
</ul>
</li>
<li><a href="#_j_quantsapi">5. J-QuantsAPI</a>
<ul class="sectlevel2">
<li><a href="#_概要">5.1. 概要</a></li>
<li><a href="#_apiの利用">5.2. APIの利用</a></li>
<li><a href="#_必要なパッケージのインポート">5.3. 必要なパッケージのインポート</a></li>
<li><a href="#_refresh_api">5.4. Refresh API</a></li>
<li><a href="#_共通で使用するメソッド">5.5. 共通で使用するメソッド</a></li>
<li><a href="#_stock_lists_api">5.6. Stock Lists API</a></li>
<li><a href="#_prices_api">5.7. Prices API</a></li>
<li><a href="#_stock_fins_api">5.8. Stock Fins API</a></li>
<li><a href="#_stock_labels_api">5.9. Stock Labels API</a></li>
<li><a href="#_news_api">5.10. News API</a></li>
<li><a href="#_tdnet_api">5.11. TDnet API</a></li>
</ul>
</li>
<li><a href="#_チュートリアル作成環境の参考文献">6. チュートリアル作成環境の参考文献</a>
<ul class="sectlevel2">
<li><a href="#_商標">6.1. 商標</a></li>
</ul>
</li>
<li><a href="#_ライセンス">7. ライセンス</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>本チュートリアルに関してのご質問は、SIGNATEにて開催中のコンペティションサイト( <a href="https://signate.jp/competitions/423" class="bare">https://signate.jp/competitions/423</a> )のフォーラムにおきまして、チュートリアル質問用のスレッドに投稿いただくか、タイトル冒頭に <code>[tutorial]</code> とご記載の上、ご質問していただけますと幸いです。</p>
</div>
<div class="paragraph">
<p>また、本チュートリアルに関してのご要望があれば、Githubリポジトリ( <a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial" class="bare">https://github.com/JapanExchangeGroup/J-Quants-Tutorial</a> )の <code>Issues</code> からご意見をいただけますと幸いです。 (なお、投稿の際には、過去に同じご要望がないかご確認ください。)</p>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>更新履歴</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>2021-01-29: 初版リリース
2021-02-05: 誤字や表記の修正を中心に改良
2021-02-12: ランタイム環境のデータの扱い、GoogleColaboratoryについて追記
2021-02-19: predictor.pyの修正、stocklabelsAPIの修正
2021-02-26: 予測対象のエッジケースにおいて追記</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">1. はじめに</h2>
<div class="sectionbody">
<div class="paragraph">
<p>証券市場では、長年、様々なデータや数学的手法を用いて市場を分析したり、金融商品の組成や投資戦略の立案が行われたりしてきました。以前はこのような分析を行うことができるのは、金融機関や機関投資家と呼ばれる大手の投資家に限られてきました。しかし近年では、個人の方にも、ITやデータを活用した金融市場の分析や取引が拡大しています。</p>
</div>
<div class="paragraph">
<p>日本取引所グループは、証券分野におけるデータ活用や人工知能の活用を発展させたいと考えています。日本においてもさまざまなデータの活用やデータサイエンティストの育成が推進されていますが、金融分野に特化したチュートリアルの作成やコンペティションはあまり行われてきていませんでした。</p>
</div>
<div class="paragraph">
<p>そこで、日本取引所グループは、投資にまつわるデータ・環境を提供し、個人投資家の皆様によるデータ利活用の可能性を検証するための実証実験プロジェクトとして、J-Quantsを立ち上げました。本プロジェクトでは、「ファンダメンタルズ分析チャレンジ」と「ニュース分析チャレンジ」の2本のコンペティションの開催を予定しています。本ページでは、これらのコンペティションに係る学習環境という位置付けで、ハンズオン形式のチュートリアルを提供します。本チュートリアルを学ぶことで、データサイエンスを活用した株価予測を行う際に、最低限必要な知識や実践方法を学ぶことができます。</p>
</div>
<div class="paragraph">
<p>本コンペティションは幅広い方にご参加いただけることを期待していますが、プログラミングの経験があり確率・統計の基礎などを勉強された学生の方や、他分野でのデータ分析経験をお持ちの社会人の方、金融分野での知見はあるがデータサイエンスについてこれから勉強をされたいと考えている社会人の方には特に楽しんでいただける内容となっています。</p>
</div>
<div class="paragraph">
<p>本チュートリアル及び本コンペティションを通じて金融データやデータ分析について理解を深めていただき、ポートフォリオ分析や資産運用に活用いただきたいと考えています。また、データサイエンスを学ぶ学生の方々にとっては、金融データを用いたデータ活用や人工知能の活用に関する研究にも興味を持っていただきたいと考えています。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="注記"></i>
</td>
<td class="content">
本プロジェクトの概要やハンズオンで使うソースコード類は以下のページで公開しています。
</td>
</tr>
</table>
</div>
<table class="tableblock frame-ends grid-none stripes-even stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロジェクト概要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.jpx-jquants-info.com/" class="bare">https://www.jpx-jquants-info.com/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">チュートリアル</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial" class="bare">https://github.com/JapanExchangeGroup/J-Quants-Tutorial</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jupyterノートブック</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial/tree/main/handson/Chapter02" class="bare">https://github.com/JapanExchangeGroup/J-Quants-Tutorial/tree/main/handson/Chapter02</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">J-QuantsAPI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://jpx-jquants.com/" class="bare">https://jpx-jquants.com/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンペティションサイト</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://signate.jp/competitions/423" class="bare">https://signate.jp/competitions/423</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_財務諸表で株価の先行きを予測しよう">2. 財務諸表で株価の先行きを予測しよう</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本章では、J-Quantsで開催するコンペティションのうち、「ファンダメンタルズ分析チャレンジ」（https://signate.jp/competitions/423）に係るチュートリアルを提供します。本コンペティションでは、データ分析や株式取引には興味はあるが、きっかけがないという方を主な対象として、投資にまつわるデータ・環境を提供し、株式市場におけるデータ利活用の可能性を試していただくことを期待しています。</p>
</div>
<div class="paragraph">
<p><strong>スケジュール</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>日時</strong></th>
<th class="tableblock halign-left valign-top"><strong>内容</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021年1月29日（金）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンペティション開始</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021年3月28日（日）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モデル提出締切</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021年3月29日（月） 〜 6月14日（月）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モデル評価期間</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021年7月頃</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">入賞者の決定</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>本コンペティションでは、東証上場企業（普通株式のみ。ETF及びREITは除きます。）が、決算短信（本資料では、四半期決算短信や訂正開示等を総称し、決算短信と表記します。）を発表した後の20営業日の間における、当該企業の株価の最高値及び最安値を、銘柄情報・株価情報・ファンダメンタル情報等を用いて予測いただきます。</p>
</div>
<div class="paragraph">
<p><strong>コンペティションの概要</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>項目</strong></th>
<th class="tableblock halign-left valign-top"><strong>内容</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンペティション名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファンダメンタルズ分析チャレンジ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">主な対象者</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">株式市場を対象としたデータ分析の初学者</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">入力内容（利用データ）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘柄情報・株価情報・ファンダメンタル情報等</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">出力内容（予測対象）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各東証上場企業が、決算短信を発表した後の20営業日の間における、当該企業の株価の最高値及び最安値</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">参加を通じて得られる知見</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">- 株価や企業業績の推移などの時系列データの解析手法<br>
- 市場動向の把握手法<br>
- リスク分析</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>本章の構成は、まず、2.1節にて、本コンペティションにおける予測対象等の詳細について説明し、2.2節にて、本コンペティションで提供するデータセットの仕様について説明します。そして、2.3節以降で、本コンペティションのベースラインモデルの開発からモデル提出までの一連のフローを説明します。</p>
</div>
<div class="sect2">
<h3 id="_予測対象">2.1. 予測対象</h3>
<div class="paragraph">
<p>本コンペティションの予測対象は、東証上場企業が、決算短信を発表した後の20営業日の期間における、当該企業の株価の最高値及び最安値です。 上場企業は決算期末を含め四半期毎に決算内容が定まった際、決算内容の開示が義務付けられています。決算の内容として開示される決算短信には財務諸表が添付されており、財務諸表は企業のファンダメンタル情報を含む複数の表で構成されています。</p>
</div>
<div class="paragraph">
<p>2.1.1項では予測対象の銘柄について、2.1.2項では予測対象の決算短信について、2.1.3項では本コンペティションの評価方法について、2.1.4項では本コンペティションのリーダーボードの仕様について、2.1.5項では決算短信と財務諸表の概要について、それぞれ説明します。</p>
</div>
<div class="sect3">
<h4 id="_予測対象の銘柄">2.1.1. 予測対象の銘柄</h4>
<div class="paragraph">
<p>本コンペティションの予測対象となる銘柄は、次に挙げる条件を全て満たします。</p>
</div>
<div class="paragraph">
<p>A)	2020年12月末日時点で、東京証券取引所に上場していること</p>
</div>
<div class="paragraph">
<p>B)	普通株式であること（種類株ではないこと）</p>
</div>
<div class="paragraph">
<p>C)	ETF、ETN、REIT、優先出資証券、インフラファンド、外国株のいずれにも該当しないこと</p>
</div>
<div class="paragraph">
<p>D)	2020年12月末日時点で、上場後2年を経過していること</p>
</div>
</div>
<div class="sect3">
<h4 id="_予測対象の決算短信">2.1.2. 予測対象の決算短信</h4>
<div class="paragraph">
<p>本コンペティションでは、2021年3月27日から同年5月15日の期間中に開示された決算短信を対象に、その開示日から起算して20営業日を経過した期間における、各銘柄の最高値及び最安値を予測します。厳密には、本コンペティションで予測対象となる決算短信は、次に挙げる条件を全て満たします。</p>
</div>
<div class="paragraph">
<p>A)	直近の決算期末または四半期期末に係る決算短信であること</p>
</div>
<div class="paragraph">
<p>B)	2021年3月27日から同年5月15日までの期間に開示されていること</p>
</div>
<div class="paragraph">
<p>C)	開示日及び同日から起算して20営業日を経過した日までの期間、訂正開示等が行われていないこと</p>
</div>
<div class="paragraph">
<p>D)	開示日及び同日から起算して20営業日を経過した日までの期間、上場廃止になっていないこと</p>
</div>
<div class="paragraph">
<p>条件Cに示す「訂正開示等」とは、決算発表資料の訂正、業績予想の修正・予想値と決算値との差異等、配当予想・配当予想の修正にかかる開示を指します。これらの詳細については、以下のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>決算発表資料の訂正<br>
決算短信等を開示した後に、開示した内容について、変更又は訂正すべき事情が生じた場合に義務付けられている訂正開示をいいます。</p>
</li>
<li>
<p>業績予想の修正・予想値と決算値との差異等<br>
売上高や営業利益、経常利益、当期純利益等について、公表がされた直近の予想値等と比較して、新たに算出した予想値または決算における数値に一定以上の差異が生じた場合に義務付けられている開示をいいます。</p>
</li>
<li>
<p>配当予想・配当予想の修正<br>
公表がされた直近の配当の予想値と比較して、新たに算出した予想値に差異が生じた場合を含め、剰余金の配当について予想値を算出した場合に義務付けられている開示をいいます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>また、決算短信の訂正開示等が、次に挙げる条件を全て満たす場合、これも予測対象に含まれます。</p>
</div>
<div class="paragraph">
<p>E)	直近の決算期末または四半期期末に係る決算短信に対する訂正開示等であること</p>
</div>
<div class="paragraph">
<p>F)	2021年3月27日から同年5月15日までの期間に開示されていること</p>
</div>
<div class="paragraph">
<p>G)	訂正開示等の開示日及び同日から起算して20営業日を経過した日までの期間、当該開示に対する訂正開示等が行われていないこと</p>
</div>
<div class="paragraph">
<p>H)	訂正開示等の開示日及び同日から起算して20営業日を経過した日までの期間、上場廃止になっていないこと</p>
</div>
<div class="paragraph">
<p>なお、ある同一銘柄について、これらの条件を満たす決算短信が複数存在する場合は、最も新しく開示されたもののみを予測の対象とします。</p>
</div>
<div class="paragraph">
<p>（追記：予測対象期間の20営業日の全てにおいて、株価が存在しない銘柄は、評価の対象外とします。）</p>
</div>
<div class="paragraph">
<p>以上を踏まえ、各決算短信等（訂正開示等を含みます。）が予測対象に該当するかどうかの事例を、図に示します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/predict_target.png" alt="predict_target">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_評価方法">2.1.3. 評価方法</h4>
<div class="paragraph">
<p>本コンペティションでは、モデルの予測と真の値（決算短信の開示後から起算して20営業日以内に発生する最高値及び最安値）との順位相関係数（算出式１）による定量評価方法を採用します。<br></p>
</div>
<div class="paragraph">
<p>先ず、最高値もしくは最安値への変化率について、（算出式１）を用いてそれぞれスピアマンの順位相関係数を計算します。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>（算出式１）順位相関係数の計算</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/math-sample1.svg" alt="math sample1" width="170" height="57">
</div>
</div>
<div class="paragraph">
<p>d = 対応するXとYの値の順位の差</p>
</div>
<div class="paragraph">
<p>n = 値のペアの数</p>
</div>
<div class="paragraph">
<p>dのXとYは、</p>
</div>
<div class="paragraph">
<p>X = 該当期間の決算日に対して出力されたモデルのスコア（予測値）</p>
</div>
<div class="paragraph">
<p>Y = 決算短信の開示後から起算して20営業日以内に発生した最高値もしくは最安値への変化率</p>
</div>
</div>
</div>
<div class="paragraph">
<p>(式は一部英語Wikipediaスピアマンの順位相関係数より引用 <a href="https://ja.wikipedia.org/wiki/%E3%82%B9%E3%83%94%E3%82%A2%E3%83%9E%E3%83%B3%E3%81%AE%E9%A0%86%E4%BD%8D%E7%9B%B8%E9%96%A2%E4%BF%82%E6%95%B0">https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient</a>)</p>
</div>
<div class="paragraph">
<p>その上で、それぞれの順位相関係数を以下の（算出式２）を用いて算出した統合スコアを最終スコアとして評価します。<br>
なお、最終スコアは0～8の値をとり、精度が高いほど <strong>小さな値</strong> となります。
（ただし、予測対象期間の20営業日の全てにおいて、株価が存在しない銘柄は、評価の対象外とします。）</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>（算出式２）最終スコアの計算</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/math-sample2.svg" alt="math sample2" width="291" height="33">
</div>
</div>
<div class="paragraph">
<p>P_high : 最高値の順位相関係数</p>
</div>
<div class="paragraph">
<p>P_low : 最安値の順位相関係数</p>
</div>
</div>
</div>
<div class="paragraph">
<p>今回、順位相関係数を採用する理由としては、以下の説明にもあるとおり、金融商品の価格変動の変化率の分布は必ずしも正規分布になるとは限りません。
そのため、本コンペティションでは、特定の分布を仮定しない順位相関係数を採用しています。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>一定間隔刻みで集計した騰落率の度数（頻度）分布が、騰落率の平均値を中心軸として左右対称の釣り鐘型の形状になる分布 (正規分布＝Normal Distribution) では、「平均値±標準偏差」の範囲に全データの約7割が収まるという確率的な特性を持ちます。ただし、金融商品の価格変動が厳密な意味での正規分布に従うことは実際上ほとんどありません。このため、「平均±標準偏差の範囲に騰落率の約7割が収まる」という考え方は理論的な目安に過ぎなく、発生確率は低いものの標準偏差を大幅に超す価格変動も起こりえます。こうした価格変動のリスクをテールリスクと呼び、とくに、金融市場の混乱期には分布がマイナス方向に偏るケースや、裾が極端に広く厚い"ファット・テール"という現象が確認できます。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>(野村証券証券用語解説集より引用 <a href="https://www.nomura.co.jp/terms/japan/hi/A02397.html" class="bare">https://www.nomura.co.jp/terms/japan/hi/A02397.html</a>)</p>
</div>
<div class="paragraph">
<p>本コンペにおいても、例えば新型コロナウイルス感染症 (COVID-19)のような外部影響を受け、マーケットの変化率の分布が歪む期間が存在すると想定されます。したがって、順位相関係数は相関係数と比較して特定の分布を仮定しないことから、本コンペティションにおいては、より適した評価方法であると考えられます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_リーダーボード">2.1.4. リーダーボード</h4>
<div class="paragraph">
<p>一般的に、データ分析コンペティションにおけるリーダーボード（Leaderboard）とは、コンペティション参加者の投稿内容に対する評価（スコア、実行時間等）をランキング形式で並べる表を意味します。本コンペティションで提供するリーダーボードは、パブリックリーダーボード（以下、Public LB）とプライベートリーダーボード（以下、Private LB）の2つで構成されます。以下では、それぞれのリーダーボードの仕様等について説明します。</p>
</div>
<div class="paragraph">
<p>まず、本コンペティションのPublic LBは、コンペティション開催日より過去の期間を対象として評価を実施します。具体的には、本コンペティションのPublic LBでは、2020年1月1日（水）〜2020年11月30日（月）の期間中に開示された決算短信等を対象に、開示日より起算して20営業日を経過した期間における最高値及び最安値を予測します。</p>
</div>
<div class="paragraph">
<p>過去の各銘柄の株価は、各Webサイト等で取得可能であることから、本コンペティションのPublic LBではチーティングが容易という特徴があります。そのため。本コンペティションのPublic LBは、他の一般的なPublic LBとは異なり、スコアや実行時間を競うというよりは、モデルが正常に投稿できることを確認するための環境として位置付けられています。</p>
</div>
<div class="paragraph">
<p>次に、本コンペティションのPrivate LBについて説明します。本コンペティションでは、モデル提出締切日よりも将来のデータを用いて、Private LBを出力します。具体的には、本コンペティションのPrivate LBでは、2021年3月27日（土）〜2021年5月15日（土）に開示された決算短信を対象に、その開示日から起算して20営業日を経過した期間における最高値及び最安値を予測します。</p>
</div>
<div class="paragraph">
<p>また、この予測に当たっては、決算短信の開示日の期間に応じて5回に分けて実施し、最終的な順位は5回目の評価で決定します。(評価の計算は5回行われますが、最後の1回を除く4回は途中経過をリーダーボードでご確認いただけるように計算しているものになります。)</p>
</div>
<div class="paragraph">
<p>この5回の評価のスケジュールは次を予定しております。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>5月10日（月）に3月27日（土）〜4月5日（月）分の財務諸表の評価</p>
</li>
<li>
<p>5月17日（月）に3月27日（土）〜4月12日（月）分の財務諸表の評価</p>
</li>
<li>
<p>5月24日（月）に3月27日（土）〜4月19日（月）分の財務諸表の評価</p>
</li>
<li>
<p>5月31日（月）に3月27日（土）〜4月26日（月）分の財務諸表の評価</p>
</li>
<li>
<p>6月14日（月）に3月27日（土）〜5月15日（土）分の財務諸表の評価</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以上を踏まえ、本コンペティションにおけるPublic LBとPrivate LBの概要を、表に示します。</p>
</div>
<div class="paragraph">
<p><strong>本コンペティションにおけるリーダーボードの仕様</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>項目</strong></th>
<th class="tableblock halign-left valign-top"><strong>Public LB</strong></th>
<th class="tableblock halign-left valign-top"><strong>Private LB</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用途</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モデルが正常に投稿できることを確認するための環境</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本コンペティションの最終的なランキングを表示</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">予測対象となる決算短信の開示日の期間</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020年1月1日（水）〜2020年11月30日（月）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021年3月27日（土）〜2021年5月15日（土）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">予測対象となる決算短信の開示日の条件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各銘柄の各四半期ごとに一番開示日が新しい開示　</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.1.2項に示すとおり</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">予測内容</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">決算短信の開示日から起算して20営業日を経過した期間における、各銘柄の最高値及び最安値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">同左</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">評価方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.1.3項に示す評価方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.1.3項に示す評価方法を、5回の決算短信開示期間に応じて実施</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_決算短信財務諸表">2.1.5. 決算短信・財務諸表</h4>
<div class="paragraph">
<p>上場企業の株価は、各社の経営状態等を反映して日々刻々と変化します。そのため、金融商品市場において公正な価格形成と円滑な流通を確保するためには公平で適時、適切な情報開示が必要不可欠なものとなっています。</p>
</div>
<div class="paragraph">
<p>東京証券取引所では、投資者が投資判断を行ううえで必要な会社情報を、迅速、正確かつ公平に提供するための制度として、適時開示制度を設けており、上場企業は、報道機関等を通じてあるいはTDnet（適時開示情報伝達システム）により直接に、広く、かつタイムリーに伝達することという特徴があります。適時開示制度の下で上場企業が開示する資料のことを、適時開示資料と呼びます。適時開示資料とそのメタデータ（タイトル、開示日時等）を総称して適時開示情報と呼び、適時開示情報は「<a href="https://www.release.tdnet.info/inbs/I_main_00.html">適時開示情報閲覧サービス</a>」で開示されます。下図に投資家における適時開示資料の代表的な用途を示します。</p>
</div>
<div class="paragraph">
<p><strong>投資家における適時開示資料の代表的な用途</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/structure.png" alt="structure">
</div>
</div>
<div class="paragraph">
<p>(開示資料と翻訳より引用 <a href="https://aamt.info/wp-content/uploads/2019/11/%E3%83%91%E3%83%8D%E3%83%AB%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3_%E5%B1%B1%E8%97%A4%E6%95%A6%E5%8F%B2%E6%B0%8F_AAMT2019Tokyo-1.pdf" class="bare">https://aamt.info/wp-content/uploads/2019/11/%E3%83%91%E3%83%8D%E3%83%AB%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3_%E5%B1%B1%E8%97%A4%E6%95%A6%E5%8F%B2%E6%B0%8F_AAMT2019Tokyo-1.pdf</a>)</p>
</div>
<div class="paragraph">
<p>上場企業が開示を義務付けられている適時開示資料の一つに、決算短信があります。決算短信とは、決算発表及び四半期決算発表を行う際に、決算内容の要点をまとめた書類のことです。本資料では、決算発表時に開示する決算短信と、四半期決算発表時に開示する四半期決算短信を総称して、決算短信と呼びます。上場企業は、決算期末を含め四半期毎に決算内容が定まった際、決算内容の開示が義務付けられています。四半期決算短信については、金商法に基づく四半期報告書の法定提出期限が45日とされていることから、また、決算短信については、決算期末後45日以内に決算の内容を開示することを東証が要請していることから、決算短信等の多くは期末後45日以内に開示されています。決算短信の作成要領等は、下記Webサイトで公開されています。</p>
</div>
<div class="paragraph">
<p>決算短信作成要領・四半期決算短信作成要領 | 日本取引所グループ<br>
<a href="https://www.jpx.co.jp/equities/listed-co/format/summary/index.html" class="bare">https://www.jpx.co.jp/equities/listed-co/format/summary/index.html</a></p>
</div>
<div class="paragraph">
<p>決算の内容として開示される決算短信は、大きく、サマリー情報と添付資料で構成されます。<br></p>
</div>
<div class="paragraph">
<p>サマリー情報は、投資者の投資判断に重要な影響を与える上場会社の決算の内容について、その要点の一覧性及び比較可能性を確保する観点から、簡潔に取りまとめたものとして、参考様式に基づいて東証が作成を要請している資料です。<br></p>
</div>
<div class="paragraph">
<p>添付資料とは、サマリー情報に記載される主要な決算数値を投資者が適切に理解できるようにする目的で作成される、経営成績・財政状態の概況、今後の見通し、財務諸表、主な注記等を記載した資料です。</p>
</div>
<div class="paragraph">
<p>前述のとおり、決算短信には、財務諸表が添付されています。財務諸表とは、財政状態、経営成績及びキャッシュ・フローの状況を外部の情報利用者に明らかにするためのもので、有価証券届出書や有価証券報告書等に記載される財務計算に関する書類のうち、貸借対照表、損益計算書、株主資本等変動計算書、キャッシュ・フロー計算書の総称を指します。これらの内、貸借対照表、損益計算書、キャッシュ・フロー計算書の3つは、総称して「財務三表」と呼ばれており、上場企業に対する投資判断において特に重要視されています。財務三表の読み方については、下記Webサイトが参考になります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>投資に不可欠な財務三表の見方 | 東証マネ部！
<a href="https://money-bu-jpx.com/news/article022723/" class="bare">https://money-bu-jpx.com/news/article022723/</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>また、各上場企業の決算発表予定日（決算短信の開示予定日）は、下記JPXのWebサイトにて随時公開されています。投資家の投資判断において、各上場企業の決算発表は特に重要視されていることから、当該Webサイトは多くの投資家より注目を集めていると推察されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>決算発表予定日 | 日本取引所グループ
　
<a href="https://www.jpx.co.jp/listing/event-schedules/financial-announcement/index.html" class="bare">https://www.jpx.co.jp/listing/event-schedules/financial-announcement/index.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以上のとおり、本コンペティションで予測対象の起点となる決算短信には、各上場企業の重要な決算内容が記されています。本コンペティションでは、決算短信に含まれる財務諸表から抽出したファンダメンタル情報をコンペティションページ若しくは専用のAPIにおいて配信しており、これを用いることで株価の先行きを予測していただきます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_データセットの説明">2.2. データセットの説明</h3>
<div class="paragraph">
<p>ここでは、コンペティションで提供している各データについて説明します。提供されるデータは以下の5種類です。</p>
</div>
<div class="paragraph">
<p><strong>データ概要</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>ファイル名</strong></th>
<th class="tableblock halign-left valign-top"><strong>説明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各銘柄の情報が記録されたデータ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_price</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各銘柄の株価情報（始値・高値・安値・終値等）が記録されたデータ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_fin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各銘柄のファンダメンタル情報（決算数値データや配当データ等）が記録されたデータ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_fin_price</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データが扱いやすいようにstock_price及びstock_finをマージしたデータ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stock_labels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本コンペティションで学習に用いるラベル（目的変数）が記録されたデータ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>提供データについては、2016年1月初から2020年12月末をcsvファイル形式、2021年１月初からのデータについては、本コンペティション専用のAPIにて提供いたします。APIによるデータ取得につきましては、5章をご参照ください。</p>
</div>
<div class="sect3">
<h4 id="_銘柄情報_stock_list">2.2.1. 銘柄情報: stock_list</h4>
<div class="paragraph">
<p>stock_listは、銘柄の名前や業種区分などの基本情報が含まれています。発行済株式数は、会社が発行することをあらかじめ定款に定めている株式数（授権株式数）のうち、会社が既に発行した株式数のことです。発行済株式数と株価とかけ合わせて時価総額を計算することができます。時価総額は企業価値を評価する際に用いられる重要な指標です。業種区分情報は、マーケットにおける業種別の平均などを計算する時に役立つ情報です。33業種は証券コード協議会が定めており、17業種はTOPIX-17シリーズとして「投資利便性を考慮して17業種に再編したもの」(JPX東証33業種別株価指数・TOPIX-17シリーズファクトシートより引用 <a href="https://www.jpx.co.jp/markets/indices/line-up/index.html" class="bare">https://www.jpx.co.jp/markets/indices/line-up/index.html</a>) です。</p>
</div>
<div class="paragraph">
<p>「業種」(JPX用語集より引用 <a href="https://www.jpx.co.jp/glossary/ka/112.html" class="bare">https://www.jpx.co.jp/glossary/ka/112.html</a>)</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>変数名</strong></th>
<th class="tableblock halign-left valign-top"><strong>説明</strong></th>
<th class="tableblock halign-left valign-top"><strong>型</strong></th>
<th class="tableblock halign-left valign-top"><strong>例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">prediction_target</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予測対象銘柄</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Effective Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘柄情報の基準日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20201030</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">株式銘柄コード</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1301</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name (English)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘柄名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KYOKUYO CO.,LTD.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Section/Products</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">市場・商品区分</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First Section (Domestic)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">33 Sector(Code)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘柄の33業種区分(コード)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">33 Sector(name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘柄の33業種区分(名前)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fishery, Agriculture and Forestry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">17 Sector(Code)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘柄の17業種区分(コード)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">17 Sector(name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘柄の17業種区分(名前)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FOODS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size Code (New Index Series)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPIXニューインデックスシリーズ規模区分(コード)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size (New Index Series)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPIXニューインデックスシリーズ規模区分</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPIX Small 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IssuedShareEquityQuote AccountingStandard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会計基準 単独:NonConsolidated、連結国内:ConsolidatedJP、連結SEC:ConsolidatedUS、連結IFRS:ConsolidatedIFRS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConsolidatedJP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IssuedShareEquityQuote ModifyDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">更新日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020/11/06</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IssuedShareEquityQuote IssuedShare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">発行済株式数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10928283.0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(JPX東証上場銘柄一覧より引用 <a href="https://www.jpx.co.jp/markets/statistics-equities/misc/01.html" class="bare">https://www.jpx.co.jp/markets/statistics-equities/misc/01.html</a>)<br>
(Quick xignite API Market Data API Catalogより引用 <a href="https://www.marketdata-cloud.quick-co.jp/Products/" class="bare">https://www.marketdata-cloud.quick-co.jp/Products/</a>)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_stock_list.png" alt="sample_stock_list">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_株価情報_stock_price">2.2.2. 株価情報 : stock_price</h4>
<div class="paragraph">
<p>stock_priceには各銘柄の各日付の始値や終値などの株価情報が記録されています。テクニカル分析などで終値ベースの分析を実施する場合は、ExchangeOfficialCloseを利用します。<br>
ここでいうテクニカル分析というのは、マーケットデータから計算される指標に基づいた分析のことです。また、終値ベースの分析とは、マーケットデータの中でも、終値のみを用いた分析を表しています。</p>
</div>
<div class="paragraph">
<p>株価情報は、「株式分割」や「株式併合」が発生した際に生じる株価の変動を、株式数の変化率に応じて調整されています。特徴量の定義によっては、その日付時点で実際に取引された株価や出来高を取得したい場合がありますが、その場合は累積調整係数を使用して<br>
 <code>[調整前株価] = [調整済株価] * [累積調整係数]</code> 及び <code>[調整前出来高] = [調整済出来高] / [累積調整係数]</code> <br>
 という計算で算出可能です。<br>
「株式分割」(JPX用語集より引用 <a href="https://www.jpx.co.jp/glossary/ka/81.html" class="bare">https://www.jpx.co.jp/glossary/ka/81.html</a>)<br>
「株式併合」(JPX用語集より引用 <a href="https://www.jpx.co.jp/glossary/ka/83.html" class="bare">https://www.jpx.co.jp/glossary/ka/83.html</a>)</p>
</div>
<div class="paragraph">
<p><strong>ただし、これらの特徴量をモデルに使用する場合には注意が必要です。</strong></p>
</div>
<div class="paragraph">
<p>履歴データの累積調整係数は過去のある日時点では知り得ない未来の情報を含んでいることに注意する必要があります。具体的には、過去のある日時点の累積調整係数が2である場合、その日以降に1:2の株式分割が発生していることがわかります。</p>
</div>
<div class="paragraph">
<p>一般に株式分割は流動性向上を期待できるポジティブなイベントとみなされています。仮に、モデル学習時に累積調整係数をモデルへ入力し、モデルが累積調整係数が大きい銘柄は未来の株価が上がる傾向があるということを学習し、履歴データを使用したバックテストでは良い結果がでたとします。しかし、このモデルに最新データを入力して予測を出力した場合、その予測は期待する結果を得られない可能性があります。なぜなら、最新データの累積調整係数にはまだ発生していない未来の情報は含まれていないためです。</p>
</div>
<div class="paragraph">
<p>このように、その日付時点では取得できない未来の情報をモデルに入力することをリークといい、時系列データには累積調整係数のようにその日付時点では取得できない情報が含まれていることがあるため、リークにはとくに注意する必要があります。</p>
</div>
<div class="paragraph">
<p><strong>データの特性</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>マーケットが開いている日に取引が成立しなかった銘柄は、売買高が0となり、四本値 (始値、高値、安値、終値) 全てが0と表示されます。</p>
</li>
<li>
<p>stock_priceのデータは、そのデータに含まれている最新日付時点で累積調整係数1となるように調整されます。調整済み株価についても同様に過去に遡って更新されます。</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>変数名</strong></th>
<th class="tableblock halign-left valign-top"><strong>説明</strong></th>
<th class="tableblock halign-left valign-top"><strong>型</strong></th>
<th class="tableblock halign-left valign-top"><strong>例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘柄コード</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1301</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日付</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/01/04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote Open</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">始値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2800</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote High</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">高値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2820</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote Low</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">安値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2740</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote Close</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">終値。大引け後にセットされる</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2750</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote ExchangeOfficialClose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">取引所公式終値。最終の特別気配または最終気配を含む終値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2750</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote Volume</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">売買高</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote CumulativeAdjustmentFactor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">累積調整係数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote PreviousClose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">前回の終値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2770</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote PreviousCloseDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">前回の終値が発生した日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015/12/30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote PreviousExchangeOfficialClose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">前回の取引所公式終値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2770</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote PreviousExchangeOfficialCloseDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">前回の取引所公式終値が発生した日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015/12/30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote ChangeFromPreviousClose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">騰落幅。前回終値と直近約定値の価格差</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote PercentChangeFromPreviousClose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">騰落率。前回終値からの直近約定値の上昇率または下落率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0.722</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndOfDayQuote VWAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">売買高加重平均価格(VWAP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2778.25</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(Quick xignite API Market Data API Catalogより引用 <a href="https://www.marketdata-cloud.quick-co.jp/Products/" class="bare">https://www.marketdata-cloud.quick-co.jp/Products/</a>)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_stock_price.png" alt="sample_stock_price">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ファンダメンタル情報_stock_fin">2.2.3. ファンダメンタル情報: stock_fin</h4>
<div class="paragraph">
<p>株式投資における <code>ファンダメンタル情報</code> とは、対象銘柄の純資産といった財務状況や当期純利益といった業績状況を表す情報のことです。ファンダメンタル情報を用いて、各銘柄の成長性、収益性、安全性、割安度などの投資判断に活用することができます。ファンダメンタル情報を利用した解析は、さまざまな手法が考案されています。</p>
</div>
<div class="paragraph">
<p>ファンダメンタル情報のデータセットであるstock_finにおいて、いくつかの変数名は <code>Forecast</code> から始まっていますが、これらは各企業が来期の自社の業績・財務状況を予想したデータです。例えば、企業が来期の業績が厳しいことが予め分かっている場合には、予想として早めに開示することがあるため、予想のデータも重要な可能性があります。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>変数名</strong></th>
<th class="tableblock halign-left valign-top"><strong>説明</strong></th>
<th class="tableblock halign-left valign-top"><strong>型</strong></th>
<th class="tableblock halign-left valign-top"><strong>例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">base_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日付</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/01/04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘柄コード</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2753</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement AccountingStandard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会計基準　単独:NonConsolidated、連結国内:ConsolidatedJP、連結SEC:ConsolidatedUS、連結IFRS:ConsolidatedIFRS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConsolidatedJP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement FiscalPeriodEnd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">決算期</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015/12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement ReportType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">決算種別　第1四半期:Q1、中間決算:Q2、第3四半期:Q3、本決算:Annual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Q3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement FiscalYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">決算年度。本決算の決算期末が属する年。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement ModifyDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">更新日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/01/04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement CompanyType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会社区分 一般事業会社:GB、銀行:BK、証券会社:SE、損保会社:IN ※上記に該当しない場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement ChangeOfFiscalYearEnd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">決算期変更フラグ 決算期変更あり:true、決算期変更なし:false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement NetSales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">売上高（単位：百万円） 会社区分によって項目名の読替えを行ういます。 銀行：経常収益、証券：営業収益、損保：経常収益 ※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22354</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement OperatingIncome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">営業利益（単位：百万円） ※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2391</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement OrdinaryIncome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">経常利益（単位：百万円） 会計基準が連結SECの場合は、項目名を「税引前利益」に読み替えます。 ※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2466</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement NetIncome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当期純利益（単位：百万円） ※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1645</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement TotalAssets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">総資産（単位：百万円） ※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21251</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement NetAssets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">純資産（単位：百万円） ※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16962</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement CashFlowsFromOperatingActivities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">営業キャッシュフロー（単位：百万円） ※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12404</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement CashFlowsFromFinancingActivities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">財務キャッシュフロー（単位：百万円） ※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-98</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_FinancialStatement CashFlowsFromInvestingActivities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">投資キャッシュフロー（単位：百万円） ※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1307</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement AccountingStandard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予想: 会計基準　単独:NonConsolidated、連結国内:ConsolidatedJP、連結SEC:ConsolidatedUS、連結IFRS:ConsolidatedIFRS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConsolidatedJP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement FiscalPeriodEnd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来期予想情報:　決算期</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/03</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement ReportType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来期予想情報:　決算種別　第1四半期:Q1、中間決算:Q2、第3四半期:Q3、本決算:Annual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annual</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement FiscalYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来期予想情報:　決算年度。本決算の決算期末が属する年。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement ModifyDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来期予想情報:　更新日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/01/04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement CompanyType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来期予想情報:　会社区分 一般事業会社:GB、銀行:BK、証券会社:SE、損保会社:IN ※上記に該当しない場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement ChangeOfFiscalYearEnd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来期予想情報:　決算期変更フラグ 決算期変更あり:true、決算期変更なし:false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement NetSales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来期予想情報:　売上高（単位：百万円） 会社区分によって項目名の読替えを行います。 銀行：経常収益、証券：営業収益、損保：経常収益 ※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement OperatingIncome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来期予想情報:　営業利益（単位：百万円） ※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement OrdinaryIncome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来期予想情報:　経常利益（単位：百万円） 会計基準が連結SECの場合は、項目名を「税引前利益」に読み替えます。 ※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_FinancialStatement NetIncome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来期予想情報:　当期純利益（単位：百万円） ※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2130</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend FiscalPeriodEnd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配当情報:　決算期</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015/11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend ReportType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配当情報:　決算種別　第1四半期:Q1、中間決算:Q2、第3四半期:Q3、本決算:Annual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annual</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend FiscalYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配当情報:　決算年度。本決算の決算期末が属する年。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend ModifyDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配当情報:　更新日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/01/07</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend RecordDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配当情報:　配当基準日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015/11/30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend DividendPayableDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配当情報:　配当支払開始日　※予想の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/02/29</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend QuarterlyDividendPerShare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配当情報:　一株当たり四半期配当金（単位：円）　※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result_Dividend AnnualDividendPerShare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配当情報:　一株当たり年間配当金累計（単位：円）※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend FiscalPeriodEnd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予想配当情報:　決算期</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/03</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend ReportType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予想配当情報:　決算種別　第1四半期:Q1、中間決算:Q2、第3四半期:Q3、本決算:Annual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annual</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend FiscalYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予想配当情報:　決算年度。本決算の決算期末が属する年。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend ModifyDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予想配当情報:　更新日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/01/04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend RecordDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予想配当情報:　配当基準日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016/03/31</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend QuarterlyDividendPerShare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予想配当情報:　一株当たり四半期配当金（単位：円）　※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">45</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forecast_Dividend AnnualDividendPerShare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予想配当情報:　一株当たり年間配当金累計（単位：円）※未開示の場合は空文字を設定してます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">90</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(Quick xignite API Market Data API Catalogより引用 <a href="https://www.marketdata-cloud.quick-co.jp/Products/" class="bare">https://www.marketdata-cloud.quick-co.jp/Products/</a>)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_stock_fin.png" alt="sample_stock_fin">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_財務諸表株価情報_stock_fin_price">2.2.4. 財務諸表+株価情報: stock_fin_price</h4>
<div class="paragraph">
<p>stock_fin_priceは、株価情報である&lt;&lt;株価情報 : stock_price, stock_price&gt;&gt;と財務諸表である&lt;&lt;ファンダメンタル情報: stock_fin, stock_fin&gt;&gt;をデータとして扱いやすいように結合したデータです。変数名や型などについては、同じであるため記載を省略しています。</p>
</div>
<div class="paragraph">
<p>また、データのサイズが非常に大きいため、必要に応じて活用していただきたいと思います。</p>
</div>
</div>
<div class="sect3">
<h4 id="_目的変数_stock_labels">2.2.5. 目的変数: stock_labels</h4>
<div class="paragraph">
<p>stock_labelsは予測の目的変数のデータであり、各銘柄で決算発表が行われた日の取引所公式終値から、その日の翌営業日以降N（5，10，20）営業日間における最高値及び最安値への変化率を記録したデータです。<br>
各値の計算式は、 <code>([基準日付の翌日以降N営業日間における高値/安値] / [基準日付の終値]) - 1</code> です。<br>
なお、ラベルの対象期間 (5、10、20営業日の間) に値が付かなかった場合は、ラベルを <code>NaN</code> としております。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>変数名</strong></th>
<th class="tableblock halign-left valign-top"><strong>説明</strong></th>
<th class="tableblock halign-left valign-top"><strong>型</strong></th>
<th class="tableblock halign-left valign-top"><strong>例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">base_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基準日付（各銘柄で決算短信等の開示がされた日）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016-01-04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">銘柄コード</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1301</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_date_5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基準日付から5営業日後の日付。label_high_5算出に使用される終値範囲の基準日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016-01-12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_high_5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基準日付の終値から5営業日の間の最高値への変化率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00364</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_low_5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基準日付の終値から5営業日の間の最安値への変化率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0.04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_date_10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基準日付から10営業日後の日付。label_high_10算出に使用される終値範囲の基準日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016-01-19</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_high_10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基準日付の終値から10営業日の間の最高値への変化率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00364</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_low_10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基準日付の終値から10営業日の間の最安値への変化率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0.05455</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_date_20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基準日付から20営業日後の日付。label_high_20算出に使用される終値範囲の基準日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016-02-02</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_high_20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基準日付の終値から20営業日の間の最高値への変化率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00364</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label_low_20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基準日付の終値から20営業日の間の最安値への変化率</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0.08364</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_stock_labels.png" alt="sample_stock_label">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_実行環境及び必要なライブラリ">2.3. 実行環境及び必要なライブラリ</h3>
<div class="sect3">
<h4 id="_実行環境">2.3.1. 実行環境</h4>
<div class="paragraph">
<p>本チュートリアルの実行環境は、本コンペティションで提出するモデルの実行環境と同一環境とするために以下のpython環境を用います。環境構築方法について、詳しくは <a href="https://signate.jp/features/runtime/detail">SIGNATE: Runtime 投稿方法: ローカル開発環境の構築方法は？</a> をご参照ください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>anaconda3-2019.03</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_google_colaboratoryの利用">2.3.2. Google Colaboratoryの利用</h4>
<div class="paragraph">
<p>本章はDockerを用いた実行環境の利用を想定して記述しておりますが、Dockerの実行環境構築がご利用のOSなど何らかの理由により困難な方、より簡便にチュートリアルを実行したい方はGoogle Colaboratoryの利用をご検討ください。本チュートリアルで提供されるNotebookはGoogle Colaboratoryでも実行可能です。詳細は第4章をご参照ください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_dockerを用いた実行環境構築方法">2.3.3. Dockerを用いた実行環境構築方法</h4>
<div class="paragraph">
<p>本チュートリアルのリポジトリを <code>git clone</code> していただき、以下の手順を実行していただくことで実行環境のdockerコンテナ内でjupyter notebookを起動可能となっています。 <code>Chapter02</code> ディレクトリ内には、本チュートリアルのコードを記載した ipynb ファイルを配置しておりますので必要に応じてご活用ください。</p>
</div>
<div class="paragraph">
<p>Windows環境の場合、コマンド実行には「PowerShell」などをご使用ください。なお、PowerShellの利用に当たっては、最新のセキュリティ事情を踏まえご自身でご判断ください。</p>
</div>
<div class="paragraph">
<p>docker のインストールについては <a href="http://docs.docker.jp/get-docker.html" class="bare">http://docs.docker.jp/get-docker.html</a> をご参照ください。docker の制約としてマウントするパスにはアルファベット、数字、「_」、「.」、「-」以外の文字を使用するとエラーとなることがあるようです。その場合は、パスが前述の文字のみで構成されているディレクトリをご使用ください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd handson/

# データ配置先のディレクトリを作成
mkdir data_dir
# その後作成したhandson/data_dirに、コンペティションサイトよりデータをダウンロードし配置します。

# dockerでjupyter notebookを起動します。(初回実行時は約2GB程度コンテナイメージをダウンロードします。)
# データ配置先のディレクトリを /path/to としてマウントしています。
# 学習済みモデル提出用のディレクトリ (handson/Chapter02/archive) を /opt/ml としてマウントしています。
# jupyter notebook作業用に handson ディレクトリを /notebook としてマウントしています。
# jupyter notebook は port 8888でtokenとpasswordを空にして、vscode のjupyter pluginからアクセスできるように xsrf 対策を無効化しています。
docker run --name tutorial -v ${PWD}/data_dir:/path/to -v ${PWD}/Chapter02/archive:/opt/ml -v ${PWD}:/notebook -e PYTHONPATH=/opt/ml/src -p8888:8888 --rm -it continuumio/anaconda3:2019.03 jupyter notebook --ip 0.0.0.0 --allow-root --no-browser --no-mathjax --NotebookApp.disable_check_xsrf=True  --NotebookApp.token='' --NotebookApp.password='' /notebook

# ブラウザで以下のURLにアクセスしてjupyter notebookの画面が表示されていて、本チュートリアル用のnotebookが表示されていることを確認します。
http://localhost:8888/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_必要なライブラリのインストール">2.3.4. 必要なライブラリのインストール</h4>
<div class="paragraph">
<p>本チュートリアル内では、上記の実行環境に含まれていないライブラリを使用するため、以下のコマンドを使用して個別にインストールします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># shap用にg++とgccをインストールします
apt-get update
apt-get install -y --no-install-recommends g++ gcc

# 必要なライブラリをインストールします
pip install shap==0.37.0 slicer==0.0.3 xgboost==1.3.0.post0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ライブラリの読み込み">2.3.5. ライブラリの読み込み</h4>
<div class="paragraph">
<p>本チュートリアルでは、下記のライブラリのインポートを行います。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">import</span> <span class="include">os</span>
<span class="keyword">import</span> <span class="include">pickle</span>
<span class="keyword">import</span> <span class="include">sys</span>
<span class="keyword">import</span> <span class="include">warnings</span>
<span class="keyword">from</span> <span class="include">glob</span> <span class="keyword">import</span> <span class="include">glob</span>

<span class="keyword">import</span> <span class="include">matplotlib</span>
<span class="keyword">import</span> <span class="include">matplotlib.pyplot</span> <span class="keyword">as</span> plt
<span class="keyword">import</span> <span class="include">numpy</span> <span class="keyword">as</span> np
<span class="keyword">import</span> <span class="include">pandas</span> <span class="keyword">as</span> pd
<span class="keyword">import</span> <span class="include">seaborn</span> <span class="keyword">as</span> sns
<span class="keyword">import</span> <span class="include">shap</span>
<span class="keyword">import</span> <span class="include">xgboost</span>
<span class="keyword">from</span> <span class="include">scipy.stats</span> <span class="keyword">import</span> <span class="include">spearmanr</span>
<span class="keyword">from</span> <span class="include">sklearn.ensemble</span> <span class="keyword">import</span> (
    ExtraTreesRegressor,
    GradientBoostingRegressor,
    RandomForestRegressor,
)
<span class="keyword">from</span> <span class="include">sklearn.metrics</span> <span class="keyword">import</span> <span class="include">accuracy_score</span>, <span class="include">mean_squared_error</span>
<span class="keyword">from</span> <span class="include">tqdm.auto</span> <span class="keyword">import</span> <span class="include">tqdm</span>


<span class="comment"># 表示用の設定を変更します</span>
%matplotlib inline
pd.options.display.max_rows = <span class="integer">100</span>
pd.options.display.max_columns = <span class="integer">100</span>
pd.options.display.width = <span class="integer">120</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ライブラリ解説">2.3.6. ライブラリ解説</h4>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>ライブラリ名</strong></th>
<th class="tableblock halign-left valign-top"><strong>目的</strong></th>
<th class="tableblock halign-left valign-top"><strong>公式ドキュメント</strong></th>
<th class="tableblock halign-left valign-top"><strong>入門解説</strong> ｑ</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pandas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データの処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://pandas.pydata.org/docs/">pandas documentation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/ysdyt/items/9ccca82fc5b504e7913a">Qiita:データ分析で頻出のPandas基本操作</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">numpy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データの処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://numpy.org/doc/stable/user/tutorials_index.html">NumPy Tutorials</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/jyori112/items/a15658d1dd17c421e1e2">Qiita:numpyの使い方</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">glob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイルの検知</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.python.org/3/library/glob.html">glob — Unix style pathname pattern expansion</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/HirosuguTakeshita/items/0e0850362c7eb3b10ea1">Qiita:【備忘録】globの使い方</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tqdm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">計算の進捗確認</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://tqdm.github.io/">tqdm</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/pontyo4/items/76145cb10e030ad8186a">Qiita:tqdmでプログレスバーを表示させる</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sklearn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">機械学習モデルを作成</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://scikit-learn.org/stable/tutorial/index.html">https://scikit-learn.org/stable/tutorial/index.html</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/ynakayama/items/9c5867b6947aa41e9229">Qiita:scikit-learn から学ぶ機械学習の手法の概要</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matplotlib</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データの可視化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://matplotlib.org/tutorials/index.html">matplotlib tutorials</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/skotaro/items/08dc0b8c5704c94eafb9">Qiita:早く知っておきたかったmatplotlibの基礎知識、あるいは見た目の調整が捗るArtistの話</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scipy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">統計用のライブラリ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.scipy.org/doc/scipy/reference/tutorial/index.html">SciPy Tutorial</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://amorphous.tf.chiba-u.jp/lecture.files/chem_computer/11_scipy%E3%81%AE%E5%9F%BA%E6%9C%AC%E3%81%A8%E5%BF%9C%E7%94%A8/11.html">千葉大: コンピュータ処理 ドキュメント 11. scipyの基本と応用</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">seaborn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データの可視化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://seaborn.pydata.org/tutorial.html">User guide and tutorial</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/hik0107/items/3dc541158fceb3156ee0">Qiita:pythonで美しいグラフ描画 -seabornを使えばデータ分析と可視化が捗る その1</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">shap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHAP分析</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://shap.readthedocs.io/en/latest/">Welcome to the SHAP Documentation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/shin_mura/items/cde01198552eda9146b7">Shapを用いた機械学習モデルの解釈説明</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xgboost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">機械学習モデル</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://xgboost.readthedocs.io/en/latest/">XGBoost Documentation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://qiita.com/triwave33/items/aad60f25485a4595b5c8">XGBoost論文を丁寧に解説する(1)</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_実行環境の確認">2.3.7. 実行環境の確認</h4>
<div class="paragraph">
<p>pythonのバージョンが3.7.3であることを確認します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">print(sys.version)</code></pre>
</div>
</div>
<div class="paragraph">
<p>出力</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">3.7.3 (default, Mar 27 2019, 22:11:17)
[GCC 7.3.0]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_データセットの読み込み">2.4. データセットの読み込み</h3>
<div class="paragraph">
<p>本コンペティション用に提供されているデータセットをダウンロードして、ファイルを解凍した場所を定義します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># データセット保存先ディレクトリ（&quot;&quot;の中身はご自身の環境に合わせて定義してください。）</span>
dataset_dir=<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>データを読み込みます。なお、本チュートリアルでは <code>stock_fin</code> 及び <code>stock_price</code> を使用するため、 <code>stock_fin_price</code> は読み込まずに進めます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 読み込むファイルを定義します。</span>
inputs = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_list.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_price.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_fin.csv.gz</span><span class="delimiter">&quot;</span></span>,
    <span class="comment"># 本チュートリアルでは使用しないため、コメントアウトしています。</span>
    <span class="comment"># &quot;stock_fin_price&quot;: f&quot;{dataset_dir}/stock_fin_price.csv.gz&quot;,</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_labels.csv.gz</span><span class="delimiter">&quot;</span></span>,
}

<span class="comment"># ファイルを読み込みます</span>
dfs = {}
<span class="keyword">for</span> k, v <span class="keyword">in</span> inputs.items():
    print(k)
    dfs[k] = pd.read_csv(v)
    <span class="comment"># DataFrameのindexを設定します。</span>
    <span class="keyword">if</span> k == <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>:
        dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = pd.to_datetime(
            dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>]
        )
        dfs[k].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
    <span class="keyword">elif</span> k <span class="keyword">in</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin_price</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>]:
        dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = pd.to_datetime(
            dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">base_date</span><span class="delimiter">&quot;</span></span>]
        )
        dfs[k].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>読み込んだデータを確認します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">for</span> k <span class="keyword">in</span> inputs.keys():
    print(k)
    print(dfs[k].info())
    print(dfs[k].head(<span class="integer">1</span>).T)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_データセットの可視化">2.5. データセットの可視化</h3>
<div class="paragraph">
<p>データセットの各項目の特徴を把握することは、モデルを作成する上で重要な要素の1つです。一般にデータの特徴を把握するためには、各項目の意味を把握し、値の平均や標準偏差などの基本統計量を確認します。可視化もそういった特徴把握の手法の1つで、データをグラフなどで表現することで特性を直感的に理解できるようになります。</p>
</div>
<div class="paragraph">
<p>Chapter 2.2 データセットの説明では、本コンペで用いるデータセットについて説明しました。ここではそれらのデータを、 <code>matplotlib</code> と <code>seaborn</code> を用いて可視化します。財務諸表、株価、移動平均、価格変化率、ヒストリカル・ボラティリティを個別で見て、最後に1つのグラフとしてまとめて可視化します。</p>
</div>
<div class="sect3">
<h4 id="_財務諸表">2.5.1. 財務諸表</h4>
<div class="paragraph">
<p>ファンダメンタル情報は項目が多いため、今回は、売上高、営業利益、純利益、純資産及びその決算期の間の関係について可視化します。サンプルとして、銘柄コード9984の「ソフトバンクグループ」を可視化します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_finの読み込み</span>
fin = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 銘柄コード9984にデータを絞る</span>
code = <span class="integer">9984</span>
fin_data = fin[fin[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]

<span class="comment"># 2019年までの値を表示</span>
fin_data = fin_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># プロット対象を定義</span>
columns = [
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetSales</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 売上高</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OperatingIncome</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 営業利益</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetIncome</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 純利益</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetAssets</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 純資産</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>  <span class="comment"># 決算期</span>
]

<span class="comment"># プロット</span>
sns.pairplot(fin_data[columns], hue=<span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>, height=<span class="integer">5</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_fin_stock.png" alt="sample fin plot">
</div>
</div>
<div class="paragraph">
<p>上記のプロットについて説明しますと、各色（緑、赤、青、オレンジ）はそれぞれQ1,Q2,Q3,Annualにおける決算の値に対応しており、対角に並んでいるプロットは各軸の特徴量の分布を表しています。また、その他のプロットは、各軸2つの変数の散布図を表しています。<br>
例えば、2行1列目のグラフを見ると、横軸が売上高、縦軸が営業利益になっています。高い売上高は高い営業利益に繋がっています。また、決算期がQ1からQ3,本決算に至るまでに基本的に右肩上がりであることが分かります。このことから財務データの純売上高や営業利益などの変数は、各決算期ごとの値ではなく、各決算期を積み上げ式で記録されていると推測できます。</p>
</div>
<div class="sect4">
<h5 id="_複数銘柄のファンダメンタル情報の比較">複数銘柄のファンダメンタル情報の比較</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_finの読み込み</span>
fin = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 銘柄コード9984と9983を比較する</span>
codes = [<span class="integer">9984</span>, <span class="integer">9983</span>]

multi_df = <span class="predefined">dict</span>()

<span class="comment"># プロット対象を定義</span>
columns = [
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetSales</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 売上高</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OperatingIncome</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 営業利益</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetIncome</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 純利益</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetAssets</span><span class="delimiter">&quot;</span></span>,  <span class="comment"># 純資産</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>  <span class="comment"># 決算期</span>
]

<span class="comment"># 比較対象の銘柄コード毎に処理</span>
<span class="keyword">for</span> code <span class="keyword">in</span> codes:
    <span class="comment"># 特定の銘柄コードに絞り込み</span>
    fin_data = fin[fin[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
    <span class="comment"># 2019年までの値を表示</span>
    fin_data = fin_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>].copy()
    <span class="comment"># 重複を排除</span>
    fin_data.drop_duplicates(
        subset=[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement FiscalYear</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>
        ],
        keep=<span class="string"><span class="delimiter">&quot;</span><span class="content">last</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
    <span class="comment"># プロット対象のカラムを取得</span>
    _fin_data = fin_data[columns]
    <span class="comment"># 決算期毎の平均を取得</span>
    multi_df[code] = _fin_data[columns].groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>).mean()

<span class="comment"># 銘柄毎に処理していたものを結合</span>
multi_df = pd.concat(multi_df)
<span class="comment"># 凡例を調整</span>
multi_df.set_index(multi_df.index.map(<span class="keyword">lambda</span> t: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{t[0]}/{t[1]}</span><span class="delimiter">&quot;</span></span>), inplace=<span class="predefined-constant">True</span>)
<span class="comment"># プロット</span>
ax = multi_df.T.plot(kind=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, figsize=(<span class="integer">12</span>, <span class="integer">6</span>), grid=<span class="predefined-constant">True</span>)
<span class="comment"># Y軸のラベルを調整</span>
ax.get_yaxis().set_major_formatter(matplotlib.ticker.FuncFormatter(<span class="keyword">lambda</span> x, p: <span class="string"><span class="delimiter">&quot;</span><span class="content">{} bYen</span><span class="delimiter">&quot;</span></span>.format(<span class="predefined">int</span>(x / <span class="integer">1</span>_000))))</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_comparison.png" alt="sample_comparison">
</div>
</div>
<div class="paragraph">
<p>画像の中にコメントを記載しておりますが、NetSales（売上高）とNetAssets（純資産）の特性の違いがわかります。NetAssetsは一定の数値になっており、決算期の影響をあまり受けていないことがわかります。一方、NetSalesはQ1からAnnualにかけて数値が積み上がっており、Q1から決算期が進むごとに大きくなる特性を持つことがわかります。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_株価">2.5.2. 株価</h4>
<div class="paragraph">
<p>ここでは、サンプルとして銘柄コード9984の「ソフトバンクグループ」の終値の動きを可視化します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_priceの読み込み</span>
price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 特定の銘柄コードに絞り込み</span>
code = <span class="integer">9984</span>
price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
<span class="comment"># 2019年までの値を表示</span>
price_data = price_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># プロット</span>
fig, ax = plt.subplots(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))

ax.plot(price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>], label=f<span class="string"><span class="delimiter">&quot;</span><span class="content">securities code : {code}.T</span><span class="delimiter">&quot;</span></span>)
ax.set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>)
ax.set_xlabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>)
ax.grid(<span class="predefined-constant">True</span>)
ax.legend()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_stock_price_close.png" alt="sample_close_price">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_移動平均">2.5.3. 移動平均</h4>
<div class="paragraph">
<p>ここでは移動平均をプロットします。移動平均にもさまざまな種類がありますが、ここでは単純移動平均線を用います。単純移動平均線というのは、例えば、5日線であれば、直近5営業日の価格の平均値です。これを1つずつ期間をスライドしながら計算したものになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_priceの読み込み</span>
price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 特定の銘柄コードに絞り込み</span>
code = <span class="integer">9984</span>
price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
<span class="comment"># 2019年までの値を表示</span>
price_data = price_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>].copy()

<span class="comment"># 5日、25日、75日の移動平均を算出</span>
periods = [<span class="integer">5</span>, <span class="integer">25</span>, <span class="integer">75</span>]
cols = []
<span class="keyword">for</span> period <span class="keyword">in</span> periods:
    col = <span class="string"><span class="delimiter">&quot;</span><span class="content">{} windows simple moving average</span><span class="delimiter">&quot;</span></span>.format(period)
    price_data[col] = price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(period, min_periods=<span class="integer">1</span>).mean()
    cols.append(col)

<span class="comment"># プロット</span>
fig, ax = plt.subplots(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))

<span class="keyword">for</span> col <span class="keyword">in</span> cols:
    ax.plot(price_data[col], label=col)
ax.set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>)
ax.set_xlabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>)
ax.grid(<span class="predefined-constant">True</span>)
ax.legend()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_moving_average.png" alt="sample_SMA">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_価格変化率">2.5.4. 価格変化率</h4>
<div class="paragraph">
<p>価格変化率は、価格がその期間でどれくらい変化したかを(%)で表現したものです。相場の勢いや方向性等を判断する際によく使われます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_priceの読み込み</span>
price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 特定の銘柄コードに絞り込み</span>
code = <span class="integer">9984</span>
price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
<span class="comment"># 2019年までの値を表示</span>
price_data = price_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>].copy()

<span class="comment"># 5日、25日、75日の価格変化率を算出</span>
periods = [<span class="integer">5</span>, <span class="integer">25</span>, <span class="integer">75</span>]
cols = []
<span class="keyword">for</span> period <span class="keyword">in</span> periods:
    col = <span class="string"><span class="delimiter">&quot;</span><span class="content">{} windows rate of return</span><span class="delimiter">&quot;</span></span>.format(period)
    price_data[col] = price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(period) * <span class="integer">100</span>
    cols.append(col)

<span class="comment"># プロット</span>
fig, ax = plt.subplots(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))

<span class="keyword">for</span> col <span class="keyword">in</span> cols:
    ax.plot(price_data[col], label=col)
ax.set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">rate of return (%)</span><span class="delimiter">&quot;</span></span>)
ax.set_xlabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>)
ax.grid(<span class="predefined-constant">True</span>)
ax.legend()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_rate_of_return.png" alt="sample_rr">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ヒストリカルボラティリティ">2.5.5. ヒストリカル・ボラティリティ</h4>
<div class="paragraph">
<p>ここではヒストリカル・ボラティリティを計算します。ここで計算するヒストリカル・ボラティリティは、5日、25日、75日の対数リターンの標準偏差です。ヒストリカル・ボラティリティはリスク指標の一つで、価格がどの程度激しく変動したかを把握するために利用します。一般的にヒストリカル・ボラティリティが大きい銘柄は、小さい銘柄よりも資産として保持するリスクが相対的に高いと考えられます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_priceの読み込み</span>
price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 特定の銘柄コードに絞り込み</span>
code = <span class="integer">9984</span>
price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
<span class="comment"># 2019年までの値を表示</span>
price_data = price_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>].copy()

<span class="comment"># 5日、25日、75日のヒストリカル・ボラティリティを算出</span>
periods = [<span class="integer">5</span>, <span class="integer">25</span>, <span class="integer">75</span>]
cols = []
<span class="keyword">for</span> period <span class="keyword">in</span> periods:
    col = <span class="string"><span class="delimiter">&quot;</span><span class="content">{} windows volatility</span><span class="delimiter">&quot;</span></span>.format(period)
    price_data[col] = np.log(price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(period).std()
    cols.append(col)

<span class="comment"># プロット</span>
fig, ax = plt.subplots(figsize=(<span class="integer">20</span>, <span class="integer">8</span>))

<span class="keyword">for</span> col <span class="keyword">in</span> cols:
    ax.plot(price_data[col], label=col)
ax.set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility</span><span class="delimiter">&quot;</span></span>)
ax.set_xlabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>)
ax.grid(<span class="predefined-constant">True</span>)
ax.legend()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_volatility.png" alt="sample_volatility">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_複数の株価データを同時にプロット">2.5.6. 複数の株価データを同時にプロット</h4>
<div class="paragraph">
<p>これまで可視化してきた株価に関するデータを同時にプロットすることで、それぞれの値の関連性について考察します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_priceの読み込み</span>
price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 特定の銘柄コードに絞り込み</span>
code = <span class="integer">9984</span>
price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
<span class="comment"># 2019年までの値を表示</span>
price_data = price_data[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>].copy()

<span class="comment"># 5日、25日、75日を対象に値を算出</span>
periods = [<span class="integer">5</span>, <span class="integer">25</span>, <span class="integer">75</span>]
ma_cols = []
<span class="comment"># 移動平均線</span>
<span class="keyword">for</span> period <span class="keyword">in</span> periods:
    col = <span class="string"><span class="delimiter">&quot;</span><span class="content">{} windows simple moving average</span><span class="delimiter">&quot;</span></span>.format(period)
    price_data[col] = price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(period, min_periods=<span class="integer">1</span>).mean()
    ma_cols.append(col)

return_cols = []
<span class="comment"># 価格変化率</span>
<span class="keyword">for</span> period <span class="keyword">in</span> periods:
    col = <span class="string"><span class="delimiter">&quot;</span><span class="content">{} windows rate of return</span><span class="delimiter">&quot;</span></span>.format(period)
    price_data[col] = price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(period) * <span class="integer">100</span>
    return_cols.append(col)

vol_cols = []
<span class="comment"># ヒストリカル・ボラティリティ</span>
<span class="keyword">for</span> period <span class="keyword">in</span> periods:
    col = <span class="string"><span class="delimiter">&quot;</span><span class="content">{} windows volatility</span><span class="delimiter">&quot;</span></span>.format(period)
    price_data[col] = np.log(price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(period).std()
    vol_cols.append(col)

<span class="comment"># プロット</span>
fig, ax = plt.subplots(nrows=<span class="integer">3</span> ,figsize=(<span class="integer">20</span>, <span class="integer">8</span>))

ax[<span class="integer">0</span>].plot(price_data[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>], label=<span class="string"><span class="delimiter">&quot;</span><span class="content">Close Price</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">for</span> col <span class="keyword">in</span> ma_cols:
    ax[<span class="integer">0</span>].plot(price_data[col], label=col)

<span class="keyword">for</span> col <span class="keyword">in</span> return_cols:
    ax[<span class="integer">1</span>].plot(price_data[col], label=col)

<span class="keyword">for</span> col <span class="keyword">in</span> vol_cols:
    ax[<span class="integer">2</span>].plot(price_data[col], label=col)

ax[<span class="integer">0</span>].set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>)
ax[<span class="integer">1</span>].set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">rate of return (%)</span><span class="delimiter">&quot;</span></span>)
ax[<span class="integer">2</span>].set_ylabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility (log return)</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">for</span> _ax <span class="keyword">in</span> ax:
    _ax.set_xlabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>)
    _ax.grid(<span class="predefined-constant">True</span>)
    _ax.legend()</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/sample_plot_all_features.png" alt="plot_all_features">
</div>
</div>
<div class="paragraph">
<p>ここでは2018年末に起きた株価の下落に着目してみます。複数の特徴量を並べてプロットすると、株価に大きな変動があった時に他の特徴量にどのような影響を与えているかを観測することができます。</p>
</div>
<div class="paragraph">
<p>移動平均の特徴量は、期間が短いほど敏感に株価の下落に反応し、期間が長い特徴量ほど反応が遅れることがわかります。リターンの特徴量も下落時には同一の傾向が見て取れますが、その後高いリターンが観測されることがわかります。一方、ヒストリカル・ボラティリティの挙動をみると、下落の前にじわじわとボラティリティが上昇していることがわかります。このように一つの株価の下落を見ても、それぞれの特徴量の挙動が微妙に異なっており、複数個の特徴量をモデルに投入することで、これらの挙動のパターンを学習することが想像できます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_データセットの前処理">2.6. データセットの前処理</h3>
<div class="paragraph">
<p>ここまでデータの読み込み及び可視化について説明してきましたが、ここからはデータの前処理やモデル構築に関して説明していきます。
大まかな流れは、次の図のとおりです。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/flow_chart.png" alt="pipeline">
</div>
</div>
<div class="paragraph">
<p>上図のとおり、モデルを構築する際には、データセットをそのまま入力するのではなく、欠損値処理や正規化処理などのデータセットの前処理を実施してから入力することが一般的です。ここではデータセットの前処理について解説していきます。</p>
</div>
<div class="sect3">
<h4 id="_欠損値処理">2.6.1. 欠損値処理</h4>
<div class="paragraph">
<p>機械学習モデルの多くは欠損値をそのまま扱うことができないため、補完するなどして対処する必要があります。欠損値補完の方法としては、平均値埋めやリストワイズ法、多重代入法などが存在します。また、変数に欠損が存在するレコードを単に除外することや、欠損を多く含む変数自体を除外することも考えられます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_欠損値の処理方法">2.6.2. 欠損値の処理方法</h4>
<div class="paragraph">
<p>本コンペティションのデータについて、まずは実際に欠損が発生している箇所やパターンを特定するために、欠損の発生状況をプロットして確認してみます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_finデータを読み込む</span>
stock_fin = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 2019年までの値を表示</span>
stock_fin = stock_fin[:<span class="string"><span class="delimiter">&quot;</span><span class="content">2019</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># データ数の確認</span>
print(stock_fin.shape)

<span class="comment"># データの欠損値数を確認</span>
print(stock_fin.isna().sum())

<span class="comment"># 欠損値の数を年別に集計</span>
stock_fin = stock_fin.isna()
stock_fin[<span class="string"><span class="delimiter">&quot;</span><span class="content">year</span><span class="delimiter">&quot;</span></span>] = stock_fin.index.year

<span class="comment"># データの欠損値をプロット</span>
fig, ax = plt.subplots(figsize=(<span class="integer">20</span>, <span class="integer">5</span>))
sns.heatmap(stock_fin.groupby(<span class="string"><span class="delimiter">&quot;</span><span class="content">year</span><span class="delimiter">&quot;</span></span>).agg(<span class="string"><span class="delimiter">&quot;</span><span class="content">sum</span><span class="delimiter">&quot;</span></span>), ax=ax)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/missing_values.png" alt="欠損値">
</div>
</div>
<div class="paragraph">
<p>明るい色で示されている箇所は、欠損値が多く発生していることを表しています。本チュートリアルでは欠損値について以下のように対応します。<br>
・`Result_FinancialStatement` の <code>CashFlowsFromOperatingActivities</code> 、 <code>CashFlowsFromFinancingActivities</code> 、 <code>CashFlowsFromInvestingActivities</code> に多くの欠損値があります（上図中央左）。これらのカラムの値は <code>Result_FinancialStatement ReportType</code> が <code>Annual</code> の場合にのみ値が入っています。これらの欠損値については <code>0</code> を代入することで対処します。<br>
・配当支払開始日を表す <code>Result_Dividend DividendPayableDate</code> や予想配当基準日を表す <code>Forecast_Dividend RecordDate</code> というデータ列等のfloat64型以外のデータ列に数多く欠損が発生していることが分かります（上図右側）。そのため、本チュートリアルではfloat64型として読み込まれているカラムのみを使用することとします。<br>
・上記に記載したキャッシュフローに関するカラム以外のfloat64型として読み込まれているカラムの欠損値についても、 <code>0</code> を代入することで対処します。ただし、変数によっては、0という数字自体に意味があるケースが有るため、気をつける必要があります。</p>
</div>
<div class="paragraph">
<p>実際の欠損値処理は、次のように変数の型 (今回は <code>np.float64</code> という型を選択) 別に後段処理できる値 (今回は <code>0</code>) で欠損値を埋めます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_finデータを読み込む</span>
stock_fin = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 銘柄コード9984にデータを絞る</span>
code = <span class="integer">9984</span>
stock_fin = stock_fin[stock_fin[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]

<span class="comment"># float64型の列に絞り込み</span>
fin_data = stock_fin.select_dtypes(include=[<span class="string"><span class="delimiter">&quot;</span><span class="content">float64</span><span class="delimiter">&quot;</span></span>])

<span class="comment"># 欠損値を0でフィル</span>
fin_data = fin_data.fillna(<span class="integer">0</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_特徴量の生成">2.7. 特徴量の生成</h3>
<div class="sect3">
<h4 id="_なぜ特徴量の設計が重要なのか">2.7.1. なぜ特徴量の設計が重要なのか</h4>
<div class="paragraph">
<p>機械学習の手法には<strong>モデルにできるだけ生に近いデータを与えてその関係性を見つける手法</strong>と<strong>ドメイン知識や専門性を活かして、特徴量を設計する手法</strong>があります。</p>
</div>
<div class="paragraph">
<p>前者の手法はEnd-To-End Learningと呼ばれ、生に近いデータをモデルに与え、そのモデル自体に特徴量を発見させる手法です。音声認識などの分野で活用されています。<br>
本チュートリアルでは、金融データに慣れ親しんでいただくためにも、特徴量の影響を細かく考察しながら汎化性能に貢献する特徴量を設計していくアプローチで、モデルを構築します。</p>
</div>
<div class="paragraph">
<p>特徴量生成は、仮説を考え、その仮説をモデルが学ぶにはどのような特徴量が必要か、ということを想像することが重要です。</p>
</div>
<div class="paragraph">
<p>本チュートリアルでは、「直近株価が上がったら、高値もより大きく変動しやすい」という仮説を立て、この仮説を基に特徴量を生成してみます。この仮説をモデルが学ぶためには直近株価が上がったことを示す特徴量が必要です。直近を仮に1ヶ月と仮定すると、20日リターンや20日移動平均乖離率などが候補になります。</p>
</div>
<div class="paragraph">
<p>また、この仮説が市場においても必ずしも正しいという必要はなく、仮説を思いついたら、その仮説を学ぶことができる特徴量を想像し、実際に実験してみることが重要です。</p>
</div>
</div>
<div class="sect3">
<h4 id="_定常性を意識した特徴量設計">2.7.2. 定常性を意識した特徴量設計</h4>
<div class="paragraph">
<p>時系列データを扱う際には、定常性を意識して特徴量を設計することが重要です。</p>
</div>
<div class="paragraph">
<p><strong>株価をそのまま学習させたケース</strong>と<strong>定常性がある特徴量を利用するケース</strong>について考えてみます。</p>
</div>
<div class="paragraph">
<p><strong>株価をそのまま学習させたケース</strong>: 例えば、モデルの訓練期間における株価が、100円〜110円の範囲で動いたとします。もし、この数値をそのままモデルに投入すると、モデルは株価が100円〜110円近辺で動くことを暗黙に学習します。しかし、この暗黙の仮定は実際のマーケットでは成立しておらず、テスト期間で株価が高騰すると、モデルがうまく動かないことがあります。他にも株価に特有の例としては株式分割や株式併合により株価のレンジが大きく変動する場合があります。</p>
</div>
<div class="paragraph">
<p><strong>定常性がある特徴量を利用するケース</strong>: 例えば、20日の価格変化率を考えると、これは正規分布ではありませんが、一部のマーケットの混乱期を除けばほぼ0を中心とした正規分布に近い分布になります。特徴量は、2%の上昇や4%の下落といった0を中心とした時系列となっており、将来に渡っても似たような分布になることが期待でき、株価範囲に対する暗黙の仮定を学ぶ恐れがなくなります。このように将来に渡っても似たような分布を期待できる特徴量は定常性があるといえます。</p>
</div>
<div class="paragraph">
<p>定常性を意識すると、正規化処理における様々な注意点が見えてきます。たとえば、最小値と最大値を-1から1などにマッピングするMinMax正規化を株価に適用したとしても定常性を期待することはできません。株価をMinMax正規化したときにその最大値・最小値が未来に対しても適用できる保証ができないためです。このように時系列の特徴量の設計をするとき、定常性を意識しながら特徴量を設計していくことが重要です。</p>
</div>
</div>
<div class="sect3">
<h4 id="_特徴量の生成例">2.7.3. 特徴量の生成例</h4>
<div class="paragraph">
<p>ここでは、特徴量の生成を <code>stock_price</code> の株価情報を利用して行います。株価情報には、価格や出来高など市場で公開されている株価の四本値(始値、高値、安値、終値)の時系列データが格納されています。本チュートリアルでは、特徴量の例として1ヶ月、2ヶ月、3ヶ月間の「終値の変化率（リターン）」、「ヒストリカル・ボラティリティ」、「移動平均線からの乖離率」を紹介します。<br>
次のコードで具体的な計算については示しますが、定義は以下のとおりです。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>特徴量の計算に使用する関数</strong></th>
<th class="tableblock halign-left valign-top"><strong>使用する関数の説明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pct_change(N)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現在の観測値とN個前の観測値との変化率</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">diff()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現在の観測値と一つ前の観測値との差</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rolling(N)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象の観測値をN個でグループ化</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">std()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">標準偏差</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mean()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">算術平均</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># stock_priceデータを読み込む</span>
price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]

<span class="comment"># 銘柄コード9984にデータを絞る</span>
code = <span class="integer">9984</span>
price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]

<span class="comment"># 終値のみに絞る</span>
feats = price_data[[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]].copy()
<span class="comment"># 終値の20営業日リターン</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_1month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(<span class="integer">20</span>)
<span class="comment"># 終値の40営業日リターン</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_2month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(<span class="integer">40</span>)
<span class="comment"># 終値の60営業日リターン</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_3month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(<span class="integer">60</span>)
<span class="comment"># 終値の20営業日ボラティリティ</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_1month</span><span class="delimiter">&quot;</span></span>] = (
    np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(<span class="integer">20</span>).std()
)
<span class="comment"># 終値の40営業日ボラティリティ</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_2month</span><span class="delimiter">&quot;</span></span>] = (
    np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(<span class="integer">40</span>).std()
)
<span class="comment"># 終値の60営業日ボラティリティ</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_3month</span><span class="delimiter">&quot;</span></span>] = (
    np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(<span class="integer">60</span>).std()
)
<span class="comment"># 終値と20営業日の単純移動平均線の乖離</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_1month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">20</span>).mean()
)
<span class="comment"># 終値と40営業日の単純移動平均線の乖離</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_2month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">40</span>).mean()
)
<span class="comment"># 終値と60営業日の単純移動平均線の乖離</span>
feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_3month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">60</span>).mean()
)
<span class="comment"># 欠損値処理</span>
feats = feats.fillna(<span class="integer">0</span>)
<span class="comment"># 元データのカラムを削除</span>
feats = feats.drop([<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>], axis=<span class="integer">1</span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_テクニカル分析を活用した特徴量の生成">2.7.4. テクニカル分析を活用した特徴量の生成</h4>
<div class="paragraph">
<p>他に株価を扱うための特徴量としてRSIやストキャスティクスのようなテクニカル分析の指標などを活用することもあります。pythonの <code>talib</code> というライブラリにはたくさんのテクニカル分析が実装されているため、活用を検討する価値があります。ただし、これらに対しては、本章では取り扱わずに、第4章で紹介しています。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_バックテスト用のテストデータ作成">2.8. バックテスト用のテストデータ作成</h3>
<div class="paragraph">
<p>ここでは、バックテストを行うためのデータの分割について説明します。</p>
</div>
<div class="sect3">
<h4 id="_バックテストとは">2.8.1. バックテストとは</h4>
<div class="paragraph">
<p>バックテストとは、モデルの有効性を検証する際に、過去のデータを用いて、一定期間にどの程度のパフォーマンスが得られたかをシミュレーションすることです。モデルの有効性を検証する上で、どのようにバックテストを実施するかは重要なポイントになります。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ホールドアウト検証">2.8.2. ホールドアウト検証</h4>
<div class="paragraph">
<p>ここでは、データセットを訓練データとテストデータに切り分けます。まずデータセットを分ける理由を説明し、次に、データセットの分け方及びコツについて解説します。</p>
</div>
<div class="paragraph">
<p>データセットを分ける理由は、モデルの汎化性能を確認し使用するモデルを決定するためです。</p>
</div>
<div class="paragraph">
<p>汎化性能とは、モデルが訓練データ以外の未知のデータに対しても機能するという能力です。汎化性能が低いモデルは、訓練データでは高い精度が得られますが、訓練データにない未知のデータについては、低い精度しか得られません。この現象を<strong>過学習</strong>と呼びます。データセットを分割せずに、そのまま全体に対して学習し、同じデータセットに対してモデルによる予測をすると、基本的には高い精度の結果を得ることができます。<br>
しかし、未知のデータに対して予測すると、予測がまったく当たらないということが起こり得ます。そのため、データセットを分割して、学習に使用していないデータをモデルの検証用として用意しておくことで、作成したモデルが過学習していないことを確認することが出来ます。</p>
</div>
<div class="paragraph">
<p>基本的な時系列データの分割手法(<strong>ホールドアウト検証</strong>)に関して解説します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1.全体のデータセットを、訓練期間(TRAIN)/検証期間(VAL)/テスト期間(TEST)で分けます。
2.TRAINデータでモデルを学習させ、VALデータでモデルを評価します。これをモデルのさまざまなパラメーターで何度か行い、一番結果が良かったパラメーターを選びます。
3.そして最後にTESTデータでモデルの予測結果を最終評価します。</pre>
</div>
</div>
<div class="paragraph">
<p>本チュートリアルでは、次の期間でデータを分割します。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even" style="width: 50%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">訓練期間</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016-01-01 - 2017-12-31</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">評価期間</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018-02-01 - 2018-12-01</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">テスト期間</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019-01-01 - 2020-12-31</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre>※データの分割に際し、各期間に間隔（1か月）を空けている理由は、未来の情報を含ませないようにするためです。例えば、2017年12月31日の目的変数には5営業日、10営業日、20営業日後の株価リターンの情報が入っているため、2017年12月31日のデータを使って学習したモデルは未来の情報（2018年1月のリターン）を知っていることになってしまいます。したがって、2018年1月のデータを検証データに含めてしまうとリークが発生し、適切なモデルの評価ができなくなってしまいます。</pre>
</div>
</div>
<div class="paragraph">
<p>以下のように変数を定義しておきます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">TRAIN_END = <span class="string"><span class="delimiter">&quot;</span><span class="content">2017-12-31</span><span class="delimiter">&quot;</span></span>
VAL_START = <span class="string"><span class="delimiter">&quot;</span><span class="content">2018-02-01</span><span class="delimiter">&quot;</span></span>
VAL_END = <span class="string"><span class="delimiter">&quot;</span><span class="content">2018-12-01</span><span class="delimiter">&quot;</span></span>
TEST_START = <span class="string"><span class="delimiter">&quot;</span><span class="content">2019-01-01</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_その他の検証方法">2.8.3. その他の検証方法</h4>
<div class="paragraph">
<p>・k-fold 交差検証(k-fold CV): データをまず訓練データとテストデータに分け、その後その訓練データをk個のグループに分割し、k-1個のグループに含まれるものを訓練データ、残りの1個のグループに含まれるものを評価データとすると、このような分割方法はk通り考えられます。<br>
そこで、それぞれの分割方法したがってk回訓練と評価を行い、それぞれの試行結果の平均などを使用して、モデルやそのモデルのパラメータを評価します。なお、時系列データでは、将来の情報を含まないように注意する必要があります。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_モデルの構築">2.9. モデルの構築</h3>
<div class="paragraph">
<p>ここでは、モデルの学習に用いるためのデータを準備します。</p>
</div>
<div class="paragraph">
<p>モデル作成のステップは、以下のとおりに行います。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1. 銘柄を一つ選ぶ
2. その銘柄に対して、財務データ及びマーケットデータから特徴量を作る
3. 全銘柄に対して同じことを繰り返す
4. 作成したデータを結合する
5. 全データを訓練データ、評価データ、テストデータに分ける
6. 訓練データで予測モデルを学習させる</pre>
</div>
</div>
<div class="paragraph">
<p>・<strong>入力用データの作成方法</strong></p>
</div>
<div class="paragraph">
<p>前回までのマーケットデータを用いた特徴量生成方法、及び財務諸表データの欠損値処理を行った後のデータ処理について解説し、今回はそれらのデータを結合させ、モデルが学習できるフォーマットに直すことが目的です。</p>
</div>
<div class="sect3">
<h4 id="_特徴量の生成_2">2.9.1. 特徴量の生成</h4>
<div class="paragraph">
<p>ここでは、特徴量生成のコードを示しています。コードのおおまかな流れとしては、以下の3ステップに分けられます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1. 財務データの取得及び前処理（Chapter 2.6.2と同様）
2. マーケットデータの取得及び特徴量定義（Chapter 2.7.2と同様）
3. 財務データと生成した特徴量を結合</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">get_features_for_predict</span>(dfs, code, start_dt=<span class="string"><span class="delimiter">&quot;</span><span class="content">2016-01-01</span><span class="delimiter">&quot;</span></span>):
    <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">    Args:</span><span class="content">
</span><span class="content">        dfs (dict)  : dict of pd.DataFrame include stock_fin, stock_price</span><span class="content">
</span><span class="content">        code (int)  : A local code for a listed company</span><span class="content">
</span><span class="content">        start_dt (str): specify date range</span><span class="content">
</span><span class="content">    Returns:</span><span class="content">
</span><span class="content">        feature DataFrame (pd.DataFrame)</span><span class="content">
</span><span class="content">    </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    <span class="comment"># おおまかな手順の1つ目</span>
    <span class="comment"># stock_finデータを読み込み</span>
    stock_fin = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>]

    <span class="comment"># 特定の銘柄コードのデータに絞る</span>
    fin_data = stock_fin[stock_fin[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
    <span class="comment"># 特徴量の作成には過去60営業日のデータを使用しているため、</span>
    <span class="comment"># 予測対象日からバッファ含めて土日を除く過去90日遡った時点から特徴量を生成します</span>
    n = <span class="integer">90</span>
    <span class="comment"># 特徴量の生成対象期間を指定</span>
    fin_data = fin_data.loc[pd.Timestamp(start_dt) - pd.offsets.BDay(n) :]
    <span class="comment"># fin_dataのnp.float64のデータのみを取得</span>
    fin_data = fin_data.select_dtypes(include=[<span class="string"><span class="delimiter">&quot;</span><span class="content">float64</span><span class="delimiter">&quot;</span></span>])
    <span class="comment"># 欠損値処理</span>
    fin_feats = fin_data.fillna(<span class="integer">0</span>)

    <span class="comment"># おおまかな手順の2つ目</span>
    <span class="comment"># stock_priceデータを読み込む</span>
    price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]
    <span class="comment"># 特定の銘柄コードのデータに絞る</span>
    price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
    <span class="comment"># 終値のみに絞る</span>
    feats = price_data[[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]]
    <span class="comment"># 特徴量の生成対象期間を指定</span>
    feats = feats.loc[pd.Timestamp(start_dt) - pd.offsets.BDay(n) :].copy()

    <span class="comment"># 終値の20営業日リターン</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_1month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(<span class="integer">20</span>)
    <span class="comment"># 終値の40営業日リターン</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_2month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(<span class="integer">40</span>)
    <span class="comment"># 終値の60営業日リターン</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_3month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].pct_change(<span class="integer">60</span>)
    <span class="comment"># 終値の20営業日ボラティリティ</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_1month</span><span class="delimiter">&quot;</span></span>] = (
        np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(<span class="integer">20</span>).std()
    )
    <span class="comment"># 終値の40営業日ボラティリティ</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_2month</span><span class="delimiter">&quot;</span></span>] = (
        np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(<span class="integer">40</span>).std()
    )
    <span class="comment"># 終値の60営業日ボラティリティ</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_3month</span><span class="delimiter">&quot;</span></span>] = (
        np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]).diff().rolling(<span class="integer">60</span>).std()
    )
    <span class="comment"># 終値と20営業日の単純移動平均線の乖離</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_1month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">20</span>).mean()
    )
    <span class="comment"># 終値と40営業日の単純移動平均線の乖離</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_2month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">40</span>).mean()
    )
    <span class="comment"># 終値と60営業日の単純移動平均線の乖離</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_3month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">60</span>).mean()
    )

    <span class="comment"># おおまかな手順の3つ目</span>
    <span class="comment"># 欠損値処理</span>
    feats = feats.fillna(<span class="integer">0</span>)
    <span class="comment"># 元データのカラムを削除</span>
    feats = feats.drop([<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>], axis=<span class="integer">1</span>)

    <span class="comment"># 財務データの特徴量とマーケットデータの特徴量のインデックスを合わせる</span>
    feats = feats.loc[feats.index.isin(fin_feats.index)]
    fin_feats = fin_feats.loc[fin_feats.index.isin(feats.index)]

    <span class="comment"># データを結合</span>
    feats = pd.concat([feats, fin_feats], axis=<span class="integer">1</span>).dropna()

    <span class="comment"># 欠損値処理を行います。</span>
    feats = feats.replace([np.inf, -np.inf], <span class="integer">0</span>)

    <span class="comment"># 銘柄コードを設定</span>
    feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] = code

    <span class="comment"># 生成対象日以降の特徴量に絞る</span>
    feats = feats.loc[pd.Timestamp(start_dt) :]

    <span class="keyword">return</span> feats</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここで、 <code>np.inf</code> を0に置換していますが、価格変化率の計算の際に発散してしまったものを、0と定義し直しています。このように、特徴量を定義する際に、特徴量変換により発散してしまった時やnanになった時の処理を、あらかじめ考慮しておくことがスムーズにデータセットを構築する上で重要です。</p>
</div>
<div class="paragraph">
<p>次にここまでの処理の結果を確認します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">df = get_features_for_predict(dfs, <span class="integer">9984</span>)
df.T</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_目的変数の対応付け及び訓練データ評価データテストデータの分割">2.9.2. 目的変数の対応付け及び訓練データ、評価データ、テストデータの分割</h4>
<div class="paragraph">
<p>次に目的変数を定義します。目的変数は、データセットの <code>stock_labels</code> 内にあり、利用する際は先ほど定義した特徴量のデータセットに対して、行（日付）を一致させる必要があります。</p>
</div>
<div class="paragraph">
<p>データセットの訓練期間、評価期間、テスト期間への分割処理も合わせて実施します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">get_features_and_label</span>(dfs, codes, feature, label):
    <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">    Args:</span><span class="content">
</span><span class="content">        dfs (dict[pd.DataFrame]): loaded data</span><span class="content">
</span><span class="content">        codes  (array) : target codes</span><span class="content">
</span><span class="content">        feature (pd.DataFrame): features</span><span class="content">
</span><span class="content">        label (str) : label column name</span><span class="content">
</span><span class="content">    Returns:</span><span class="content">
</span><span class="content">        train_X (pd.DataFrame): training data</span><span class="content">
</span><span class="content">        train_y (pd.DataFrame): label for train_X</span><span class="content">
</span><span class="content">        val_X (pd.DataFrame): validation data</span><span class="content">
</span><span class="content">        val_y (pd.DataFrame): label for val_X</span><span class="content">
</span><span class="content">        test_X (pd.DataFrame): test data</span><span class="content">
</span><span class="content">        test_y (pd.DataFrame): label for test_X</span><span class="content">
</span><span class="content">    </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    <span class="comment"># 分割データ用の変数を定義</span>
    trains_X, vals_X, tests_X = [], [], []
    trains_y, vals_y, tests_y = [], [], []

    <span class="comment"># 銘柄コード毎に特徴量を作成</span>
    <span class="keyword">for</span> code <span class="keyword">in</span> tqdm(codes):
        <span class="comment"># 特徴量取得</span>
        feats = feature[feature[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] == code]

        <span class="comment"># stock_labelデータを読み込み</span>
        stock_labels = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>]
        <span class="comment"># 特定の銘柄コードのデータに絞る</span>
        stock_labels = stock_labels[stock_labels[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]

        <span class="comment"># 特定の目的変数に絞る</span>
        labels = stock_labels[label]
        <span class="comment"># nanを削除</span>
        labels.dropna(inplace=<span class="predefined-constant">True</span>)

        <span class="keyword">if</span> feats.shape[<span class="integer">0</span>] &gt; <span class="integer">0</span> <span class="keyword">and</span> labels.shape[<span class="integer">0</span>] &gt; <span class="integer">0</span>:
            <span class="comment"># 特徴量と目的変数のインデックスを合わせる</span>
            labels = labels.loc[labels.index.isin(feats.index)]
            feats = feats.loc[feats.index.isin(labels.index)]
            labels.index = feats.index

            <span class="comment"># データを分割（ホールドアウト法）</span>
            _train_X = feats[: TRAIN_END]
            _val_X = feats[VAL_START : VAL_END]
            _test_X = feats[TEST_START :]

            _train_y = labels[: TRAIN_END]
            _val_y = labels[VAL_START : VAL_END]
            _test_y = labels[TEST_START :]

            <span class="comment"># データを配列に格納 (後ほど結合するため)</span>
            trains_X.append(_train_X)
            vals_X.append(_val_X)
            tests_X.append(_test_X)

            trains_y.append(_train_y)
            vals_y.append(_val_y)
            tests_y.append(_test_y)

    <span class="comment"># 銘柄毎に作成した説明変数データを結合します。</span>
    train_X = pd.concat(trains_X)
    val_X = pd.concat(vals_X)
    test_X = pd.concat(tests_X)
    <span class="comment"># 銘柄毎に作成した目的変数データを結合します。</span>
    train_y = pd.concat(trains_y)
    val_y = pd.concat(vals_y)
    test_y = pd.concat(tests_y)

    <span class="keyword">return</span> train_X, train_y, val_X, val_y, test_X, test_y</code></pre>
</div>
</div>
<div class="paragraph">
<p>次に、ここまでの結果を確認します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 対象銘柄コードを定義</span>
codes = [<span class="integer">9984</span>]
<span class="comment"># 対象の目的変数を定義</span>
label = <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>
<span class="comment"># 特徴量を取得</span>
feat = get_features_for_predict(dfs, codes[<span class="integer">0</span>])
<span class="comment"># 特徴量と目的変数を入力し、分割データを取得</span>
ret = get_features_and_label(dfs, codes, feat, label)
<span class="keyword">for</span> v <span class="keyword">in</span> ret:
    print(v.T)</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここまでは一つの銘柄に対して処理をしてきましたが、ここからは全ての予測対象銘柄に対して上記の処理を実施するために、予測対象の銘柄コードを以下のように取得します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">get_codes</span>(dfs):
    <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">    Args:</span><span class="content">
</span><span class="content">        dfs (dict[pd.DataFrame]): loaded data</span><span class="content">
</span><span class="content">    Returns:</span><span class="content">
</span><span class="content">        array: list of stock codes</span><span class="content">
</span><span class="content">    </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    stock_list = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>].copy()
    <span class="comment"># 予測対象の銘柄コードを取得</span>
    codes = stock_list[stock_list[<span class="string"><span class="delimiter">&quot;</span><span class="content">prediction_target</span><span class="delimiter">&quot;</span></span>] == <span class="predefined-constant">True</span>][
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>
    ].values
    <span class="keyword">return</span> codes</code></pre>
</div>
</div>
<div class="paragraph">
<p>次に、目的変数毎にデータセットを作成します。今回は全ての目的変数に同一の特徴量を使用していますが、目的変数に応じて特徴量をチューニングすることでより精度の高いモデルを作成することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 対象の目的変数を定義</span>
labels = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_5</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_10</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_low_5</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_low_10</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_low_20</span><span class="delimiter">&quot;</span></span>,
}
<span class="comment"># 目的変数毎にデータを保存するための変数</span>
train_X, val_X, test_X = {}, {}, {}
train_y, val_y, test_y = {}, {}, {}

<span class="comment"># 予測対象銘柄を取得</span>
codes = get_codes(dfs)

<span class="comment"># 特徴量を作成</span>
buff = []
<span class="keyword">for</span> code <span class="keyword">in</span> tqdm(codes):
    feat = get_features_for_predict(dfs, code)
    buff.append(feat)
feature = pd.concat(buff)

<span class="comment"># 目的変数毎に処理</span>
<span class="keyword">for</span> label <span class="keyword">in</span> tqdm(labels):
    <span class="comment"># 特徴量と目的変数を取得</span>
    _train_X, _train_y, _val_X, _val_y, _test_X, _test_y = get_features_and_label(dfs, codes, feature, label)
    <span class="comment"># 目的変数をキーとして値を保存</span>
    train_X[label] = _train_X
    val_X[label] = _val_X
    test_X[label] = _test_X
    train_y[label] = _train_y
    val_y[label] = _val_y
    test_y[label] = _test_y</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_モデル学習の実行方法">2.9.3. <strong>モデル学習の実行方法</strong></h4>
<div class="paragraph">
<p>データの準備が完了したので、いよいよモデルの学習を実行します。ここでは、sklearnライブラリのRandomForestRegressorモデルを使用します。モデルに設定する各種パラメータは、ここではとくに指定せずにライブラリのデフォルトパラメータを使用します。</p>
</div>
<div class="paragraph">
<p>RandomForestの回帰モデルであるRandomForestRegressorモデルを利用する理由は、予測する目的変数が連続値であるからです。RandomForestモデルは決定木をベースとするモデルであるため、以下の理由から最初に選択するモデルとして扱いやすいです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RandomForest内部で利用する決定木は、特徴量の大小関係のみに着目しており、値自体には意味がないので正規化処理の必要がありません</p>
</li>
<li>
<p>特徴量の重要度を取得することができ、次に実施することの道筋を立てやすい</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 目的変数を指定</span>
label = <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>
<span class="comment"># モデルの初期化</span>
pred_model = RandomForestRegressor(random_state=<span class="integer">0</span>)
<span class="comment"># モデルの学習</span>
pred_model.fit(train_X[label], train_y[label])</code></pre>
</div>
</div>
<div class="paragraph">
<p>一方、サポートベクターマシンやニューラルネットワークを利用する際は、データの前処理における注意点が増えます。選択するモデルの特性に応じた正規化処理と特徴量設計が重要です。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_モデルの推論">2.10. モデルの推論</h3>
<div class="paragraph">
<p>ここでは構築したモデルから予測結果を出力し、可視化などによる分析を実施します。</p>
</div>
<div class="sect3">
<h4 id="_予測結果の出力方法">2.10.1. 予測結果の出力方法</h4>
<div class="paragraph">
<p>ここまで、それぞれの目的変数に対して、訓練データ、評価データ、テストデータに分割しました。ここからは、モデルの学習完了後に、テストデータを入力として予測を出力し、pandas.DataFrame形式に変換します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># モデルを定義</span>
models = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">rf</span><span class="delimiter">&quot;</span></span>: RandomForestRegressor,
}

<span class="comment"># モデルを選択</span>
model = <span class="string"><span class="delimiter">&quot;</span><span class="content">rf</span><span class="delimiter">&quot;</span></span>

<span class="comment"># 目的変数を指定</span>
label = <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>

<span class="comment"># 学習用データセット定義</span>
<span class="comment"># ファンダメンタル情報</span>
fundamental_cols = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>].select_dtypes(<span class="string"><span class="delimiter">&quot;</span><span class="content">float64</span><span class="delimiter">&quot;</span></span>).columns
fundamental_cols = fundamental_cols[fundamental_cols != <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_Dividend DividendPayableDate</span><span class="delimiter">&quot;</span></span>]
fundamental_cols = fundamental_cols[fundamental_cols != <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>]
<span class="comment"># 価格変化率</span>
returns_cols = [x <span class="keyword">for</span> x <span class="keyword">in</span> train_X[label].columns <span class="keyword">if</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">return</span><span class="delimiter">&quot;</span></span> <span class="keyword">in</span> x]
<span class="comment"># テクニカル</span>
technical_cols = [x <span class="keyword">for</span> x <span class="keyword">in</span> train_X[label].columns <span class="keyword">if</span> (x <span class="keyword">not</span> <span class="keyword">in</span> fundamental_cols) <span class="keyword">and</span> (x != <span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>)]

columns = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental_only</span><span class="delimiter">&quot;</span></span>: fundamental_cols,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">return_only</span><span class="delimiter">&quot;</span></span>: returns_cols,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">technical_only</span><span class="delimiter">&quot;</span></span>: technical_cols,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental+technical</span><span class="delimiter">&quot;</span></span>: <span class="predefined">list</span>(fundamental_cols) + <span class="predefined">list</span>(technical_cols),
}
<span class="comment"># 学習用データセットを指定</span>
col = <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental_only</span><span class="delimiter">&quot;</span></span>

<span class="comment"># 学習</span>
pred_model = models[model](random_state=<span class="integer">0</span>)
pred_model.fit(train_X[label][columns[col]].values, train_y[label])

<span class="comment"># 予測</span>
result = {}
result[label] = pd.DataFrame(
    pred_model.predict(val_X[label][columns[col]]), columns=[<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>]
)

<span class="comment"># 予測結果に日付と銘柄コードを追加</span>
result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = val_X[label][columns[col]].index
result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] = val_X[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>].values

<span class="comment"># 予測の符号を取得</span>
result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">predict_dir</span><span class="delimiter">&quot;</span></span>] = np.sign(result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>])

<span class="comment"># 実際の値を追加</span>
result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>] = val_y[label].values</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_予測結果の可視化方法">2.10.2. 予測結果の可視化方法</h4>
<div class="paragraph">
<p>予測結果の確認として、実際に決算開示等のあった銘柄について基準日付の終値から最高値への変化率(actual)と予測スコア(predict)の散布図を見ます。ここで散布図を選択する理由は、予測対象に対して予測スコアがどのような分布をとっているかを見ることが、モデルの挙動を理解するわかりやすい可視化であることが挙げられます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">sns.jointplot(data=result[label], x=<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>, y=<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/actual_pred.png" alt="scatter_plot_actual_predict">
</div>
</div>
<div class="paragraph">
<p>この図では、横軸が予測値で、縦軸が真の値です。予測と真の値には、正の相関(0.144192)が見受けられるので、ある程度の相関関係が発生しています。一般的なデータで0.144という数字が出てもほぼ無相関に見えますが、金融データでは0.144というスコアは高い部類に入ります。このように視覚化すると、予測値と真の値の関係性を可視化できます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_予測結果に対する分析の道筋">2.11. 予測結果に対する分析の道筋</h3>
<div class="paragraph">
<p>予測精度を向上させるためには、特徴量とモデルの分析を集中的に行う必要があります。特徴量の分析では、さまざまな手法がありますが、ここでは特徴量の重要度の分析とSHAPという手法を紹介します。</p>
</div>
<div class="sect3">
<h4 id="_特徴量の重要度">2.11.1. 特徴量の重要度</h4>
<div class="paragraph">
<p>特徴量の重要度は、Random ForestやGradient Boostingなどのいくつかの機械学習モデルで取得でき、モデル内でどの程度それぞれの説明変数が、目的変数に対して重要であるかを判断するために参考になる指標です。</p>
</div>
<div class="paragraph">
<p>重要度が極端に低いものは、そもそも説明変数から除外したり、重要度が高いものは更に分析することで、性能の向上が期待できないか、など分析の道筋をつける上でも役に立ちます。</p>
</div>
<div class="paragraph">
<p>ここではファンダメンタル情報を用いて、モデルの訓練データ(2016年初から2017年末まで)における特徴量の重要度を調査します。</p>
</div>
<div class="paragraph">
<p>次の方法に従って、特徴量の重要度をプロットします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 学習済みモデルを指定</span>
rf = pred_model

<span class="comment"># 重要度順を取得</span>
sorted_idx = rf.feature_importances_.argsort()
<span class="comment"># プロット</span>
fig, ax = plt.subplots(figsize=(<span class="integer">8</span>, <span class="integer">8</span>))
ax.barh(fundamental_cols[sorted_idx], rf.feature_importances_[sorted_idx])
ax.set_xlabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Random Forest Feature Importance</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/feature_importance.png" alt="ファンダメンタル情報の特徴量重要度">
</div>
</div>
<div class="paragraph">
<p>上記の可視化により、 一番上にある <code>NetAssets(純資産)</code> にモデルが注目していることがわかります。純資産は資本金や利益剰余金などを合算した指標で、次に登場する <code>TotalAssets(総資産)</code> から負債を引いたものとなります。 <code>TotalAssets(総資産)</code> は、流動資産や固定資産、繰延資産など、会社の全ての資産を合算したものを示す指標です。<br>
この2つは会社の規模を示す代表的な指標となっています。<br>
Random Forestモデルの内部で、この2つを利用した分岐が多数存在していることを示しており、会社規模が重要な指標である可能性を示唆しています。</p>
</div>
</div>
<div class="sect3">
<h4 id="_shap">2.11.2. SHAP</h4>
<div class="paragraph">
<p>SHAPは、学習済みモデルにおいて、各特徴量がモデルの出力する予測値に与えた影響度を算出してくれるものです。</p>
</div>
<div class="paragraph">
<p>ここでは、サンプルモデルとしてXGBoostモデルを利用し、 <code>label_high_20</code> という目的変数に対して、どの特徴量が学習に効果的な特徴量なのかを見てみます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># モデルを定義します</span>
sample_model = xgboost.train({<span class="string"><span class="delimiter">&quot;</span><span class="content">learning_rate</span><span class="delimiter">&quot;</span></span>: <span class="float">0.01</span>}, xgboost.DMatrix(train_X[<span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>], label=train_y[<span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>]), <span class="integer">100</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>次にshap値を求めます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">shap.initjs()
explainer = shap.TreeExplainer(model=sample_model, feature_perturbation=<span class="string"><span class="delimiter">'</span><span class="content">tree_path_dependent</span><span class="delimiter">'</span></span>, model_output=<span class="string"><span class="delimiter">'</span><span class="content">margin</span><span class="delimiter">'</span></span>)
<span class="comment"># SHAP値</span>
shap_values = explainer.shap_values(X=train_X[<span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>])
<span class="comment"># プロット</span>
shap.summary_plot(shap_values, train_X[<span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>], plot_type=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/shap_bar.png" alt="shap importance">
</div>
</div>
<div class="paragraph">
<p>次にshapのsummary_plotを確認します。これは特徴量を少し変化させた時の学習のインパクトを表しています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">shap.summary_plot(shap_values, train_X[<span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/shap_graph.png" alt="shap summary plot">
</div>
</div>
<div class="paragraph">
<p>この図の見方ですが、上にある特徴量ほどモデルにとって重要であることを意味します。色が赤いのがその特徴量が高い時、青いのがその特徴量が低い時のSHAP値になります。図からは例えば以下のようなことが読み取れます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Total Assets</code> が1番目にモデルに影響を与える特徴量であることがわかります。プラス方向、マイナス方向に関わらず青い色が多いので、モデルが <code>Total Assets</code> が小さい場合にこの特徴量を活用していることがわかります。 <code>Net Assets</code> も同様の傾向が観測されます</p>
</li>
<li>
<p><code>volatility_1month</code> がモデルに大きな影響を与える特徴量であることがわかります。この特徴量は赤い時にプラス方向(高値が大きくなる)の影響が大きいことがわかります。これはボラティリティが上昇すると高値が高くなるということを意味するので直感に合致します。</p>
</li>
<li>
<p><code>MA_gap_1_month</code> が小さい時にプラス方向(高値が大きくなる)に影響を与えています。移動平均乖離率が小さいときは移動平均線がその時点の株価よりも下にいる期間なので、その時に高値が伸びるのは株価が反転している可能性が高いのかもしれません。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>上記のような考察を行いながら、さまざまな特徴量を考え、モデルを改善していくことが重要です。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_モデルの評価">2.12. モデルの評価</h3>
<div class="sect3">
<h4 id="_複数モデルの学習及び結果をまとめる">2.12.1. 複数モデルの学習及び結果をまとめる</h4>
<div class="paragraph">
<p>ここでは、複数モデルを用いて、予測及び結果の比較を行いたいと思います。</p>
</div>
<div class="paragraph">
<p>今回はシンプルなモデルを複数用います。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>モデル名</strong></th>
<th class="tableblock halign-left valign-top"><strong>パラメーター</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RandomForestRegressor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random_state = 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ExtraTreesRegressor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random_state = 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GradientBoostingRegressor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random_state = 0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>次は学習用のデータセットも複数用意します。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>学習用データセット名</strong></th>
<th class="tableblock halign-left valign-top"><strong>説明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fundamental_only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">財務諸表データのみ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">return_only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">価格変化率のデータのみ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">technical_only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">テクニカル指標のみ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fundamental+technical</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">財務諸表とテクニカル指標の両方</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># モデルを定義</span>
models = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">rf</span><span class="delimiter">&quot;</span></span>: RandomForestRegressor,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">extraTree</span><span class="delimiter">&quot;</span></span>: ExtraTreesRegressor,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">gbr</span><span class="delimiter">&quot;</span></span>: GradientBoostingRegressor,
}

<span class="comment"># 学習用データセット定義</span>
columns = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental_only</span><span class="delimiter">&quot;</span></span>: fundamental_cols,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">return_only</span><span class="delimiter">&quot;</span></span>: returns_cols,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">technical_only</span><span class="delimiter">&quot;</span></span>: technical_cols,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental+technical</span><span class="delimiter">&quot;</span></span>: <span class="predefined">list</span>(fundamental_cols) + <span class="predefined">list</span>(technical_cols),
}

<span class="comment"># 学習済みモデル保存用</span>
trained_models = <span class="predefined">dict</span>()
<span class="comment"># 結果保存用</span>
all_results = <span class="predefined">dict</span>()
<span class="comment"># モデル毎に処理</span>
<span class="keyword">for</span> model <span class="keyword">in</span> tqdm(models.keys()):
    all_results[model] = <span class="predefined">dict</span>()
    trained_models[model] = <span class="predefined">dict</span>()
    <span class="comment"># データセット毎に処理</span>
    <span class="keyword">for</span> col <span class="keyword">in</span> tqdm(columns.keys()):
        result = <span class="predefined">dict</span>()
        trained_models[model][col] = <span class="predefined">dict</span>()
        <span class="comment"># 目的変数毎に処理</span>
        <span class="keyword">for</span> label <span class="keyword">in</span> tqdm(labels):
            <span class="keyword">if</span> <span class="predefined">len</span>(test_X[label][columns[col]]) &gt; <span class="integer">0</span>:
                <span class="comment"># モデル取得</span>
                pred_model = models[model](random_state=<span class="integer">0</span>)
                <span class="comment"># 学習</span>
                pred_model.fit(train_X[label][columns[col]].values, train_y[label])
                <span class="comment"># 学習済みモデル保存</span>
                trained_models[model][col][label] = pred_model
                <span class="comment"># 結果データ作成</span>
                result[label] = test_X[label][[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>]].copy()
                result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = test_X[label][columns[col]].index
                <span class="comment"># 予測</span>
                result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>] = pred_model.predict(test_X[label][columns[col]])
                result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">predict_dir</span><span class="delimiter">&quot;</span></span>] = np.sign(result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>])
                <span class="comment"># 実際の結果</span>
                result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>] = test_y[label].values
                result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">actual_dir</span><span class="delimiter">&quot;</span></span>] = np.sign(result[label][<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>])
                result[label].dropna(inplace=<span class="predefined-constant">True</span>)

        all_results[model][col] = result</code></pre>
</div>
</div>
<div class="paragraph">
<p>次にデータをまとめます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">results = []
<span class="keyword">for</span> model <span class="keyword">in</span> all_results.keys():
    <span class="keyword">for</span> col <span class="keyword">in</span> all_results[model]:
        tmp = pd.concat(all_results[model][col])
        tmp[<span class="string"><span class="delimiter">&quot;</span><span class="content">model</span><span class="delimiter">&quot;</span></span>] = model
        tmp[<span class="string"><span class="delimiter">&quot;</span><span class="content">feature</span><span class="delimiter">&quot;</span></span>] = col
        results.append(tmp)
results = pd.concat(results)
results[<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>] = [x[<span class="integer">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> results.index]
results.head(<span class="integer">5</span>)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/multiple_data_results.png" alt="データのフォーマット">
</div>
</div>
<div class="paragraph">
<p>では、次に評価していきます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_モデルの性能を示す評価関数の紹介">2.12.2. モデルの性能を示す評価関数の紹介</h4>
<div class="paragraph">
<p>まずは、今回用いる評価関数のリストを紹介します。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>評価関数</strong></th>
<th class="tableblock halign-left valign-top"><strong>説明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RMSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">二乗平均平方根</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">accuracy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">目的変数の符号と予測した目的変数の符号の精度</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spearman_corr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スピアマンの順位相関</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">corr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ピアソンの相関係数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R^2 score</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">単回帰した時の直線と観測値のバラつき</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 結果保存用変数</span>
all_metrics = []

<span class="comment"># データセット毎に処理</span>
<span class="keyword">for</span> feature <span class="keyword">in</span> columns:
    matrix = <span class="predefined">dict</span>()
    <span class="comment"># モデル毎に処理</span>
    <span class="keyword">for</span> model <span class="keyword">in</span> models:
        <span class="comment"># 目的変数毎に処理</span>
        <span class="keyword">for</span> label <span class="keyword">in</span> labels:
            <span class="comment"># 処理対象データに絞り込み</span>
            tmp_df = results[(results[<span class="string"><span class="delimiter">&quot;</span><span class="content">model</span><span class="delimiter">&quot;</span></span>] == model) &amp; (results[<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>] == label) &amp; (results[<span class="string"><span class="delimiter">&quot;</span><span class="content">feature</span><span class="delimiter">&quot;</span></span>] == feature)]
            <span class="comment"># RMSE</span>
            rmse = np.sqrt(mean_squared_error(tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>], tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>]))
            <span class="comment"># 精度</span>
            accuracy = accuracy_score(tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">predict_dir</span><span class="delimiter">&quot;</span></span>], tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">actual_dir</span><span class="delimiter">&quot;</span></span>])
            <span class="comment"># 相関係数</span>
            corr = np.corrcoef(tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>], tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>])[<span class="integer">0</span>, <span class="integer">1</span>]
            <span class="comment"># 順位相関</span>
            spearman_corr = spearmanr(tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">actual</span><span class="delimiter">&quot;</span></span>], tmp_df[<span class="string"><span class="delimiter">&quot;</span><span class="content">predict</span><span class="delimiter">&quot;</span></span>])[<span class="integer">0</span>]
            <span class="comment"># 結果を保存</span>
            matrix[label] = [rmse, accuracy, spearman_corr,corr, corr**<span class="integer">2</span>, feature, model, tmp_df.shape[<span class="integer">0</span>]]
        res = pd.DataFrame.from_dict(matrix).T
        res.columns = [<span class="string"><span class="delimiter">&quot;</span><span class="content">RMSE</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">accuracy</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">spearman_corr</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">corr</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">R^2 score</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">feature</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">model</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content"># of samples</span><span class="delimiter">&quot;</span></span>]
        all_metrics.append(res)
all_metrics = pd.concat(all_metrics)
all_metrics.reset_index()</code></pre>
</div>
</div>
<div class="paragraph">
<p>このままだと出力が多すぎるため、集計します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">numeric_cols = [<span class="string"><span class="delimiter">&quot;</span><span class="content">RMSE</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">accuracy</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">spearman_corr</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">corr</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">R^2 score</span><span class="delimiter">&quot;</span></span>]
<span class="keyword">for</span> col <span class="keyword">in</span> numeric_cols:
    all_metrics[col] = all_metrics[col].astype(<span class="predefined">float</span>)
<span class="comment"># indexとデータセット毎に平均を計算</span>
agg = all_metrics.reset_index().groupby([<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">feature</span><span class="delimiter">&quot;</span></span>]).agg(<span class="string"><span class="delimiter">&quot;</span><span class="content">mean</span><span class="delimiter">&quot;</span></span>)
agg</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Chapter02/images/agg_mutiple_models.png" alt="agg mutiple models">
</div>
</div>
<div class="paragraph">
<p>この表のテクニカル分析（technical_only）とファンダメンタルデータ（fundamental_only）にそれぞれ着目すると、テクニカル分析のみを用いた特徴量の方が、ファンダメンタルデータよりも精度（accuracy）という観点で若干優れていることが分かります。<br>
また、テクニカル分析とファンダメンタルデータの両方を特徴量を用いた場合の結果に関しては、テクニカル分析よりも若干全体正解率が高くなっていますが、誤差の範囲内です。相関係数（corr）に関し、テクニカル分析とファンダメンタルデータを両方用いた場合は、用いていない場合に比べて、優れていることが分かります。</p>
</div>
<div class="paragraph">
<p>このように特徴量を選択しながら複数のモデルをつくり、複数の評価関数で評価を行うことで、テクニカル分析とファンダメンタルデータを組み合わせたアプローチのポテンシャルが高いことがわかります。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_モデルの提出">2.13. モデルの提出</h3>
<div class="paragraph">
<p>本コンペティションでは、モデルの予測の提出方法はモデル提出方式になります。以下ではこの方式について簡単に説明しますが、詳しくは <a href="https://signate.jp/features/runtime/detail">SIGNATE: Runtime 投稿方法</a>をご参照ください。</p>
</div>
<div class="sect3">
<h4 id="_runtimeの概要">2.13.1. Runtimeの概要</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>学習済モデルを投稿すると、アルゴリズム (推論プログラム) が実行され、推論時間・推論結果が出力されます。
出力された推論結果は、評価関数（既存の投稿機能）に自動で投稿されます。</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Runtime 機能でできること<br>
<cite><a href="https://signate.jp/features/runtime/detail">SIGNATE: Runtime 投稿方法</a></cite>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_提出ファイルの作成">2.13.2. 提出ファイルの作成</h4>
<div class="sect4">
<h5 id="_1_提出ファイルのテンプレートをダウンロード">1.提出ファイルのテンプレートをダウンロード</h5>
<div class="paragraph">
<p><a href="https://signate-prd-public.s3.ap-northeast-1.amazonaws.com/features/runtime/archive.zip">こちら</a>からダウンロード</p>
</div>
</div>
<div class="sect4">
<h5 id="_2_ディレクトリの構造を確認する">2.ディレクトリの構造を確認する</h5>
<div class="paragraph">
<p>アップロードするディレクトリ構造は次のとおりです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── model                  必須 学習済モデルを置くディレクトリ
│   └── ...
├── src                    必須 Python のプログラムを置くディレクトリ
│   ├── predictor.py       必須 最初のプログラムが呼び出すファイル
│   └── ...                その他のファイル (ディレクトリ作成可能)
└── requirements.txt       任意</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_3_学習済みモデルの作成">3.学習済みモデルの作成</h5>
<div class="paragraph">
<p>以下の環境でモデルを構築してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Python3 Anaconda3-2019.03 インストールガイドは次のとおりです。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>一般的なケース</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>https://repo.continuum.io/archive/ からバージョン2019.03をダウンロードしてください</pre>
</div>
</div>
<div class="paragraph">
<p><strong>pyenv</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>pyenv install anaconda3-2019.03</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Docker</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker pull continuumio/anaconda3:2019.03</pre>
</div>
</div>
<div class="paragraph">
<p>ここで、学習済みモデルの保存方法について説明します。
学習済みモデルは <code>pickle</code> で保存します。保存場所はChapter 2.13.2で説明したディレクトリ構造の学習済みモデルの配置先である <code>model</code> ディレクトリになります。任意のファイル名を設定可能なので、今回はモデルの対象としている目的変数がわかるように <code>my_model_{label}.pkl</code> という名前で保存します。具体的にはモデルの保存は以下のように行います。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># モデル保存用にメソッドを定義します</span>
<span class="keyword">def</span> <span class="function">save_model</span>(model, label, model_path=<span class="string"><span class="delimiter">&quot;</span><span class="content">../model</span><span class="delimiter">&quot;</span></span>):
    <span class="comment"># モデル保存先ディレクトリを作成</span>
    os.makedirs(model_path, exist_ok=<span class="predefined-constant">True</span>)
    <span class="keyword">with</span> <span class="predefined">open</span>(os.path.join(model_path, f<span class="string"><span class="delimiter">&quot;</span><span class="content">my_model_{label}.pkl</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">wb</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
        <span class="comment"># モデルをpickle形式で保存</span>
        pickle.dump(model, f)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># 保存した学習済みモデルから、提出するモデルを選択してpickle形式で保存します。</span>
<span class="comment"># 使用するモデルや特徴量を変更する際は、学習時と推論時で同一の特徴量をモデルに</span>
<span class="comment"># 入力するために提出用のpredictor.pyについても変更する必要があることにご注意ください。</span>

<span class="comment"># モデルの保存先を指定します。</span>
model_path = <span class="string"><span class="delimiter">&quot;</span><span class="content">archive/model</span><span class="delimiter">&quot;</span></span>
<span class="comment"># モデルの種類</span>
models = [<span class="string"><span class="delimiter">&quot;</span><span class="content">rf</span><span class="delimiter">&quot;</span></span>]
<span class="comment"># 使用する特徴量カラム</span>
columns = [<span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental+technical</span><span class="delimiter">&quot;</span></span>]
<span class="comment"># 目的変数</span>
labels = [
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">label_low_20</span><span class="delimiter">&quot;</span></span>,
]

<span class="comment"># モデル毎に処理</span>
<span class="keyword">for</span> model <span class="keyword">in</span> models:
    <span class="comment"># 特徴量毎に処理</span>
    <span class="keyword">for</span> col <span class="keyword">in</span> columns:
        <span class="comment"># 目的変数毎に処理</span>
        <span class="keyword">for</span> label <span class="keyword">in</span> labels:
            <span class="comment"># 学習済みモデルを取得</span>
            pred_model = trained_models[model][col][label]
            <span class="comment"># モデルを保存</span>
            save_model(pred_model, label, model_path=model_path)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_4_predictor_py_を記述する">4.predictor.py を記述する</h5>
<div class="paragraph">
<p>ここでは、提出する予測モデルを読み込み、当該モデルを用いて予測を出力させるコードの書き方について説明します。
<code>predictor.py</code> ファイルには、少なくとも以下のクラス及びメソッドを作成する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ScoringService
推論実行のためのクラスです。
以下のメソッドを実装してください。

get_model
モデルを取得するメソッドです。以下の条件があります。
- クラスメソッドであること
- 引数 model_path (str 型) を指定すること
- 正常終了時は返り値を true (bool 型) とすること

predict
推論を実行するメソッドです。以下の条件があります。
- クラスメソッドであること
- 引数 input (dict[str] 型) を指定すること
※ 詳しくはテンプレート内の、predictor.pyファイルをご確認ください。</pre>
</div>
</div>
<div class="paragraph">
<p>本コンペティションにおけるpredictメソッドの返り値の定義は以下となります。詳細は以下に記載したコードをご参照ください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>結果を以下のcsv形式の文字列として出力する。
１列目:datetimeとcodeをつなげたもの(Ex 2016-05-09-1301)
２列目:label_high_20　終値→最高値への変化率
３列目:label_low_20　終値→最安値への変化率
headerはなし、B列C列はfloat64</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下は、本チュートリアルで説明した内容をこの規約に合わせて記載したpredictor.pyです。
本コンペティションのPublic LBの評価期間と一致するようにデータの分割期間を調整してあります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># -*- coding: utf-8 -*-</span>
<span class="keyword">import</span> <span class="include">io</span>
<span class="keyword">import</span> <span class="include">os</span>
<span class="keyword">import</span> <span class="include">pickle</span>

<span class="keyword">import</span> <span class="include">numpy</span> <span class="keyword">as</span> np
<span class="keyword">import</span> <span class="include">pandas</span> <span class="keyword">as</span> pd
<span class="keyword">from</span> <span class="include">sklearn.ensemble</span> <span class="keyword">import</span> <span class="include">RandomForestRegressor</span>
<span class="keyword">from</span> <span class="include">tqdm.auto</span> <span class="keyword">import</span> <span class="include">tqdm</span>


<span class="keyword">class</span> <span class="class">ScoringService</span>(<span class="predefined">object</span>):
    <span class="comment"># 訓練期間終了日</span>
    TRAIN_END = <span class="string"><span class="delimiter">&quot;</span><span class="content">2018-12-31</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 評価期間開始日</span>
    VAL_START = <span class="string"><span class="delimiter">&quot;</span><span class="content">2019-02-01</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 評価期間終了日</span>
    VAL_END = <span class="string"><span class="delimiter">&quot;</span><span class="content">2019-12-01</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># テスト期間開始日</span>
    TEST_START = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-01</span><span class="delimiter">&quot;</span></span>
    <span class="comment"># 目的変数</span>
    TARGET_LABELS = [<span class="string"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">label_low_20</span><span class="delimiter">&quot;</span></span>]

    <span class="comment"># データをこの変数に読み込む</span>
    dfs = <span class="predefined-constant">None</span>
    <span class="comment"># モデルをこの変数に読み込む</span>
    models = <span class="predefined-constant">None</span>
    <span class="comment"># 対象の銘柄コードをこの変数に読み込む</span>
    codes = <span class="predefined-constant">None</span>

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_inputs</span>(cls, dataset_dir):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            dataset_dir (str)  : path to dataset directory</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            dict[str]: path to dataset files</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        inputs = {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_list.csv.gz</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_price.csv.gz</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_fin.csv.gz</span><span class="delimiter">&quot;</span></span>,
            <span class="comment"># &quot;stock_fin_price&quot;: f&quot;{dataset_dir}/stock_fin_price.csv.gz&quot;,</span>
            <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>: f<span class="string"><span class="delimiter">&quot;</span><span class="content">{dataset_dir}/stock_labels.csv.gz</span><span class="delimiter">&quot;</span></span>,
        }
        <span class="keyword">return</span> inputs

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_dataset</span>(cls, inputs):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            inputs (list[str]): path to dataset files</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            dict[pd.DataFrame]: loaded data</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="keyword">if</span> cls.dfs <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            cls.dfs = {}
        <span class="keyword">for</span> k, v <span class="keyword">in</span> inputs.items():
            cls.dfs[k] = pd.read_csv(v)
            <span class="comment"># DataFrameのindexを設定します。</span>
            <span class="keyword">if</span> k == <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>:
                cls.dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = pd.to_datetime(
                    cls.dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>]
                )
                cls.dfs[k].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
            <span class="keyword">elif</span> k <span class="keyword">in</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin_price</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>]:
                cls.dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>] = pd.to_datetime(
                    cls.dfs[k].loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">base_date</span><span class="delimiter">&quot;</span></span>]
                )
                cls.dfs[k].set_index(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>, inplace=<span class="predefined-constant">True</span>)
        <span class="keyword">return</span> cls.dfs

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_codes</span>(cls, dfs):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            dfs (dict[pd.DataFrame]): loaded data</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            array: list of stock codes</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        stock_list = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_list</span><span class="delimiter">&quot;</span></span>].copy()
        <span class="comment"># 予測対象の銘柄コードを取得</span>
        cls.codes = stock_list[stock_list[<span class="string"><span class="delimiter">&quot;</span><span class="content">prediction_target</span><span class="delimiter">&quot;</span></span>] == <span class="predefined-constant">True</span>][
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>
        ].values
        <span class="keyword">return</span> cls.codes

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_features_and_label</span>(cls, dfs, codes, feature, label):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            dfs (dict[pd.DataFrame]): loaded data</span><span class="content">
</span><span class="content">            codes  (array) : target codes</span><span class="content">
</span><span class="content">            feature (pd.DataFrame): features</span><span class="content">
</span><span class="content">            label (str) : label column name</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            train_X (pd.DataFrame): training data</span><span class="content">
</span><span class="content">            train_y (pd.DataFrame): label for train_X</span><span class="content">
</span><span class="content">            val_X (pd.DataFrame): validation data</span><span class="content">
</span><span class="content">            val_y (pd.DataFrame): label for val_X</span><span class="content">
</span><span class="content">            test_X (pd.DataFrame): test data</span><span class="content">
</span><span class="content">            test_y (pd.DataFrame): label for test_X</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="comment"># 分割データ用の変数を定義</span>
        trains_X, vals_X, tests_X = [], [], []
        trains_y, vals_y, tests_y = [], [], []

        <span class="comment"># 銘柄コード毎に特徴量を作成</span>
        <span class="keyword">for</span> code <span class="keyword">in</span> tqdm(codes):
            <span class="comment"># 特徴量取得</span>
            feats = feature[feature[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] == code]

            <span class="comment"># stock_labelデータを読み込み</span>
            stock_labels = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_labels</span><span class="delimiter">&quot;</span></span>]
            <span class="comment"># 特定の銘柄コードのデータに絞る</span>
            stock_labels = stock_labels[stock_labels[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]

            <span class="comment"># 特定の目的変数に絞る</span>
            labels = stock_labels[label].copy()
            <span class="comment"># nanを削除</span>
            labels.dropna(inplace=<span class="predefined-constant">True</span>)

            <span class="keyword">if</span> feats.shape[<span class="integer">0</span>] &gt; <span class="integer">0</span> <span class="keyword">and</span> labels.shape[<span class="integer">0</span>] &gt; <span class="integer">0</span>:
                <span class="comment"># 特徴量と目的変数のインデックスを合わせる</span>
                labels = labels.loc[labels.index.isin(feats.index)]
                feats = feats.loc[feats.index.isin(labels.index)]
                labels.index = feats.index

                <span class="comment"># データを分割</span>
                _train_X = feats[: cls.TRAIN_END]
                _val_X = feats[cls.VAL_START : cls.VAL_END]
                _test_X = feats[cls.TEST_START :]

                _train_y = labels[: cls.TRAIN_END]
                _val_y = labels[cls.VAL_START : cls.VAL_END]
                _test_y = labels[cls.TEST_START :]

                <span class="comment"># データを配列に格納 (後ほど結合するため)</span>
                trains_X.append(_train_X)
                vals_X.append(_val_X)
                tests_X.append(_test_X)

                trains_y.append(_train_y)
                vals_y.append(_val_y)
                tests_y.append(_test_y)
        <span class="comment"># 銘柄毎に作成した説明変数データを結合します。</span>
        train_X = pd.concat(trains_X)
        val_X = pd.concat(vals_X)
        test_X = pd.concat(tests_X)
        <span class="comment"># 銘柄毎に作成した目的変数データを結合します。</span>
        train_y = pd.concat(trains_y)
        val_y = pd.concat(vals_y)
        test_y = pd.concat(tests_y)

        <span class="keyword">return</span> train_X, train_y, val_X, val_y, test_X, test_y

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_features_for_predict</span>(cls, dfs, code, start_dt=<span class="string"><span class="delimiter">&quot;</span><span class="content">2016-01-01</span><span class="delimiter">&quot;</span></span>):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            dfs (dict)  : dict of pd.DataFrame include stock_fin, stock_price</span><span class="content">
</span><span class="content">            code (int)  : A local code for a listed company</span><span class="content">
</span><span class="content">            start_dt (str): specify date range</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            feature DataFrame (pd.DataFrame)</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="comment"># stock_finデータを読み込み</span>
        stock_fin = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>]

        <span class="comment"># 特定の銘柄コードのデータに絞る</span>
        fin_data = stock_fin[stock_fin[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
        <span class="comment"># 特徴量の作成には過去60営業日のデータを使用しているため、</span>
        <span class="comment"># 予測対象日からバッファ含めて土日を除く過去90日遡った時点から特徴量を生成します</span>
        n = <span class="integer">90</span>
        <span class="comment"># 特徴量の生成対象期間を指定</span>
        fin_data = fin_data.loc[pd.Timestamp(start_dt) - pd.offsets.BDay(n) :]
        <span class="comment"># fin_dataのnp.float64のデータのみを取得</span>
        fin_data = fin_data.select_dtypes(include=[<span class="string"><span class="delimiter">&quot;</span><span class="content">float64</span><span class="delimiter">&quot;</span></span>])
        <span class="comment"># 欠損値処理</span>
        fin_feats = fin_data.fillna(<span class="integer">0</span>)

        <span class="comment"># stock_priceデータを読み込む</span>
        price = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_price</span><span class="delimiter">&quot;</span></span>]
        <span class="comment"># 特定の銘柄コードのデータに絞る</span>
        price_data = price[price[<span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>] == code]
        <span class="comment"># 終値のみに絞る</span>
        feats = price_data[[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>]]
        <span class="comment"># 特徴量の生成対象期間を指定</span>
        feats = feats.loc[pd.Timestamp(start_dt) - pd.offsets.BDay(n) :].copy()

        <span class="comment"># 終値の20営業日リターン</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_1month</span><span class="delimiter">&quot;</span></span>] = feats[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>
        ].pct_change(<span class="integer">20</span>)
        <span class="comment"># 終値の40営業日リターン</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_2month</span><span class="delimiter">&quot;</span></span>] = feats[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>
        ].pct_change(<span class="integer">40</span>)
        <span class="comment"># 終値の60営業日リターン</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">return_3month</span><span class="delimiter">&quot;</span></span>] = feats[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>
        ].pct_change(<span class="integer">60</span>)
        <span class="comment"># 終値の20営業日ボラティリティ</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_1month</span><span class="delimiter">&quot;</span></span>] = (
            np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>])
            .diff()
            .rolling(<span class="integer">20</span>)
            .std()
        )
        <span class="comment"># 終値の40営業日ボラティリティ</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_2month</span><span class="delimiter">&quot;</span></span>] = (
            np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>])
            .diff()
            .rolling(<span class="integer">40</span>)
            .std()
        )
        <span class="comment"># 終値の60営業日ボラティリティ</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">volatility_3month</span><span class="delimiter">&quot;</span></span>] = (
            np.log(feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>])
            .diff()
            .rolling(<span class="integer">60</span>)
            .std()
        )
        <span class="comment"># 終値と20営業日の単純移動平均線の乖離</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_1month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
            feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">20</span>).mean()
        )
        <span class="comment"># 終値と40営業日の単純移動平均線の乖離</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_2month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
            feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">40</span>).mean()
        )
        <span class="comment"># 終値と60営業日の単純移動平均線の乖離</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">MA_gap_3month</span><span class="delimiter">&quot;</span></span>] = feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>] / (
            feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>].rolling(<span class="integer">60</span>).mean()
        )
        <span class="comment"># 欠損値処理</span>
        feats = feats.fillna(<span class="integer">0</span>)
        <span class="comment"># 元データのカラムを削除</span>
        feats = feats.drop([<span class="string"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>], axis=<span class="integer">1</span>)

        <span class="comment"># 財務データの特徴量とマーケットデータの特徴量のインデックスを合わせる</span>
        feats = feats.loc[feats.index.isin(fin_feats.index)]
        fin_feats = fin_feats.loc[fin_feats.index.isin(feats.index)]

        <span class="comment"># データを結合</span>
        feats = pd.concat([feats, fin_feats], axis=<span class="integer">1</span>).dropna()

        <span class="comment"># 欠損値処理を行います。</span>
        feats = feats.replace([np.inf, -np.inf], <span class="integer">0</span>)

        <span class="comment"># 銘柄コードを設定</span>
        feats[<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] = code

        <span class="comment"># 生成対象日以降の特徴量に絞る</span>
        feats = feats.loc[pd.Timestamp(start_dt) :]

        <span class="keyword">return</span> feats

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_feature_columns</span>(cls, dfs, train_X, column_group=<span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental+technical</span><span class="delimiter">&quot;</span></span>):
        <span class="comment"># 特徴量グループを定義</span>
        <span class="comment"># ファンダメンタル</span>
        fundamental_cols = dfs[<span class="string"><span class="delimiter">&quot;</span><span class="content">stock_fin</span><span class="delimiter">&quot;</span></span>].select_dtypes(<span class="string"><span class="delimiter">&quot;</span><span class="content">float64</span><span class="delimiter">&quot;</span></span>).columns
        fundamental_cols = fundamental_cols[
            fundamental_cols != <span class="string"><span class="delimiter">&quot;</span><span class="content">Result_Dividend DividendPayableDate</span><span class="delimiter">&quot;</span></span>
        ]
        fundamental_cols = fundamental_cols[fundamental_cols != <span class="string"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>]
        <span class="comment"># 価格変化率</span>
        returns_cols = [x <span class="keyword">for</span> x <span class="keyword">in</span> train_X.columns <span class="keyword">if</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">return</span><span class="delimiter">&quot;</span></span> <span class="keyword">in</span> x]
        <span class="comment"># テクニカル</span>
        technical_cols = [
            x <span class="keyword">for</span> x <span class="keyword">in</span> train_X.columns <span class="keyword">if</span> (x <span class="keyword">not</span> <span class="keyword">in</span> fundamental_cols) <span class="keyword">and</span> (x != <span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>)
        ]
        columns = {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental_only</span><span class="delimiter">&quot;</span></span>: fundamental_cols,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">return_only</span><span class="delimiter">&quot;</span></span>: returns_cols,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">technical_only</span><span class="delimiter">&quot;</span></span>: technical_cols,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">fundamental+technical</span><span class="delimiter">&quot;</span></span>: <span class="predefined">list</span>(fundamental_cols) + <span class="predefined">list</span>(technical_cols),
        }
        <span class="keyword">return</span> columns[column_group]

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">create_model</span>(cls, dfs, codes, label):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            dfs (dict)  : dict of pd.DataFrame include stock_fin, stock_price</span><span class="content">
</span><span class="content">            codes (list[int]): A local code for a listed company</span><span class="content">
</span><span class="content">            label (str): prediction target label</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            RandomForestRegressor</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="comment"># 特徴量を取得</span>
        buff = []
        <span class="keyword">for</span> code <span class="keyword">in</span> codes:
            buff.append(cls.get_features_for_predict(cls.dfs, code))
        feature = pd.concat(buff)
        <span class="comment"># 特徴量と目的変数を一致させて、データを分割</span>
        train_X, train_y, _, _, _, _ = cls.get_features_and_label(
            dfs, codes, feature, label
        )
        <span class="comment"># 特徴量カラムを指定</span>
        feature_columns = cls.get_feature_columns(dfs, train_X)
        <span class="comment"># モデル作成</span>
        model = RandomForestRegressor(random_state=<span class="integer">0</span>)
        model.fit(train_X[feature_columns], train_y)

        <span class="keyword">return</span> model

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">save_model</span>(cls, model, label, model_path=<span class="string"><span class="delimiter">&quot;</span><span class="content">../model</span><span class="delimiter">&quot;</span></span>):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            model (RandomForestRegressor): trained model</span><span class="content">
</span><span class="content">            label (str): prediction target label</span><span class="content">
</span><span class="content">            model_path (str): path to save model</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            -</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="comment"># tag::save_model_partial[]</span>
        <span class="comment"># モデル保存先ディレクトリを作成</span>
        os.makedirs(model_path, exist_ok=<span class="predefined-constant">True</span>)
        <span class="keyword">with</span> <span class="predefined">open</span>(os.path.join(model_path, f<span class="string"><span class="delimiter">&quot;</span><span class="content">my_model_{label}.pkl</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">wb</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
            <span class="comment"># モデルをpickle形式で保存</span>
            pickle.dump(model, f)
        <span class="comment"># end::save_model_partial[]</span>

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_model</span>(cls, model_path=<span class="string"><span class="delimiter">&quot;</span><span class="content">../model</span><span class="delimiter">&quot;</span></span>, labels=<span class="predefined-constant">None</span>):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">Get model method</span><span class="content">
</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            model_path (str): Path to the trained model directory.</span><span class="content">
</span><span class="content">            labels (arrayt): list of prediction target labels</span><span class="content">
</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            bool: The return value. True for success, False otherwise.</span><span class="content">
</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="keyword">if</span> cls.models <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            cls.models = {}
        <span class="keyword">if</span> labels <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            labels = cls.TARGET_LABELS
        <span class="keyword">for</span> label <span class="keyword">in</span> labels:
            m = os.path.join(model_path, f<span class="string"><span class="delimiter">&quot;</span><span class="content">my_model_{label}.pkl</span><span class="delimiter">&quot;</span></span>)
            <span class="keyword">with</span> <span class="predefined">open</span>(m, <span class="string"><span class="delimiter">&quot;</span><span class="content">rb</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> f:
                <span class="comment"># pickle形式で保存されているモデルを読み込み</span>
                cls.models[label] = pickle.load(f)

        <span class="keyword">return</span> <span class="predefined-constant">True</span>

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">train_and_save_model</span>(
        cls, inputs, labels=<span class="predefined-constant">None</span>, codes=<span class="predefined-constant">None</span>, model_path=<span class="string"><span class="delimiter">&quot;</span><span class="content">../model</span><span class="delimiter">&quot;</span></span>
    ):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">Predict method</span><span class="content">
</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            inputs (str)   : paths to the dataset files</span><span class="content">
</span><span class="content">            labels (array) : labels which is used in prediction model</span><span class="content">
</span><span class="content">            codes  (array) : target codes</span><span class="content">
</span><span class="content">            model_path (str): Path to the trained model directory.</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            Dict[pd.DataFrame]: Inference for the given input.</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="keyword">if</span> cls.dfs <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            cls.get_dataset(inputs)
            cls.get_codes(cls.dfs)
        <span class="keyword">if</span> codes <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            codes = cls.codes
        <span class="keyword">if</span> labels <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            labels = cls.TARGET_LABELS
        <span class="keyword">for</span> label <span class="keyword">in</span> labels:
            print(label)
            model = cls.create_model(cls.dfs, codes=codes, label=label)
            cls.save_model(model, label, model_path=model_path)

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">predict</span>(cls, inputs, labels=<span class="predefined-constant">None</span>, codes=<span class="predefined-constant">None</span>, start_dt=TEST_START):
        <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">Predict method</span><span class="content">
</span><span class="content">
</span><span class="content">        Args:</span><span class="content">
</span><span class="content">            inputs (dict[str]): paths to the dataset files</span><span class="content">
</span><span class="content">            labels (list[str]): target label names</span><span class="content">
</span><span class="content">            codes (list[int]): traget codes</span><span class="content">
</span><span class="content">            start_dt (str): specify date range</span><span class="content">
</span><span class="content">        Returns:</span><span class="content">
</span><span class="content">            str: Inference for the given input.</span><span class="content">
</span><span class="content">        </span><span class="delimiter">&quot;&quot;&quot;</span></span>

        <span class="comment"># データ読み込み</span>
        <span class="keyword">if</span> cls.dfs <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            cls.get_dataset(inputs)
            cls.get_codes(cls.dfs)

        <span class="comment"># 予測対象の銘柄コードと目的変数を設定</span>
        <span class="keyword">if</span> codes <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            codes = cls.codes
        <span class="keyword">if</span> labels <span class="keyword">is</span> <span class="predefined-constant">None</span>:
            labels = cls.TARGET_LABELS

        <span class="comment"># 特徴量を作成</span>
        buff = []
        <span class="keyword">for</span> code <span class="keyword">in</span> codes:
            buff.append(cls.get_features_for_predict(cls.dfs, code, start_dt))
        feats = pd.concat(buff)

        <span class="comment"># 結果を以下のcsv形式で出力する</span>
        <span class="comment"># １列目:datetimeとcodeをつなげたもの(Ex 2016-05-09-1301)</span>
        <span class="comment"># ２列目:label_high_20　終値→最高値への変化率</span>
        <span class="comment"># ３列目:label_low_20　終値→最安値への変化率</span>
        <span class="comment"># headerはなし、B列C列はfloat64</span>

        <span class="comment"># 日付と銘柄コードに絞り込み</span>
        df = feats.loc[:, [<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>]].copy()
        <span class="comment"># codeを出力形式の１列目と一致させる</span>
        df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>] = df.index.strftime(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Y-%m-%d-</span><span class="delimiter">&quot;</span></span>) + df.loc[:, <span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>].astype(
            <span class="predefined">str</span>
        )

        <span class="comment"># 出力対象列を定義</span>
        output_columns = [<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>]

        <span class="comment"># 特徴量カラムを指定</span>
        feature_columns = cls.get_feature_columns(cls.dfs, feats)

        <span class="comment"># 目的変数毎に予測</span>
        <span class="keyword">for</span> label <span class="keyword">in</span> labels:
            <span class="comment"># 予測実施</span>
            df[label] = cls.models[label].predict(feats[feature_columns])
            <span class="comment"># 出力対象列に追加</span>
            output_columns.append(label)

        out = io.StringIO()
        df.to_csv(out, header=<span class="predefined-constant">False</span>, index=<span class="predefined-constant">False</span>, columns=output_columns)

        <span class="keyword">return</span> out.getvalue()</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_モジュールの追加">モジュールの追加</h6>
<div class="paragraph">
<p><a href="https://docs.anaconda.com/anaconda/packages/py3.7_linux-64/" class="bare">https://docs.anaconda.com/anaconda/packages/py3.7_linux-64/</a>
この表の [In Installer] にチェックが入っているものが、すでにインストールされています（ただしバージョンは異なります）。</p>
</div>
<div class="paragraph">
<p>Runtime環境にモジュールを追加するためには <code>requirements.txt</code> に追記します。requirements.txtに記載したモジュールは実行時にpipでインストールされます。</p>
</div>
<div class="paragraph">
<p>モジュールを追加する際はRuntime環境でインストール及び使用可能かをご確認ください。本チュートリアルで評価のために使用したSHAPのように、一部のモジュールはインストール時にビルドが必要となるものもあります。そのためRuntime環境では使用することのできないモジュールもあります。以下のように実行環境のdocker container内でインストールすることで確認可能です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker run --rm -it continuumio/anaconda3:2019.03 bash
# pip install tensorflow==2.4.0</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>requirements.txt</code> には以下のようにモジュールのバージョンを指定して記載します。これは、モデルを提出してから全ての評価が完了するまで数ヶ月かかるためその間にモジュールの最新バージョンがリリースされても影響を受けないようにするためです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>tensorflow==2.4.0</pre>
</div>
</div>
<div class="paragraph">
<p><code>requirements.txt</code> の作成には <code>pip freeze</code> コマンドを使用すると便利です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker run --rm -it continuumio/anaconda3:2019.03 bash
# pip install [インストールするモジュール]
# pip freeze</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_デバッグ方法">デバッグ方法</h6>
<div class="paragraph">
<p>通常</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ pip install -r requirements.txt   # モジュールが必要な場合は pip でインストールします
$ cd src    # ソースディレクトリに移動
$ python    # python の実行
Python 3.7.3 (default, Mar 27 2019, 16:54:48)
[Clang 4.0.1 (tags/RELEASE_401/final)] :: Anaconda, Inc. on darwin
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; DATASET_DIR= "/path/to" # データ保存先ディレクトリ
&gt;&gt;&gt; from predictor import ScoringService  # モジュール読み込み
&gt;&gt;&gt; inputs = ScoringService.get_inputs(DATASET_DIR)  # 推論入力データ取得
&gt;&gt;&gt; ScoringService.get_model()  # モデルの取得
True
&gt;&gt;&gt; ScoringService.predict(inputs)  # 推論の実行
'[推論結果]'</pre>
</div>
</div>
<div class="paragraph">
<p>pyenvを使用</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ pyenv local anaconda3-2019.03</pre>
</div>
</div>
<div class="paragraph">
<p>以降 通常のインストールの場合と同様のデバッグ方法です。</p>
</div>
<div class="paragraph">
<p>Docker を使用</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ docker run -it -v $(pwd):/opt/ml continuumio/anaconda3:2019.03 /bin/bash
$ cd /opt/ml</pre>
</div>
</div>
<div class="paragraph">
<p>以降は、通常のインストールの場合と同様のデバッグ方法になります。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_5_zip_で圧縮して提出する">5.zip で圧縮して提出する。</h5>
<div class="paragraph">
<p>指定されたディレクトリ構成で学習済みモデルを保存した上で、predictor.pyを作成したら、以下のようにzipで圧縮して提出します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ls
model  requirements.txt  src
$ zip -v submit.zip requirements.txt src/*.py model/*.pkl
updating: requirements.txt	(in=0) (out=0) (stored 0%)
updating: src/predictor.py	(in=11408) (out=2417) (deflated 79%)
updating: model/my_model_label_high_20.pkl .	(in=18919345) (out=5071005) (deflated 73%)
updating: model/my_model_label_low_20.pkl .	(in=18704305) (out=5006613) (deflated 73%)
total bytes=37635058, compressed=10080035 -&gt; 73% savings</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ランタイム環境に関して">2.13.3. ランタイム環境に関して</h4>
<div class="paragraph">
<p>■ランタイム環境での利用可能なデータについて</p>
</div>
<div class="paragraph">
<p>・ランタイム環境に提出したモデルは、各銘柄の株価の最高値及び最安値を予測する際、評価対象となる決算短信の開示日以前のデータ（銘柄、株価、ファンダメンタル情報）を利用することができます。</p>
</div>
<div class="paragraph">
<p>・ただし、ランタイム環境では、評価対象となる決算短信の開示日の期間のデータを全て格納しているため、予測時に開示日より未来のデータを利用すると、リークが生じることになります。</p>
</div>
<div class="paragraph">
<p>・ランタイム環境でこれらのデータを用いて特徴量生成やモデルの再学習を行う際は、リークが含まれないようご留意ください。</p>
</div>
<div class="paragraph">
<p>以下、ランタイム実行日が5月10日のケース（Private 1st）を例として取り上げます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>・ランタイム環境には、2016年1月1日から2021年4月5日までのデータが配置されています
・提出モデルは、3月29日に開示された決算短信について翌営業日より20営業日間の最高値及び最安値を予測する際、3月29日までのデータを利用できます。3月30日以降のデータを利用するとリークとなり、入賞資格を失います
・同様に、4月1日に開示された決算短信について予測する際には、4月2日以降のデータは利用できません</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ニュースでポートフォリオを構築しよう">3. ニュースでポートフォリオを構築しよう</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本章は問題２の公開時に公開を予定しております。</p>
</div>
<div class="paragraph">
<p><strong>スケジュール</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>日時</strong></th>
<th class="tableblock halign-left valign-top"><strong>内容</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2021年3月ごろ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンペティション開始</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_tips集">4. tips集</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本章では、本コンペティションに関連する金融・データ解析一般についてのtipsを紹介します。</p>
</div>
<div class="sect2">
<h3 id="_コンペティションフォーラムの紹介">4.1. コンペティションフォーラムの紹介</h3>
<div class="paragraph">
<p>J-Quantsでは、コンペティションに関連して執筆された記事の投稿やチュートリアルへのご質問をフォーラム（ "https://signate.jp/competitions/423/discussions" ）にて募集しております（コンペの登録が必要）。また、下記内容以外にも有志の方による素晴らしいスレッドがありますので、ぜひご確認ください。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>タイトル</strong></th>
<th class="tableblock halign-left valign-top"><strong>URL</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">参考書籍・記事・知見共有スレッド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://signate.jp/competitions/423/discussions/jpx-1" class="bare">https://signate.jp/competitions/423/discussions/jpx-1</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web記事投稿スレッド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://signate.jp/competitions/423/discussions/jpx-web" class="bare">https://signate.jp/competitions/423/discussions/jpx-web</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">チュートリアル質問用スレッド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://signate.jp/competitions/423/discussions/jpx" class="bare">https://signate.jp/competitions/423/discussions/jpx</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_金融用語集">4.2. 金融用語集</h3>
<div class="paragraph">
<p>本コンペティションで必要となる専門用語を解説してくれているサイトをご紹介します。<br>
もし、専門用語で困った場合は、下記リンク先のコンテンツを確認していただければ幸いです。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>タイトル</strong></th>
<th class="tableblock halign-left valign-top"><strong>運営元</strong></th>
<th class="tableblock halign-left valign-top"><strong>URL</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">証券用語解説集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">野村證券</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nomura.co.jp/terms/" class="bare">https://www.nomura.co.jp/terms/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">金融・証券用語解説集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">大和証券</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.daiwa.jp/glossary/" class="bare">https://www.daiwa.jp/glossary/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイナンス用語集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">みずほ証券</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://glossary.mizuho-sc.com/" class="bare">https://glossary.mizuho-sc.com/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">初めてでもわかりやすい用語集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ＳＭＢＣ日興証券</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.smbcnikko.co.jp/terms/index.html" class="bare">https://www.smbcnikko.co.jp/terms/index.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用語解説</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">三菱UFJモルガン・スタンレー証券株式会社</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.sc.mufg.jp/learn/terms/index.html" class="bare">https://www.sc.mufg.jp/learn/terms/index.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">金融用語解説(知るぽると)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">金融広報中央委員会</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.shiruporuto.jp/public/document/container/yogo/" class="bare">https://www.shiruporuto.jp/public/document/container/yogo/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">金融・証券用語集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日本証券業協会</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.jsda.or.jp/jikan/word/" class="bare">https://www.jsda.or.jp/jikan/word/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用語集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EY新日本有限責任監査法人</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.shinnihon.or.jp/corporate-accounting/glossary/" class="bare">https://www.shinnihon.or.jp/corporate-accounting/glossary/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">会計監査用語解説集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日本公認会計士協会</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://jicpa.or.jp/cpainfo/introduction/keyword/" class="bare">https://jicpa.or.jp/cpainfo/introduction/keyword/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">財務諸表等の用語、様式及び作成方法に関する規則</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e-GOV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://elaws.e-gov.go.jp/document?lawid=338M50000040059" class="bare">https://elaws.e-gov.go.jp/document?lawid=338M50000040059</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用語集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">野村アセットマネジメント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nomura-am.co.jp/basicknowledge/word/" class="bare">https://www.nomura-am.co.jp/basicknowledge/word/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用語集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アセットマネジメントOne</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.am-one.co.jp/shisankeisei/glossary/" class="bare">http://www.am-one.co.jp/shisankeisei/glossary/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用語集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">大和アセットマネジメント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.daiwa-am.co.jp/guide/term/" class="bare">https://www.daiwa-am.co.jp/guide/term/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">わかりやすい用語集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">三井住友DSアセットマネジメント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.smd-am.co.jp/learning/glossary/" class="bare">https://www.smd-am.co.jp/learning/glossary/</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_東証マネ部">4.3. 東証マネ部</h3>
<div class="paragraph">
<p>「東証 マネ部！」は身近なお金の話から、プロが教える資産運用のノウハウまで 、資産形成についてわかりやすく解説するサイトです。
今回は、コンペに関係がありそうな記事をピックアップしてみました。コンペティションの息抜きにぜひご確認ください。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>タイトル</strong></th>
<th class="tableblock halign-left valign-top"><strong>リンク</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">投資に不可欠な財務三表の見方</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article022723/" class="bare">https://money-bu-jpx.com/news/article022723/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">財務ニュースを読む</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article028193/" class="bare">https://money-bu-jpx.com/news/article028193/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">長期投資に欠かせない運用コストを意識しよう</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article004555/" class="bare">https://money-bu-jpx.com/news/article004555/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロの投資家が注目する指標「ROE」とは？</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article005169/" class="bare">https://money-bu-jpx.com/news/article005169/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ディープラーニングが拓く「AI投資」の可能性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article008127/" class="bare">https://money-bu-jpx.com/news/article008127/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AIが導く金融市場の未来</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article008332/" class="bare">https://money-bu-jpx.com/news/article008332/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">４大投資指標のワナ～解析力の鍛錬～</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article012308/" class="bare">https://money-bu-jpx.com/news/article012308/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AIを使った市場の予測に挑む「AlpacaJapan」</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article015448/" class="bare">https://money-bu-jpx.com/news/article015448/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">「AIと資産運用」</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article016485/" class="bare">https://money-bu-jpx.com/news/article016485/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">投資に役立つ「会社四季報」活用のポイント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article020860/" class="bare">https://money-bu-jpx.com/news/article020860/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">最低投資金額50万円以下の銘柄特集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article022924/" class="bare">https://money-bu-jpx.com/news/article022924/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">クチコミで投資を楽しめるアプリ「ferci（フェルシー)」</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article023550/" class="bare">https://money-bu-jpx.com/news/article023550/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">コロナ後の世界</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article024736/" class="bare">https://money-bu-jpx.com/news/article024736/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">株式場況を読む～専門用語の理解～</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article026712/" class="bare">https://money-bu-jpx.com/news/article026712/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">決算ニュースを読む～会計用語の理解～</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article027285/" class="bare">https://money-bu-jpx.com/news/article027285/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">公的統計を補完する「オルタナティブデータ」とは？</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://money-bu-jpx.com/news/article028023/" class="bare">https://money-bu-jpx.com/news/article028023/</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_参考になる書籍">4.4. 参考になる書籍</h3>
<div class="paragraph">
<p>本コンペティションに参考になる書籍を紹介致します。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>タイトル</strong></th>
<th class="tableblock halign-left valign-top"><strong>著者</strong>　</th>
<th class="tableblock halign-left valign-top"><strong>概要</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイナンス機械学習―金融市場分析を変える機械学習アルゴリズムの理論と実践</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マルコス・ロペス・デ・プラド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">機械学習を用いて金融データを分析する上での知識を網羅的に学ぶことができる。金融のドメイン知識をデータサイエンティストが学ぶには最適な本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アセットマネージャーのためのファイナンス機械学習</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マルコス・ロペス・デ・プラド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイナンス機械学習に続き、ノイズ除去、クラスタリング、ラベリング、特徴量の重要度分析などの本コンペでも関連の深いトピックを学ぶことができる。ただし、「ファイナンス機械学習」と比較すると網羅性はないので、2冊目として読むことを推奨。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kaggleで勝つデータ分析の技術</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">門脇 大輔 他</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モデルのチューニング・アンサンブルなど機械学習のコンペに関連するテクニックを効率的に学ぶことができる。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">株を買うなら最低限知っておきたい ファンダメンタル投資の教科書 改訂版</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">足立 武志</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファンダメンタル分析に必要な基礎知識を学ぶことができる。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">経済・ファイナンスデータの計量時系列分析</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">沖本竜義</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARIMAモデルをベースとした古典的な時系列解析を学ぶことができる。ARIMAモデル自体を予測モデルとして使うことは、コンペではまれだが、金融データに対して時系列分析を実施する上での実務上の課題なども学ぶことができる。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">金融・経済分析のためのテキストマイニング</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">和泉 潔他</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">市場レポートや経済ニュースなどのテキストデータを分析し、資産運用や市場分析に活かす手法を解説している。数式は少なく、金融テキストマイニングの独特な注意点や思考法を中心に整理しており、初めて金融分野のテキストマイニングをする人には助かる一冊。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">統計学入門</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">東京大学教養学部統計学教室 編</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">文科と理科両方の学生のために，統計的なものの考え方の基礎がやさしく解説されており、統計学の体系的な知識を与えるように，編集・執筆された一冊。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pythonデータサイエンスハンドブック</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jake VanderPlas 著、菊池 彰 訳</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本チュートリアルにおいても利用されているJupyter、NumPy、pandas、Matplotlib、scikit-learn等をカバーしている一冊。それぞれのトピックについて、押さえておくべき基本、tips、便利なコマンドなどが紹介されている。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_参考になるコンペティション">4.5. 参考になるコンペティション</h3>
<div class="paragraph">
<p>本コンペティションに関連したコンペティションを紹介いたします。</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>タイトル</strong></th>
<th class="tableblock halign-left valign-top"><strong>概要</strong>　</th>
<th class="tableblock halign-left valign-top"><strong>URL</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two Sigma: Using News to Predict Stock Movements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ニュースデータを用いた株価の予測</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.kaggle.com/c/two-sigma-financial-news" class="bare">https://www.kaggle.com/c/two-sigma-financial-news</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fintech Data Championship</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日本株式のポートフォリオで次の1カ月後に、最も上昇する組み合わせを検討</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://compass.labbase.jp/articles/296" class="bare">https://compass.labbase.jp/articles/296</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Algorithmic Trading Challenge　</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">投資戦略に関する収益率・取引高等のデータから、各戦略への資金の割り当ての重みを最適化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://signate.jp/competitions/146" class="bare">https://signate.jp/competitions/146</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">大手ヘッジファンドX: 金融モデリングチャレンジ　</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">独自に導出した様々な特徴量から将来の動きを予想</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://signate.jp/competitions/53" class="bare">https://signate.jp/competitions/53</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">財務・非財務情報を活用した株主価値予測　</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会計年度2014-2017年の各企業の財務・非財務情報から、会計年度2018年の期末時価総額を予測</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nishika.com/competitions/4/summary" class="bare">https://www.nishika.com/competitions/4/summary</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Winton Stock Market Challenge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">過去の株価とマスクされた特徴量から将来の株価を予想</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.kaggle.com/c/the-winton-stock-market-challenge" class="bare">https://www.kaggle.com/c/the-winton-stock-market-challenge</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numerai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マスクされた銘柄・特徴量から週次で予測結果を提出</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://numer.ai/" class="bare">https://numer.ai/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quantconnect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">条件を満たしたモデルでリターンを追求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.quantconnect.com/competitions" class="bare">https://www.quantconnect.com/competitions</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bloomberg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESG要素を効果的に投資判断に組み込んでいるかなどの評価</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.bloomberg.co.jp/company/stories/investment_contest_2020/" class="bare">https://www.bloomberg.co.jp/company/stories/investment_contest_2020/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jane Street Market Prediction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">株の取引戦略を採用するかどうかを予測</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.kaggle.com/c/jane-street-market-prediction/" class="bare">https://www.kaggle.com/c/jane-street-market-prediction/</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_ファンダメンタルズ分析の活用方法">4.6. ファンダメンタルズ分析の活用方法</h3>
<div class="paragraph">
<p>ファンダメンタルズ分析とは、企業の成長性、収益性、割安性、安定性、効率性などを分析し、投資判断などに活用する手法です。ここでは成長性、収益性、割安性、安定性、効率性の代表的な指標を紹介します。</p>
</div>
<div class="paragraph">
<p>（<strong>成長性</strong>）<br>
成長性とは、売上や利益の増加が継続しているかを指し、企業価値の増大に直結する指標です。本コンペのデータでは、純資産や営業利益の上昇率に着目することで、その銘柄の成長性を測ることが出来ます。営業利益の上昇率を計算する場合は、季節性を考慮し、前年同期比と比較することが多いです。</p>
</div>
<div class="paragraph">
<p>また、年間を通して同一の指標で評価を行いたいときは、直近の四半期のデータで移動平均などを取る方法があります。成長性について利用される様々な指標として売上高増加率、営業利益増加率、経常利益増加率、総資本増加率、純資本増加率、従業員増加率、一株当たり当期純利益（EPS）(成長性分析で企業の成長度を測る 知っておくべき指標や分析方法 より引用 <a href="https://keiei.freee.co.jp/articles/c0201686" class="bare">https://keiei.freee.co.jp/articles/c0201686</a> )などがあります。</p>
</div>
<div class="paragraph">
<p>なお、過去の成長性を解析することはできますが、その成長性が長期間に渡って継続するかを予測することは、様々な要因が関係するため難しい問題です。また、株価そのものではなく成長性自体をモデルの予測対象にして、その予測に基づき投資を行うスタイルも存在します。</p>
</div>
<div class="paragraph">
<p>（<strong>収益性</strong>）<br>
収益性は、営業利益率や経常利益率等を指し、それぞれ営業利益、経常利益を売上高で割ることで計算されます。営業利益率や経常利益率が高い企業は優れたビジネスモデルを保持していたり、販管費を低く保つオペレーションが徹底されていたりすることが多く、優良企業を判断する上での指標となっています。そして、この収益性の変化率を成長性と扱うこともできます。</p>
</div>
<div class="paragraph">
<p>一般的に投資家が期待する収益性は、業種において大きく異なることに注意が必要です。<br>
例えば、様々ある業種のうち、情報通信と食品に期待される営業利益率は大きく異なることが想定されます。この場合、銘柄情報にはセクター情報が含まれているため、セクター平均の営業利益率を計算し、その差分を計算することで、セクター平均からの上振れや下振れを特徴量にすることができます。</p>
</div>
<div class="paragraph">
<p>（<strong>割安性</strong>）<br>
株式が割安であるとは、その企業の株価が企業価値と比較して安いということです。代表的な指標としてはPBRが挙げられます。この指標は、企業の純資産と発行済み株式数を割って、1株当たりの純資産を計算します。そして、現在の株価をこの1株当たりの純資産で割ってPBRを求めます。この指標が1を割っている場合は、その企業の本来の価値よりも安い値段で株を買えることになるので、割安であると考えることができます。PBRが高い銘柄をグロース銘柄、低い銘柄をバリュー銘柄として扱いそれぞれ異なる特性を持った銘柄として分析することもあり、企業の状態を知る上で重要な指標です。</p>
</div>
<div class="paragraph">
<p>現状の日本マーケットにおいては、PBRが1未満の銘柄が数多くあります(Yahooファイナンス 低PBRランキングより引用 <a href="https://info.finance.yahoo.co.jp/ranking/?kd=12" class="bare">https://info.finance.yahoo.co.jp/ranking/?kd=12</a> )。
これらの極めて割安な銘柄はディープバリュー株と呼ばれています。PBRが低い理由として以下のような理由も考えられますので、PBRをもって一概に割安銘柄とするのではなく、各企業のその他の決算情報を参照するなど、複数の情報を考慮することも重要です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>株式市場全体が調整局面にあるなどの理由により、企業実態より株価が売り込まれている。</p>
</li>
<li>
<p>含み損の実現や業績の悪化による純資産の減少を株価が先取りして織り込んで下落している。</p>
</li>
<li>
<p>不人気のため安値に放置されている。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>（<strong>安定性</strong>）<br>
安定性は、大型株や安定性が重視される金融・銀行のような特定のセクターで重視される指標です。安定性を計算する代表的な指標は「自己資本比率」です。<br>
「自己資本比率」は総資本における自己資本の割合を計算して得られます。自己資本比率が高ければ、自己資本が多い、つまり返済義務のないお金を潤沢に持っているということになるので「中長期的に見て倒産しにくい会社」ということができ、株式の中長期保有を行う上で倒産リスクを減らすための重要なチェックポイントとなっています。(自己資本比率｜会社経営の「安全性」をあらわす指標 より引用 <a href="https://advisors-freee.jp/article/category/cat-big-03/cat-small-08/9011/" class="bare">https://advisors-freee.jp/article/category/cat-big-03/cat-small-08/9011/</a> )</p>
</div>
<div class="paragraph">
<p>なお、以下の効率性に関する記載でも紹介しているROEでは、当期純利益と自己資本の割合を見ますが、自己資本が低い株はROEが高くなるので注意が必要です。つまり、借り入れを増やしリスクを取っている銘柄ではROEが高くなりやすく、安定性が低くなる可能性があります。また、小型株においては安定性よりも成長性を重視することもあるという点に注意が必要です。特定のセクターや特定の領域において重要視される指標をモデルに投入する場合、セクターの情報を特徴量として投入するなど、一緒に銘柄を分類できる情報をモデルに投入することで、それらの特性を学ばせることが可能です。</p>
</div>
<div class="paragraph">
<p>（<strong>効率性</strong>）<br>
効率性は、近年注目されているROEやROAから計算される指標です。<br>
ROEは、当期純利益 ÷ 自己資本 × 100として計算され、自己資本に対してどれだけの利益が生み出されたのかを示します。<br>
ROAは、借り入れなどを含む総資産を使ってどれだけ利益を生み出したかを表す指標です。<br>
ROEやROAは、効率性を示す指標として注目されており、政府が2017年に公表した成長戦略「未来投資戦略2017」において、「《KPI》大企業（TOPIX500）の ROA について、2025 年までに欧米企業に遜色のない水準を目指す。」(未来投資戦略2017 より引用 <a href="https://www.kantei.go.jp/jp/singi/keizaisaisei/pdf/miraitousi2017_sisaku.pdf" class="bare">https://www.kantei.go.jp/jp/singi/keizaisaisei/pdf/miraitousi2017_sisaku.pdf</a> )というKPIが設定され注目を浴びています。</p>
</div>
<div class="paragraph">
<p>ROEが高い銘柄ほど効率性が高いと考えることができ、企業価値を高めるための施策としてROEの向上、または維持を目標とする企業が多く、ROE重視の流れの背景は「投資指標としての ROE」(<a href="https://www.tr.mufg.jp/houjin/jutaku/pdf/u201503_1.pdf" class="bare">https://www.tr.mufg.jp/houjin/jutaku/pdf/u201503_1.pdf</a>) で詳しく解説されています。</p>
</div>
<div class="paragraph">
<p>上記のファンダメンタル情報は、本コンペティションで提供されるデータで計算可能ですので、様々なファンダメンタル情報を勉強することは、特徴量設計の次の一歩に繋がるでしょう。</p>
</div>
</div>
<div class="sect2">
<h3 id="_テクニカル分析の活用方法">4.7. テクニカル分析の活用方法</h3>
<div class="paragraph">
<p>テクニカル分析は、将来の株価の変化を過去に発生した価格や出来高等の時系列パターンから予想・分析しようとする手法であり、メジャーな分析手法の一つです。テクニカル分析にはトレンド分析、オシレーター分析、フォーメーション分析、ローソク足分析(テクニカル指標一覧より引用 <a href="https://info.monex.co.jp/technical-analysis/indicators/" class="bare">https://info.monex.co.jp/technical-analysis/indicators/</a> )があり、2章においてもオシレーターの代表的な分析手法の一つである「移動平均乖離率」を特徴量の一つとして採用しています。</p>
</div>
<div class="paragraph">
<p>ここでは、テクニカル分析を更に活用するための注意事項を説明します。テクニカル分析を特徴量として採用する場合、テクニカル分析により得た新規の情報がすでに投入済みの特徴量と比較して、どの程度新しい情報を保持しているか、という観点から考えることが重要です。</p>
</div>
<div class="paragraph">
<p>例えば、移動平均と移動平均乖離率は、それぞれ似たような情報を保持していることが容易に想像がつきます。これらの情報を特徴量として考えた場合、「20日移動平均乖離率」の方が0平均となるため、定常性を仮定することができ、扱いやすいことから移動平均乖離率を2章では採用しています。<br>
ストキャスティクス(詳細は <a href="https://info.monex.co.jp/technical-analysis/indicators/006.html" class="bare">https://info.monex.co.jp/technical-analysis/indicators/006.html</a> を参照)やRSI(詳細は <a href="https://info.monex.co.jp/technical-analysis/indicators/005.html" class="bare">https://info.monex.co.jp/technical-analysis/indicators/005.html</a> を参照)のようなオシレーター系の分析も、似通った情報を保持していることが推測できます。</p>
</div>
<div class="paragraph">
<p>機械学習のモデル構築において、若干のパラメータを変更したテクニカル分析を複数個特徴量として投入することは、ほとんどの場合良い結果に結びつきません。これは、パラメータ違いのテクニカル分析や同一種類のテクニカル分析は、ほぼ同一の情報を保持していることが多く、複数個特徴量を投入したとしても、パフォーマンスが向上する程の新規の情報を発見することが難しいためです。また、時系列解析はサンプル数が限られていることが多く、特徴量の種類を多くすると学習に必要な十分なデータ量を確保できないため、むやみに特徴量を増やすべきではなく、特徴量自体にパフォーマンス向上に結びつく新しい情報が含まれていることを重視しましょう。</p>
</div>
<div class="paragraph">
<p>例えば、2章にあるような移動平均乖離率と標準偏差の組み合わせは、お互いに直近時系列に対してトレンドとボラティリティという異なる情報を保持しているため、パフォーマンス向上に期待が持てます。テクニカル分析は順張り系、逆張り系のような系統でくくることができる(第1回 数多くあるテクニカル指標を体系的に解説より引用 <a href="https://kabu.com/investment/guide/technical/01.html" class="bare">https://kabu.com/investment/guide/technical/01.html</a> )ので、それらの系統の中から選択したり、異なる系統として時間時系列に対して依存しない手法、例えば、過去の高値圏にどれだけ近づいているかを計算するような方法なども考えられます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_ファクター分析の活用方法">4.8. ファクター分析の活用方法</h3>
<div class="paragraph">
<p>ファクター分析とは、投資が産み出すリターンを説明するファクターを定義し、そのファクターの挙動から分析を行う手法です。</p>
</div>
<div class="paragraph">
<p>例えば、ファーマ-フレンチの3ファクターモデルでは、株式投資が産み出すリターンをリスクプレミアム、時価総額リスクファクター、簿価時価比率リスクファクターの3要素に分解してます。(Wikipedia ファーマ-フレンチの3ファクターモデルより引用 <a href="https://ja.wikipedia.org/wiki/%E3%83%95%E3%82%A1%E3%83%BC%E3%83%9E-%E3%83%95%E3%83%AC%E3%83%B3%E3%83%81%E3%81%AE3%E3%83%95%E3%82%A1%E3%82%AF%E3%82%BF%E3%83%BC%E3%83%A2%E3%83%87%E3%83%AB" class="bare">https://ja.wikipedia.org/wiki/%E3%83%95%E3%82%A1%E3%83%BC%E3%83%9E-%E3%83%95%E3%83%AC%E3%83%B3%E3%83%81%E3%81%AE3%E3%83%95%E3%82%A1%E3%82%AF%E3%82%BF%E3%83%BC%E3%83%A2%E3%83%87%E3%83%AB</a> )</p>
</div>
<div class="paragraph">
<p>株式投資におけるファクター分析を知っておくことは、どのような特徴量を設計するかという考察を行うために役立ちます。</p>
</div>
<div class="paragraph">
<p>例えば、主要なファクターである時価総額について考えてみましょう。本コンペで利用できるデータを利用し、株価と発行済株式数から各銘柄の時価総額を計算することができます。一般的にマーケットは小型株が優位なときもあれば、大型株が優位なときもあるため、どちらに投資するべきかを簡単に決めることはできません。しかし、この時価総額が株価のリターンの説明要因の一つであるということを知っていれば、少なくとも特徴量に追加することで何らかの学習を行える可能性があるのではと考える事ができます。時価総額が入力データに含まれていない場合、モデルは時価総額ファクターに関連した相場変動を理解することが難しくなりますので、特徴量として投入したほうが良さそうだということが推測されます。</p>
</div>
<div class="paragraph">
<p>また、近年新たな投資手法として現れたスマートベータ投資も、このファクター分析を利用したアプローチの一つであり、ファクター分析は新しい投資手法を考える上で、基礎知識の一つになっています。スマートベータ投資とは、特定のファクターをベンチマークとして制御する手法です。具体的には、高配当、バリュー、低リスク、最小分散、クオリティ、モメンタム、及びこれらの組み合わせ等が、ベンチマークとして制御するファクターの候補となっています(スマートベータとリターン特性についてより引用 <a href="https://www.mizuho-ir.co.jp/publication/report/2020/fe36.html" class="bare">https://www.mizuho-ir.co.jp/publication/report/2020/fe36.html</a> )。</p>
</div>
<div class="paragraph">
<p>ファクター分析で扱われているファクターは、リターンの要因として定義され、株価にも何らかの影響力があると考えられたものです。様々なファクターについて勉強することが、特徴量設計の次の一歩に繋がるでしょう。</p>
</div>
</div>
<div class="sect2">
<h3 id="_複数個のモデルの出力をアンサンブルするアプローチ">4.9. 複数個のモデルの出力をアンサンブルするアプローチ</h3>
<div class="paragraph">
<p>アンサンブルの活用について説明します。機械学習における「アンサンブル」とは、複数のモデルを組み合わせることでパフォーマンスの高いモデルを作成する手法を意味します。アンサンブルに使うモデルは多様性があればある程基本的には好ましく、多様性のあるモデルを作り、最終的にアンサンブルすることで、単一モデルでは達成できないパフォーマンスを最終的に達成する可能性があります。</p>
</div>
<div class="paragraph">
<p>アンサンブルには、シンプルに複数のモデルの出力の平均を取るモデル平均法、scikit-learnライブラリのStandardScaler( <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html" class="bare">https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html</a> )による標準化を実施して分布をある程度揃えてから足し合わせる方法などがあります。また、より高度な手法であるスタッキングもscikit-learnライブラリにはStackingClassifer/StackingRegressorがあるため容易に実施(スタッキングで分類・回帰 (scikit-learn) より引用 <a href="https://qiita.com/maskot1977/items/de7383898123fa378d86" class="bare">https://qiita.com/maskot1977/items/de7383898123fa378d86</a> )することが可能です。kaggleで活用されている様々なアンサンブルの方法がKAGGLE ENSEMBLING GUIDE( <a href="https://mlwave.com/kaggle-ensembling-guide/" class="bare">https://mlwave.com/kaggle-ensembling-guide/</a> )では紹介されており、英文ですが読む価値があります。</p>
</div>
<div class="paragraph">
<p>ここでは、時価総額に着目して学習の対象を分けて複数個のモデルを作るアプローチを考えてみます。一般的に時価総額が低い銘柄は、大きな値動きが発生しやすいことが知られています。これは市場の流動性に違いがあり、同一額の投資が発生しても、小型株のほうがよりインパクトが大きいためです。今回のコンペティションでは、全銘柄を予測対象としていますが、実際にモデルを作ると全銘柄の時価総額の下位の銘柄を学習対象から除外すると、よりモデルのパフォーマンスが高くなることがあります。これは時価総額が低い銘柄は、ランダム性がより高く、またファンダメンタルに従わないことが多いためです。</p>
</div>
<div class="paragraph">
<p>では、以下の2つのモデルをつくった場合を考えてみます。</p>
</div>
<div class="paragraph">
<p><strong>A</strong>: 全銘柄を対象に学習したモデル</p>
</div>
<div class="paragraph">
<p><strong>B</strong>: 時価総額の下位の銘柄を学習から除外した上で、パフォーマンスをチューニングしたモデル</p>
</div>
<div class="paragraph">
<p>この2つが異なることを学習したとした場合、Bのモデルの出力に対してStandardScalerによる標準化を実施し、Aのモデルの出力に足し合わせると、Bのモデルが学んだことをBの学習対象の銘柄に足し合わせることができます。Bの出力に対しては、StandardScalerによる標準化を実施しているため分布が0平均となっており、学習対象外の銘柄に対する影響も限定することができます。</p>
</div>
<div class="paragraph">
<p>異なる特性をもったデータを学習させることで、モデルが異なることを学び、結果的にモデル同士の出力の相関が低くなります。モデル間の出力の相関が低いもの同士をアンサンブルさせると、相関の高いもの同士をアンサンブルさせた時よりも、アンサンブルの効果は高く出ることが多いため、上記のように学習対象を変えることで複数のモデルを作り、アンサンブルを実施するようなアプローチは有用です。</p>
</div>
</div>
<div class="sect2">
<h3 id="_プライベート期間の性能の向上のために考慮すべきこと">4.10. プライベート期間の性能の向上のために考慮すべきこと</h3>
<div class="paragraph">
<p>金融時系列はサンプル数が少ないため、特徴量を大量に生成し、特徴量選択をすべてモデルに任せるアプローチを採用する場合、ライブ性能の劣化に注意する必要があります。特徴量をどんどん増やすと、訓練期間のパフォーマンスは伸びていても、評価期間のパフォーマンスの向上が止まることがあります。100種類のデータを使うモデルと10種類のデータを使うモデルが、同一の訓練期間で同一の精度を達成した場合、評価期間・ライブ期間では、少ないデータを使ったモデルの方が高い性能を期待できる可能性が高いことが、経験的にわかっています。これは、説明変数の取りうるパターンが多いと、未来で同じ現象を発生する確率が下がっていくためと考えられます。モデルの複雑さとデータへの適合度とのバランスを取るためには、オッカムの剃刀(Wikipedia オッカムの剃刀より引用 <a href="https://ja.wikipedia.org/wiki/%E3%82%AA%E3%83%83%E3%82%AB%E3%83%A0%E3%81%AE%E5%89%83%E5%88%80" class="bare">https://ja.wikipedia.org/wiki/%E3%82%AA%E3%83%83%E3%82%AB%E3%83%A0%E3%81%AE%E5%89%83%E5%88%80</a> ) のような発想が必要となります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_本コンペでは利用できないがモデルを将来的に発展させるために検討する価値のある外部データ">4.11. 本コンペでは利用できないが、モデルを将来的に発展させるために検討する価値のある外部データ</h3>
<div class="paragraph">
<p>日本株のデータ以外に特徴量設計に利用可能と思われるデータを紹介します。本コンペでは、あらかじめ定められたデータしか利用することはできませんが、今後手元で新たなモデルを作成するときの知識としてご活用下さい。</p>
</div>
<div class="paragraph">
<p><strong>為替データ</strong>: ドル円の値動きが株式市場に影響を与えていることはよく知られています。特に日本市場の株式は輸出関連銘柄が多いため、ドル円の値動きは直接収益に関連します。よって、為替データを説明変数に採用するアプローチも想定されます。為替データは、いくつかのFX会社がAPIを提供しています。</p>
</div>
<div class="paragraph">
<p><strong>金利データ</strong>: 金利データとは、例えば米国債10年金利のような各国の債券の金利を指します。一般的に、機関投資家は債券と株式の両方を投資対象とするため、債券市場の動きは株式市場に反映されます。こちらは、APIによるデータ習得は容易ではありませんが、そこまで数は多くないため、説明変数として利用することは難しくありません。</p>
</div>
<div class="paragraph">
<p><strong>米国株データ</strong>: Alpaca US( <a href="https://alpaca.markets/data" class="bare">https://alpaca.markets/data</a> )やIEX Cloud( <a href="https://iexcloud.io/" class="bare">https://iexcloud.io/</a> )など、様々な米国株の株価/ETFのデータを提供するサービスが存在します。日本株式のマーケットは、米国株式のマーケットクローズ後にオープンするため、米国市場が日本市場に与える影響を解析することで、様々な情報を分析することが可能です。</p>
</div>
<div class="paragraph">
<p>他にも政府が発表するGDPなどの各国の経済動向、金などのコモディティ市場も、密接に株式市場の長期トレンドの形成に関わっていますので、様々な外部データの利用を検討することで新たなモデルを作ることができる可能性があります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_モデルの再学習の運用について">4.12. モデルの再学習の運用について</h3>
<div class="paragraph">
<p>長期間に渡りモデルを運用しようとする場合、再学習の運用を考慮しておく必要があります。再学習の運用とは、例えば2019年までのデータを用いてモデルを学習し2020年で運用した場合、2020年末に2020年のデータを用いて再学習を行うといったようなことを指します。再学習を行うにあたっていくつか考慮しておくべきポイントを紹介します。</p>
</div>
<div class="sect3">
<h4 id="_再学習を行う必要があるほど新規のデータが存在するか">4.12.1. 再学習を行う必要があるほど新規のデータが存在するか</h4>
<div class="paragraph">
<p>再学習は、新規のデータが溜まった時に実施します。モデルにも依存しますが、モデルが挙動を変えるには、既存の学習に用いたデータ量と比較してある程度の量の新規データが存在しないと、再学習を実施してもモデルの挙動は変わりません。再学習する際に有用な新規データ量は一概には言えず、モデルによって変わります。毎日モデルをトレーニングするような運用も可能ですが、データ量が多少増えただけでは、ほぼ同じ挙動となる可能性が高いです。</p>
</div>
</div>
<div class="sect3">
<h4 id="_再学習を行うことでモデルの出力分布が変わらないか">4.12.2. 再学習を行うことでモデルの出力分布が変わらないか</h4>
<div class="paragraph">
<p>こちらは、システムで運用する場合に発生しやすい問題です。例えば、投資する際の購入タイミングを、モデルの出力が0.8以上といったしきい値を用いた実装をしていたとします。この際に再学習を行うことでモデルの出力が変わると、想像以上に購入したり、逆に購入を実施しなくなったりします。再学習を行った場合、直近数週間程度のデータは利用せずに、古いモデルと新しいモデルで出力を比較し、出力の分布が変わっていないことを確認するのが良いでしょう。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_google_colaboratoryの使用法">4.13. Google Colaboratoryの使用法</h3>
<div class="paragraph">
<p>Google Colaboratoryは、ブラウザから Python をノートブック形式で記述、実行できるサービスです。環境構築が不要となっており、本チュートリアルもGoogle Colaboratoryで実行することが可能となっています。また、時間等の制限はございますがGPUを利用できることや、ノートブックの共有が簡単にできることなど、多くの利点を備えています (<a href="https://colab.research.google.com/notebooks/intro.ipynb?hl=ja#">参考元</a>  )。</p>
</div>
<div class="sect3">
<h4 id="_colab_でノートブックが動作する時間は">4.13.1. <strong>Colab でノートブックが動作する時間は？</strong></h4>
<div class="paragraph">
<p>本チュートリアルをGoogle Colaboratoryで実行する際には時間制限にご注意ください。ノートブックは、インスタンスが起動された後 12 時間経過すると自動的にランタイムがリセットされ実行環境が初期化されます。また、ノートブックのアイドル状態が 90 分続くとタイムアウトし、こちらもランタイムがリセットされます。(詳細は<a href="https://research.google.com/colaboratory/faq.html#:~:text=How%20long%20can%20notebooks%20run,or%20based%20on%20your%20usage">Google ColaboratoryのQ&amp;A</a>をご参照ください。)。</p>
</div>
</div>
<div class="sect3">
<h4 id="_本コンペでgoogle_colaboratoryを使用するために">4.13.2. 本コンペでGoogle Colaboratoryを使用するために</h4>
<div class="paragraph">
<p>本コンペの2章のチュートリアルをGoogle Colaboratory上で動かすためには、まず以下の手順でGoogle Drive上にファイルを設置します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Google DriveのMy Driveに<code>JPX_competition</code>というフォルダーを作成します。</p>
</li>
<li>
<p>SIGNATEのコンペティションサイトよりダウンロードした各種データを1で作成したフォルダーにアップロードします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>次にGoogle Colaboratory上でチュートリアルのノートブックを展開します。ノートブックはGoogle Colaboratory上でも実行可能となっており、そのまま編集なしで実行できます。以下、具体的な方法を説明します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ノートブックをダウンロードします。 <a href="https://github.com/JapanExchangeGroup/J-Quants-Tutorial/blob/main/handson/Chapter02/20210121-chapter02-tutorial.ipynb">こちらのGithubリポジトリ</a>よりRawボタンを右クリックし、「リンク先を名前をつけて保存」を選択して先程作成した<code>JPX_competition</code>に保存してください。</p>
</li>
<li>
<p>Google Driveにアップロードした <code>20210121-chapter02-tutorial.ipynb</code> ファイルをダブルクリックして Google Colaboratory で開きます。</p>
</li>
<li>
<p>コンペティションデータをノートブックで読み込むために、Google Driveへマウントします。マウント方法については<a href="https://qiita.com/kado_u/items/45b76f9a6f920bf0f786">こちら</a>の記事をご参照ください。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_内国株の売買制度">4.14. 内国株の売買制度</h3>
<div class="paragraph">
<p>本節では、本コンペティションの題材となっている株式の売買制度について説明します。</p>
</div>
<div class="sect3">
<h4 id="_制限値幅">4.14.1. 制限値幅</h4>
<div class="paragraph">
<p>東京証券取引所では、一日の売買における値動きの幅を価格水準に応じて一定に制限しており、この値幅を <strong>制限値幅</strong> といいます。制限値幅は、前日の終値又は最終気配値段など（以下、「基準値段」と言います）を基準としており、その値幅の大きさは基準値段によって異なります。詳細は<a href="https://www.jpx.co.jp/equities/trading/domestic/06.html">こちら</a>をご参照ください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_呼値の単位">4.14.2. 呼値の単位</h4>
<div class="paragraph">
<p>内国株式の売買の注文をする際の値段の刻みことを <strong>呼値の単位</strong> といい、この呼値の単位は、売買の対象となる銘柄及びその値段の水準に応じて異なります。各値段の水準における詳細な呼値の単位については、<a href="https://www.jpx.co.jp/equities/trading/domestic/07.html">こちら</a>をご参照ください。なお、銘柄によっては呼値の単位は整数ではなく、小数点があるものもございますのでご留意ください。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_j_quantsapi">5. J-QuantsAPI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_概要">5.1. 概要</h3>
<div class="paragraph">
<p>この章では、各種データをダウンロードできるJ-QuantsAPIについてご紹介します。APIの詳細な仕様はこちら(<a href="https://jpx-jquants.com/apidoc.html" class="bare">https://jpx-jquants.com/apidoc.html</a> )をご確認ください。</p>
</div>
</div>
<div class="sect2">
<h3 id="_apiの利用">5.2. APIの利用</h3>
<div class="paragraph">
<p>APIを利用するには、SIGNATEでのコンペティションへのご登録( <a href="https://signate.jp/competitions/423" class="bare">https://signate.jp/competitions/423</a> )とJ-QuantsAPIの利用登録( <a href="https://jpx-jquants.com/" class="bare">https://jpx-jquants.com/</a> )が必要となります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_必要なパッケージのインポート">5.3. 必要なパッケージのインポート</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">import</span> <span class="include">os</span>
<span class="keyword">import</span> <span class="include">json</span>
<span class="keyword">import</span> <span class="include">requests</span>
<span class="keyword">import</span> <span class="include">base64</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>パッケージ名</strong></th>
<th class="tableblock halign-left valign-top"><strong>目的</strong>　</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">os</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ディレクトリ、ファイル操作のため</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">レスポンスの加工のため</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">APIのGETやPOSTを利用するため</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">base64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDnetのファイルダウンロードAPIでBase64形式で返ってくるデータをデコードするため</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_refresh_api">5.4. Refresh API</h3>
<div class="paragraph">
<p>はじめに、idTokenをリフレッシュするRefresh API("/refresh")をご紹介します。このAPIでは、J-Quantsのログイン後の画面でご確認いただくことができるrefreshTokenを使用します。</p>
</div>
<div class="paragraph">
<p>Refresh APIを使うためのサンプルコードは以下のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">call_refresh_api</span>(refreshtoken: <span class="predefined">str</span>):
    <span class="docstring"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
</span><span class="content">    idTokenをリフレッシュするメソッド。</span><span class="content">
</span><span class="content">
</span><span class="content">    Parameters</span><span class="content">
</span><span class="content">    ----------</span><span class="content">
</span><span class="content">    refreshtoken : str</span><span class="content">
</span><span class="content">        refreshtoken。ログイン後の画面からご確認いただけます。</span><span class="content">
</span><span class="content">
</span><span class="content">    Returns</span><span class="content">
</span><span class="content">    -------</span><span class="content">
</span><span class="content">    resjson : dict</span><span class="content">
</span><span class="content">        新しいidtokenが格納されたAPIレスポンス(json形式)</span><span class="content">
</span><span class="content">    </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    headers = {<span class="string"><span class="delimiter">&quot;</span><span class="content">accept</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>}
    data = {<span class="string"><span class="delimiter">&quot;</span><span class="content">refresh-token</span><span class="delimiter">&quot;</span></span>: refreshtoken}

    response = requests.post(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">https://api.jpx-jquants.com/refresh</span><span class="delimiter">&quot;</span></span>, headers=headers, data=json.dumps(data)
    )

    resjson = json.loads(response.text)
    <span class="keyword">return</span> resjson</code></pre>
</div>
</div>
<div class="paragraph">
<p>このAPIを使うことで新しいidtokenを払い出すことができます。使用例は以下の通りです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">refreshtoken = &lt;Your refreshtoken&gt;
call_refresh_api(refreshtoken)</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下のようなレスポンスが返ります。なお、idtokenの有効期限は１時間（3600sec）となっております。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">idToken</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Your New idtoken&gt;</span><span class="delimiter">&quot;</span></span>,
<span class="key"><span class="delimiter">&quot;</span><span class="content">expiresIn</span><span class="delimiter">&quot;</span></span>: <span class="integer">3600</span>}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_共通で使用するメソッド">5.5. 共通で使用するメソッド</h3>
<div class="paragraph">
<p>ここでは、API共通の関数を用意しております。</p>
</div>
<div class="paragraph">
<p>サンプルコードは以下の通りです。引数"apitype"に各APIを指定することで呼び出すことができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">d</span><span class="error">e</span><span class="error">f</span> <span class="error">c</span><span class="error">a</span><span class="error">l</span><span class="error">l</span><span class="error">_</span><span class="error">j</span><span class="error">q</span><span class="error">u</span><span class="error">a</span><span class="error">n</span><span class="error">t</span><span class="error">s</span><span class="error">_</span><span class="error">a</span><span class="error">p</span><span class="error">i</span><span class="error">(</span><span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span>: <span class="error">d</span><span class="error">i</span><span class="error">c</span><span class="error">t</span>, <span class="error">i</span><span class="error">d</span><span class="error">t</span><span class="error">o</span><span class="error">k</span><span class="error">e</span><span class="error">n</span>: <span class="error">s</span><span class="error">t</span><span class="error">r</span>, <span class="error">a</span><span class="error">p</span><span class="error">i</span><span class="error">t</span><span class="error">y</span><span class="error">p</span><span class="error">e</span>: <span class="error">s</span><span class="error">t</span><span class="error">r</span>, <span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span>: <span class="error">s</span><span class="error">t</span><span class="error">r</span> <span class="error">=</span> <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>:
    <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="string"><span class="delimiter">&quot;</span><span class="content">
    J-QuantsのAPIを試すメソッド。

    Parameters
    ----------
    params : dict
        リクエストパラメータ。
    idtoken : str
        idTokenはログイン後の画面からご確認いただけます。
    apitype: str
        APIの種類。</span><span class="delimiter">&quot;</span></span><span class="error">n</span><span class="error">e</span><span class="error">w</span><span class="error">s</span><span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span><span class="error">p</span><span class="error">r</span><span class="error">i</span><span class="error">c</span><span class="error">e</span><span class="error">s</span><span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span><span class="error">l</span><span class="error">i</span><span class="error">s</span><span class="error">t</span><span class="error">s</span><span class="string"><span class="delimiter">&quot;</span><span class="content">などがあります。
    code: str
        銘柄を指定するAPIの場合に設定します。

    Returns
    -------
    resjson : dict
        APIレスポンス(json形式)
    </span><span class="delimiter">&quot;</span></span><span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
    <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">e</span><span class="error">f</span><span class="error">r</span><span class="error">o</span><span class="error">m</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">datefrom</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">e</span><span class="error">t</span><span class="error">o</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">dateto</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">e</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">i</span><span class="error">n</span><span class="error">c</span><span class="error">l</span><span class="error">u</span><span class="error">d</span><span class="error">e</span><span class="error">d</span><span class="error">e</span><span class="error">t</span><span class="error">a</span><span class="error">i</span><span class="error">l</span><span class="error">s</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="error">)</span>
    <span class="error">k</span><span class="error">e</span><span class="error">y</span><span class="error">w</span><span class="error">o</span><span class="error">r</span><span class="error">d</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">keyword</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">l</span><span class="error">i</span><span class="error">n</span><span class="error">e</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">n</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">t</span><span class="error">o</span><span class="error">k</span><span class="error">e</span><span class="error">n</span> <span class="error">=</span> <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span><span class="string"><span class="delimiter">&quot;</span><span class="content">nexttoken</span><span class="delimiter">&quot;</span></span>, <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">)</span>
    <span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">e</span><span class="error">r</span><span class="error">s</span> <span class="error">=</span> {<span class="key"><span class="delimiter">&quot;</span><span class="content">accept</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">Authorization</span><span class="delimiter">&quot;</span></span>: <span class="error">i</span><span class="error">d</span><span class="error">t</span><span class="error">o</span><span class="error">k</span><span class="error">e</span><span class="error">n</span>}
    <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">a</span> <span class="error">=</span> {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>: <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">e</span><span class="error">f</span><span class="error">r</span><span class="error">o</span><span class="error">m</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>: <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">e</span><span class="error">t</span><span class="error">o</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">includeDetails</span><span class="delimiter">&quot;</span></span>: <span class="error">i</span><span class="error">n</span><span class="error">c</span><span class="error">l</span><span class="error">u</span><span class="error">d</span><span class="error">e</span><span class="error">d</span><span class="error">e</span><span class="error">t</span><span class="error">a</span><span class="error">i</span><span class="error">l</span><span class="error">s</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">nexttoken</span><span class="delimiter">&quot;</span></span>: <span class="error">n</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">t</span><span class="error">o</span><span class="error">k</span><span class="error">e</span><span class="error">n</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>: <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">e</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">keyword</span><span class="delimiter">&quot;</span></span>: <span class="error">k</span><span class="error">e</span><span class="error">y</span><span class="error">w</span><span class="error">o</span><span class="error">r</span><span class="error">d</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>: <span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">l</span><span class="error">i</span><span class="error">n</span><span class="error">e</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>: <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span>,
    }

    <span class="error">i</span><span class="error">f</span> <span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span>:
        <span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span> <span class="error">=</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> <span class="error">+</span> <span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span>
        <span class="error">r</span> <span class="error">=</span> <span class="error">r</span><span class="error">e</span><span class="error">q</span><span class="error">u</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span>
            <span class="string"><span class="delimiter">&quot;</span><span class="content">https://api.jpx-jquants.com/</span><span class="delimiter">&quot;</span></span> <span class="error">+</span> <span class="error">a</span><span class="error">p</span><span class="error">i</span><span class="error">t</span><span class="error">y</span><span class="error">p</span><span class="error">e</span> <span class="error">+</span> <span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">e</span>,
            <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">=</span><span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">a</span>,
            <span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">=</span><span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">e</span><span class="error">r</span><span class="error">s</span>,
        <span class="error">)</span>
    <span class="error">e</span><span class="error">l</span><span class="error">s</span><span class="error">e</span>:
        <span class="error">r</span> <span class="error">=</span> <span class="error">r</span><span class="error">e</span><span class="error">q</span><span class="error">u</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">s</span><span class="error">.</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">(</span>
            <span class="string"><span class="delimiter">&quot;</span><span class="content">https://api.jpx-jquants.com/</span><span class="delimiter">&quot;</span></span> <span class="error">+</span> <span class="error">a</span><span class="error">p</span><span class="error">i</span><span class="error">t</span><span class="error">y</span><span class="error">p</span><span class="error">e</span>, <span class="error">p</span><span class="error">a</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">s</span><span class="error">=</span><span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">a</span>, <span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">=</span><span class="error">h</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">e</span><span class="error">r</span><span class="error">s</span>
        <span class="error">)</span>
    <span class="error">r</span><span class="error">e</span><span class="error">s</span><span class="error">j</span><span class="error">s</span><span class="error">o</span><span class="error">n</span> <span class="error">=</span> <span class="error">j</span><span class="error">s</span><span class="error">o</span><span class="error">n</span><span class="error">.</span><span class="error">l</span><span class="error">o</span><span class="error">a</span><span class="error">d</span><span class="error">s</span><span class="error">(</span><span class="error">r</span><span class="error">.</span><span class="error">t</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">)</span>
    <span class="error">r</span><span class="error">e</span><span class="error">t</span><span class="error">u</span><span class="error">r</span><span class="error">n</span> <span class="error">r</span><span class="error">e</span><span class="error">s</span><span class="error">j</span><span class="error">s</span><span class="error">o</span><span class="error">n</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stock_lists_api">5.6. Stock Lists API</h3>
<div class="paragraph">
<p>銘柄一覧を取得するAPIについて紹介いたします。</p>
</div>
<div class="paragraph">
<p>このAPIでは、企業名や業種区分などの基本情報を取得することができます。全銘柄の一覧を取得する"/lists"と銘柄コードを指定した"/lists/{code}"が利用できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">idtk=&lt;your idtoken&gt;
<span class="comment"># Codeを指定しない場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">lists</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># Codeを指定する場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">lists</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>レスポンスは以下のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>: [{<span class="key"><span class="delimiter">&quot;</span><span class="content">33 Sector(name)</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Other Financing Business</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Effective Date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">20201230</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">prediction_target</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Section/Products</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">First Section (Domestic)</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">33 Sector(Code)</span><span class="delimiter">&quot;</span></span>: <span class="float">7200.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Name (English)</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Japan Exchange Group,Inc.</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">IssuedShareEquityQuote IssuedShare</span><span class="delimiter">&quot;</span></span>: <span class="float">536351448.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>}]}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prices_api">5.7. Prices API</h3>
<div class="paragraph">
<p>株価情報を取得するPrice APIをご紹介します。</p>
</div>
<div class="paragraph">
<p>検索期間や銘柄コードを指定することで、四本値、売買高、前日比変化率などを取得することができます。銘柄コードを指定する場合は"/prices/{code}"でAPIをご利用ください。"includeDetails"をTrueにした場合は、全てのデータ系列を取得します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">idtk=&lt;your idtoken&gt;
<span class="comment"># Codeを指定しない場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-12-30</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">prices</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># Codeを指定する場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">datefrom</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-17</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">dateto</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-31</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">prices</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>レスポンスのサンプルは以下の通りです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">prices</span><span class="delimiter">&quot;</span></span>: [{<span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Open</span><span class="delimiter">&quot;</span></span>: <span class="float">2005.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousClose</span><span class="delimiter">&quot;</span></span>: <span class="float">1972.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote CumulativeAdjustmentFactor</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote VWAP</span><span class="delimiter">&quot;</span></span>: <span class="float">1994.792</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Low</span><span class="delimiter">&quot;</span></span>: <span class="float">1989.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>: <span class="float">1972.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote High</span><span class="delimiter">&quot;</span></span>: <span class="float">2008.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/20</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Close</span><span class="delimiter">&quot;</span></span>: <span class="float">1990.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousExchangeOfficialCloseDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/17</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>: <span class="float">1990.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ChangeFromPreviousClose</span><span class="delimiter">&quot;</span></span>: <span class="float">18.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PercentChangeFromPreviousClose</span><span class="delimiter">&quot;</span></span>: <span class="float">0.913</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousCloseDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/17</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Volume</span><span class="delimiter">&quot;</span></span>: <span class="float">528600.0</span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Open</span><span class="delimiter">&quot;</span></span>: <span class="float">1989.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousClose</span><span class="delimiter">&quot;</span></span>: <span class="float">1990.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote CumulativeAdjustmentFactor</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote VWAP</span><span class="delimiter">&quot;</span></span>: <span class="float">1976.539</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Low</span><span class="delimiter">&quot;</span></span>: <span class="float">1965.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>: <span class="float">1990.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote High</span><span class="delimiter">&quot;</span></span>: <span class="float">1995.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/21</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Close</span><span class="delimiter">&quot;</span></span>: <span class="float">1977.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousExchangeOfficialCloseDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/20</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ExchangeOfficialClose</span><span class="delimiter">&quot;</span></span>: <span class="float">1977.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote ChangeFromPreviousClose</span><span class="delimiter">&quot;</span></span>: <span class="float">-13.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PercentChangeFromPreviousClose</span><span class="delimiter">&quot;</span></span>: <span class="float">-0.653</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote PreviousCloseDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/20</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">EndOfDayQuote Volume</span><span class="delimiter">&quot;</span></span>: <span class="float">571000.0</span>},
    <span class="error">.</span><span class="error">.</span><span class="error">.</span>]}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stock_fins_api">5.8. Stock Fins API</h3>
<div class="paragraph">
<p>各銘柄の財務諸表データを取得するAPIをご紹介します。</p>
</div>
<div class="paragraph">
<p>特定の日の全銘柄の情報を取得する"/stockfins"と１銘柄の情報を取得する"/stockfins/{code}"がございます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">idtk=&lt;your idtoken&gt;
<span class="comment"># Codeを指定しない場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-12-30</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">stockfins</span><span class="delimiter">&quot;</span></span>)


<span class="comment"># Codeを指定する場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">datefrom</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-01</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">dateto</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-12-30</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">True</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">stockfins</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>レスポンスは以下のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">stockfin</span><span class="delimiter">&quot;</span></span>: [{<span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement TotalAssets</span><span class="delimiter">&quot;</span></span>: <span class="float">56671198.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">base_date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/01/30</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement FiscalPeriodEnd</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2019/12</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Q3</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OrdinaryIncome</span><span class="delimiter">&quot;</span></span>: <span class="float">48586.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromOperatingActivities</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetSales</span><span class="delimiter">&quot;</span></span>: <span class="float">87433.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromFinancingActivities</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromInvestingActivities</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement AccountingStandard</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ConsolidatedIFRS</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetIncome</span><span class="delimiter">&quot;</span></span>: <span class="float">33317.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OperatingIncome</span><span class="delimiter">&quot;</span></span>: <span class="float">48176.0</span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement TotalAssets</span><span class="delimiter">&quot;</span></span>: <span class="float">56671198.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">base_date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020/03/23</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement FiscalPeriodEnd</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2019/12</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement ReportType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Q3</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OrdinaryIncome</span><span class="delimiter">&quot;</span></span>: <span class="float">48586.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromOperatingActivities</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetSales</span><span class="delimiter">&quot;</span></span>: <span class="float">87433.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromFinancingActivities</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement CashFlowsFromInvestingActivities</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement AccountingStandard</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ConsolidatedIFRS</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement NetIncome</span><span class="delimiter">&quot;</span></span>: <span class="float">33317.0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Result_FinancialStatement OperatingIncome</span><span class="delimiter">&quot;</span></span>: <span class="float">48176.0</span>}]}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stock_labels_api">5.9. Stock Labels API</h3>
<div class="paragraph">
<p>基準日から5日、10日、20日の株価の最大上昇率、最大下落率を取得するAPIをご紹介します。</p>
</div>
<div class="paragraph">
<p>Stock Labels APIは期間や銘柄コードを指定することで該当する株価騰落率のデータを取得できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># Codeを指定しない場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2018-05-31</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">stocklabels</span><span class="delimiter">&quot;</span></span>)

<span class="comment"># Codeを指定する場合</span>
paramdict = {}
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">datefrom</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-01</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">dateto</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-28</span><span class="delimiter">&quot;</span></span>
paramdict[<span class="string"><span class="delimiter">&quot;</span><span class="content">includedetails</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
call_jquants_api(paramdict, idtk, <span class="string"><span class="delimiter">&quot;</span><span class="content">stocklabels</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1301</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>レスポンスのサンプルは以下の通りです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">labels</span><span class="delimiter">&quot;</span></span>: [{<span class="key"><span class="delimiter">&quot;</span><span class="content">label_low_10</span><span class="delimiter">&quot;</span></span>: <span class="float">-0.01748</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_low_20</span><span class="delimiter">&quot;</span></span>: <span class="float">-0.10699</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_low_5</span><span class="delimiter">&quot;</span></span>: <span class="float">0.0021</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>: <span class="float">0.02203</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">base_date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-04</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_high_10</span><span class="delimiter">&quot;</span></span>: <span class="float">0.02203</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_date_5</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-12</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_date_10</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-19</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_high_5</span><span class="delimiter">&quot;</span></span>: <span class="float">0.02203</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_date_20</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-03-05</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1301</span><span class="delimiter">&quot;</span></span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">label_low_10</span><span class="delimiter">&quot;</span></span>: <span class="float">-0.02507</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_low_20</span><span class="delimiter">&quot;</span></span>: <span class="float">-0.11072</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_low_5</span><span class="delimiter">&quot;</span></span>: <span class="float">-0.00557</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_high_20</span><span class="delimiter">&quot;</span></span>: <span class="float">0.01776</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">base_date</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-05</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_high_10</span><span class="delimiter">&quot;</span></span>: <span class="float">0.01776</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_date_5</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-13</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_date_10</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-20</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_high_5</span><span class="delimiter">&quot;</span></span>: <span class="float">0.01776</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label_date_20</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-03-06</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Local Code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1301</span><span class="delimiter">&quot;</span></span>}],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">scrollId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">eyJMb2NhbCBDb2RlIjogIjEzMDEiLCAiYmFzZV9kYXRlIjogIjIwMjAtMDItMDUifQ==</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_news_api">5.10. News API</h3>
<div class="paragraph">
<p>日経新聞の記事情報を取得するAPIはまだ公開しておりません。</p>
</div>
<div class="paragraph">
<p>レスポンスのサンプルは以下の通りになる予定です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">news</span><span class="delimiter">&quot;</span></span>: [{<span class="key"><span class="delimiter">&quot;</span><span class="content">article_id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TDSKDBDGXLASFL21HM9_21022020000000</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">publish_datetime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-02-21T16:34:00Z</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">media_code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TNY</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">media_name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">日本経済新聞電子版</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">men_name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">日本取引所ＣＥＯ、東商取のエネルギー市場「早期に統合したい」</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">keywords</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">最高経営責任者</span><span class="char">\n</span><span class="content">東京商品取引所</span><span class="char">\n</span><span class="content">日本取引所グループ</span><span class="char">\n</span><span class="content">清田瞭</span><span class="char">\n</span><span class="content">エネルギー市場</span><span class="char">\n</span><span class="content">大阪取引所</span><span class="char">\n</span><span class="content">統合</span><span class="char">\n</span><span class="content">定例</span><span class="char">\n</span><span class="content">早期</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">classifications</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Ｔ８６９７</span><span class="char">\n</span><span class="content">ＰＤ５２１</span><span class="char">\n</span><span class="content">Ｎ００４０４３１</span><span class="char">\n</span><span class="content">Ｎ００７５１０７</span><span class="char">\n</span><span class="content">Ｎ００４０７７９</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">stock_code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">8697</span><span class="delimiter">&quot;</span></span>}],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">scrollId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FGluY2x1ZGVfY29u</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tdnet_api">5.11. TDnet API</h3>
<div class="paragraph">
<p>適時開示を取得できるTDnetAPIはまだ公開しておりません。</p>
</div>
<div class="paragraph">
<p>レスポンスのサンプルは以下の通りになる予定です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">tdnet</span><span class="delimiter">&quot;</span></span>: [{<span class="key"><span class="delimiter">&quot;</span><span class="content">pdfSumaryFlag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">modifiedHistory</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ＪＰＸ</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">11384</span><span class="delimiter">&quot;</span></span>],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">86970</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosedDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-30</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-30:12:00:00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">handlingType</span><span class="delimiter">&quot;</span></span>: <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosedTime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">12:00:00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">pdfGeneralFlag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">20200129453073</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">xbrlFlag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020年３月期 第３四半期決算短信〔ＩＦＲＳ〕（連結） </span><span class="delimiter">&quot;</span></span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">pdfSumaryFlag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">modifiedHistory</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ＪＰＸ</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureItems</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">11804</span><span class="delimiter">&quot;</span></span>],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">86970</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosedDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-30</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2020-01-30:12:00:00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">handlingType</span><span class="delimiter">&quot;</span></span>: <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosedTime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">12:00:00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">pdfGeneralFlag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">disclosureNumber</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">20200129453074</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">xbrlFlag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Consolidated financial results for the nine months ended December 31, 2019</span><span class="delimiter">&quot;</span></span>},
    <span class="error">.</span><span class="error">.</span><span class="error">.</span>]}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_チュートリアル作成環境の参考文献">6. チュートリアル作成環境の参考文献</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本文書の執筆では次のプロダクトと技術資料が使われています。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="注記"></i>
</td>
<td class="content">
プロダクト名の隣にライセンスを併記しております。
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Template</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>AsciidoctorとGradleでつくる文書執筆環境 - MIT License -
<a href="https://h1romas4.github.io/asciidoctor-gradle-template/index.html" class="bare">https://h1romas4.github.io/asciidoctor-gradle-template/index.html</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Font</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>源真ゴシック - SIL Open Font License 1.1  - <a href="http://jikasei.me/font/genshin/" class="bare">http://jikasei.me/font/genshin/</a></p>
</li>
<li>
<p>源様明朝 - SIL Open Font License 1.1 - <a href="https://github.com/ButTaiwan/genyo-font" class="bare">https://github.com/ButTaiwan/genyo-font</a></p>
</li>
<li>
<p>Ricty Diminished - SIL Open Font License 1.1 - <a href="https://github.com/edihbrandon/RictyDiminished" class="bare">https://github.com/edihbrandon/RictyDiminished</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Asciidoc</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Asciidoctor - MIT License - <a href="https://asciidoctor.org/" class="bare">https://asciidoctor.org/</a></p>
</li>
<li>
<p>Asciidoctorj - Apache License 2.0 - <a href="https://github.com/asciidoctor/asciidoctorj" class="bare">https://github.com/asciidoctor/asciidoctorj</a></p>
</li>
<li>
<p>Asciidoctor.js - MIT License - <a href="https://asciidoctor.org/docs/asciidoctor.js/" class="bare">https://asciidoctor.org/docs/asciidoctor.js/</a></p>
</li>
<li>
<p>Asciidoctor PDF - MIT License - <a href="https://asciidoctor.org/docs/asciidoctor-pdf/" class="bare">https://asciidoctor.org/docs/asciidoctor-pdf/</a></p>
</li>
<li>
<p>Asciidoctor Gradle Plugin Suite - Apache License 2.0 - <a href="https://github.com/asciidoctor/asciidoctor-gradle-plugin" class="bare">https://github.com/asciidoctor/asciidoctor-gradle-plugin</a></p>
</li>
<li>
<p>asciidoctor-pdf-linewrap-ja - MIT License - <a href="https://github.com/fuka/asciidoctor-pdf-linewrap-ja" class="bare">https://github.com/fuka/asciidoctor-pdf-linewrap-ja</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Build Tool</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>SDKMAN - Apache License 2.0 - <a href="https://sdkman.io/" class="bare">https://sdkman.io/</a></p>
</li>
<li>
<p>Gradle - Apache License 2.0 - <a href="https://gradle.org/" class="bare">https://gradle.org/</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Text Editor</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Visual Studio Code - Microsoft - <a href="https://code.visualstudio.com/" class="bare">https://code.visualstudio.com/</a></p>
</li>
<li>
<p>asciidoctor-vscode - MIT License - <a href="https://github.com/asciidoctor/asciidoctor-vscode" class="bare">https://github.com/asciidoctor/asciidoctor-vscode</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Guide</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>asciidoctor-pdfでかっこいいPDFを作る - <a href="https://qiita.com/kuboaki/items/67774c5ebd41467b83e2" class="bare">https://qiita.com/kuboaki/items/67774c5ebd41467b83e2</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">OGP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Socialify - <a href="https://github.com/wei/socialify" class="bare">https://github.com/wei/socialify</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="_商標">6.1. 商標</h3>
<div class="ulist">
<ul>
<li>
<p>Windows、PowerShellは、Microsoft Corporation の登録商標または商標です。</p>
</li>
<li>
<p>Docker は、Docker Inc.の登録商標または商標です。</p>
</li>
<li>
<p>CoLaboratory™ は、Google Inc. の登録商標または商標です。</p>
</li>
<li>
<p>GitHub は、GitHub Inc.の登録商標または商標です</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ライセンス">7. ライセンス</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本チュートリアルおよびハンズオンのソースコードは <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a> に従うライセンスで公開しています。</p>
</div>
<div class="paragraph">
<p>教育など非商用の目的での本チュートリアルの使用や再配布は自由に行うことが可能です。
商用目的で本チュートリアルの全体またはその一部を無断で転載する行為は，これを固く禁じます。</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="ChapterLicence/images/cc_by_nc_nd.png" alt="cc_by_nc_nd.png" width="400">
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
最終更新 2021-02-26 17:52:58 +0900
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "AMS" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>